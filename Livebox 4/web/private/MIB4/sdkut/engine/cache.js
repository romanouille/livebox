define(["utils/basics"],function(basicUtilities){"use strict";function CacheProvider(useLocalStorageIfAvailable){this.useLocalStorage="undefined"===typeof useLocalStorageIfAvailable?true:useLocalStorageIfAvailable}try{CacheProvider.hasLocalStorage=typeof window.localStorage!=="undefined";CacheProvider.hasAsyncStorage=false}catch(ex){CacheProvider.hasLocalStorage=false}if(CacheProvider.hasLocalStorage){if(Storage!==null){Storage.prototype.setObject=function(key,value){this.setItem(key,JSON.stringify(value))};Storage.prototype.getObject=function(key){return JSON.parse(this.getItem(key))}}else{localStorage.setObject=localStorage.setItem;localStorage.getObject=localStorage.getItem}}CacheProvider.prototype={get:function(k){var kName,v,isObject,action;kName="cacheProvider_"+k;if(this.useLocalStorage&&CacheProvider.hasLocalStorage){isObject=localStorage.getItem(kName+"___isObject");action=isObject?"getObject":"getItem";return localStorage[action](kName)||undefined}v=basicUtilities.getCookie(kName);return v?JSON.parse(v):undefined},set:function(k,v,aCallback){var kName;kName="cacheProvider_"+k;if(this.useLocalStorage&&CacheProvider.hasLocalStorage){if(CacheProvider.hasAsyncStorage&&aCallback){window.document.addEventListener("onstoragecommit",aCallback,false)}if(typeof v!=="string"){localStorage.setObject(kName,v);localStorage.setItem(kName+"___isObject",true)}else{try{localStorage.setItem(kName,v)}catch(ex){if(ex.name==="QUOTA_EXCEEDED_ERR"){throw new Exception(v)}}}if(!CacheProvider.hasAsyncStorage){basicUtilities.callback(aCallback,false,0)}}else{basicUtilities.setCookie(kName,JSON.stringify(v));basicUtilities.callback(aCallback,false,0)}return v},clear:function(k){var kName;kName="cacheProvider_"+k;if(this.useLocalStorage&&CacheProvider.hasLocalStorage){localStorage.removeItem(kName);localStorage.removeItem(kName+"___isObject")}else{basicUtilities.deleteCookie(kName)}},clearAll:function(){var key,cookies,cookie,i,eqPos,cookieName;if(this.useLocalStorage&&CacheProvider.hasLocalStorage){for(key in localStorage){if(localStorage.hasOwnProperty(key)){if(key.indexOf("cacheProvider_")===0){localStorage.removeItem(key)}}}return true}cookies=window.document.cookie.split(";");for(i=0;i<cookies.length;i+=1){cookie=cookies[i];eqPos=cookie.indexOf("=");cookieName=eqPos>-1?cookie.substr(0,eqPos):cookie;if(cookieName.indexOf("cacheProvider_")===0){window.document.cookie=cookieName+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}return true}};return new CacheProvider});