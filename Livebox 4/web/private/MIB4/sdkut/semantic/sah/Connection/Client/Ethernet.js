define(["utils/console","utils/basics","engine/callStack"],function(console,basicUtilities,callStack){"use strict";return{getStatus:{name:"GetStatus",description:"This method gets details about the current ethernet status",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:null},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;this.fields.data={};if(callStack.hasCapability("hasConnectionManager")){callStack.push("api","com.softathome.ConnectionManager.Client.Ethernet.GetStatus","1",this)}else{callStack.push("api","com.softathome.Network.Common.GetEthernetStatus","2",this)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0){this.fields.data.maximumSpeed=aResult.data.maximum_speed;this.fields.data.duplexMode=aResult.data.duplex_mode}else{this.fields.data.maximumSpeed=-1;this.fields.data.duplexMode="";console.warn("No active ethernet connection detected")}break;case"2":if(aResult.status===0){if(aResult.data.result[1]!=="NULL"){this.fields.data.maximumSpeed=parseInt(aResult.data.result[1],10)}else{this.fields.data.maximumSpeed=-1}if(aResult.data.result[2]!=="NULL"){this.fields.data.duplexMode=aResult.data.result[2]}else{this.fields.data.duplexMode=""}}else{this.fields.data.maximumSpeed=-1;this.fields.data.duplexMode="";console.warn("No active ethernet connection detected")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},getConfiguration:{name:"Retrieves the current Configuration of the Ethernet connection",description:"This method returns the current Configuration of the Ethernet connection.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,output,eth;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={};this.fields.data.portList=[];this.fields.macAddress="";this.fields.ports=["eth1"];this.fields.mode={internet:"Internet",internetTV:"Internet & TV",off:"off",internetONT:"FTTH",tv:"TV"};this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;callStack.push("api","pcb.NeMo.getFirstParameter","1",this,"lan",{name:"LLAddress"})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){this.fields.macAddress=aResult.data;this.fields.mxStep+=1;callStack.push("api","pcb.NeMo.getPorts","2",this,"data",{mibs:"base eth"})}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=0}break;case"2":if(aResult.status===0||aResult.status===true){output=aResult.data;eth={};if(output.eth[this.fields.ports[0]]&&output.base[this.fields.ports[0]]){eth.portId=output.eth[this.fields.ports[0]].PhyId;eth.isEnabled=output.base[this.fields.ports[0]].Status;eth.usageMode=this.fields.mode.internetONT;eth.isConfigurationAutomatic=output.eth[this.fields.ports[0]].DuplexModeEnabled==="Auto"?true:false;eth.macAddress=this.fields.macAddress;eth.maximumSpeed=output.eth[this.fields.ports[0]].MaxBitRateSupported;eth.duplexMode=output.eth[this.fields.ports[0]].CurrentDuplexMode.toUpperCase();this.fields.data.portList.push(eth)}}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=0}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}}}});