define(["utils/console","utils/basics","engine/callStack"],function(console,basicUtilities,callStack){"use strict";return{isServerAvailable:{name:"isServerAvailable",description:"This method gets details about the current Pnp server",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;if(callStack.isOnHgw()){callStack.push("api","pcb.PnP.getPnPStatus","1",this)}else{callStack.push("api","com.softathome.ConnectionManager.Client.Common.GetConnectionState","1",this)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.data.Status==="Idle"||aResult.data.Status==="Running"||aResult.data.Status==="OK"||aResult.data.Status==="Timeout"){this.fields.data.isAvailable=true}else{this.fields.data.isAvailable=false;console.warn("No active Pnp connection detected")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){var result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},getUserParameters:{name:"getUserParameters",description:"This method gets details about the current Pnp User parameters",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;if(callStack.isOnHgw()){callStack.push("api","pcb.PnP.getPnPStatus","1",this)}else{callStack.push("api","com.softathome.ConnectionManager.Client.Common.GetConnectionState","1",this)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.data.Status==="Idle"||aResult.data.Status==="Running"||aResult.data.Status==="OK"||aResult.data.Status==="Timeout"){this.fields.data.lastName=aResult.data.LastName;this.fields.data.firstName=aResult.data.FirstName;this.fields.data.phoneNumber=aResult.data.MobilePhoneNumber}else{this.fields.data.lastName="";this.fields.data.firstName="";this.fields.data.phoneNumber=""}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){var result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},getStatus:{name:"getStatus",description:"This method gets the current Pnp state",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,states;states={Idle:"idle",Running:"running",Error:"error",OK:"done",Timeout:"timeout"};if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;if(callStack.isOnHgw()){callStack.push("api","pcb.PnP.getPnPStatus","1",this)}else{callStack.push("api","com.softathome.ConnectionManager.Client.Common.GetConnectionState","1",this)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.data.Status==="Error"||aResult.data.Status==="Idle"||aResult.data.Status==="Running"||aResult.data.Status==="OK"||aResult.data.Status==="Timeout"){this.fields.data.state=states[aResult.data.Status]}else{this.fields.data.state=states.Error}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}}});