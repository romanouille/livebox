define(["utils/console","engine/callStack"],function(console,callStack){"use strict";return{countContacts:{name:"Retrieves the number of contacts in the Address Book",description:"This method returns the number of contacts available in the Address Book.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.data={nbContacts:""};this.fields.mxStep+=1;callStack.push("api","pcb.Phonebook.getNumberOfContacts","1",this,{})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){if(aResult.data!==undefined){this.fields.data.nbContacts=aResult.data}else{callStack.logMessage("SEM_SYN_ERROR","Number of contacts was not provided");this.fields.status=-1;this.fields.mxStep=-1}}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},addContact:{name:"Adds a new contact to the Address Book",description:"This method adds a new contact to the Address Book.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,inputObj,i=0,tmp={name:"",type:"",preferred:false};if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={contactId:""};this.fields.nbStep=0;this.fields.mxStep=0;result=aResult.inputList[0];if(callStack.isOnHgw()){inputObj={contact:{name:"",formattedName:"",birthDay:"",title:"",organisation:"",url:"",isFavourite:false,ringtone:""}};if(result.givenName&&Object.typeOf(result.givenName)==="string"&&(result.familyName&&Object.typeOf(result.familyName)==="string")){inputObj.contact.name="N:"+result.familyName+";"+result.givenName+";"}else if(result.givenName&&Object.typeOf(result.givenName)==="string"){inputObj.contact.name="N:;"+result.givenName+";"}else if(result.familyName&&Object.typeOf(result.familyName)==="string"){inputObj.contact.name="N:"+result.familyName+";;"}if(result.formattedName&&Object.typeOf(result.formattedName)==="string"){inputObj.contact.formattedName=result.formattedName}if(result.birthday&&Object.typeOf(result.birthday)==="string"){inputObj.contact.birthDay=result.birthday}if(result.title&&Object.typeOf(result.title)==="string"){inputObj.contact.title=result.title}if(result.organisationName&&Object.typeOf(result.organisationName)==="string"){inputObj.contact.organisation=result.organisationName}if(Object.typeOf(result.url)==="string"&&result.url){inputObj.contact.url=result.url}if(Object.typeOf(result.isFavourite)==="boolean"){inputObj.contact.isFavourite=result.isFavourite}if(result.ringtoneId&&Object.typeOf(result.ringtoneId)==="string"){inputObj.contact.ringtone=result.ringtoneId}if(result.addressList.length>0){inputObj.contact.addresses=[];for(i=0;i<result.addressList.length;i+=1){if(result.addressList[i].address&&Object.typeOf(result.addressList[i].address)==="string"&&result.addressList[i].type&&Object.typeOf(result.addressList[i].type)==="string"&&Object.typeOf(result.addressList[i].isPreferred)==="boolean"){tmp={name:result.addressList[i].address,type:result.addressList[i].type,preferred:result.addressList[i].isPreferred};inputObj.contact.addresses.push(tmp)}}}if(result.emailList.length>0){inputObj.contact.emails=[];for(i=0;i<result.emailList.length;i+=1){if(result.emailList[i].email&&Object.typeOf(result.emailList[i].email)==="string"&&(result.emailList[i].type&&Object.typeOf(result.emailList[i].type)==="string")&&Object.typeOf(result.emailList[i].preferred)==="boolean"){tmp={name:result.emailList[i].email,type:result.emailList[i].type,preferred:result.emailList[i].preferred};inputObj.contact.emails.push(tmp)}}}if(result.phoneNumberList.length>0){inputObj.contact.telephoneNumbers=[];for(i=0;i<result.phoneNumberList.length;i+=1){if(result.phoneNumberList[i].number&&Object.typeOf(result.phoneNumberList[i].number)==="string"&&(result.phoneNumberList[i].type&&Object.typeOf(result.phoneNumberList[i].type)==="string")&&Object.typeOf(result.phoneNumberList[i].preferred)==="boolean"){tmp={name:result.phoneNumberList[i].number,type:result.phoneNumberList[i].type,preferred:result.phoneNumberList[i].preferred};inputObj.contact.telephoneNumbers.push(tmp)}}}this.fields.mxStep+=1;callStack.push("api","pcb.Phonebook.addContact","1",this,inputObj)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){this.fields.data.contactId=aResult.data}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if((this.fields.status===0||this.fields.status===true)&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},getContact:{name:"Returns the description of a contact from the Address Book",description:"This method returns the description of a contact from the Address Book from the unique contact identifier.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,givenName,lastName,name,i=0,tmp,inputObj={uniqueID:""};if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={contactId:"",modificationDate:"",familyName:"",givenName:"",additionalNameList:[],honorificPrefixes:"",honorificSuffixes:"",formattedName:"",birthday:"",title:"",organisationName:"",organisationUnitList:[],url:"",isFavourite:false,addressList:[],phoneNumberList:[],ringtoneId:"",emailList:[]};this.fields.nbStep=0;this.fields.mxStep=0;if(callStack.isOnHgw()){this.fields.mxStep+=1;inputObj.uniqueID=aResult.inputList[0];callStack.push("api","pcb.Phonebook.getContact","1",this,inputObj)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){givenName=aResult.data.formattedName.split(" ")[1];lastName=aResult.data.formattedName.split(" ")[0];if(aResult.data.name){name=aResult.data.name.split(":")[1];givenName=name.split(";")[1];lastName=name.split(";")[0]}else{name=aResult.data.formattedName;givenName=aResult.data.formattedName;lastName=""}if(aResult.data.emails.length>0){for(i=0;i<aResult.data.emails.length;i+=1){tmp={email:aResult.data.emails[i].name,type:aResult.data.emails[i].type,preferred:aResult.data.emails[i].preferred};this.fields.data.emailList.push(tmp)}}if(aResult.data.addresses.length>0){for(i=0;i<aResult.data.addresses.length;i+=1){tmp={address:aResult.data.addresses[i].name,type:aResult.data.addresses[i].type,isPreferred:aResult.data.addresses[i].preferred};this.fields.data.addressList.push(tmp)}}if(aResult.data.telephoneNumbers.length>0){for(i=0;i<aResult.data.telephoneNumbers.length;i+=1){tmp={number:aResult.data.telephoneNumbers[i].name,type:aResult.data.telephoneNumbers[i].type,preferred:aResult.data.telephoneNumbers[i].preferred};this.fields.data.phoneNumberList.push(tmp)}}this.fields.data.contactId=aResult.data.uniqueID;this.fields.data.modificationDate=aResult.data.lastRevision;this.fields.data.familyName=lastName;this.fields.data.givenName=givenName;this.fields.data.formattedName=aResult.data.formattedName;this.fields.data.birthday=aResult.data.birthDay;this.fields.data.title=aResult.data.title;this.fields.data.organisationName=aResult.data.organisation;this.fields.data.url=aResult.data.url;this.fields.data.isFavourite=aResult.data.isFavourite;this.fields.data.ringtoneId=aResult.data.ringtone}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if((this.fields.status===0||this.fields.status===true)&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},updateContact:{name:"Updates the description of a contact in the Address Book",description:"This method updates the description of a contact in the Address Book through the unique contact identifier.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,input:{}},call:function(aStep,aResult){var result,i=0,j=0,ok=false,familyName,givenName,splittedName,tmp={name:"",type:"",preferred:false};if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.input={};this.fields.input=aResult.inputList[0];console.log(this.fields.input);if(this.fields.input.contactId&&Object.typeOf(this.fields.input.contactId)==="string"){this.fields.mxStep+=1;callStack.push("api","pcb.Phonebook.getContact","1",this,{uniqueID:this.fields.input.contactId})}else{callStack.logMessage("SYN_BAD_ARGS");this.fields.status=-1}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){result=aResult.data;if(this.fields.input.modificationDate&&Object.typeOf(this.fields.input.modificationDate)==="string"&&this.fields.input.modificationDate!==result.lastRevision){result.lastRevision=this.fields.input.modificationDate}if(this.fields.input.givenName&&Object.typeOf(this.fields.input.givenName)==="string"&&(this.fields.input.familyName&&Object.typeOf(this.fields.input.familyName)==="string")){result.name="N:"+this.fields.input.familyName+";"+this.fields.input.givenName+";"}else if(this.fields.input.givenName&&Object.typeOf(this.fields.input.givenName)==="string"){result.name="N:;"+this.fields.input.givenName+";"}else if(this.fields.input.familyName&&Object.typeOf(this.fields.input.familyName)==="string"){result.name="N:"+this.fields.input.familyName+";;"}if(this.fields.input.formattedName&&Object.typeOf(this.fields.input.formattedName)==="string"&&this.fields.input.formattedName!==result.formattedName){result.formattedName=this.fields.input.formattedName;splittedName=this.fields.input.formattedName.split(" ");familyName=splittedName[1];givenName=splittedName[0]}if(this.fields.input.birthday&&Object.typeOf(this.fields.input.birthday)==="string"&&this.fields.input.birthday!==result.birthDay){result.birthDay=this.fields.input.birthday}if(this.fields.input.title&&Object.typeOf(this.fields.input.title)==="string"&&this.fields.input.title!==result.title){result.title=this.fields.input.title}if(this.fields.input.organisationName&&Object.typeOf(this.fields.input.organisationName)==="string"&&this.fields.input.organisationName!==result.organisation){result.organisation=this.fields.input.organisationName}if(this.fields.input.url&&Object.typeOf(this.fields.input.url)==="string"&&this.fields.input.url!==result.url){result.url=this.fields.input.url}if(Object.typeOf(this.fields.input.isFavourite)==="boolean"&&this.fields.input.isFavourite!==result.isFavourite){result.isFavourite=this.fields.input.isFavourite}if(this.fields.input.ringtoneId&&Object.typeOf(this.fields.input.ringtoneId)==="string"&&this.fields.input.ringtoneId!==result.ringtone){result.ringtone=this.fields.input.ringtoneId}if(this.fields.input.addressList&&this.fields.input.addressList.length>0){for(i=0;i<this.fields.input.addressList.length;i+=1){ok=false;if(result.addresses&&result.addresses.length>0){for(j=0;j<result.addresses.length;j+=1){if(this.fields.input.addressList[i].address&&Object.typeOf(this.fields.input.addressList[i].address)==="string"&&this.fields.input.addressList[i].type&&Object.typeOf(this.fields.input.addressList[i].type)==="string"&&Object.typeOf(this.fields.input.addressList[i].isPreferred)==="boolean"&&this.fields.input.addressList[i].type===result.addresses[j].type){result.addresses[j].name=this.fields.input.addressList[i].address;result.addresses[j].preferred=this.fields.input.addressList[i].isPreferred;ok=true}}if(!ok){tmp={name:this.fields.input.addressList[i].address,type:this.fields.input.addressList[i].type,preferred:this.fields.input.addressList[i].isPreferred};result.addresses.push(tmp)}}else{tmp={name:this.fields.input.addressList[i].address,type:this.fields.input.addressList[i].type,preferred:this.fields.input.addressList[i].isPreferred};result.addresses.push(tmp)}}}if(this.fields.input.emailList&&this.fields.input.emailList.length>0){for(i=0;i<this.fields.input.emailList.length;i+=1){ok=false;if(result.emails&&result.emails.length>0){for(j=0;j<result.emails.length;j+=1){if(this.fields.input.emailList[i].email&&Object.typeOf(this.fields.input.emailList[i].email)==="string"&&this.fields.input.emailList[i].type&&Object.typeOf(this.fields.input.emailList[i].type)==="string"&&Object.typeOf(this.fields.input.emailList[i].preferred)==="boolean"&&this.fields.input.emailList[i].type===result.emails[j].type){result.emails[j].name=this.fields.input.emailList[i].email;result.emails[j].preferred=this.fields.input.emailList[i].preferred;ok=true}}if(!ok){tmp={name:this.fields.input.emailList[i].email,type:this.fields.input.emailList[i].type,preferred:this.fields.input.emailList[i].preferred};result.emails.push(tmp)}}else{tmp={name:this.fields.input.emailList[i].email,type:this.fields.input.emailList[i].type,preferred:this.fields.input.emailList[i].preferred};result.emails.push(tmp)}}}if(this.fields.input.phoneNumberList&&this.fields.input.phoneNumberList.length>0){for(i=0;i<this.fields.input.phoneNumberList.length;i+=1){ok=false;if(result.telephoneNumbers&&result.telephoneNumbers.length>0){for(j=0;j<result.telephoneNumbers.length;j+=1){if(this.fields.input.phoneNumberList[i].number&&Object.typeOf(this.fields.input.phoneNumberList[i].number)==="string"&&this.fields.input.phoneNumberList[i].type&&Object.typeOf(this.fields.input.phoneNumberList[i].type)==="string"&&Object.typeOf(this.fields.input.phoneNumberList[i].preferred)==="boolean"&&this.fields.input.phoneNumberList[i].type===result.telephoneNumbers[j].type){result.telephoneNumbers[j].name=this.fields.input.phoneNumberList[i].number;result.telephoneNumbers[j].preferred=this.fields.input.phoneNumberList[i].preferred;ok=true}}if(!ok){tmp={name:this.fields.input.phoneNumberList[i].number,type:this.fields.input.phoneNumberList[i].type,preferred:this.fields.input.phoneNumberList[i].preferred};result.telephoneNumbers.push(tmp)}}else{tmp={name:this.fields.input.phoneNumberList[i].number,type:this.fields.input.phoneNumberList[i].type,preferred:this.fields.input.phoneNumberList[i].preferred};result.telephoneNumbers.push(tmp)}}}this.fields.input={};this.fields.input.uniqueID=result.uniqueID;this.fields.input.contact={};this.fields.input.contact=result;this.fields.mxStep+=1;callStack.push("api","pcb.Phonebook.updateContact","2",this,this.fields.input)}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}break;case"2":if(aResult.status!==0&&aResult.status!==true){callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if((this.fields.status===0||this.fields.status===true)&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},deleteContact:{name:"Removes a contact from the Address Book",description:"This method removes a contact from the Address Book through the unique contact identifier.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,inputObj={uniqueID:""};if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;if(callStack.isOnHgw()){if(aResult.inputList[0]&&Object.typeOf(aResult.inputList[0])==="string"){this.fields.mxStep+=1;inputObj.uniqueID=aResult.inputList[0];callStack.push("api","pcb.Phonebook.deleteContact","1",this,inputObj)}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1}}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status!==0&&aResult.status!==true){callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if((this.fields.status===0||this.fields.status===true)&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},deleteAllContacts:{name:"Removes all contacts from the Address Book",description:"This method removes all contacts available in the Address Book.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;callStack.push("api","pcb.Phonebook.deleteAllContacts","1",this,{})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status!==0&&aResult.status!==true){callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};callStack.popAll("api",result,this.fields.uuid)}}},browseContacts:{name:"Browses contacts available in the Address Book",description:"This method browses through contacts that are available in the Address Book.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,givenName,lastName,name,j=0,i=0,tmp,item={};if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={contactList:[]};this.fields.nbStep=0;this.fields.mxStep=0;if(callStack.isOnHgw()){this.fields.mxStep+=1;callStack.push("api","pcb.Phonebook.getAllContacts","1",this,{})}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){if(aResult.data&&aResult.data.length>0){result=aResult.data;for(j=0;j<result.length;j+=1){if(result[j].uniqueID&&result[j].uniqueID.length>0){item={};if(result[j].name){name=result[j].name.split(":")[1];givenName=name.split(";")[1];lastName=name.split(";")[0]}else{name=result[j].formattedName;givenName=result[j].formattedName;lastName=""}item.contactId=result[j].uniqueID;item.modificationDate=result[j].lastRevision;item.familyName=lastName;item.givenName=givenName;item.formattedName=result[j].formattedName;item.birthday=result[j].birthDay;item.title=result[j].title;item.organisationName=result[j].organisation;item.url=result[j].url;item.isFavourite=false;item.addressList=[];item.phoneNumberList=[];item.ringtoneId=result[j].ringtone;item.emailList=[];if(result[j].addresses.length>0){for(i=0;i<result[j].addresses.length;i+=1){tmp={address:result[j].addresses[i].name,type:result[j].addresses[i].type,isPreferred:result[j].addresses[i].preferred};item.addressList.push(tmp)}}if(result[j].telephoneNumbers.length>0){for(i=0;i<result[j].telephoneNumbers.length;i+=1){tmp={number:result[j].telephoneNumbers[i].name,type:result[j].telephoneNumbers[i].type,preferred:result[j].telephoneNumbers[i].preferred};item.phoneNumberList.push(tmp)}}if(result[j].emails.length>0){for(i=0;i<result[j].emails.length;i+=1){tmp={email:result[j].emails[i].name,type:result[j].emails[i].type,preferred:result[j].emails[i].preferred};item.emailList.push(tmp)}}this.fields.data.contactList.push(item)}}}}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if((this.fields.status===0||this.fields.status===true)&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},getMaxNumberOfContacts:{name:"Max Number Of Contacts",description:"This method returns the Max Number Of Contacts in the Address Book.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;callStack.push("api","pcb.Phonebook.getMaxNumberOfContacts","1",this)}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status!==0&&aResult.status!==true){callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=-1}else{this.fields.data.maxContacts=aResult.data}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},testContactRingtone:{name:"Plays a ringtone on phone devices",description:"This method plays a given ringtone on every phone device",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(){return}}}});