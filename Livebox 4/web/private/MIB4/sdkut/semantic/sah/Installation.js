define(["utils/console","utils/basics","engine/callStack"],function(console,basicUtilities,callStack){"use strict";return{isInstallationRequired:{name:"isInstallationRequired",description:"This method checks the FirstInstall",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{},userInterfaceStatus:""},call:function(aStep,aResult){if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;if(callStack.isOnHgw()){this.fields.mxStep+=1;callStack.push("api","pcb.UserInterface.getState","1",this,{})}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){this.fields.userInterfaceStatus=aResult.data;this.fields.mxStep+=1;callStack.push("api","pcb.NMC.getAutodetect","2",this,{})}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;case"2":if(aResult.status===0||aResult.status===true){if(this.fields.userInterfaceStatus==="installed"){this.fields.data.isInstallationRequired=false;this.fields.data.isFirstConnectionRequired=true}else if(this.fields.userInterfaceStatus==="connected"){this.fields.data.isInstallationRequired=false;this.fields.data.isFirstConnectionRequired=false}else if(!aResult.data.FirstBoot){this.fields.mxStep+=1;callStack.push("api","pcb.UserInterface.setState","3",this,{currentState:"installed"})}else{this.fields.data.isInstallationRequired=true;this.fields.data.isFirstConnectionRequired=true}}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;case"3":if(aResult.status===0||aResult.status===true){this.fields.data.isInstallationRequired=false;this.fields.data.isFirstConnectionRequired=true}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}this.fields.status=0;if(this.fields.nbStep>=this.fields.mxStep){var result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},setInstallationState:{name:"Sets installation state of User Interface",description:"This method sets the installation state of User Interface.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,isInstallationRequired,isFirstConnectionRequired;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;isInstallationRequired=aResult.inputList[0].isInstallationRequired;isFirstConnectionRequired=aResult.inputList[0].isFirstConnectionRequired;this.fields.mxStep+=1;if(typeof isInstallationRequired==="boolean"&&isInstallationRequired===true){callStack.push("api","pcb.UserInterface.setState","1",this,{currentState:""})}else if(typeof isFirstConnectionRequired==="boolean"&&isFirstConnectionRequired===true){callStack.push("api","pcb.UserInterface.setState","1",this,{currentState:"installed"})}else{callStack.push("api","pcb.UserInterface.setState","1",this,{currentState:"connected"})}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status!==true&&aResult.status!==0){this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}}});