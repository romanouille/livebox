define(["utils/console","engine/callStack"],function(console,callStack){"use strict";return{getCountry:{name:"Returns the country code",description:"This method returns the current values of the regional settings parameters.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={countryCode:"GBR"};this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;if(callStack.isOnHgw()){callStack.push("api","pcb.DeviceManager.getDeviceInfo","2",this)}else{callStack.push("api","com.softathome.Config.Common.GetDefaultCountry","1",this)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0){if(aResult.data.result.length===3){this.fields.data.countryCode=aResult.data.result}else{callStack.logMessage("SEM_VALUE_WORK","Skipping invalid API com.softathome.Config.Common.GetDefaultCountry()");this.fields.data.countryCode="GBR"}}else{this.fields.mxStep=-1;this.fields.status=-1;callStack.logMessage("SEM_SYN_ERROR")}break;case"2":if(aResult.status===0||aResult.status===true){this.fields.data.countryCode=aResult.data.Country}else{this.fields.mxStep=-1;this.fields.status=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},setCountry:{name:"Updates the country code",description:"This method rupdates the values of the regional settings parameters.",fields:{uuid:null,nbStep:0,mxStep:0,status:0},call:function(aStep,aResult){var result,aParameters;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;aParameters=aResult.inputList[0];this.fields.mxStep+=1;callStack.push("api","com.softathome.Config.Common.SetDefaultCountry","1",this,aParameters.countryCode)}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status!==0){this.fields.mxStep=-1;this.fields.status=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}}});