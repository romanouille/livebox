define(["utils/console","engine/callStack"],function(console,callStack){"use strict";return{getBasicInformation:{name:"Returns a basic device description",description:"This method returns a basic description of the device.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,aFilter,buffer,key,index;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;aFilter=aResult.inputList[0];if(!aFilter||Object.typeOf(aFilter.parameterList)!=="array"||!aFilter.parameterList.length){this.fields.data={sopVersion:"",softwareVersion:"",operatorVersion:"",softwareDate:"",hardwareVersion:"",driverVersion:"",loaderVersion:"",manufacturerName:"",modelId:"",productId:"",serialNumber:"",upTime:""};if(callStack.isOnHgw()){this.fields.mxStep+=1;callStack.push("api","pcb.DeviceManager.getDeviceInfo","11",this)}else{this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSopVersion","1",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSoftwareVersion","2",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSoftwareDate","3",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetHardwareVersion","4",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetDriverVersion","5",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetLoaderVersion","6",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetManufacturerName","7",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetModelId","8",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetProductId","9",this);this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSerialNumber","10",this)}}else{this.fields.data={};if(callStack.isOnHgw()){for(index=0;index<aFilter.parameterList.length;index=index+1){this.fields.data[aFilter.parameterList[index]]=""}this.fields.mxStep+=1;callStack.push("api","pcb.DeviceManager.getDeviceInfo","11",this)}else{if(aFilter.parameterList.indexOf("sopVersion")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSopVersion","1",this)}if(aFilter.parameterList.indexOf("softwareVersion")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSoftwareVersion","2",this)}if(aFilter.parameterList.indexOf("softwareDate")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSoftwareDate","3",this)}if(aFilter.parameterList.indexOf("hardwareVersion")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetHardwareVersion","4",this)}if(aFilter.parameterList.indexOf("driverVersion")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetDriverVersion","5",this)}if(aFilter.parameterList.indexOf("loaderVersion")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetLoaderVersion","6",this)}if(aFilter.parameterList.indexOf("manufacturerName")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetManufacturerName","7",this)}if(aFilter.parameterList.indexOf("modelId")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetModelId","8",this)}if(aFilter.parameterList.indexOf("productId")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Hardware.GetProductId","9",this)}if(aFilter.parameterList.indexOf("serialNumber")!==-1){this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSerialNumber","10",this)}}}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0){this.fields.data.sopVersion=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"2":if(aResult.status===0){this.fields.data.softwareVersion=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"3":if(aResult.status===0){this.fields.data.softwareDate=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"4":if(aResult.status===0){this.fields.data.hardwareVersion=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"5":if(aResult.status===0){this.fields.data.driverVersion=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"6":if(aResult.status===0){this.fields.data.loaderVersion=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"7":if(aResult.status===0){this.fields.data.manufacturerName=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"8":if(aResult.status===0){this.fields.data.modelId=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"9":if(aResult.status===0){this.fields.data.productId=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"10":if(aResult.status===0){this.fields.data.serialNumber=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"11":if(aResult.status===0||aResult.status===true){buffer={};buffer.softwareVersion=aResult.data.SoftwareVersion;buffer.operatorVersion=aResult.data.AdditionalSoftwareVersion||"";buffer.softwareDate=aResult.data.FirstUseDate||"";buffer.hardwareVersion=aResult.data.HardwareVersion||"";buffer.manufacturerName=aResult.data.Manufacturer||"";buffer.modelId=aResult.data.ModelName;buffer.serialNumber=aResult.data.SerialNumber||"";buffer.productId=aResult.data.ProductClass||"";buffer.driverVersion="";buffer.loaderVersion="";buffer.sopVersion="";buffer.upTime=aResult.data.UpTime||"";for(key in buffer){if(buffer.hasOwnProperty(key)){if(this.fields.data.hasOwnProperty(key)){this.fields.data[key]=buffer[key]}}}}else{callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},getDeviceIdentifier:{name:"Returns a unique identifier of the device",description:"This method returns a unique identifier of the device.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.status=0;this.fields.data={deviceId:""};if(callStack.isOnHgw()){this.fields.mxStep+=1;callStack.push("api","pcb.NMC.get","3",this)}else{this.fields.mxStep+=1;callStack.push("api","com.softathome.System.Software.GetSerialNumber","1",this)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0&&aResult.data.result){this.fields.data.deviceId=aResult.data.result}else{this.fields.mxStep+=1;callStack.push("api","com.softathome.Network.Common.GetMacAddress","2",this)}break;case"2":if(aResult.status===0){this.fields.data.deviceId=aResult.data.result}else{callStack.logMessage("SEM_SYN_ERROR")}break;case"3":if(aResult.status===0||aResult.status===true){if(aResult.data.DeviceID){this.fields.data.deviceId=aResult.data.DeviceID}else{this.fields.data.deviceId=""}}else{callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},getServicesState:{name:"getServicesState",description:"Returns the state of SOP services",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,indService,elt,input_list,reversed_services;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.status=0;this.fields.data={globalState:"",serviceList:{}};this.fields.allServices={"sah.Device.Time":"TIME_SERVER","sah.Device.RemoteManagement":"DATAMODEL","sah.Device.Network":"NETWORK","sah.Content.DlnaServer":"DMS","sah.Content.DlnaController":"DMC","sah.Player.LocalDlnaRenderer":"DMR","sah.Browser.RemoteUIServer":"RUIS","sah.Browser.RemoteUIClient":"RUIP","sah.Browser.RemoteUIController":"RUIC","sah.Recorder":"PVR","sah.Content.Epg":"EITS","sah.Device.FrontPanel":"FRONT_PANEL"};this.fields.mxStep+=1;input_list=[];if(aResult.inputList&&aResult.inputList[0]&&aResult.inputList[0].serviceList&&aResult.inputList[0].serviceList.length>0){for(indService=0;indService<aResult.inputList[0].serviceList.length;indService+=1){if(this.fields.allServices.hasOwnProperty(aResult.inputList[0].serviceList[indService])){input_list.push(this.fields.allServices[aResult.inputList[0].serviceList[indService]])}else{console.warn("sah.Device.Information.getServiceState: unknown service: '"+aResult.inputList[0].serviceList[indService]+"'")}}}else{for(elt in this.fields.allServices){if(this.fields.allServices.hasOwnProperty(elt)){input_list.push(this.fields.allServices[elt])}}}callStack.push("api","com.softathome.System.Service.GetStates","1",this,{services_list:input_list})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0){this.fields.data.globalState=aResult.data.global_state;this.fields.data.serviceList={};reversed_services={};for(elt in this.fields.allServices){if(this.fields.allServices.hasOwnProperty(elt)){reversed_services[this.fields.allServices[elt]]=elt}}for(elt in aResult.data.services){if(aResult.data.services.hasOwnProperty(elt)&&reversed_services.hasOwnProperty(elt)){this.fields.data.serviceList[reversed_services[elt]]=aResult.data.services[elt]}}}else{callStack.logMessage("SEM_SYN_ERROR","com.softathome.System.Services.GetStates : cannot get service states")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},getLanguage:{name:"Returns the device language",description:"This method returns the device language.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.status=0;this.fields.data={deviceId:""};this.fields.mxStep+=1;callStack.push("api","pcb.UserInterface.getLanguage","1",this)}else{this.fields.nbStep+=1;switch(aStep){case"1":this.fields.data.languageId=aResult.status;break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},setLanguage:{name:"Updates the device language",description:"This method updates the device language.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,configObj;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.status=0;this.fields.data={deviceId:""};configObj={currentLanguage:aResult.inputList[0].languageId};this.fields.mxStep+=1;callStack.push("api","pcb.UserInterface.setLanguage","1",this,configObj)}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status!==0&&aResult.status!==true){this.fields.status=-1;this.fields.mxStep=0;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}}});