define(["utils/console","engine/callStack"],function(console,callStack){"use strict";return{changePassword:{name:"Changes the password of a user",description:"This method changes the password of a user.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,credentials;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;credentials=aResult.inputList[0];this.fields.mxStep+=1;callStack.push("api","pcb.UserManagement.changePassword","1",this,{name:credentials.login,password:credentials.password})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status!==true&&aResult.status!==0){this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},resetPassword:{name:"Resets the password of a user to a default value",description:"This method resets the password of a user.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,credentials;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;credentials=aResult.inputList[0];this.fields.mxStep+=1;callStack.push("api","pcb.UserManagement.resetPassword","1",this,{name:credentials.login})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status!==true){this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},isPasswordValid:{name:"Validates the password of a user",description:"This method resets the password of a user.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,credentials;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={isValid:false};this.fields.nbStep=0;this.fields.mxStep=0;credentials=aResult.inputList[0];this.fields.mxStep+=1;callStack.push("api","pcb.UserManagement.validatePassword","1",this,{name:credentials.login,password:credentials.password,groups:["admin"]})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===true){this.fields.data.isValid=true}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},listCurrentUser:{name:"Lists current user",description:"This method lists current user on the targeted device.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,tempObj;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={userList:[]};this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;callStack.push("api","pcb.UserManagement.getCurrentUser","1",this)}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===true||aResult.status===0){if(aResult.hasOwnProperty("data")){if(aResult.data.hasOwnProperty("user")&&aResult.data.hasOwnProperty("groups")){if(typeof aResult.data.user==="string"&&aResult.data.groups.length>0){tempObj={};tempObj.login=aResult.data.user;tempObj.groupList=aResult.data.groups.slice(0);this.fields.data.userList.push(tempObj)}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},listUsers:{name:"Lists all available users",description:"This method lists all users available on the targeted device.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,userTab,indUser;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={userList:[]};this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;callStack.push("api","pcb.UserManagement.listUsers","1",this)}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===true){userTab=aResult.data;for(indUser=0;indUser<userTab.length;indUser+=1){if(userTab[indUser].enable){this.fields.data.userList.push({login:userTab[indUser].name,groupList:userTab[indUser].groups})}}}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},listGroups:{name:"Lists all available user groups",description:"This method lists all user groups available on the targeted device.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,indGroup,groupTab;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={groupList:[]};this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;callStack.push("api","pcb.UserManagement.listGroups","1",this)}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===true){groupTab=aResult.data;for(indGroup=0;indGroup<groupTab.length;indGroup+=1){if(groupTab[indGroup].enable){this.fields.data.groupList.push(groupTab[indGroup].name)}}}else{this.fields.status=-1;this.fields.mxStep=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}}});