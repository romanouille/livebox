define(["utils/console","engine/callStack"],function(console,callStack){"use strict";return{getConfiguration:{name:"Retrieves the current Configuration of the Lan Ports",description:"This method returns the current Configuration of the Lan Ports.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,output,indexPort,eth;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={};this.fields.data.portList=[];this.fields.macAddress="";this.fields.OrangeTV_Mode=null;this.fields.MLTV=null;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.ports=["swport1","swport2","swport3","swport4"];this.fields.mode={internet:"Internet",internetTV:"Internet & TV",off:"off",internetONT:"FTTH",tv:"TV"};this.fields.mxStep+=1;callStack.push("api","pcb.NeMo.getFirstParameter","1",this,"lan",{name:"LLAddress"})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){this.fields.macAddress=aResult.data;this.fields.mxStep+=1;callStack.push("api","pcb.NMC.getIPTVStatus","2",this)}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=0}break;case"2":if(aResult.status===0||aResult.status===true){this.fields.OrangeTV_Mode=aResult.data;this.fields.mxStep+=1;callStack.push("api","pcb.NMC.getIPTVMultiScreens","3",this)}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=0}break;case"3":if(aResult.status===0||aResult.status===true){this.fields.MLTV=aResult.data;this.fields.mxStep+=1;callStack.push("api","pcb.NeMo.getPorts","4",this,"lan",{mibs:"base eth"})}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=0}break;case"4":if(aResult.status===0||aResult.status===true){output=aResult.data;for(indexPort=0;indexPort<this.fields.ports.length;indexPort+=1){eth={};if(output.eth[this.fields.ports[indexPort]]&&output.base[this.fields.ports[indexPort]]){eth.portId=output.eth[this.fields.ports[indexPort]].PhyId;eth.isEnabled=output.base[this.fields.ports[indexPort]].Status;if(output.eth[this.fields.ports[indexPort]].CurrentBitRate===-1){eth.usageMode=this.fields.mode.off}else{if(this.fields.OrangeTV_Mode.IPTVStatus!=="Unknown"){eth.usageMode=this.fields.mode.internetTV}else{eth.usageMode=this.fields.mode.internet}}if(indexPort===2&&this.fields.MLTV.MLTVEnable){eth.usageMode=this.fields.mode.tv}eth.isConfigurationAutomatic=output.eth[this.fields.ports[indexPort]].DuplexModeEnabled==="Auto"?true:false;eth.macAddress=this.fields.macAddress;eth.maximumSpeed=output.eth[this.fields.ports[indexPort]].MaxBitRateSupported;eth.duplexMode=output.eth[this.fields.ports[indexPort]].CurrentDuplexMode.toUpperCase()==="FULL"?"FULL":"HALF"}else{if(output.eth[this.fields.ports[0]]&&output.base[this.fields.ports[0]]){eth.portId=output.eth[this.fields.ports[0]].PhyId;eth.isEnabled=output.base[this.fields.ports[0]].Status;if(indexPort===3){eth.usageMode=this.fields.mode.ftth}else{eth.usageMode=this.fields.mode.tv}eth.isConfigurationAutomatic=output.eth[this.fields.ports[0]].DuplexModeEnabled==="Auto"?true:false;eth.macAddress=this.fields.macAddress;eth.maximumSpeed=output.eth[this.fields.ports[0]].MaxBitRateSupported;eth.duplexMode=output.eth[this.fields.ports[0]].CurrentDuplexMode.toUpperCase()==="FULL"?"FULL":"HALF"}}this.fields.data.portList.push(eth)}}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=0}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}}}});