define(["utils/console","engine/callStack"],function(console,callStack){"use strict";return{getState:{name:"Returns the current state of the firewall",description:"This method returns the current state of the firewall.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{},initialParameters:{}},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.inputArg=aResult.inputList[0];this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.data={};if(!this.fields.inputArg||typeof this.fields.inputArg.ipVersion==="string"&&(this.fields.inputArg.ipVersion==="4"||this.fields.inputArg.ipVersion==="0")){this.fields.mxStep+=1;callStack.push("api","pcb.Firewall.getFirewallLevel","1",this,{})}else{this.fields.mxStep+=1;callStack.reCall(this,"1",0)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult){if(aResult.status===0||aResult.status===true){this.fields.data.isActivated=aResult.data!=="Off"}else{this.fields.mxStep=0;this.fields.status=-1;callStack.logMessage("SEM_SYN_ERROR");break}}if(this.fields.inputArg&&typeof this.fields.inputArg.ipVersion==="string"&&(this.fields.inputArg.ipVersion==="6"||this.fields.inputArg.ipVersion==="0")){this.fields.mxStep+=1;callStack.push("api","pcb.Firewall.getFirewallIPv6Level","2",this,{})}else{this.fields.mxStep+=1;callStack.reCall(this,"2",0)}break;case"2":if(aResult){if(aResult.status===0||aResult.status===true){this.fields.data.isActivatedIpv6=aResult.data!=="Off"}else{this.fields.mxStep=0;this.fields.status=-1;callStack.logMessage("SEM_SYN_ERROR");break}}this.fields.mxStep+=1;callStack.push("api","pcb.NMC.getWANStatus","3",this);break;case"3":if(aResult.status===0||aResult.status===true){this.fields.data.isInIpv6Mode=aResult.data.IPv6Address&&aResult.data.IPv6Address!==""&&aResult.data.IPv6Address!=="0.0.0.0"}else{this.fields.status=-1;this.fields.mxStep=0;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}},setState:{name:"Updates the state of the firewall",description:"This method updates the state of the firewall.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{},initialParameters:{}},call:function(aStep,aResult){var result;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.nbStep=0;this.fields.mxStep=0;this.fields.inputArg=aResult.inputList[0];if(typeof this.fields.inputArg.ipVersion!=="string"||this.fields.inputArg.ipVersion==="4"||this.fields.inputArg.ipVersion==="0"){if(this.fields.inputArg.isActivated){this.fields.mxStep+=1;callStack.push("api","pcb.Firewall.setFirewallLevel","1",this,{level:"Medium"})}else{this.fields.mxStep+=1;callStack.push("api","pcb.Firewall.setFirewallLevel","1",this,{level:"Off"})}}else{this.fields.mxStep+=1;callStack.reCall(this,"1",0)}}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult){if(aResult.status===0||aResult.status===true){this.fields.data=aResult.data}else{this.fields.mxStep=0;this.fields.status=-1;callStack.logMessage("SEM_SYN_ERROR");break}}if(typeof this.fields.inputArg.ipVersion==="string"&&(this.fields.inputArg.ipVersion==="6"||this.fields.inputArg.ipVersion==="0")){if(this.fields.inputArg.isActivated){this.fields.mxStep+=1;callStack.push("api","pcb.Firewall.setFirewallIPv6Level","2",this,{level:"Medium"})}else{this.fields.mxStep+=1;callStack.push("api","pcb.Firewall.setFirewallIPv6Level","2",this,{level:"Off"})}}break;case"2":if(aResult.status===0||aResult.status===true){this.fields.data=aResult.data}else{this.fields.mxStep=0;this.fields.status=-1;callStack.logMessage("SEM_SYN_ERROR")}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}}});