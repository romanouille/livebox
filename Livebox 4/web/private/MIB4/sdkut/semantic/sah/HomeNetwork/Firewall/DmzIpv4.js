define(["utils/console","engine/callStack"],function(console,callStack){"use strict";return{getCurrentState:{name:"Retrieves the current state of the DMZ",description:"This method returns the current state of the DMZ.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var result,output;if(aStep==="0"){this.fields.uuid=aResult.uuid;this.fields.status=0;this.fields.data={};this.fields.nbStep=0;this.fields.mxStep=0;this.fields.mxStep+=1;callStack.push("api","pcb.Firewall.getDMZ","1",this,{})}else{this.fields.nbStep+=1;switch(aStep){case"1":if(aResult.status===0||aResult.status===true){output=aResult.data;if(output&&output.webui){this.fields.data.ipAddress=output.webui.DestinationIPAddress;this.fields.data.isDmzEnabled=output.webui.Enable}else{this.fields.data.isDmzEnabled=false;this.fields.data.ipAddress=""}}else{callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=0}break;default:console.warn("Unexpected step '"+aStep+"' in call stack");this.fields.nbStep-=1;break}if(this.fields.nbStep>=this.fields.mxStep){result={status:this.fields.status};if(this.fields.status===0&&this.fields.data){result.data=this.fields.data}callStack.popAll("api",result,this.fields.uuid)}}}},setCurrentState:{name:"Updates the state of the DMZ",description:"This method updates the current state of the DMZ.",fields:{uuid:null,nbStep:0,mxStep:0,status:0,data:{}},call:function(aStep,aResult){var inputArg,inputObj;if(aStep==="0"){this.fields.nbStep=0;this.fields.mxStep=0;this.fields.status=0;this.fields.uuid=aResult.uuid;inputArg=aResult.inputList[0];this.fields.mxStep+=1;if(Object.typeOf(inputArg.isDmzEnabled)==="boolean"&&inputArg.isDmzEnabled===true){if(Object.typeOf(inputArg.ipAddress)==="string"){inputObj={id:"webui",sourceInterface:"data",destinationIPAddress:inputArg.ipAddress,enable:true};callStack.push("api","pcb.Firewall.setDMZ",this.fields.mxStep.toString(),this,inputObj)}}else if(Object.typeOf(inputArg.isDmzEnabled)==="boolean"&&inputArg.isDmzEnabled===false){inputObj={id:"webui"};callStack.push("api","pcb.Firewall.deleteDMZ",this.fields.mxStep.toString(),this,inputObj)}}else{if(parseInt(aStep,10)>0&&parseInt(aStep,10)<=this.fields.mxStep){this.fields.nbStep+=1;if(aResult.status!==0&&aResult.status!==true){callStack.logMessage("SEM_SYN_ERROR");this.fields.status=-1;this.fields.mxStep=0}}else{console.warn("Unexpected step '"+aStep+"'in call stack");this.fields.nbStep-=1}}if(this.fields.nbStep>=this.fields.mxStep){callStack.popAll("api",{status:this.fields.status},this.fields.uuid)}}}}});