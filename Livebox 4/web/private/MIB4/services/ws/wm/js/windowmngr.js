define(["jquery","jquery-ui","widget-swiper/idangerous.swiper","widget-swiper/idangerous.swiper.progress","lib/sah-core/sah"],function($){"use strict";var pathToFirstInstall=window.location.href.split("?")[0].split("/").slice(0,-1).join("/")+"/first-install/app/index.html"+window.location.search,sdHeightToRestore,iOSIframeFixTimer,iOSIframeFixValue=0;(function($){$.extend({inArrayIn:function(elem,arr,i){if(typeof elem!=="string"){return $.inArray.apply(this,arguments)}if(arr){var len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;elem=elem.toLowerCase();for(;i<len;i++){if(i in arr&&arr[i].toLowerCase()==elem){return i}}}return-1}})})(jQuery);SAH.WM=undefined;var browser_compatible=true;var browser_warning_translate=function(){};(function(){function get_browser_info(){var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return{name:"msie",version:tem[1]||""}}if(M[1]==="Chrome"){tem=ua.match(/\bOPR\/(\d+)/);if(tem!=null){return{name:"opera",version:tem[1]}}}M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"];if((tem=ua.match(/version\/(\d+)/i))!=null){M.splice(1,1,tem[1])}return{name:M[0].toLowerCase(),version:M[1]}}function showBrowserWarning(){var div=$('<div class="browser_warning_bg"><div class="browser_warning"><div translate="browserwarning.text"></div><br><button translate="browserwarning.button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" style="color:#FFFFFF;background:#F16E00;float:none;clear:both;"></button></div></div>');div.find("button").click(function(){div.remove()});$("body").prepend(div);browser_warning_translate=function(){SAH.currentTranslator().run(div)}}var b=get_browser_info();var browser_versions={msie:10,firefox:16,chrome:28,safari:7,opera:19};if(browser_versions[b.name]!=undefined&&b.version<browser_versions[b.name]){browser_compatible=false;showBrowserWarning()}window["get_browser_info"]=get_browser_info})();$.widget("sah_ui.wm3",{options:{centerPages:false,pagesInLargeView:1.5,pagesInMediumView:1.1,pagesInSmallView:1.01,enableTileDrag:false,gridSize:[3,3],tileSizes:[{width:90,height:90},{width:150,height:150},{width:180,height:180}],tileMargin:10,enableFavorites:true,title:"",autologin:{username:"admin",password:"admin"},defaultLanguage:"en",styleScheme:"",useRandomAnimations:true,enableTimeout:false,enableCategoryButtons:true,enableNavigationArrows:true,enableMobileMode:false,enableBrowserScrollbar:true,loadAllTilesOnStartup:true,profileScript:"",profile:"sah"},_pageLoaded:false,_pages:[],_widgets:{},_apps:[],_shuffleTimer:-1,_resizeTimer:-1,_shortcuts:{},_appRunning:false,_launchedAppManifest:{},_create:function(){console.log("wm3 create");SAH.WM=this;var languageChangeHandler=function(event){if(event.data.indexOf("LANGUAGE_UPDATE_fr")>-1){SAH.loadLanguage("fr");$.when(SAH.currentTranslator().isLoaded()).then(function(){SAH.currentTranslator().run()})}else if(event.data.indexOf("LANGUAGE_UPDATE_en")>-1){SAH.loadLanguage("en");$.when(SAH.currentTranslator().isLoaded()).then(function(){SAH.currentTranslator().run()})}};window.addEventListener("message",languageChangeHandler,false);$.when(this._checkUIStatus()).then(function(status){if(status){if(status.isInstallationRequired){console.log("Redirecting to first install");document.location.href=pathToFirstInstall}else{$.when(SAH.Profile.getData(),this._checkUILanguage()).then(function(settings,language){if(settings){this.options.centerPages=settings.centerPages;this.options.pagesInLargeView=settings.pagesInLargeView||1.5;this.options.pagesInMediumView=settings.pagesInMediumView||1.1;this.options.pagesInSmallView=settings.pagesInSmallView||1.01;this.options.enableTileDrag=settings.enableTileDrag;this.options.gridSize=settings.gridSize||"auto";this.options.tileSizes=settings.tileSizes||[{width:90,height:90},{width:150,height:150},{width:180,height:180}];this.options.tileMargin=settings.tileMargin||10;this.options.enableFavorites=settings.enableFavorites;this.options.title=settings.title||"";this.options.autologin=settings.autologin;if(language){this.options.defaultLanguage=language}else{this.options.defaultLanguage=settings.defaultLanguage||"en"}this.options.styleScheme=settings.styleScheme||"";this.options.useRandomAnimations=settings.useRandomAnimations;this.options.enableTimeout=settings.enableTimeout;this.options.enableCategoryButtons=settings.enableCategoryButtons;this.options.enableNavigationArrows=settings.enableNavigationArrows||true;this.options.enableMobileMode=settings.enableMobileMode||false;this.options.enableBrowserScrollbar=settings.enableBrowserScrollbar||true;this.options.loadAllTilesOnStartup=settings.loadAllTilesOnStartup||true;this.options.profileScript=settings.profileScript}if(this.options.profileScript&&this.options.profileScript.length>0){$("head").append('<script src="'+this.options.profileScript+'"></script>')}$("body").removeClass().addClass(this.options.styleScheme);var swiper='<div class="sah_ui_pages_container swiper-container">'+'<div class="sah_ui_slides">'+"</div>"+"</div>";this.element.find(".sah_main").append(swiper);this.element.find(".sah_action_bar").actionbar().actionbar("addAction","shuffle","icon-shuffle","");if(this.options.enableFavorites){this.element.find(".sah_action_bar").actionbar("addAction","favorites","icon-star3","")}SAH.WM.ActionBar=$(this.element.find(".sah_action_bar")).data("wm3Actionbar");this.element.find(".sah_category_shuffle").shuffle();if(this.options.enableCategoryButtons){this.element.find(".sah_page_selector").iconbar();SAH.WM.Search=this.element.find(".sah_page_selector").data("wm3Iconbar")}else{this.element.find(".sah_page_selector").search();SAH.WM.Search=this.element.find(".sah_page_selector").data("wm3Search")}this.element.find(".sah_ui_pages_container").pages();SAH.WM.Main=this.element.find(".sah_ui_pages_container").data("wm3Pages");if(this.options.enableNavigationArrows){var navarrowdiv=$("<div class=sah_navarrow></div>");navarrowdiv.arrownavigation();this.element.find(".sah_main").append(navarrowdiv);SAH.WM["Arrows"]=navarrowdiv.data("wm3Arrownavigation")}if(this.options.autologin&&typeof this.options.autologin=="object"){this._autoLogin(this.options.autologin.username,this.options.autologin.password)}this.element.find(".sah_page_selector").on("next_page",this.Main.nextPage.bind(this.Main)).on("prev_page",this.Main.prevPage.bind(this.Main)).on("goto",this.gotoPage.bind(this));this.element.find(".sah_category_shuffle").on("goto",this._shuffleGotoEvent.bind(this)).on("page_order_changed",this._shufflePageOrderEvent.bind(this));this.element.find(".sah_ui_pages_container").on("page_changed",function(event,index){this.Search.setContent(this._pages[index]);this.Arrows&&this.Arrows.setContent(this._pages[index]);$(".sah_ui_page").eq(SAH.WM.Main.currentPage()).find("h2").eq(0).focus()}.bind(this));$(window).resize(this._resizeEvent.bind(this));this.keyboardControl(true);if(this.options.enableFavorites){$(window).on("action-favorites",function(){this.gotoPage(0)}.bind(this))}$(window).on("action-shuffle",this._toggleShuffleEvent.bind(this));$(window).on("action-login",this._login_logoutEvent.bind(this));SAH.loadLanguage(this.options.defaultLanguage);SAH.currentTranslator().isLoaded().done(function(){if(!browser_compatible){browser_warning_translate()}this._createLoginDialog();this._createChangePasswordDialog();this._createDefaultPasswordDialog();this._createLegalDialog();this._createResetPasswordDialog();$("#defaultpassword_link").on("click",function(event){event.preventDefault();$("#sah_dialog_defaultpassword_location").sah_dialog("open");this._makeClock()}.bind(this));$("#defaultpassword_link").on("keypress",function(event){if(event.which===13){event.preventDefault();$("#defaultpassword_link").click()}}.bind(this));$("#defaultpassword_link2").on("click",function(event){event.preventDefault();$("#sah_dialog_defaultpassword_location").sah_dialog("open");this._makeClock()}.bind(this));$("#defaultpassword_link2").on("keypress",function(event){if(event.which===13){event.preventDefault();$("#defaultpassword_link2").click()}}.bind(this));$(document).on("click","#sah_dialog_login_legal_link",function(event){event.preventDefault();$("#sah_dialog_legal").sah_dialog("open");this._makeClock()}.bind(this));$("#sah_dialog_login_legal_link").on("keypress",function(event){if(event.which===13){event.preventDefault();$("#sah_dialog_login_legal_link").click()}}.bind(this));$("#resetpassword_link").on("click",function(event){event.preventDefault();$("#sah_dialog_password_reset").sah_dialog("open");this._makeClock()}.bind(this));$("#resetpassword_link").on("keypress",function(event){if(event.which===13){event.preventDefault();$("#resetpassword_link").click()}}.bind(this));this._setShortcuts();this.ActionBar.setTitle(this.options.title);if(status.isFirstConnectionRequired){console.log("Installed, requiring a change of default password");$("#sah_dialog_changepwd").sah_dialog("open");this._makeClock()}else{console.log("Connected");if(!SAH.WM.options.autologin||typeof SAH.WM.options.autologin!="object"){if(SAH.SDKut.isLoggedIn()){SAH.WM._loginEvent()}else{$("#sah_dialog_login").sah_dialog("open");this._makeClock()}}}this._errorbox=$("#sah_dialog_error").sah_dialog({buttons:[{translate:"common.back",click:function(){$(this).sah_dialog("close")}}],actions:{close:false,back:false,favorite:false,remove:false,reload:false}});this._timeoutbox=$("#sah_dialog_timeout").sah_dialog({buttons:[{translate:"common.ok",click:function(){SAH.WM._logoutEvent();$(this).sah_dialog("close");$(".sah_app").fadeOut(500);$(".sah_footer").show(0,function(){$(".sah_main").fadeIn(500,function(){SAH.WM.Search.activate("auto");SAH.WM.Main.resize(SAH.WM.Search.isActive());SAH.WM._resizeEvent()})});$(".sah_app").empty();setTimeout(function(){$("#sah_dialog_login").sah_dialog("setValues",{username:SAH.currentSession()?SAH.currentSession().userName():"",password:""});$("#sah_dialog_login").sah_dialog("open");this._makeClock()},500)}}],actions:{close:false,back:false,favorite:false,remove:false,reload:false}})}.bind(SAH.WM));SAH.on("session_lost",this._session_lost.bind(this));SAH.on("connection_down",this._connection_down.bind(this));SAH.on("connection_restored",this._connection_restored.bind(this));SAH.on("session_hijacked",this._session_hijacked.bind(this));if(this.options.enableTimeout){SAH.on("session_timeout",this._session_timeout.bind(this))}}.bind(this))}}else{}}.bind(SAH.WM))},_makeClock:function(){var doIt=function(){var result,d=new Date,date={};date.hours=d.getHours().toString();if(date.hours.length===1){date.hours="0"+date.hours}date.minutes=d.getMinutes().toString();if(date.minutes.length===1){date.minutes="0"+date.minutes}date.fulltime=date.hours+":"+date.minutes;date.day=d.getDate();switch(d.getDay()){default:case 0:date.weekday=$("<span></span>").translate("common.sunday");break;case 1:date.weekday=$("<span></span>").translate("common.monday");break;case 2:date.weekday=$("<span></span>").translate("common.tuesday");break;case 3:date.weekday=$("<span></span>").translate("common.wednesday");break;case 4:date.weekday=$("<span></span>").translate("common.thursday");break;case 5:date.weekday=$("<span></span>").translate("common.friday");break;case 6:date.weekday=$("<span></span>").translate("common.saturday");break}switch(d.getMonth()){default:case 0:date.month=$("<span></span>").translate("common.january");break;case 1:date.month=$("<span></span>").translate("common.february");break;case 2:date.month=$("<span></span>").translate("common.march");break;case 3:date.month=$("<span></span>").translate("common.april");break;case 4:date.month=$("<span></span>").translate("common.may");break;case 5:date.month=$("<span></span>").translate("common.june");break;case 6:date.month=$("<span></span>").translate("common.july");break;case 7:date.month=$("<span></span>").translate("common.august");break;case 8:date.month=$("<span></span>").translate("common.september");break;case 9:date.month=$("<span></span>").translate("common.october");break;case 10:date.month=$("<span></span>").translate("common.november");break;case 11:date.month=$("<span></span>").translate("common.december");break}$(".ui-widget-overlay").html("");$(".ui-widget-overlay").append("<div class='mhsclock_time'></div>");$(".ui-widget-overlay").append("<div class='mhsclock_date'></div>");$(".ui-widget-overlay").find(".mhsclock_time").append(date.fulltime);$(".ui-widget-overlay").find(".mhsclock_date").append(date.weekday);$(".ui-widget-overlay").find(".mhsclock_date").append(" ");$(".ui-widget-overlay").find(".mhsclock_date").append(date.day);$(".ui-widget-overlay").find(".mhsclock_date").append(" ");$(".ui-widget-overlay").find(".mhsclock_date").append(date.month)};setTimeout(doIt,500);setInterval(doIt,6e4)},_keyboardEvents:function(event){var mode=0;if(this.element.find(".sah_category_shuffle").shuffle("isVisible")){mode=1}switch(event.which){case 9:event.stopPropagation();event.preventDefault();if(mode==0){if(event.shiftKey){SAH.WM.Main.activePage().selectPrevTile()}else{SAH.WM.Main.activePage().selectNextTile()}}else{}break;case 13:if(!$("#search-input").is(":focus")){event.stopPropagation();event.preventDefault();console.log("keyboard event - enter");if(mode==0){$(".sah_ui_slide_active .sah_ui_page").page("activateSelected")}else{}}break;default:$.each(this._shortcuts,function(k,shortcut){if(event.which==shortcut.key){if(event.shiftKey==(shortcut.shiftKey||false)&&event.ctrlKey==(shortcut.ctrlKey||false)&&event.altKey==(shortcut.altKey||false)){shortcut["action"]();event.stopPropagation();event.preventDefault()}}}.bind(this));break}},_shuffleGotoEvent:function(event,page_name){if(this._shuffleTimer!=-1){return}this._shuffleTimer=setTimeout(function(){this.element.find(".sah_category_shuffle").shuffle("toggle");this.element.find(".sah_footer").show(0);SAH.WM.gotoPage(page_name);this._shuffleTimer=-1}.bind(this),100)},_shufflePageOrderEvent:function(event,pages){var activeIndex=SAH.WM.Main.currentPage(),activePage=this._pages[activeIndex],i=0;for(i=0;i<pages.page_order.length;i++){var new_index=i,old_index=$.inArray(pages.page_order[i],this._pages);if(this.options.enableFavorites){new_index+=1}if(new_index!=old_index){console.log("set page "+pages.page_order[i]+" from "+old_index+" to "+new_index);this._pages.splice(old_index,1);var removed_item=this._pages.splice(new_index,1,pages.page_order[i]);this._pages.splice(old_index,0,removed_item[0]);SAH.WM.Main.movePage(old_index,new_index).movePage(new_index,old_index)}}var index=$.inArray(activePage,this._pages);if(activeIndex!=index){SAH.WM.gotoPage(index)}SAH.WM.store()},_resizeEvent:function(){if(this._resizeTimer!=-1){clearTimeout(this._resizeTimer)}this._resizeTimer=setTimeout(function(){this._resizeTimer=-1;SAH.WM.ActionBar.resize();if(this.element.find(".sah_category_shuffle").shuffle("isVisible")){this.element.find(".sah_category_shuffle").shuffle("setTileSize",this._pages.length)}if(this._appRunning){this.element.find(".sah_app").width($(window).width()).height("100%")}else{SAH.WM.Search.activate("auto");SAH.WM.Main.resize(SAH.WM.Search.isActive());if(SAH.WM.Arrows!=undefined){SAH.WM.Arrows.resize()}}}.bind(this),500)},_loginEvent:function(){SAH.WM.ActionBar.resize();SAH.WM.Main.removeAllPages();SAH.WM._pages=[];$("head title").attr("data-translation","common.headtitle");SAH.TranslateObj.putTranslation();SAH.WM._loadManifests()},_logoutEvent:function(){SAH.WM.ActionBar.updateAction("login","icon-user","");$("head title").attr("data-translation","common.headtitlelogin");SAH.TranslateObj.putTranslation();SAH.WM.Main.removeAllPages();SAH.WM._pages=[];$("#login_password").val("")},_login_logoutEvent:function(){if(SAH.SDKut.isLoggedIn()||SAH.SDKut.isEmulated()){console.log("logout");$.when(this._logout()).then(function(){SAH.WM._logoutEvent()});$("#sah_dialog_login").sah_dialog("open");this._makeClock()}console.log("login")},_toggleShuffleEvent:function(){if(this.element.find(".sah_category_shuffle").shuffle("toggle")){this.element.find(".sah_footer").hide(0);this.element.find(".sah_category_shuffle").shuffle("setTileSize",this._pages.length);this.element.find(".sah_ui_pages_container .sah_ui_page").page("loadTiles");var width=this.element.find(".sah_ui_pages_container .sah_ui_page").width();var height=this.element.find(".sah_ui_pages_container .sah_ui_page").height();for(var i=0;i<this._pages.length;i++){var page=this._pages[i];if(i>0||!this.options.enableFavorites){var id=page.replace(/ /g,"_");var html=this.element.find("#"+id).html();this.element.find(".sah_category_shuffle").shuffle("addPage",page,this.options.enableFavorites?i:i+1,html,width,height)}}}else{this.element.find(".sah_footer").show(0)}},_gotoFavorites:function(){SAH.WM.Main.gotoPage(0)},_language_changed:function(translator){this.store();SAH.WM.Search.updateStrings(translator)},_session_lost:function(){var showDialog=function(message){clearInterval(this._conndown_timer);this._conndown_timer=undefined;var errstr=$("<span class=errstr1></span>").translate(message);this._errorbox.find(".sah_dialog_body").html(errstr);this._errorbox.sah_dialog("open");this._makeClock()};this._login_logoutEvent();showDialog("wm.connectionlost")},_connection_down:function(){if(!this._conndown_timer){var errstr=$("<span class=errstr1></span>").translate("wm.connectiondown");var countdown=10;var errstr2=$("<span class=errstr2></span>").html(countdown);var errorbox=this._errorbox;this._conndown_timer=setInterval(function(){countdown--;errorbox.find(".errstr2").html(countdown);if(countdown==0){clearInterval(this._conndown_timer);this._conndown_timer=undefined}}.bind(this),1e3);this._errorbox.find(".sah_dialog_body").html(errstr).append(errstr2);this._errorbox.sah_dialog("open");this._makeClock()}},_connection_restored:function(){var errstr=$("<span class=errstr1></span>").translate("wm.connectionrestored");this._errorbox.find(".sah_dialog_body").html(errstr);clearInterval(this._conndown_timer);this._conndown_timer=undefined;this._errorbox.sah_dialog("open");this._makeClock();var errorbox=this._errorbox;setTimeout(function(){errorbox.sah_dialog("close")},3e3)},_session_hijacked:function(){var errstr=$("<span class=errstr1></span>").translate("wm.sessionhijacked");this._errorbox.find(".sah_dialog_body").html(errstr);var error2=$("<span class=errstr1></span>");if(this.options.autologin&&typeof this.options.autologin=="object"){this._autoLogin(this.options.autologin.username,this.options.autologin.password);error2.translate("wm.autologinagain")}else{error2.translate("wm.loginagain")}this._errorbox.find(".sah_dialog_body").append(error2);this._errorbox.sah_dialog("open");this._makeClock()},_session_timeout:function(){var errstr=$("<span class=errstr1></span>").translate("wm.sessiontimeout");this._timeoutbox.find(".sah_dialog_body").html(errstr);this._timeoutbox.sah_dialog("open");this._makeClock()},_setShortcuts:function(){if(this.options.enableFavorites){this.addShortcut("gotoFavorites",{altKey:true,key:70},this._gotoFavorites.bind(this))}this.addShortcut("toggleShuffle",{altKey:true,key:67},this._toggleShuffleEvent.bind(this))},_createLoginDialog:function(){var self=this,loginSaveTimer,justActivated=0;var dialog=$("#sah_dialog_login");$(dialog).sah_dialog({buttons:[{id:"login_save",translate:"common.login",click:function(){var dialog=this,username=$(dialog).find('input[name="username"]').val(),password=$(dialog).find('input[name="password"]').val();$.when(self._login(username,password)).then(function(){$(dialog).sah_dialog("close");$(dialog).find(".sah_error_string").hide();$(dialog).find(".sah_error_string").attr("aria-hidden",true);SAH.WM._loginEvent()},function(){console.log("FAILURE");$(dialog).find(".sah_error_string").show();$(dialog).find(".sah_error_string").attr("aria-hidden",false)})}}],size:[400,"auto"],actions:{close:false,back:false,favorite:false,remove:false,reload:false},values:{username:"",password:""},deactivateKeyboardOnFocus:true});$.when(SAH.currentTranslator().run(dialog.find(".sah_dialog_body"))).then(function(){var legalWorkAround=window.setInterval(function(){if($("#sah_dialog_login").closest(".ui-dialog").find(".ui-dialog-buttonpane").length>0){$("#sah_dialog_login").closest(".ui-dialog").find(".ui-dialog-buttonpane").prepend($(".sah_dialog_login_legal").eq(0).clone());$(".sah_dialog_login_legal").eq(0).remove();window.clearInterval(legalWorkAround)}},100);dialog.find("#login_username").attr("placeholder",dialog.find("#login_username_translation").html());dialog.find("#login_password").attr("placeholder",dialog.find("#login_password_translation").html())});$("#login_save").prop("disabled",true);$("#login_save").prop("aria-disabled",true);$("#login_save").find("span").removeClass("ui-button-text");$("#login_save").on("click",function(){$("#login_submit").click()});window.setInterval(function(){if($("#login_username").val()===""||$("#login_password").val()===""){$("#login_save").prop("disabled",true);$("#login_save").prop("aria-disabled",true);$("#login_save").css("background-color","#cccccc");$("#login_save").css("color","#999999");$("#login_save").off("mouseover mouseleave");justActivated=1}else{if(justActivated){$("#login_save").css("background-color","#999999");$("#login_save").css("color","#FFFFFF");$("#login_save").removeProp("disabled");$("#login_save").prop("aria-disabled",false);$("#login_save").mouseover(function(){$("#login_save").css("background-color","#000000");$("#login_save").css("color","#FFFFFF")});$("#login_save").mouseleave(function(){$("#login_save").css("background-color","#999999");$("#login_save").css("color","#FFFFFF")});justActivated=0}}},500)},_createChangePasswordDialog:function(){var self=this,justActivated=0;var dialog=$("#sah_dialog_changepwd");$(dialog).sah_dialog({buttons:[{id:"changepwd_save",translate:"common.save",click:function(){var dialog=this,defaultpassword=$(dialog).find('input[name="defaultpassword"]').val(),password=$(dialog).find('input[name="password"]').val(),confirmpassword=$(dialog).find('input[name="confirmpassword"]').val();$.when(self._changePassword(null,defaultpassword,password,confirmpassword)).then(function(){$(dialog).sah_dialog("close");$(dialog).find(".sah_error_string").hide();$(dialog).find(".sah_error_string").attr("aria-hidden",true);SAH.WM._loginEvent()},function(){console.log("FAILURE");$(dialog).find(".sah_error_string").show();$(dialog).find(".sah_error_string").attr("aria-hidden",false)})}}],size:[600,"auto"],actions:{close:false,back:false,favorite:false,remove:false,reload:false},values:{username:"",password:""},deactivateKeyboardOnFocus:true});$.when(SAH.currentTranslator().run(dialog.find(".sah_dialog_body"))).then(function(){var noticeWorkAround=window.setInterval(function(){if($("#sah_dialog_changepwd").closest(".ui-dialog").find(".ui-dialog-buttonpane").length>0){$("#sah_dialog_changepwd").closest(".ui-dialog").find(".ui-dialog-buttonpane").prepend($(".sah_dialog_firstlogin_notice").eq(0).clone());$(".sah_dialog_firstlogin_notice").eq(0).remove();window.clearInterval(noticeWorkAround)}},100);$("#changepwd_save").find("span").removeClass("ui-button-text");$("#changepwd_save").prop("disabled",true);$("#changepwd_save").prop("aria-disabled",true);window.setInterval(function(){if($("#changepwd_defaultpassword").val()===""||$("#changepwd_password").val()===""||$("#changepwd_confirmpassword").val()===""){$("#changepwd_save").prop("disabled",true);$("#changepwd_save").prop("aria-disabled",true);$("#changepwd_save").css("background-color","#cccccc");$("#changepwd_save").css("color","#999999");$("#changepwd_save").off("mouseover mouseleave");justActivated=1}else{if(justActivated){$("#changepwd_save").css("background-color","#999999");$("#changepwd_save").css("color","#FFFFFF");$("#changepwd_save").removeProp("disabled");$("#changepwd_save").prop("aria-disabled",false);$("#changepwd_save").mouseover(function(){$("#changepwd_save").css("background-color","#000000");$("#changepwd_save").css("color","#FFFFFF")});$("#changepwd_save").mouseleave(function(){$("#changepwd_save").css("background-color","#999999");$("#changepwd_save").css("color","#FFFFFF")});justActivated=0}}},500)})},_createDefaultPasswordDialog:function(){var self=this;var dialog=$("#sah_dialog_defaultpassword_location");$(dialog).sah_dialog({buttons:[{id:"defaultpassword_location_close",translate:"common.close",click:function(){var dialog=this;$(dialog).sah_dialog("close")}}],size:[400,"auto"],actions:{close:false,back:false,favorite:false,remove:false,reload:false},values:{}});$.when(SAH.currentTranslator().run(dialog.find(".sah_dialog_body"))).then(function(){$("#defaultpassword_location_close").css("background-color","#999999");$("#defaultpassword_location_close").css("color","#FFFFFF");$("#defaultpassword_location_close").mouseover(function(){$("#defaultpassword_location_close").css("background-color","#000000");$("#defaultpassword_location_close").css("color","#FFFFFF")});$("#defaultpassword_location_close").mouseleave(function(){$("#defaultpassword_location_close").css("background-color","#999999");$("#defaultpassword_location_close").css("color","#FFFFFF")})})},_createLegalDialog:function(){var self=this;var dialog=$("#sah_dialog_legal");$(dialog).sah_dialog({buttons:[{id:"login_legal_close",translate:"common.close",click:function(){var dialog=this;$(dialog).sah_dialog("close")}}],size:[700,"auto"],actions:{close:false,back:false,favorite:false,remove:false,reload:false},values:{}});$.when(SAH.currentTranslator().run(dialog.find(".sah_dialog_body"))).then(function(){$("#login_legal_close").css("background-color","#999999");$("#login_legal_close").css("color","#FFFFFF");$("#login_legal_close").mouseover(function(){$("#login_legal_close").css("background-color","#000000");$("#login_legal_close").css("color","#FFFFFF")});$("#login_legal_close").mouseleave(function(){$("#login_legal_close").css("background-color","#999999");$("#login_legal_close").css("color","#FFFFFF")})})},_createResetPasswordDialog:function(){var self=this;var dialog=$("#sah_dialog_password_reset");$(dialog).sah_dialog({buttons:[{id:"password_reset_close",translate:"common.close",click:function(){var dialog=this;$(dialog).sah_dialog("close")}}],size:[390,"auto"],actions:{close:false,back:false,favorite:false,remove:false,reload:false},values:{}});$.when(SAH.currentTranslator().run(dialog.find(".sah_dialog_body"))).then(function(){$("#password_reset_close").css("background-color","#999999");$("#password_reset_close").css("color","#FFFFFF");$("#password_reset_close").mouseover(function(){$("#password_reset_close").css("background-color","#000000");$("#password_reset_close").css("color","#FFFFFF")});$("#password_reset_close").mouseleave(function(){$("#password_reset_close").css("background-color","#999999");$("#password_reset_close").css("color","#FFFFFF")})})},_login:function(username,password){var deferred=$.Deferred();if(SAH.SDKut.logIn(username,password)){deferred.resolve(true)}else{deferred.reject()}return deferred.promise()},_logout:function(){var deferred=$.Deferred();if(SAH.SDKut.logOut()!==null){deferred.resolve(true)}else{deferred.reject()}return deferred.promise()},_autoLogin:function(username,password){var deferred=$.Deferred();var session=new SAH.Session(username);var loginSuccessHandler=function(){SAH.WM._loginEvent();deferred.resolve()};$.when(session.restore()).then(function(){console.log("previous session restored... [user = "+username+"]");loginSuccessHandler()},function(){session.login(password).then(function(){console.log("session logged in... [user = "+username+"]");loginSuccessHandler()},function(){console.warning("auto login failed [user = "+username+"]");deferred.resolve()})});return deferred.promise()},_changePassword:function(username,oldpassword,newpassword,confirmpassword){var deferred=$.Deferred(),_this=this,firstLoginHandling=function(){$.when(_this._login(username,oldpassword)).then(function(username,oldpassword,newpassword,confirmpassword){SAH.SDKut.invokeApi("semantic","sah.Device.User.changePassword",changePasswordHandler,{login:username,password:newpassword})}.bind(_this,username,oldpassword,newpassword,confirmpassword),function(){deferred.reject(false)})},changePasswordHandler=function(aResult){if(aResult.status===0){logoutHandling(username,oldpassword,newpassword,confirmpassword)}else{deferred.reject(false)}},logoutHandling=function(username,oldpassword,newpassword,confirmpassword){$.when(_this._logout()).then(function(username,oldpassword,newpassword,confirmpassword){secondLoginHandling(username,oldpassword,newpassword,confirmpassword)}.bind(_this,username,oldpassword,newpassword,confirmpassword),function(){deferred.reject(false)})},secondLoginHandling=function(username,oldpassword,newpassword,confirmpassword){$.when(_this._login(username,newpassword)).then(function(){SAH.SDKut.invokeApi("semantic","sah.Installation.setInstallationState",setNewUIStateHandler,{isInstallationRequired:false,isFirstConnectionRequired:false})},function(){deferred.reject(false)})},setNewUIStateHandler=function(aResult){if(aResult.status===0){deferred.resolve(true)}else{deferred.reject(false)}};if(typeof username==="undefined"||username===null){username="admin"}if(oldpassword===newpassword||newpassword!==confirmpassword||oldpassword===""||oldpassword===null||newpassword===""||newpassword===null){deferred.reject(false)}else{firstLoginHandling()}return deferred.promise()},_resetPassword:function(){var deferred=$.Deferred(),resetPasswordHandler=function(aResult){if(aResult.status===0){deferred.resolve(true)}else{deferred.reject()}};SAH.SDKut.invokeApi("semantic","sah.Device.User.resetPassword",resetPasswordHandler,{});return deferred.promise()},_checkUIStatus:function(){var deferred=$.Deferred(),checkUIStatusHandler=function(aResult){if(aResult.status===0){deferred.resolve(aResult.data)}else{deferred.reject()}};SAH.SDKut.invokeApi("semantic","sah.Installation.isInstallationRequired",checkUIStatusHandler,{});return deferred.promise()},_checkUILanguage:function(){var deferred=$.Deferred(),checkUILanguageHandler=function(aResult){if(aResult.status===0){deferred.resolve(aResult.data.languageId)}else{deferred.reject()}};SAH.SDKut.invokeApi("semantic","sah.Device.Information.getLanguage",checkUILanguageHandler,{});return deferred.promise()},_loadManifests:function(){$.when(SAH.Manifests.get(),SAH.Manifests.categories(),SAH.Manifests.retrieve("wm_settings")).then(function(manifests,categories,settings){var sort_manifests=function(a,b){var category1=a.option("category");var category2=b.option("category");var name1=a.option("name");var name2=b.option("name");if(category1==category2){if(name1==name2){return 0}else if(name1<name2){return-1}else{return 1}}else if(category1<category2){return-1}else{return 1}};var getManifest=function(id,manifests){var manifest=undefined;for(var i=0;i<manifests.length;i++){if(manifests[i].id()==id){manifest=manifests[i];break}}return manifest};var goToApp=function(){if(this._pageLoaded)return;var args=window.location.search.substring(1);var appval;if(args&&(appval=args.match(/app=([\w\d_]+)/))){if(SAH.Manifests.lookup(appval[1])){SAH.WM.launchApp(SAH.Manifests.lookup(appval[1]))}}};var populate_pages=function(manifests,categories,settings){var i,index,applet;SAH.WM.Search.clear();if(this.options.enableFavorites){this.addPage("Favorites")}manifests.sort(sort_manifests);for(var i=0;i<manifests.length;i++){var translation=manifests[i].language(SAH.currentTranslator().currentLanguage());if(translation){SAH.currentTranslator().add(manifests[i].id(),translation)}SAH.WM.Search.addKeyword(manifests[i].option("title"),manifests[i].option("category"))}if(settings.categories){$.each(settings.categories,function(page,tiles){for(i=0;i<tiles.length;i++){var manifest=getManifest.call(tiles[i].manifest,manifests);if(manifest==undefined){continue}if(manifest.option("category")!=page&&page!="Favorites"){continue}if(page=="Favorites"){if(this.options.enableFavorites){this.addPage(page)
}}else{this.addPage(page)}SAH.WM.Main.addTileTo(page,manifest,tiles[i].index);if(page=="Favorites"&&this.options.enableFavorites){manifest.setFavorite(tiles[i].index)}}})}for(i=0;i<categories.length;i++){var startpos=0,endpos=0;index=0;while(index<manifests.length&&manifests[index].option("category")!=categories[i]){index++}if(index>=manifests.length){continue}console.log("Category = "+categories[i]);this.addPage(categories[i]);startpos=index;while(index<manifests.length&&manifests[index].option("category")==categories[i]){for(applet=0;applet<manifests[index].option("applets");applet++){if(SAH.WM.Main.hasTile(categories[i],manifests[index],applet)==false){SAH.WM.Main.addTileTo(categories[i],manifests[index],applet)}}index++}endpos=index;manifests.splice(startpos,endpos-startpos)}for(index=0;index<manifests.length;index++){this.addPage(manifests[index].option("category"));for(applet=0;applet<manifests[index].option("applets");applet++){if(SAH.WM.Main.hasTile(manifests[index].option("category"),manifests[index],applet)==false){SAH.WM.Main.addTileTo(manifests[index].option("category"),manifests[index],applet)}}}if(this.options.loadAllTilesOnStartup){var delayOnStartup=0;this.element.find(".sah_ui_page").each(function(){window.setTimeout(function(){$(this).page("loadTiles")}.bind(this),delayOnStartup);delayOnStartup=delayOnStartup+500})}else{SAH.WM.Main.activePage().loadTiles()}SAH.WM.Main.activePage().activate(true);SAH.on("language_changed",this._language_changed.bind(this));if(this.options.enableFavorites){SAH.WM.Main.gotoPage(0)}else{SAH.WM.Main.gotoPage(1)}this._resizeEvent();goToApp.call(this);this._pageLoaded=true;if(SAH.WM.Arrows!=undefined){SAH.WM.Arrows.init()}};SAH.off("language_changed");if(settings.language){SAH.loadLanguage(settings.language);$.when(SAH.currentTranslator().isLoaded()).then(function(manifests,categories,settings){populate_pages.call(SAH.WM,manifests,categories,settings);SAH.currentTranslator().run()}.bind(SAH.WM,manifests,categories,settings))}else{populate_pages.call(SAH.WM,manifests,categories,settings)}})},addPage:function(name){if($.inArray(name,this._pages)==-1){this._pages.push(name);this.Main.addPage(name);this.Search.addKeyword("categories."+name,name)}},delPage:function(index){if(index<=1){return}var curpage=this.Main.currentPage();if(curpage==index){this.gotoPage(0);this.Search.setContent(_this._pages[0])}this.Main.delPage(index);this.Search.delKeyword(_this._pages[index]);this._pages.splice(index,1)},gotoPage:function(){var arg_array=Array.prototype.slice.call(arguments,0,arguments.length),page=0;switch(arg_array.length){case 1:page=arg_array[0];break;case 2:page=arg_array[1];break}if(typeof page=="string"){page=$.inArray(page,this._pages)}this.Main.gotoPage(page)},getPageIndex:function(name){return $.inArray(name,this._pages)},addShortcut:function(name,keydef,action){this._shortcuts[name]=keydef;this._shortcuts[name].action=action},addToFavorites:function(manifest,index){if(manifest.isFavorite(index)){manifest.clearFavorite(index);this.Main.removeTileFrom("Favorites",manifest,index)}else{manifest.setFavorite(index);this.Main.addTileTo("Favorites",manifest,index,true)}this.store()},loadWidget:function(element,url,callback){if(this._widgets[url]==undefined){var deferred=$.Deferred();this._widgets[url]={html:$("<div>"),promise:deferred.promise()};SAH.etag().done(function(etag){this._widgets[url].html.load(url+"?"+etag,function(response,status,xhr){$("head").append(this._widgets[url].html.find("widget-files").html().replace(/\.css/g,".css?"+etag).replace(/\.js/g,".js?"+etag));$(element).html(this._widgets[url].html.find("widget-ui").html());callback();deferred.resolve()}.bind(this))}.bind(this))}else{this._widgets[url].promise.then(function(){$(element).html(this._widgets[url].html.find("widget-ui").html());callback()}.bind(this))}},loadApp:function(element,url,callback){if(this._apps[url]==undefined){var deferred=$.Deferred();this._apps[url]={html:$("<div>"),promise:deferred.promise()};SAH.etag().done(function(etag){this._apps[url].html.load(url+"?"+etag,function(response,status,xhr){$("head").append(this._apps[url].html.find("app-files").html().replace(/\.css/g,".css?"+etag).replace(/\.js/g,".js?"+etag));callback();deferred.resolve()}.bind(this))}.bind(this))}else{this._apps[url].promise.then(function(){$(element).html(this._apps[url].html.find("app-ui").html());callback()}.bind(this))}},launchApp:function(manifest){var self=this;if(manifest==undefined){return}SAH.WM._launchedAppManifest=manifest;sdHeightToRestore=$("body > .scrolldummy").css("height");$("body > .scrolldummy").css("height",0);$(".sah_main").fadeOut(500,function(){$(".sah_footer").hide(0)});this.ActionBar.clearActions();var startApp=function(){console.log("application = "+manifest.id());console.log("application settings = "+JSON.stringify(manifest.option("settings")));var options=manifest.option("settings");options.manifest=manifest;var url=manifest.option("app");if(self._apps[url]!=undefined){$(".sah_app").html(self._apps[url].html.find("app-ui").html())}if(options.target){options.target+=window.location.search}$(".sah_app")[manifest.option("main")](options)};if(manifest.option("main")!=undefined){if($(".sah_app")[manifest.option("main")]==undefined){this.loadApp($(".sah_app"),manifest.option("app"),function(){startApp()})}else{startApp()}}if(manifest.option("title")!=undefined){this.ActionBar.setTitle('<span translate="'+manifest.option("title")+'"></span>')}this.ActionBar.addAction("back","icon-arrow-left","");$(".sah_app").fadeIn(500,function(){this.element.find(".sah_app").width($(window).width()).height("100%");this.keyboardControl(false);SAH.WM._resizeEvent()}.bind(this));this._appRunning=true;$(window).on("action-back",function(){this.closeApp(manifest)}.bind(this))},closeApp:function(manifest){$(".sah_app").fadeOut(500);$(window).off("action-back");this._appRunning=false;if(manifest.option("main")!=undefined){console.log("application = "+manifest.id());$(".sah_app")[manifest.option("main")]("destroy");$(".sah_app").empty()}var title=this.options.title;this.ActionBar.clearActions().addAction("shuffle","icon-shuffle","").setTitle(title);if(this.options.enableFavorites){this.ActionBar.addAction("favorites","icon-star3","")}$(".sah_footer").show(0,function(){$(".sah_main").fadeIn(500,function(){SAH.WM.Search.activate("auto");SAH.WM.Main.resize(SAH.WM.Search.isActive());SAH.WM._resizeEvent()})});this.keyboardControl(true);$(".sah_ui_slide_active .sah_ui_page").page("loadTiles").page("activate",true,true);SAH.WM._launchedAppManifest=null;$("body > .scrolldummy").css("height",sdHeightToRestore)},keyboardControl:function(flag){if(flag){$(document).on("keydown",this._keyboardEvents.bind(this))}else{$(document).off("keydown")}SAH.WM.Main.keyboardControl(flag)},store:function(){var settings={language:SAH.currentTranslator().currentLanguage(),categories:{}};for(var i=0;i<this._pages.length;i++){settings.categories[this._pages[i]]=SAH.WM.Main.tilesFrom(this._pages[i])}SAH.Manifests.store("wm_settings",settings)}});$.widget("wm3.actionbar",{options:{},_create:function(){console.log("action bar create");this.element.find("li").each(function(index,button){$(button).click(function(e){e.preventDefault();$(window).trigger($(this).attr("id"))})})},resize:function(){this._updateTitleWidth()},clearActions:function(){$("li").each(function(index,button){if($(button).attr("id")=="action-login"){return true}$(button).remove()});return this},addAction:function(id,icon,text){var action=this.element.find("#action-"+id);if(action.length!=0){updateAction(id,icon,text)}else{var button='<li id="action-'+id+'" class="white">'+'   <span class="'+icon+' action_button_icon sah_icon_medium"></span>'+'   <span class="action_button_text">'+text+"</span>"+"</li>",title=this.element.find("#action-title"),last=title.length==0?this.element.find("li:last-child"):title;$(button).insertBefore(last).click(function(e){e.preventDefault();$(window).trigger($(this).attr("id"))})}this._updateTitleWidth();return this},updateAction:function(id,icon,text){var action=this.element.find("#action-"+id);if(action.length==0){return 0}action.html("");var action_text='<span class="action_button_text">'+text+"</span>",action_icon='<span class="'+icon+' action_button_icon sah_icon_medium"></span>';$(action_icon).appendTo(action);$(action_text).appendTo(action);this._updateTitleWidth();return this},setTitle:function(html){var title=this.element.find("#action-title");if(title.length!=0){title.remove()}var last=this.element.find("li:last-child");var title_li='<li id="action-title" class="white">'+'   <div class="marquee">'+html+"</div>"+"</li>",last=this.element.find("li:last-child");$(title_li).insertBefore(last);SAH.currentTranslator().run(last.prev());this._updateTitleWidth();return this},_updateTitleWidth:function(){var title=this.element.find("#action-title");if(title.length==0){return}var action_items=this.element.children("li"),width=$(window).width();for(var i=0;i<action_items.length;i++){if($(action_items[i]).attr("id")!="action-title"){width-=$(action_items[i]).outerWidth(true)}}width-=15;var marquee=this.element.find(".marquee");marquee.css({"padding-left":""});$(marquee).parent().width("auto");if($(marquee).data("marquee-running")){$(marquee).marquee("destroy").data("marquee-running",false)}marquee.css({overflow:"hidden"});var title_width=marquee.parent().outerWidth(true);$(marquee).parent().width(width);if(title_width<width){marquee.css({"padding-left":(width-title_width)/2})}else{$(marquee).marquee().data("marquee-running",true)}return this}});$.widget("wm3.shuffle",{options:{tile_width:200,tile_height:200},_isVisible:true,_indexFontSize:20,_titleFontSize:20,_create:function(){var _this=this;this.hide();this.element.find(".sah_category_shuffle_grid").grid({tile:{size:{width:this.options.width,height:this.options.height},margin:{horizontal:10,vertical:10}},autoresize:false,longpress:false,autoposition:true,insert:true,tileClass:"shuffle_tile"});this.element.find(".sah_category_shuffle_grid").on("tiledrag_end",function(){var tiles=_this.element.find(".sah_category_shuffle_grid").grid("tiles"),pages={page_order:[]};for(var i=0;i<tiles.length;i++){pages.page_order.push($(tiles[i]).data("page"));console.log(i+" - "+$(tiles[i]).data("page"));$(tiles[i]).find(".index").html(i+1)}_this.element.trigger("page_order_changed",pages)})},hide:function(){if(this._isVisible){this.element.css({opacity:0},0);this.element.fadeOut(0);this._isVisible=false}},isVisible:function(){return this._isVisible},toggle:function(cb){var _this=this;if(this._isVisible){this.element.animate({opacity:0},function(){_this.element.fadeOut(0);_this.element.find(".shuffle_tile").off().remove();if(cb){cb()}});this._isVisible=false}else{this.element.show(0);this.element.animate({opacity:1},function(){_this.element.find(".sah_category_shuffle_grid").grid("resize").grid("reIndex").grid("arrangeTiles");if(cb){cb()}});this._isVisible=true}return this._isVisible},addPage:function(page,index,html,orig_width,orig_height){var _this=this,height=this.options.tile_height,width=this.options.tile_width,id=page.replace(/ /g,"_"),body='<div class="title" translate="categories.'+page+'"></div>'+'<div class="index">'+index+"</div>";if(html!=undefined){body=html}this.element.find(".sah_category_shuffle_grid").grid("addTile",1,1,"img_"+id);$("#img_"+id).html(body).data("page",page).on("activate",function(){_this.element.trigger("goto",page)});SAH.currentTranslator().run($("#img_"+id));var base=Math.min(height,width),margin=(base-base*.12-base*.3)/2;if(html==undefined){$("#img_"+id+" .title").css({"font-size":base*.12+"px","line-height":base*.12+"px"});$("#img_"+id+" .index").css({"font-size":base*.3+"px","line-height":base*.3+"px","margin-top":margin})}else{$("#img_"+id+" .sah_ui_page").width(orig_width);$("#img_"+id+" .sah_ui_page").height(orig_height);$("#img_"+id+" .sah_ui_page").css("transform-origin","top left");$("#img_"+id+" .sah_ui_page").css("transform","scale("+width/orig_width+")")}},setTileSize:function(nrTiles){var divider=Math.ceil(Math.sqrt(nrTiles)),width=$(".sah_ui_slide_active").width(),height=$(".sah_ui_slide_active").height();if($(window).width()<400){divider+=.15}divider=Math.min(Math.max(2,divider),4);this.options.tile_width=width/divider;this.options.tile_height=height/divider;this.element.find(".sah_category_shuffle_grid").grid("tileDimensions",width/divider,height/divider);height=this.options.tile_height;width=this.options.tile_width;var base=Math.min(height,width),margin=(base-base*.12-base*.3)/2;this.element.find(" .title").css({"font-size":base*.12+"px","line-height":base*.12+"px"});this.element.find(" .index").css({"font-size":base*.3+"px","line-height":base*.3+"px","margin-top":margin})}});$.widget("wm3.pages",{options:{},_tile_sizes:[{width:90,height:90},{width:150,height:150},{width:243,height:180}],_current_size:1,_size_classes:["small","medium","large"],_full_animation:true,_create:function(){console.log("pages create");var _this=this;var ss=document.styleSheets[1];var rules=ss.cssRules||ss.rules;var slideRule=null;var pageRule=null;for(var i=0;i<rules.length;i++){var rule=rules[i];if(/^\.sah_ui_slide_visible$/.test(rule.selectorText)){slideRule=rule}else if(/^\.sah_ui_page$/.test(rule.selectorText)){pageRule=rule}if(slideRule&&pageRule)break}if(slideRule&&SAH.WM.options.enableMobileMode&&$(window).height()<800){this._full_animation=false;slideRule.style.transform="scale(1)";slideRule.style["webkitTransform"]="scale(1)";slideRule.style["mozTransform"]="scale(1)";slideRule.style["msTransform"]="scale(1)";slideRule.style["oTransform"]="scale(1)"}if(pageRule&&SAH.WM.options.enableBrowserScrollbar){pageRule.style["overflowY"]="hidden"}if(SAH.WM.options.enableBrowserScrollbar){var sd=$("body > .scrolldummy");if(sd.length==0){sd=$("<div class=scrolldummy><div>");sd.css({width:"1px",position:"relative"});$("body").append(sd)}this["sd"]=sd}this._tiles_sizes=SAH.WM.options.tileSizes;_this.element.swiper({wrapperClass:"sah_ui_slides",slideClass:"sah_ui_slide",slideActiveClass:"sah_ui_slide_active",slideVisibleClass:"sah_ui_slide_visible",centeredSlides:SAH.WM.options.centerPages,slidesPerView:SAH.WM.options.pagesInLargeView,roundLengths:true,mousewheelControl:false,watchActiveIndex:true,calculateHeight:false,initialSlide:1,simulateTouch:true,queueEndCallbacks:true,onSlideChangeEnd:function(swiper,direction){_this.element.trigger("page_changed",swiper.activeIndex);var curpage=_this.element.find(".sah_ui_slide_active .sah_ui_page");if(!SAH.WM.options.loadAllTilesOnStartup){curpage.page("loadTiles")}curpage.page("resizeTiles",_this._tile_sizes[_this._current_size].width,_this._tile_sizes[_this._current_size].height).page("activate",true,true).find(".tile").removeClass("small").removeClass("medium").removeClass("large").addClass(_this._size_classes[_this._current_size]);_this.element.find(".sah_ui_slide:not(.sah_ui_slide_active) .sah_ui_page").page("activate",false);setTimeout(function(){var slide=swiper.getSlide(swiper.activeIndex);if(_this._full_animation)$(slide).css({width:Math.floor($(slide).width()),opacity:.9});swiper.setTransform(slide,"scale(1)")},200);if(SAH.WM.options.enableBrowserScrollbar){_this.handleScrollbar()}},progress:this._full_animation,onProgressChange:function(swiper){for(var i=0;i<swiper.slides.length;i++){var slide=swiper.slides[i],progress=slide.progress,opacity=Math.max(1-Math.min(Math.abs(progress),1),.5),scale=1-Math.min(Math.abs(progress*.2),1);slide.style.opacity=Math.min(opacity,.9);swiper.setTransform(slide,"scale("+scale+")")}}});_this.resize(SAH.WM.Search.isActive());_this.element.find(".sah_ui_page").page({tile_width:_this._tile_sizes[_this._current_size].width,tile_height:_this._tile_sizes[_this._current_size].height});_this.element.trigger("page_changed",1);_this.element.find(".sah_ui_page .sah_ui_widget_grid").on("tiledrag_start",function(){if(SAH.WM.options.enableFavorites){var swiper=_this.element.data("swiper");swiper.disable();var manifest=$(tile).tile("manifest");if(manifest.manifest.isFavorite(manifest.index)){_this.element.find(".sah_ui_dropzone").html("Remove from favorites")}else{_this.element.find(".sah_ui_dropzone").html("Add to favorites")}$(slide).find(".sah_ui_title").css("visibility","hidden");$(slide).find(".sah_ui_title").attr("aria-hidden",true);$(slide).find(".sah_ui_dropzone").css("visibility","visible");$(slide).find(".sah_ui_dropzone").attr("aria-hidden",false)}}).on("tiledrag_end",function(){if(SAH.WM.options.enableFavorites){var swiper=_this.element.data("swiper");$(slide).find(".sah_ui_title").css("visibility","visible");$(slide).find(".sah_ui_title").attr("aria-hidden",false);$(slide).find(".sah_ui_dropzone").css("visibility","hidden");$(slide).find(".sah_ui_dropzone").attr("aria-hidden",true);swiper.enable()}SAH.WM.store()}).on("tiledrop",function(event,tile,dropzone){if(SAH.WM.options.enableFavorites){var manifest=$(tile).tile("manifest");SAH.WM.addToFavorites(manifest.manifest,manifest.index)}});var swiper=_this.element.data("swiper");swiper.enableKeyboardControl()},handleScrollbar:function(){var sd=this.sd;var curpage=this.element.find(".sah_ui_slide_active .sah_ui_page");if(curpage.length>0&&sd.length>0){sd.css({height:curpage[0].scrollHeight/curpage.height()*$(window).height()});$(window).off("scroll").scroll(function(){curpage[0].scrollTop=$(window).scrollTop()/$(window).height()*curpage.height()})}SAH.WM.Arrows.resize();SAH.WM.ActionBar._updateTitleWidth()},resize:function(footer){var _this=this,swiper=this.element.data("swiper");_this.element.width($(window).width());if(SAH.WM.options.enableMobileMode&&$(window).width()<400){swiper.params.slidesPerView=SAH.WM.options.pagesInSmallView;_this._current_size=0}else if(SAH.WM.options.enableMobileMode&&$(window).width()<800){swiper.params.slidesPerView=SAH.WM.options.pagesInMediumView;_this._current_size=1}else{swiper.params.slidesPerView=SAH.WM.options.pagesInLargeView;_this._current_size=1}if(!footer){_this.element.height($(window).height()-$(".sah_header").outerHeight(true)-$(window).height()*.02)}else{_this.element.height($(window).height()-$(".sah_header").outerHeight(true)-$(".sah_footer").height())}swiper.resizeFix();var slide=swiper.getSlide(swiper.activeIndex);if(slide!=undefined){$(slide).css({width:Math.floor($(slide).width()),opacity:.9});swiper.setTransform(slide,"scale(1)")}_this.element.find(".sah_ui_page").page("resize");if(SAH.WM.options.enableBrowserScrollbar){setTimeout(function(){_this.handleScrollbar()},500)}return this},keyboardControl:function(enable){var swiper=this.element.data("swiper");if(enable==true){swiper.enableKeyboardControl()}else{swiper.disableKeyboardControl()}},nextPage:function(){var swiper=this.element.data("swiper");swiper.swipeNext();return this},prevPage:function(){var swiper=this.element.data("swiper");swiper.swipePrev();return this},gotoPage:function(index){if(this.currentPage()==index){this.element.trigger("page_changed",index)}else{var swiper=this.element.data("swiper");swiper.swipeTo(index,1e3,true)}return this},addPage:function(name){var _this=this,id=name.replace(/ /g,"_"),page_body='<div class="sah_ui_page">'+'    <div class="sah_ui_title"><h2 translate="categories.'+name+'" tabindex="-1"></h2></div>'+'<div class="sah_ui_dropzone" style="visibility:hidden;" translate="favorites.add">Add to favorites</div>'+'    <div class="sah_ui_widget_grid"></div>'+"</div>",swiper=this.element.data("swiper"),slide=swiper.createSlide(page_body);$(slide).attr("id",id);slide.append();SAH.currentTranslator().run(slide);$(slide).find(".sah_ui_page").page({tile_width:this._tile_sizes[this._current_size].width,tile_height:this._tile_sizes[this._current_size].height,name:name});$(slide).find(".sah_ui_page .sah_ui_widget_grid").on("tiledrag_start",function(event,tile){if(SAH.WM.options.enableFavorites){var swiper=_this.element.data("swiper");swiper.disable();var manifest=$(tile).tile("manifest");if(manifest.manifest.isFavorite(manifest.index)){_this.element.find(".sah_ui_dropzone").html("Remove from favorites")}else{_this.element.find(".sah_ui_dropzone").html("Add to favorites")}$(slide).find(".sah_ui_title").css("visibility","hidden");$(slide).find(".sah_ui_title").attr("aria-hidden",true);$(slide).find(".sah_ui_dropzone").css("visibility","visible");$(slide).find(".sah_ui_dropzone").attr("aria-hidden",false)}}).on("tiledrag_end",function(event,tile){if(SAH.WM.options.enableFavorites){var swiper=_this.element.data("swiper");$(slide).find(".sah_ui_title").css("visibility","visible");$(slide).find(".sah_ui_title").attr("aria-hidden",true);$(slide).find(".sah_ui_dropzone").css("visibility","hidden");$(slide).find(".sah_ui_dropzone").attr("aria-hidden",false);swiper.enable()}SAH.WM.store()}).on("tiledrop",function(event,tile,dropzone){if(SAH.WM.options.enableFavorites){var manifest=$(tile).tile("manifest");SAH.WM.addToFavorites(manifest.manifest,manifest.index);$(this).grid("arrangeTiles")}});return this},currentPage:function(){var swiper=this.element.data("swiper");return swiper.activeIndex},delPage:function(index){var swiper=this.element.data("swiper");swiper.removeSlide(index);return this},removeAllPages:function(){var swiper=this.element.data("swiper");swiper.removeAllSlides();return this},addTileTo:function(pagename,manifest,index,load){var _this=this,id=pagename.replace(/ /g,"_");_this.element.find("#"+id+" .sah_ui_page").page("addTile",manifest,index,load).find(".tile").removeClass("small").removeClass("medium").removeClass("large").addClass(_this._size_classes[_this._current_size]);return this},tilesFrom:function(pagename){var _this=this,id=pagename.replace(/ /g,"_");return _this.element.find("#"+id+" .sah_ui_page").page("tiles")},removeAllTilesFrom:function(pagename){var _this=this,id=pagename.replace(/ /g,"_");_this.element.find("#"+id+" .sah_ui_page").page("removeAllTiles");return this},removeTileFrom:function(pagename,manifest,index){var _this=this,id=pagename.replace(/ /g,"_");_this.element.find("#"+id+" .sah_ui_page").page("removeTile",manifest,index);return this},hasTile:function(pagename,manifest,index){var _this=this,id=pagename.replace(/ /g,"_");return _this.element.find("#"+id+" .sah_ui_page").page("hasTile",manifest,index)},movePage:function(pageIndex,toIndex,keepFocus){var swiper=this.element.data("swiper"),page=swiper.getSlide(pageIndex);page.insertAfter(toIndex);if(keepFocus){swiper.swipeTo(toIndex,1e3,true)}return this},activePage:function(){return this.element.find(".sah_ui_slide_active .sah_ui_page").data("wm3Page")}});$.widget("wm3.page",{options:{tile_width:150,tile_height:150,name:""},_create:function(){console.log("page create");if(typeof SAH.WM.options.gridSize=="string"&&SAH.WM.options.gridSize=="auto"){this.element.find(".sah_ui_widget_grid").grid({tile:{size:{width:this.options.tile_width,height:this.options.tile_height},margin:{horizontal:SAH.WM.options.tileMargin,vertical:SAH.WM.options.tileMargin}},autoresize:false,enableDrag:SAH.WM.options.enableTileDrag,dropzone:".sah_ui_dropzone"})}else{var w=(this.element.width()-2*SAH.WM.options.tileMargin)/SAH.WM.options.gridSize[0]-SAH.WM.options.tileMargin;var h=(this.element.height()-4*SAH.WM.options.tileMargin-$(this.element.find(".sah_ui_title")).outerHeight())/SAH.WM.options.gridSize[1]-SAH.WM.options.tileMargin;this.element.find(".sah_ui_widget_grid").grid({tile:{size:{width:w,height:h},margin:{horizontal:SAH.WM.options.tileMargin,vertical:SAH.WM.options.tileMargin}},autoresize:false,enableDrag:SAH.WM.options.enableTileDrag,dropzone:".sah_ui_dropzone"})}$(document).on("mouseover mousemove",".tile.tile-orange",function(event){this.element.find(".sah_ui_widget_grid").grid("selectByHover",$(event.target).closest(".tile.tile-orange"))}.bind(this))},resize:function(){if(typeof SAH.WM.options.gridSize=="string"&&SAH.WM.options.gridSize=="auto"){this.element.find(".sah_ui_widget_grid").grid("resize");this.element.find(".sah_ui_widget_grid").grid("arrangeTiles")}else{this.element.find(".sah_ui_widget_grid").grid("resize");this.resizeTiles()}},resizeTiles:function(width,height){if(typeof SAH.WM.options.gridSize=="string"&&SAH.WM.options.gridSize=="auto"){width=width||this.options.width;height=height||this.options.height;if(width!=this.options.width||height!=this.options.height){this.options.width=width;this.options.height=height;this.element.find(".sah_ui_widget_grid").grid("tileDimensions",width,height);this.element.find(".sah_ui_widget_grid").grid("arrangeTiles");this.element.find(".tile").tile("resize")}}else{var w=(this.element.width()-2*SAH.WM.options.tileMargin)/SAH.WM.options.gridSize[0]-SAH.WM.options.tileMargin;var h=(this.element.height()-4*SAH.WM.options.tileMargin-$(this.element.find(".sah_ui_title")).outerHeight())/SAH.WM.options.gridSize[1]-SAH.WM.options.tileMargin;this.element.find(".sah_ui_widget_grid").grid("tileDimensions",w,h);this.element.find(".sah_ui_widget_grid").grid("arrangeTiles");this.element.find(".tile").tile("resize")}},addTile:function(manifest,index,load){var size=manifest.sizeHint(index),id=manifest.id()+"_"+index,temp_id=id,count=0;while($("#"+temp_id).length){count++;temp_id=id+"_"+count}id=temp_id;this.element.find(".sah_ui_widget_grid").grid("addTile",Math.min(size[0],2),Math.min(size[1],2),id,undefined,manifest.applet()[index].settings.nonremovable);this.element.find("#"+id).tile({manifest:manifest,index:index});if(load){this.element.find("#"+id).tile("load")}},removeTile:function(manifest,index){var id=manifest.id()+"_"+index,tiles=this.element.find(".tile");$.each(tiles,function(index,tile){if($(tile).tile("id")==id){$(tile).remove()}})},removeAllTiles:function(){var tiles=this.element.find(".tile");$.each(tiles,function(index,tile){$(tile).remove()})},hasTile:function(manifest,index){var tiles=this.element.find('.tile[manifest="'+manifest.id()+'"][manifest-index="'+index+'"]');return tiles.length?true:false},selectNextTile:function(){var tiles=this.element.find(".sah_ui_widget_grid").grid("tiles").length,selected=this.element.find(".sah_ui_widget_grid").grid("select");if(selected<tiles){this.element.find(".sah_ui_widget_grid").grid("select",selected+1)}else{this.element.find(".sah_ui_widget_grid").grid("select",1)}},selectPrevTile:function(){var tiles=this.element.find(".sah_ui_widget_grid").grid("tiles").length,selected=this.element.find(".sah_ui_widget_grid").grid("select");if(selected>1){this.element.find(".sah_ui_widget_grid").grid("select",selected-1)}else{this.element.find(".sah_ui_widget_grid").grid("select",tiles)}},activateSelected:function(){this.element.find(".sah_ui_widget_grid").grid("activateSelected")},loadTiles:function(){this.element.find(".tile").tile("load")},runActivation:function(active){this.element.find(".tile").tile("activate",active);if(active){this.element.find(".sah_ui_widget_grid").grid("select",1);this.element.focus()}},activate:function(active,isHubFirstActivation){if(isHubFirstActivation){SAH.isHubStorage=false;SAH.isHubActive=false;if($("#Hub.sah_ui_slide.sah_ui_slide_visible.sah_ui_slide_active").length===0){this.runActivation(active)}else{SAH.SDKut.invokeApi("semantic","sah.Device.MediaCloud.getStorage",function(result){if(result.status===0&&result.hasOwnProperty("data")&&result.data.volumeList.length>0){SAH.isHubStorage=true}SAH.SDKut.invokeApi("semantic","sah.Device.MediaCloud.getServiceState",function(result){if(result.status===0&&result.hasOwnProperty("data")&&result.data.provisioningStatus==="ok"){SAH.isHubActive=true}this.runActivation(active)}.bind(this),{})}.bind(this),{})}}else{this.runActivation(active)}},tiles:function(){var sort_index=function(a,b){var index_a=$(a).grid_tile("index");var index_b=$(b).grid_tile("index");return index_a-index_b};var tiles_list=[];var tiles=this.element.find(".tile");tiles.sort(sort_index);$.each(tiles,function(){var object=$(this).tile("manifest_id");tiles_list.push(object)});return tiles_list}});$.widget("wm3.tile",{options:{manifest:{},index:0},_loaded:false,_active:false,_create:function(){console.log("tile created");this.element.attr("manifest",this.options.manifest.id());this.element.attr("manifest-index",this.options.index);this.element.attr("class",this.element.attr("class")+" tile-orange");this.element.attr("role","button")},load:function(){if(!this._loaded){var _this=this,manifest=this.options.manifest,index=this.options.index;console.log("Load widget from manifest "+manifest.id());SAH.WM.loadWidget(this.element,manifest.option("applet.url",index),function(){if(manifest.option("applet.class",index)!=undefined){var tile_class=manifest.option("applet.class",index);_this.element.addClass(tile_class)}if(manifest.option("applet.init",index)!=undefined){var options=manifest.option("applet.settings",index);options.manifest=manifest;options.index=index;$(_this.element)[manifest.option("applet.init",index)](options);if(_this._active){$(_this.element)[manifest.option("applet.init",index)]("start")}else{$(_this.element)[manifest.option("applet.init",index)]("stop")}}_this._loaded=true})}},activate:function(active){this._active=active;if(this._loaded){var manifest=this.options.manifest,index=this.options.index;if(manifest.option("applet.init",index)!=undefined){if(active){$(this.element)[manifest.option("applet.init",index)]("start")}else{$(this.element)[manifest.option("applet.init",index)]("stop")}}}},resize:function(){if(this._loaded){var manifest=this.options.manifest,index=this.options.index;if(manifest.option("applet.init",index)!=undefined){$(this.element)[manifest.option("applet.init",index)]("resize")}}},id:function(){var manifest=this.options.manifest,index=this.options.index;return manifest.id()+"_"+index},manifest_id:function(){return{manifest:this.options.manifest.id(),index:this.options.index}},manifest:function(){return{manifest:this.options.manifest,index:this.options.index}}});$.widget("wm3.search",{options:{},_pages:[],_translated_pages:[],_keywords:[],_current:"",_active:true,_create:function(){console.log("search create");var _this=this;_this.prev=this.element.find(".left");_this.next=this.element.find(".right");_this.input=this.element.find("input");_this.input.autocomplete({source:_this._keywords,position:{my:"left bottom",at:"left top"},select:function(event,ui){_this.input.val(ui.item.value);_this._triggerGoto(ui.item.value);_this.input.blur()}});_this.input.on("focusin",function(){console.log("Search focusin");_this._current=_this.input.val();_this.next.stop().fadeOut("slow");_this.prev.stop().fadeOut("slow");_this.input.val("")});_this.input.on("focusout",function(){console.log("Search focusout");var name=_this.input.val();_this._triggerGoto(name)});_this.input.on("keyup",function(event){switch(event.which){case 9:break;case 13:console.log("Search enter pressed");var name=_this.input.val();_this._triggerGoto(name);_this.input.blur();event.stopPropagation();event.preventDefault();break;case 27:_this.input.val(_this._current);_this.input.blur();event.stopPropagation();event.preventDefault();break}});_this.next.on("click",function(){_this.element.trigger("next_page")});_this.prev.on("click",function(){_this.element.trigger("prev_page")});this.activate("auto")},_triggerGoto:function(name){var index=$.inArrayIn(name,this._translated_pages);if(index!=-1){this.element.trigger("goto",this._pages[index])}else{index=$.inArrayIn(this._current,this._translated_pages)}this.setContent(this._pages[index])},activate:function(flag){if(typeof flag=="string"){if(flag=="auto"){if($("html").hasClass("touch")){this._active=false}else if($(window).height()<800){this._active=false}else{this._active=true}}}else{this._active=flag}if($("html").hasClass("touch")){this.prev.hide(0);this.next.hide(0)}if(this._active){if($("html").hasClass("no-touch")){this.prev.show(0);this.next.show(0)}this.input.show(0)}else{this.prev.hide(0);this.next.hide(0);this.input.hide(0)}},isActive:function(){return this._active},focus:function(flag){if(flag){this.input.focus()}else{this.input.blur()}},addKeyword:function(keyword,page){var translated_keyword=SAH.currentTranslator().lookup(keyword);
var translated_page=SAH.currentTranslator().lookup("categories."+page);var option={label:translated_keyword,value:translated_page};var index=$.inArrayIn(page,this._pages);if(index==-1){this._pages.push(page);this._translated_pages.push(translated_page)}this._keywords.push(option)},delKeyword:function(keyword){var translated_keyword=SAH.currentTranslator().lookup(keyword);for(var index=0;index<this._keywords.length;index++){if(_this.keywords[index].label.toLowerCase()==translated_keyword.toLowerCase()){this.keywords.splice(index,1)}}},clear:function(){this._keywords=[];this._pages=[];this._translated_pages=[];this.input.autocomplete("option","source",this._keywords)},setContent:function(name){var translated_name=SAH.currentTranslator().lookup("categories."+name);var index=SAH.WM.getPageIndex(name);this._current=translated_name;this.input.val(this._current);if(this._active){if($("html").hasClass("no-touch")){if(index==0){this.prev.stop().fadeOut(100);this.next.stop().fadeIn(100)}else if(index==this._pages.length-1){this.prev.stop().fadeIn(100);this.next.stop().fadeOut(100)}else{this.prev.stop().fadeIn(100);this.next.stop().fadeIn(100)}}}},updateStrings:function(translator){$.when(SAH.currentTranslator().isLoaded()).then(function(){console.log("Current language = "+translator.currentLanguage());SAH.WM.Search.clear();for(var i=0;i<SAH.Manifests.category.length;i++){SAH.WM.Search.addKeyword("categories."+SAH.Manifests.category[i],SAH.Manifests.category[i])}for(var i=0;i<SAH.Manifests.manifests.length;i++){var translation=SAH.Manifests.manifests[i].language(SAH.currentTranslator().currentLanguage());if(translation){SAH.currentTranslator().add(SAH.Manifests.manifests[i].id(),translation)}SAH.WM.Search.addKeyword(SAH.Manifests.manifests[i].option("title"),SAH.Manifests.manifests[i].option("category"))}SAH.WM.Search.setContent(this._pages[SAH.WM.Main.currentPage()])}.bind(this))}});$.widget("wm3.iconbar",{options:{width:30},_active:true,_map:{Communication:"phone",Connectivity:"connection","Family Protection":"shield","Media Center":"play","Self Care":"aid","Smart Home":"home",Social:"share",Television:"tv",Network:"network",Hub:"hub",Advanced:"advanced",Support:"support",Applications:"applications",Favorites:"favorites"},categories:[],_create:function(){console.log("icon bar create");var _this=this;SAH.Manifests.categories().done(function(categories){_this.categories=["Favorites"].concat(categories);var num=_this.categories.length;_this.element.width(_this.options.width*num/parseInt(_this.element.css("font-size"))+"em");var divs="";for(var i=0;i<num;i++){divs+='<div class="iconbar_button" role="button"><span class="axs_hidden" translate="categories.'+_this.categories[i]+'"></span></div>'}_this.element.html(divs);_this.element.find("div").each(function(i){$(this).css("left",i*(_this.options.width+20)/parseInt($(this).css("font-size"))+"em").click(function(){SAH.WM.gotoPage(_this.categories[i])});var icon=_this._map[_this.categories[i]]||"radio-unchecked";$(this).addClass("icon-"+icon+" icon")})})},addKeyword:function(){},delKeyword:function(){},isActive:function(){return this._active},clear:function(){},addButton:function(category){var i=this.categories.length;this.categories.push(category);var div=$('<div class="iconbar_button" role="button"></div>');div.css("left",i*(this.options.width+20)/parseInt(div.css("font-size"))+"em").html("<span class='axs_hidden' translate='categories."+category+"'></span>").click(function(){SAH.WM.gotoPage(category)});var icon=this._map[category]||"radio-unchecked";div.addClass("icon-"+icon+" icon");this.element.width(this.options.width*(i+1)/parseInt(this.element.css("font-size"))+"em");this.element.append(div)},activate:function(flag){if(typeof flag=="string"){if(flag=="auto"){if(SAH.WM.options.enableMobileMode&&$(window).height()<800){this._active=false;this.element.hide();$(this).attr("aria-hidden",true)}else{this._active=true;this.element.show();$(this).attr("aria-hidden",false)}}}else{this._active=flag}},setContent:function(name){this.markActive(name)},markActive:function(name){for(var i=0;i<this.categories.length;i++){var bg=this.element.children("div").eq(i).css("background-image");if(this.categories[i]==name){if(bg.indexOf("_s.png")===-1){bg=bg.replace(".png","_s.png")}}else{bg=bg.replace("_s.png",".png")}this.element.children("div").eq(i).css({"background-image":bg})}},updateStrings:function(){}});$.widget("wm3.arrownavigation",{arrows:undefined,hidden:false,_create:function(){if(!$("html").hasClass("no-touch"))return;console.log("arrows create");var _this=this;var arrows=$('<div class="navarrow left"> </div><div class="navarrow right"> </div>');this.arrows=arrows},init:function(){this.arrows.css("top",$(window).height()/2-30);var l=this.arrows.eq(0);var r=this.arrows.eq(1);l.click(function(){SAH.WM.Main.prevPage()});r.click(function(){SAH.WM.Main.nextPage()});var index=SAH.WM.Main.currentPage();var pagecount=SAH.WM._pages.length;if(index==0){l.hide()}if(index==pagecount-1){r.hide()}this.element.html(this.arrows);this.setPosition()},resize:function(){if(!this.arrows)return;this.arrows.css("top",($(window).height()-this.arrows.height())/2);var l=this.arrows.eq(0);var r=this.arrows.eq(1);if(SAH.WM.options.enableMobileMode&&$(window).width()<600){this.arrows.hide();this.hidden=true}else{var index=SAH.WM.Main.currentPage();var pagecount=SAH.WM._pages.length;if(index>0){l.fadeIn(200)}if(index<pagecount-1){r.fadeIn(200)}this.hidden=false}this.setPosition()},setPosition:function(){var swiper=SAH.WM.Main.element.data("swiper");if(swiper.slides.length>0){var l=this.arrows.eq(0);var r=this.arrows.eq(1);var width=swiper.slides[0].getWidth()+2;var width=swiper.slides[0].getWidth()+2;var gap=width*.1;var windowwidth=$(window).width();var arrwidth=l.outerWidth();var lpos=windowwidth/2-width/2-gap/2-arrwidth/2;var rpos=windowwidth/2+width/2+gap/2-arrwidth/2;if(lpos<0)lpos=0;if(rpos+arrwidth>windowwidth)rpos=windowwidth-arrwidth;l.css("left",lpos+"px");r.css("left",rpos+"px")}},setContent:function(name){if(!this.arrows||this.hidden)return;var index=SAH.WM.getPageIndex(name);var pagecount=SAH.WM._pages.length;var l=this.arrows.eq(0);var r=this.arrows.eq(1);if(index==0){l.stop().fadeOut(200);r.css("display")=="none"&&r.stop().fadeIn(200)}else if(index==pagecount-1){r.stop().fadeOut(200);l.css("display")=="none"&&l.stop().fadeIn(200)}else{l.css("display")=="none"&&l.stop().fadeIn(200);r.css("display")=="none"&&r.stop().fadeIn(200)}}});$.widget("wm3.sah_dialog",{options:{buttons:[],actions:{},values:{},defaultButton:0,manifest:{},index:undefined},_create:function(){var _this=this;_this.setActions(this.options.actions);_this.setValues(this.options.values);if(this.options.deactivateKeyboardOnFocus){this.element.on("dialogclose",function(event,ui){SAH.WM.keyboardControl(true);$(this).attr("aria-hidden",true)});this.element.on("dialogopen",function(event,ui){SAH.WM.keyboardControl(false);$(this).attr("aria-hidden",false)})}this.element.focus();this.element.dialog({dialogClass:"sah_dialog",modal:true,closeOnEscape:false,hide:{effect:"drop",direction:"up"},resizable:false,show:{effect:"drop",direction:"up"},buttons:this.options.buttons,autoOpen:false});if(this.options.size){this.element.dialog("option","width",this.options.size[0]);this.element.dialog("option","height",this.options.size[1])}this.element.submit(function(){return false});this.element.on("keypress",function(event){switch(event.which){case 13:if(_this.options.defaultButton>-1&&_this.options.defaultButton<_this.options.buttons.length){_this.element.parent().find(".ui-dialog-buttonpane button")[_this.options.defaultButton].click()}break}});$(window).resize(function(){_this.element.dialog("option","position",{my:"center",at:"center"})});var userAgent=navigator.userAgent;if(userAgent.indexOf("Mozilla/5.0")>-1&&(userAgent.indexOf("iPad")>-1||userAgent.indexOf("iPhone")>-1)&&(userAgent.indexOf("OS 8_")>-1||userAgent.indexOf("OS 7_"))&&userAgent.indexOf("like Mac OS X")>-1&&userAgent.indexOf("AppleWebKit")>-1&&userAgent.indexOf("KHTML, like Gecko")>-1){window.addEventListener("orientationchange",function(){if(window.orientation==0||window.orientation==180){window.scrollTo(0,0);_this.element.dialog("option","position",{my:"center",at:"center"})}},false)}},setActions:function(actions){actions=actions||this.options.actions;this.options.actions=actions;var dialog_header='<ul class="sah_dialog_buttons">';if(this.options.actions.back){dialog_header+='<li class="white dialog_action_back">'+'   <span class="icon-arrow-left dialog_button_icon sah_icon_medium"></span>'+"</li>"}else{if(this.options.actions.close){dialog_header+='<li class="white dialog_action_close right">'+'    <span class="icon-close dialog_button_icon sah_icon_medium"></span>'+"</li>"}}if(this.options.actions.reload){dialog_header+='<li class="white dialog_action_reload right">'+'    <span class="icon-loop2 dialog_button_icon sah_icon_medium"></span>'+"</li>"}if(this.options.actions.remove){dialog_header+='<li class="white dialog_action_remove right">'+'    <span class="icon-remove dialog_button_icon sah_icon_medium"></span>'+"</li>"}if(this.options.actions.favorite&&SAH.WM.options.enableFavorites){if(this.options.manifest.isFavorite(this.options.index)){dialog_header+='<li class="white dialog_action_favorite right">'+'  <span class="icon-star3 dialog_button_icon sah_icon_medium"></span>'+"</li>"}else{dialog_header+='<li class="white dialog_action_favorite right">'+'  <span class="icon-star dialog_button_icon sah_icon_medium"></span>'+"</li>"}}dialog_header+="</ul>";this.element.find(".sah_dialog_header").html(dialog_header);this.element.find(".dialog_action_back").off();this.element.find(".dialog_action_close").off();var _this=this;this.element.find(".dialog_action_back").click(function(){_this.element.dialog("close")});this.element.find(".dialog_action_close").click(function(){_this.element.dialog("close")});if(SAH.WM.options.enableFavorites){this.element.find(".dialog_action_favorite").click(function(){SAH.WM.addToFavorites(_this.options.manifest,_this.options.index);_this.setActions(actions)})}},setValues:function(values){values=values||this.options.values;this.options.values=values;var _this=this;$.each(this.options.values,function(key,value){_this.element.find('[name="'+key+'"]').val(value)})},open:function(){var self=this;this.setActions();this.element.dialog("open");SAH.WM.keyboardControl(false)},close:function(){this.element.dialog("close")}})});