define(["jquery","jquery-ui","lib/sah-core/sah"],function($){"use strict";$.widget("sah.profile",{options:{slides:[]},_profiles:[],_create:function(){console.log("app slider: slides = "+this.options.slides);var self=this;var element=this.element.find(".slider");var popup=this.element.find(".sah_popup");var manifest=this.options.manifest;for(var index=0;index<this.options.slides.length;index++){var content=this.options.slides[index];var pattern="{{title}}";if(content.indexOf(pattern)>=0){content=content.replace(pattern,this.options.manifest.option("title"))}var item='<div class="slider-item">'+content+"</div>";console.log("adding slider item"+item);element.append(item);SAH.currentTranslator().run(element)}$(popup).sah_dialog({buttons:[{translate:"common.done",click:function(){popup.sah_dialog("close")}}],actions:{close:false,back:true,favorite:true,remove:false,reload:false},manifest:manifest,index:this.options.index});popup.find(".sah_dialog_body .title").translate(manifest.option("title"));SAH.Profile.get("mhs").done(function(data){var profiles=data.Profiles.split(",");var radios="<div id=proflist>";for(var i=0;i<profiles.length;i++){var prof=profiles[i];radios+='<input type="radio" id="prof'+i+'" name=langlist profile='+prof+">"+'<label for="prof'+i+'">'+prof+"</label>"}radios+="</div>";radios=$(radios).buttonset().change(function(e){var prof=$(e.target).attr("profile");SAH.Profile.current("mhs").done(function(currprof){if(currprof!=prof){self.element.find(".currprof").text(prof);SAH.Profile.current("mhs",prof).done(function(data){location.reload()})}})});setTimeout(function(){radios.find("input[profile="+data.Current+"]").prop("checked",true).button("refresh")},100);self.element.find(".currprof").text(data.Current);$(radios).appendTo(popup.find(".sah_dialog_body"))});this.element.on("activate",function(){popup.sah_dialog("open")});SAH.currentTranslator().run(popup)},start:function(){var self=this;if(this.options.slides.length==0){return}var currlang=SAH.currentTranslator().currentLanguage();var el=this.element.find(".currlang");if(el.attr("translate")!="sah_language."+currlang){el.attr("translate","sah_language."+currlang);SAH.currentTranslator().run(el.parent())}},stop:function(){var element=$(this.element).find(".slider");element.finish()},resize:function(){}})});