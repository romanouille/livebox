define(["utils/console","utils/basics","text","jquery"],function(console,basicUtilities,Text,$){"use strict";var fields,convertPathStringToObj=function(obj,path){if(typeof obj==="undefined"||typeof path==="undefined"){return null}function digPath(aObject,aPath){if(typeof aObject==="undefined"||typeof aPath==="undefined"){console.log("Warning: translation one level above this path failed: "+aPath);return null}return aPath.length?digPath(aObject[aPath[0]],aPath.slice(1)):aObject}return digPath(obj,path.split("."))},setDocumentLanguage=function(lang){var parent=window.parent.document,current=window.document,children=window.document.getElementsByTagName("iframe"),index;switch(lang){case"fr":$(parent).find("html").attr("lang","fr-FR");$(parent).find("body").attr("lang","fr-FR");$(current).find("html").attr("lang","fr-FR");$(current).find("body").attr("lang","fr-FR");for(index=0;index<children.length;index=index+1){$(children[index].contentWindow.document).find("html").attr("lang","fr-FR");$(children[index].contentWindow.document).find("body").attr("lang","fr-FR")}break;case"en":$(parent).find("html").attr("lang","en-US");$(parent).find("body").attr("lang","en-US");$(current).find("html").attr("lang","en-US");$(current).find("body").attr("lang","en-US");for(index=0;index<children.length;index=index+1){$(children[index].contentWindow.document).find("html").attr("lang","en-US");$(children[index].contentWindow.document).find("body").attr("lang","en-US")}break;default:break}basicUtilities.setCookie("UILang",lang);basicUtilities.setParentCookie("UILang",lang)};fields={langId:null,langData:null};return{init:function(alangId,alangData){fields.langId=alangId||"fr";fields.langData=alangData},updateTranslation:function(aCallback){setDocumentLanguage(fields.langId);basicUtilities.callback(aCallback,false,0,null)},loadTranslation:function(aCallback,aLanguage){var bLanguage=aLanguage;if(typeof aLanguage==="undefined"||aLanguage===null){bLanguage=basicUtilities.getParentCookie("UILang")}fields.langData={};require(["json!langCommon/"+bLanguage+".json","json!langApp/"+bLanguage+".json"],function(aCommonLang,aAppLang){fields.langId=bLanguage;fields.langData=Object.deepExtend(aAppLang,aCommonLang);setDocumentLanguage(fields.langId);basicUtilities.callback(aCallback,false,0,null)})},getTranslation:function(aData,aPath){return convertPathStringToObj(aData,aPath)},putTranslation:function(aTarget){var translationData,translationObj,translationDataTable,translationDataTargetTable,index,target;if(typeof aTarget==="undefined"||aTarget===null){target=$(document).find(".Translation")}else{target=$(aTarget).find(".Translation")}translationObj=fields.langData;if($("title[data-translation]").length>0){for(index=0;index<$("title[data-translation]").length;index=index+1){$("title[data-translation]").eq(index).html(convertPathStringToObj(translationObj,$("title[data-translation]").eq(index).attr("data-translation")))}}$(target).each(function(){switch($(this).prop("tagName").toLowerCase()){case"span":case"div":case"option":case"label":if($(this).attr("data-translation-target")){translationDataTargetTable=$(this).attr("data-translation-target").explode(",");translationDataTable=$(this).attr("data-translation").explode(",");if(translationDataTargetTable.length===0||translationDataTable.length===0||translationDataTargetTable.length!==translationDataTable){console.log("Error: data-translation-target and data-translation do not have the same size")}else{for(index=0;index<translationDataTargetTable.length;index=index+1){translationData=convertPathStringToObj(translationObj,translationDataTable[index]);$(this).attr(translationDataTargetTable[index],translationData)}}}else{translationData=convertPathStringToObj(translationObj,$(this).attr("data-translation"));$(this).html(translationData)}break;case"input":switch($(this).attr("type").toLowerCase()){case"button":case"text":if($(this).attr("data-translation-target")){translationDataTargetTable=$(this).attr("data-translation-target").split(",");translationDataTable=$(this).attr("data-translation").split(",");if(translationDataTargetTable.length===0||translationDataTable.length===0||translationDataTargetTable.length!==translationDataTable.length){console.log("Error: data-translation-target and data-translation do not have the same size")}else{for(index=0;index<translationDataTargetTable.length;index=index+1){translationData=convertPathStringToObj(translationObj,translationDataTable[index]);$(this).attr(translationDataTargetTable[index],translationData)}}}else{translationData=convertPathStringToObj(translationObj,$(this).attr("data-translation"));$(this).attr("value",translationData)}break;default:break}break;case"img":if($(this).attr("data-translation-target")){translationDataTargetTable=$(this).attr("data-translation-target").explode(",");translationDataTable=$(this).attr("data-translation").explode(",");if(translationDataTargetTable.length===0||translationDataTable.length===0||translationDataTargetTable.length!==translationDataTable){console.log("Error: data-translation-target and data-translation do not have the same size")}else{for(index=0;index<translationDataTargetTable.length;index=index+1){translationData=convertPathStringToObj(translationObj,translationDataTable[index]);$(this).attr(translationDataTargetTable[index],translationData)}}}else{translationData=convertPathStringToObj(translationObj,$(this).attr("data-translation"));$(this).attr("alt",translationData)}break;case"a":if($(this).attr("data-translation-target")){translationDataTargetTable=$(this).attr("data-translation-target").explode(",");translationDataTable=$(this).attr("data-translation").explode(",");if(translationDataTargetTable.length===0||translationDataTable.length===0||translationDataTargetTable.length!==translationDataTable){console.log("Error: data-translation-target and data-translation do not have the same size")}else{for(index=0;index<translationDataTargetTable.length;index=index+1){translationData=convertPathStringToObj(translationObj,translationDataTable[index]);$(this).attr(translationDataTargetTable[index],translationData)}}}else{translationData=convertPathStringToObj(translationObj,$(this).attr("data-translation"));$(this).attr("title",translationData)}break;default:break}})}}});