define(["utils/console","utils/basics","lib/stateCtrlInterface"],function(console,basicUtilities,StateCtrlClass){"use strict";function VoiceAssociateCtrlClass(aStateId,aStateManager,aSahObj,aViewObj){var onViewEvent=function(aEventId,aData){if(aEventId==="ViewSubmitted"){console.debug("VoiceAssociateCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));if(aData.state==="status"){window.location.hash="#statut"}else if(aData.state==="journal"){window.location.hash="#journal"}else if(aData.state==="contacts"){window.location.hash="#contacts"}else if(aData.state==="associate"){window.location.hash="#associate"}else if(aData.state==="reset"){basicUtilities.queue([function(aNext){this.getViewObj().showLoadingScreen(aNext)},function(aNext){this.resetDectBase(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){window.setTimeout(function(aNext){this.refreshBaseInformation(aNext)}.bind(this),1e4);window.setTimeout(function(aNext){this.refreshListDevice(aNext)}.bind(this),1e4)}else{this.getViewObj().hideLoadingScreen(null);basicUtilities.callback(aNext,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass resetDectBase failed","rra0066")}}],this)}else if(aData.state==="setpincode"){basicUtilities.queue([function(aNext){this.getViewObj().showLoadingScreen(aNext)},function(aNext,aResult){this.setDectBasePairingPinCode(aNext,aData.param)},function(aNext,aResult){if(!aResult||aResult.status===0){window.setTimeout(function(aNext){this.refreshBaseInformation(aNext)}.bind(this),1e4)}else{this.getViewObj().hideLoadingScreen(null);basicUtilities.callback(aNext,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass setDectBasePairingPinCode failed","rra0068")}}],this)}else if(aData.state==="startpairing"){this.startDectPairing(null)}else if(aData.state==="stoppairing"){this.stopDectPairing(null)}else if(aData.state==="list_associate_dect"){basicUtilities.queue([function(aNext){this.getListAssociate(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayListAssociateDect(aResult.data.deviceList)}else{console.error("VoiceAssociateCtrlClass: Internal error");this.getViewObj().notifyError("VoiceAssociateCtrlClass getListAssociate failed","rra0070")}}],this)}else if(aData.state==="rename"){basicUtilities.queue([function(aNext){this.getViewObj().showLoadingScreen(aNext)},function(aNext,aResult){this.renameDevice(aNext,aData.param)},function(aNext,aResult){if(!aResult||aResult.status===0){window.setTimeout(function(aNext){this.refreshListDevice(aNext)}.bind(this),1e4)}else{this.getViewObj().hideLoadingScreen(null);basicUtilities.callback(aNext,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass renameDevice failed ","rra0071")}}],this)}else if(aData.state==="delete"){basicUtilities.queue([function(aNext){this.getViewObj().showLoadingScreen(aNext)},function(aNext,aResult){this.removeDevice(aNext,aData.param)},function(aNext,aResult){if(!aResult||aResult.status===0){window.setTimeout(function(aNext){this.refreshListDevice(aNext)}.bind(this),1e4)}else{this.getViewObj().hideLoadingScreen(null);basicUtilities.callback(aNext,false,-1,null)}}],this)}}else{console.warn("VoiceAssociateCtrlClass: Unexpected event '"+aEventId+"'");this.getViewObj().notifyError("VoiceAssociateCtrlClass: Unexpected event '"+aEventId+"'","rra0074")}};StateCtrlClass.call(this,aStateId,aStateManager,aSahObj,aViewObj);this.init=function(aCallback){console.debug("VoiceAssociateCtrlClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().subscribeEvents(this.getId(),onViewEvent.bind(this));this.getViewObj().init(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass init failed","rra0075")}}],this)};this.quit=function(aCallback){console.debug("VoiceAssociateCtrlClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().quit(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Releasing state '"+this.getId()+"'","rra0076")}}],this)};this.enable=function(aCallback){console.debug("VoiceAssociateCtrlClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getVoiceStatuts(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().enable(aNext);aViewObj.displayStatuts(aResult.data)}else{console.error("VoiceAssociateCtrlClass: Internal error");this.getViewObj().notifyError("VoiceAssociateCtrlClass: Enabling state '"+this.getId()+"'","rra0077")}},function(aNext,aResult){if(!aResult||aResult.status===0){this.getListAssociate(aNext)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass displayStatuts failed","rra0078")}},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayListAssociateDect(aResult.data.deviceList);this.getDectBaseInformation(aNext)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass getListAssociate failed","rra0079")}},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayStatuts(aResult.data)}else{console.error("VoiceAssociateCtrlClass: Internal error");this.getViewObj().notifyError("VoiceAssociateCtrlClass getDectBaseInformation failed","rra0080")}}],this)};this.disable=function(aCallback){console.debug("VoiceAssociateCtrlClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().disable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass getDectBaseInformation failed","rra0081")}}],this)};this.getVoiceStatuts=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Phone.getServerState",aNext,null)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to retrieve voice status");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to retrieve voice status","rra0082")}}],this)};this.getDectBaseInformation=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Phone.getDectBaseInformation",aNext,null)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to retrieve voice status");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to retrieve dect base information","rra0083")}}],this)};this.getListAssociate=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.NetworkMap.listDevices",aNext,{filter:{linkModeList:["CATIQ2"],isActive:true}})},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to retrieve voice status");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to retrieve dect devices","rra0084")}}],this)};this.startDectPairing=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Phone.startDectPairing",aNext,null)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to start Dect Pairing");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to start Dect Pairing","rra0085")}}],this)};this.stopDectPairing=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Phone.stopDectPairing",aNext,null)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to stop Dect Pairing");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to stop Dect Pairing","rra0086")}}],this)};this.resetDectBase=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Phone.resetDectBase",aNext,null)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to reset Dect Base");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to reset Dect Base","rra0087")}}],this)};this.setDectBasePairingPinCode=function(aCallback,pinCode){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Phone.setDectBasePairingPinCode",aNext,pinCode)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to set pin code");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to set pin code","rra0088")}}],this)};this.getListAssociate=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.NetworkMap.listDevices",aNext,{filter:{linkModeList:["CATIQ2"],isActive:true}})},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to retrieve voice status");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to retreive list dect devices","rra0089")}}],this)};this.renameDevice=function(aCallback,device){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.NetworkMap.configureDevice",aNext,device)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to rename device");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to rename device","rra0090")}}],this)};this.removeDevice=function(aCallback,deviceId){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Phone.deleteDect",aNext,deviceId)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceAssociateCtrlClass: Failed to remove device");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("VoiceAssociateCtrlClass: Failed to remove device","rra0091")}}],this)};this.refreshBaseInformation=function(aCallback){basicUtilities.queue([function(aNext){this.getDectBaseInformation(aNext)},function(aNext,aResult){this.getViewObj().hideLoadingScreen(null);if(!aResult||aResult.status===0){aViewObj.displayStatuts(aResult.data);basicUtilities.callback(aCallback,false,0,aResult.data)}else{basicUtilities.callback(aCallback,false,-1,null);console.error("VoiceAssociateCtrlClass: Internal error");this.getViewObj().notifyError("VoiceAssociateCtrlClass getDectBaseInformation failed","rra0067")}}],this)};this.refreshListDevice=function(aCallback){basicUtilities.queue([function(aNext){this.getListAssociate(aNext)},function(aNext,aResult){this.getViewObj().hideLoadingScreen(null);if(!aResult||aResult.status===0){aViewObj.displayListAssociateDect(aResult.data.deviceList);basicUtilities.callback(aCallback,false,0,aResult.data)}else{basicUtilities.callback(aCallback,false,-1,null);console.error("VoiceAssociateCtrlClass: Internal error");this.getViewObj().notifyError("VoiceAssociateCtrlClass getListAssociate failed","rra0072")}}],this)}}return VoiceAssociateCtrlClass});