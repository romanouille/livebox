define(["utils/console","utils/basics","lib/eventHandler","lib/stateViewInterface","jquery","text","templates_app/template","text!bootstrap/bootstrap.css","text!app/config/journal.json"],function(console,basicUtilities,EventHandlerClass,StateViewClass,$,Text,TemplateClass,Bootstrap,Config){"use strict";function VoiceJournalViewClass(aStateId,aTranslateObj){var fields,validatePhone=function(phoneNumber){var phoneNumberPattern=/^([\+|\*|\#])*(\*|\#|[0-9]*)*$/;return phoneNumberPattern.test(phoneNumber)},toggleSaveButton=function(){if(($("#firstname").val()+$("#lastname").val()).trim().length===0){$("#popup_updatecontact_update").attr("disabled",true)}else if(($("#mobile").val()+$("#office").val()+$("#home").val()).trim().length===0){$("#popup_updatecontact_update").attr("disabled",true)}else{$("#popup_updatecontact_update").attr("disabled",false)}},formatDate=function(date){var hours,minutes,day,month,year,strTime,strDay,currentDay,currentMonth,currentYear,today;hours=date.getHours();minutes=date.getMinutes();day=date.getDate();month=date.getMonth()+1;year=date.getFullYear();hours=hours%24;hours=hours<10?"0"+hours:hours;minutes=minutes<10?"0"+minutes:minutes;strTime=hours+":"+minutes+" ";today=new Date;currentDay=today.getDate();currentMonth=today.getMonth()+1;currentYear=today.getFullYear();if(currentYear===year&&currentMonth===month&&currentDay===day){strDay='<div data-translation="common.today" class="Translation" style="display:inline-block;"></div>'}else{date.setDate(date.getDate()+1);day=date.getDate();month=date.getMonth()+1;year=date.getFullYear();if(currentYear===year&&currentMonth===month&&currentDay===day){strDay='<div data-translation="common.yesterday" class="Translation" style="display:inline-block;"></div>'}else{date.setDate(date.getDate()+1);day=date.getDate();month=date.getMonth()+1;year=date.getFullYear();if(currentYear===year&&currentMonth===month&&currentDay===day){strDay='<div data-translation="common.day_before_yesterday" class="Translation" style="display:inline-block;"></div>'}else{date.setDate(date.getDate()-2);day=date.getDate();month=date.getMonth()+1;year=date.getFullYear();day=day<10?"0"+day:day;month=month<10?"0"+month:month;year=year<10?"0"+year:year;strDay=day+"/"+month+"/"+year}}}return strDay+"<div style='padding-left:0.5em;display:inline-block;'>"+strTime+"</div>"},deleteCall=function(event){event.preventDefault();fields.selected=parseInt(event.currentTarget.id.split("_")[4],10);$("#journal_telephone_table_table .conf-table-row:eq("+fields.selected+")").remove();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"delete_call",param:fields.dataCall[fields.selected].callLogId});if($("#journal_telephone_table_table .conf-table-row").length<=1){$("#empty_journal").show()}else{$("#empty_journal").hide()}this.translate()},editContact=function(event){event.preventDefault();TemplateClass.showPopup($("#popup_update_contact"));fields.selected=parseInt(event.target.id.split("_")[1],10);if(fields.dataCall[fields.selected].contact.formattedName===""){$("#popup_update_contact .title").html('<span data-translation="voiceAdvanced.journal.popup.addcontact.title" class="Translation"></span>');$("#popup_updatecontact_update").attr("data-translation","voiceAdvanced.journal.popup.addcontact.add");this.displayContact();$("#home").val($("#"+event.target.id).text())}else{$("#popup_update_contact .title").html('<span data-translation="voiceAdvanced.journal.popup.updatecontact.title" class="Translation"></span>');$("#popup_updatecontact_update").attr("data-translation","voiceAdvanced.journal.popup.updatecontact.update");this.generateEvent("ViewSubmitted",{origin:fields.id,state:"get_contact",param:fields.dataCall[fields.selected].contact.contactId})}$("#popup_update_contact span:eq(1)").hide();this.translate()},displayJournalTable=function(){var context={type:"dynamictable",label:"",id:"journal_telephone_table",sortable:1,titlevalue:["<span class='Translation' data-translation='voiceAdvanced.journal.date.label'></span><span class='Translation' data-translation='voiceAdvanced.journal.heure.label'></span>","<span class='Translation' data-translation='voiceAdvanced.journal.contact.label'></span>","<span class='Translation' data-translation='voiceAdvanced.journal.type.label'></span>"],value:fields.dataJournalTable};if(fields.dataJournalTable.length===0){context={type:"dynamictable",label:"",id:"journal_telephone_table",emptyLabel:"<span class='Translation' data-translation='voiceAdvanced.journal.empty'></span>",sortable:1,titlevalue:["<span class='Translation' data-translation='voiceAdvanced.journal.date.label'></span><span class='Translation' data-translation='voiceAdvanced.journal.heure.label'></span>","<span class='Translation' data-translation='voiceAdvanced.journal.contact.label'></span>","<span class='Translation' data-translation='voiceAdvanced.journal.type.label'></span>"],value:[]}}basicUtilities.queue([function(aNext){TemplateClass.boundDataTable($("#journal_telephone_table"),context);aNext()},function(){listenViewEvents.call(this);if(fields.dataJournalTable.length>0){$(".conf-table-cell").css("text-align","initial");$(".conf-table-title").css("text-align","initial");$(".conf-table-title span").css("position","relative");$(".conf-table-cell span").css("position","relative");$(".conf-table-cell span").css("left","5em");$(".conf-table-title span").css("left","5em")}this.translate()}],this)},sortJournalTable=function(){function sortByName(a,b){var aName,bName;aName=a.contact.formattedName===""?a.phoneNumber.toString():a.contact.formattedName;bName=b.contact.formattedName===""?b.phoneNumber.toString():b.contact.formattedName;return aName.trim().localeCompare(bName.trim())}function reverseByName(a,b){var aName,bName;aName=a.contact.formattedName===""?a.phoneNumber.toString():a.contact.formattedName;bName=b.contact.formattedName===""?b.phoneNumber.toString():b.contact.formattedName;return bName.trim().localeCompare(aName.trim())}function sortByTime(a,b){return new Date(a.date).getTime()>new Date(b.date).getTime()}function reverseByTime(a,b){return new Date(b.date).getTime()>new Date(a.date).getTime()}function sortByType(a,b){if(a.type===b.type){return 0}if(a.type==="missed"){return-1}if(b.type==="missed"){return 1}if(a.type==="in"){return-1}return 1}function reverseByType(a,b){if(a.type===b.type){return 0}if(a.type==="missed"){return 1}if(b.type==="missed"){return-1}if(a.type==="in"){return 1}return-1}if(fields.sortBy==="name"){if(fields.reverseName){fields.dataCall.sort(reverseByName)}else{fields.dataCall.sort(sortByName)}}else if(fields.sortBy==="time"){if(fields.reverseTime){fields.dataCall.sort(reverseByTime)}else{fields.dataCall.sort(sortByTime)}}else if(fields.sortBy==="type"){if(fields.reverseType){fields.dataCall.sort(reverseByType)}else{fields.dataCall.sort(sortByType)}}},listenViewEvents=function(){var index;$("#tab_template_container").off().on("keydown",function(event){var keyCode=event.keyCode||event.which;if(keyCode===39){event.preventDefault();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"contacts"})}else if(keyCode===37){event.preventDefault();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"status"})}}.bind(this));$("#tab_telephone_status").off().on("click",function(event){event.preventDefault();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"status"})}.bind(this));$("#tab_telephone_contacts").off().on("click",function(event){event.preventDefault();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"contacts"})}.bind(this));$("#tab_telephone_journal").off().on("click",function(event){event.preventDefault();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"journal"})}.bind(this));$("#tab_telephone_associate").off().on("click",function(event){event.preventDefault();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"associate"})}.bind(this));TemplateClass.enablePopOver();$("#journal_telephone_table_col0_sort").off().on("click",function(event){event.preventDefault();fields.sortBy="time";fields.reverseTime=!fields.reverseTime;this.displayJournal(fields.dataCall);$("#journal_telephone_table_col0_sort").attr("class","conf-table-title-sortable-arrow-selected");$("#journal_telephone_table_col2_sort").hide()}.bind(this));$("#journal_telephone_table_col1_sort").off().on("click",function(event){event.preventDefault();fields.sortBy="name";fields.reverseName=!fields.reverseName;this.displayJournal(fields.dataCall);$("#journal_telephone_table_col1_sort").attr("class","conf-table-title-sortable-arrow-selected");$("#journal_telephone_table_col2_sort").hide()}.bind(this));$("#journal_telephone_table_col1_sort").on("keydown",function(event){var keyCode=event.keyCode||event.which;if(keyCode===13){event.preventDefault();fields.sortBy="name";fields.reverseName=!fields.reverseName;this.displayJournal(fields.dataCall);$("#journal_telephone_table_col1_sort").attr("class","conf-table-title-sortable-arrow-selected");$("#journal_telephone_table_col1_sort").focus();$("#journal_telephone_table_col2_sort").hide()}}.bind(this));$("#journal_telephone_table_col0_sort").on("keydown",function(event){var keyCode=event.keyCode||event.which;if(keyCode===13){fields.sortBy="time";fields.reverseTime=!fields.reverseTime;this.displayJournal(fields.dataCall);$("#journal_telephone_table_col0_sort").attr("class","conf-table-title-sortable-arrow-selected");$("#journal_telephone_table_col2_sort").hide();$("#journal_telephone_table_col0_sort").focus()}}.bind(this));$("#delete_historic").off().on("click",function(event){event.preventDefault();TemplateClass.showPopup($("#popup_delete_appels"))}.bind(this));for(index=0;index<fields.dataJournalTable.length;index+=1){$("#journal_telephone_table_delete_"+index).off().on("click",deleteCall.bind(this));$(".conf-table-cell a:eq("+index+")").off().on("click",editContact.bind(this))}$("#popup_delete").off().on("click",function(event){event.preventDefault();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"delete_all_calls"});TemplateClass.hidePopup($("#popup_delete_appels"))}.bind(this));$("#popup_delete_call_contact").off().on("click",function(event){event.preventDefault();$("#journal_telephone_table_table .conf-table-row:eq("+fields.selected+")").remove();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"delete_call",param:fields.dataJournalTable[fields.selected-1].defaultvalue[1].split(">")[5].split("<")[0]});if($("#journal_telephone_table_table .conf-table-row").length<=1){$("#empty_journal").show()}else{$("#empty_journal").hide()}TemplateClass.hidePopup($("#popup_delete_contacts"))}.bind(this));$("#popup_cancel").off().on("click",function(event){event.preventDefault();TemplateClass.hidePopup($("#popup_delete_appels"))}.bind(this));$("#popup_cancel_contact").off().on("click",function(event){event.preventDefault();TemplateClass.hidePopup($("#popup_delete_contacts"))}.bind(this));$("#popup_updatecontact_cancel").off().on("click",function(event){event.preventDefault();$(".txtandfield-container:eq(2) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(3) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(4) div").attr("class","row txtandfield-text-input");$("#popup_update_contact span:eq(1)").attr("class","");$("#popup_update_contact span:eq(1)").hide();TemplateClass.hidePopup($("#popup_update_contact"))}.bind(this));$("#popup_updatecontact_update").off().on("click",function(event){var contact;event.preventDefault();if(!validatePhone($("#mobile").val())){$("#popup_update_contact span:eq(1)").show();$("#popup_update_contact span:eq(1)").attr("class","redtxt");$(".txtandfield-container:eq(3) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(4) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(2) div").attr("class","row txtandfield-text-input-red")}else if(!validatePhone($("#office").val())){$("#popup_update_contact span:eq(1)").show();$("#popup_update_contact span:eq(1)").attr("class","redtxt");$(".txtandfield-container:eq(2) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(4) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(3) div").attr("class","row txtandfield-text-input-red")}else if(!validatePhone($("#home").val())){$("#popup_update_contact span:eq(1)").show();$("#popup_update_contact span:eq(1)").attr("class","redtxt");$(".txtandfield-container:eq(2) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(3) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(4) div").attr("class","row txtandfield-text-input-red")}else{$(".txtandfield-container:eq(2) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(3) div").attr("class","row txtandfield-text-input");$(".txtandfield-container:eq(4) div").attr("class","row txtandfield-text-input");$("#popup_update_contact span:eq(1)").attr("class","");$("#popup_update_contact span:eq(1)").hide();contact={givenName:$("#firstname").val(),familyName:$("#lastname").val(),formattedName:$("#lastname").val()+" "+$("#firstname").val(),birthDay:"",title:"",organisation:"",url:"",isFavourite:false,ringtoneId:$("#ring option:selected").text(),emailList:[],addressList:[],phoneNumberList:[]};if($("#mobile").val()!==""){contact.phoneNumberList.push({number:$("#mobile").val().toString(),type:"CELL",preferred:false})}if($("#office").val()!==""){contact.phoneNumberList.push({number:$("#office").val().toString(),type:"WORK",preferred:false})}if($("#home").val()!==""){contact.phoneNumberList.push({number:$("#home").val().toString(),type:"HOME",preferred:false})}if($("#popup_update_contact .title").html().indexOf("updatecontact")>0){contact.contactId=fields.dataCall[fields.selected].contact.contactId;this.generateEvent("ViewSubmitted",{origin:fields.id,state:"update_contact",param:contact})}else{this.generateEvent("ViewSubmitted",{origin:fields.id,state:"add_contact",param:contact})}TemplateClass.hidePopup($("#popup_update_contact"))}}.bind(this));$("#firstname, #lastname, #home, #office, #mobile").off().on("keyup",function(event){event.preventDefault();toggleSaveButton.call(this)}.bind(this));$("#popup_ring_form a").off().on("click",function(event){event.preventDefault();this.generateEvent("ViewSubmitted",{origin:fields.id,state:"ringtest",param:$("#ring option:selected").text()})}.bind(this));if(fields.sortBy==="name"){$("#journal_telephone_table_col1_sort").attr("class","conf-table-title-sortable-arrow-selected")}else if(fields.sortBy==="time"){$("#journal_telephone_table_col0_sort").attr("class","conf-table-title-sortable-arrow-selected")}$("#journal_telephone_table_col2_sort").hide()};fields={language:{id:"",data:{}},loggedUserBehaviour:{lastFocusedElt:[],lastClickedElt:[],lastRelevantElt:""},currentData:{},reverseName:false,reverseTime:false,reverseType:false,sortBy:"time",selected:0,dataCall:[],dataMissedCall:[],dataNotMissedCall:[],dataJournalTable:[]};StateViewClass.call(this,aStateId,aTranslateObj);this.init=function(aCallback){console.debug("VoiceJournalViewClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("VoiceJournalViewClass: Initialising state '"+this.getId()+"'","rra0099")}}],this)};this.quit=function(aCallback){console.debug("VoiceJournalViewClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.unsetStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("VoiceJournalViewClass: Releasing state '"+this.getId()+"'","rra0100")}}],this)};this.enable=function(aCallback){console.debug("VoiceJournalViewClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setAppCloseButton(aNext,"app_close")},function(aNext){this.viewDisplayPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){fields.reverseName=false;fields.reverseTime=false;fields.reverseType=false;fields.sortBy="time";basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("VoiceJournalViewClass: Enabling state '"+this.getId()+"'","rra0101")}}],this)};this.disable=function(aCallback){console.debug("VoiceJournalViewClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){fields.dataJournalTable=[];this.viewEmptyPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("VoiceJournalViewClass: Disabling state '"+this.getId()+"'","rra0102")}}],this)};this.logUserBehaviour=function(aCallback){$(window.document).on("click",function(event){if(fields.loggedUserBehaviour.lastClickedElt.length>10){fields.loggedUserBehaviour.lastClickedElt.shift()}fields.loggedUserBehaviour.lastClickedElt.push($(event.target))});$(window.document).on("focus",function(event){if(fields.loggedUserBehaviour.lastFocusedElt.length>10){fields.loggedUserBehaviour.lastFocusedElt.shift()}fields.loggedUserBehaviour.lastFocusedElt.push($(event.target))});basicUtilities.callback(aCallback,false,0,null)};this.logLastRelevantElt=function(aCallback,aObj){fields.loggedUserBehaviour.lastRelevantElt=aObj;basicUtilities.callback(aCallback,false,0,null)};this.getLastClickedHistory=function(){return fields.loggedUserBehaviour.lastClickedElt};this.getLastFocusedHistory=function(){return fields.loggedUserBehaviour.lastFocusedElt};this.getLastRelevantElt=function(){return fields.loggedUserBehaviour.lastRelevantElt};this.stripLines=function(aCallback,aString){basicUtilities.callback(aCallback,false,0,aString.replace(/(\r\n|\n|\r|\t)/gm,""))};this.fillTemplate=function(aCallback,template,context){basicUtilities.queue([function(aNext){this.stripLines(aNext,context)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,template(JSON.parse(aResult.data)))}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("VoiceJournalViewClass fillTemplate failed","rra0103")}}],this)};this.setStyle=function(aCallback){basicUtilities.queue([function(aNext){this.stripLines(aNext,Bootstrap)},function(aNext,aResult){if(!aResult||aResult.status===0){if(!$("#app_conf_style_sheet").length){$("head").append('<style id="app_conf_style_sheet">'+aResult.data+"</style>")}if(!$("#bootstrap_style_sheet").length){$("head").append('<style id="bootstrap_style_sheet">'+TemplateClass.style+"</style>")}basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("VoiceJournalViewClass setStyle failed","rra0104")}}],this)};this.unsetStyle=function(aCallback){if($("#app_conf_style_sheet").length){$("head").children("#app_conf_style_sheet").remove()}if($("#bootstrap_style_sheet").length){$("head").children("#bootstrap_style_sheet").remove()}basicUtilities.callback(aCallback,false,0,null)};this.viewEmptyPage=function(aCallback){$(window.document.body).html();basicUtilities.callback(aCallback,false,0,null)};this.setDisabledInput=function(aCallback,aId,aDisabled){if(aDisabled){$("#"+aId).prop("disabled",true)}else{$("#"+aId).prop("disabled",false)}basicUtilities.callback(aCallback,false,0,null)};this.displayStatuts=function(aStatut){var undef;if($("#telnumber").length===0){$(".header-title span").after('<span id="telnumber"></span>')}if(aStatut.phoneNumber!==undef&&aStatut.phoneNumber!==""){var prefix,indexPrefix,phoneNumber;prefix=["262","590","594","596"];phoneNumber=aStatut.phoneNumber;for(indexPrefix=0;indexPrefix<prefix.length;indexPrefix+=1){if(phoneNumber===aStatut.phoneNumber){phoneNumber=phoneNumber.replace(new RegExp(prefix[indexPrefix],"g"),"0")}}$("#telnumber").text(" (N° "+phoneNumber+")")}this.translate()};this.displayJournal=function(aList){var indexCall,call,undef,missedCall;fields.dataJournalTable=[];fields.dataCall=aList;missedCall=0;if(aList!==undef){sortJournalTable.call(this);for(indexCall=0;indexCall<fields.dataCall.length;indexCall+=1){call={};if(fields.dataCall[indexCall].contact.formattedName===""){if(fields.dataCall[indexCall].type==="missed"){call={type:"static",defaultvalue:["<span><b>"+formatDate.call(this,new Date(fields.dataCall[indexCall].date))+"</b></span>","<span style='font-weight: bold;'><a id='call_"+indexCall+"' href='#'>"+fields.dataCall[indexCall].phoneNumber+"</a></span><span style='display:none;'>"+fields.dataCall[indexCall].callLogId+"</span>","<b><span class='Translation' data-translation=voiceAdvanced.journal.type."+fields.dataCall[indexCall].type+"></span></b>"]}}else{call={type:"static",defaultvalue:["<span>"+formatDate.call(this,new Date(fields.dataCall[indexCall].date))+"</span>","<span><a id='call_"+indexCall+"' href='#'>"+fields.dataCall[indexCall].phoneNumber+"</a></span><span style='display:none;'>"+fields.dataCall[indexCall].callLogId+"</span>","<span class='Translation' data-translation=voiceAdvanced.journal.type."+fields.dataCall[indexCall].type+"></span>"]}}}else{if(fields.dataCall[indexCall].type==="missed"){call={type:"static",defaultvalue:["<span><b>"+formatDate.call(this,new Date(fields.dataCall[indexCall].date))+"</b></span>","<span style='font-weight: bold;'><a id='call_"+indexCall+"' href='#'>"+this.escapeString("js",this.escapeString("html",fields.dataCall[indexCall].contact.givenName+" "+fields.dataCall[indexCall].contact.familyName))+"</a></span><span style='display:none;'>"+fields.dataCall[indexCall].callLogId+"</span>","<b><span class='Translation' data-translation=voiceAdvanced.journal.type."+fields.dataCall[indexCall].type+"></span></b>"]}}else{call={type:"static",defaultvalue:["<span>"+formatDate.call(this,new Date(fields.dataCall[indexCall].date))+"</span>","<span><a id='call_"+indexCall+"' href='#'>"+this.escapeString("js",this.escapeString("html",fields.dataCall[indexCall].contact.givenName+" "+fields.dataCall[indexCall].contact.familyName))+"</a></span><span style='display:none;'>"+fields.dataCall[indexCall].callLogId+"</span>","<span class='Translation' data-translation=voiceAdvanced.journal.type."+fields.dataCall[indexCall].type+"></span>"]}}}if(fields.dataCall[indexCall].type==="missed"){missedCall+=1}fields.dataJournalTable.push(call)}}if(missedCall!==0){$("#missedCall").text(" ("+missedCall+") ")}else{$("#missedCall").text("")}basicUtilities.setCookie("missedCall",missedCall);displayJournalTable.call(this);if(aList!==undef&&aList.length>0){$("#delete_historic").show()}else{$("#delete_historic").hide()}};this.displayContact=function(aContact){var undef,indexPhoneNumber;$("#mobile").val("");$("#office").val("");$("#home").val("");$("#firstname").val("");$("#lastname").val("");$("#ring").val("1");if(aContact!==undef){$("#firstname").val(aContact.givenName);$("#lastname").val(aContact.familyName);$("#ring").val(aContact.ringtoneId);for(indexPhoneNumber=0;indexPhoneNumber<aContact.phoneNumberList.length;indexPhoneNumber+=1){if(aContact.phoneNumberList[indexPhoneNumber].type==="HOME"){$("#home").val(aContact.phoneNumberList[indexPhoneNumber].number)}else if(aContact.phoneNumberList[indexPhoneNumber].type==="WORK"){$("#office").val(aContact.phoneNumberList[indexPhoneNumber].number)}else{$("#mobile").val(aContact.phoneNumberList[indexPhoneNumber].number)}}}$("#popup_ring_form .txtandfield-label").attr("class","txtandfield-label col-xs-1");$("#popup_ring_form .txtandfield-text-input").attr("class","col-xs-1 txtandfield-text-input small-select-padding");$("#ring").attr("class","small-select");$("#mobile").attr("maxlength","20");$("#office").attr("maxlength","20");$("#home").attr("maxlength","20");$("#firstname").attr("maxlength","16");$("#lastname").attr("maxlength","16");$("#popup_updatecontact_update").attr("disabled",true)};this.viewDisplayPage=function(aCallback){basicUtilities.queue([function(aNext){this.fillTemplate(aNext,TemplateClass.template,Config)},function(aNext,aResult){if(!aResult||aResult.status===0){$(window.document.body).html(aResult.data);this.translate();TemplateClass.enablePopOver();$(window).resize(function(){TemplateClass.enablePopOver()});aNext()}else{basicUtilities.callback(aCallback,false,-1,null)}},function(){$("#delete_historic").hide();$("#tab_template_container").focus();listenViewEvents.call(this);this.setPageTitle(null,$(".header-title").find("h1").find("span").html());basicUtilities.callback(aCallback,false,0,null)}],this)}}return VoiceJournalViewClass});