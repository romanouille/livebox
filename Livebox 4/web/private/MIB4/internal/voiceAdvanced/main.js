define(["utils/console","utils/basics","lib/stateManager","app/voiceStatutCtrl","app/voiceStatutView","app/voiceJournalCtrl","app/voiceJournalView","app/voiceContactCtrl","app/voiceContactView","app/voiceAssociateCtrl","app/voiceAssociateView","jquery"],function(console,basicUtilities,StateManagerClass,VoiceStatutCtrlClass,VoiceStatutViewClass,VoiceJournalCtrlClass,VoiceJournalViewClass,VoiceContactCtrlClass,VoiceContactViewClass,VoiceAssociateCtrlClass,VoiceAssociateViewClass,$){"use strict";function MainClass(aSahObj,aConfigObj,aTranslateObj){var fields;fields={sahObj:aSahObj,stateManagerObj:null};fields.stateManagerObj=new StateManagerClass("voiceApp",aSahObj,aTranslateObj);this.getCallLog=function(aCallback){basicUtilities.queue([function(aNext){fields.sahObj.invokeApi("semantic","sah.Content.CallLog.browse",aNext,null)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("VoiceMainClass: Failed to retrieve voice calllog");basicUtilities.callback(aCallback,false,0,null)}}],this)};this.run=function(){basicUtilities.queue([function(aNext){fields.stateManagerObj.registerState(aNext,"Statut",VoiceStatutCtrlClass,VoiceStatutViewClass,false)},function(aNext,aResult){if(!aResult||aResult.status===0){fields.stateManagerObj.registerState(aNext,"Journal",VoiceJournalCtrlClass,VoiceJournalViewClass,false)}else{console.error("MainClass: Internal error. Aborting...")}},function(aNext,aResult){if(!aResult||aResult.status===0){fields.stateManagerObj.registerState(aNext,"Contact",VoiceContactCtrlClass,VoiceContactViewClass,false)}else{console.error("MainClass: Internal error. Aborting...")}},function(aNext,aResult){if(!aResult||aResult.status===0){fields.stateManagerObj.registerState(aNext,"Associate",VoiceAssociateCtrlClass,VoiceAssociateViewClass,false)}else{console.error("MainClass: Internal error. Aborting...")}},function(aNext,aResult){if(!aResult||aResult.status===0){$(window).on("hashchange",{},function(){switch(window.location.hash.substr(1)){case"statut":fields.stateManagerObj.switchState(null,"Statut",null);break;case"journal":fields.stateManagerObj.switchState(null,"Journal",null);break;case"contacts":fields.stateManagerObj.switchState(null,"Contact",null);break;case"associate":fields.stateManagerObj.switchState(null,"Associate",null);break;default:console.error('MainClass: Unknown State "'+window.location.hash.substr(1)+'". Redirecting to MHS');fields.stateManagerObj.requestAppClose(null);break}});basicUtilities.callback(aNext,false,0,null)}else{console.error("MainClass: Internal error. Aborting...")}},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.queue([function(aNext){this.getCallLog(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){if(aResult.data&&aResult.data.length>0){window.location.hash="#journal"}else{window.location.hash="#statut"}basicUtilities.callback(aNext,false,0,null)}else{basicUtilities.callback(aNext,false,-1,null)}}],this)}else{console.error("MainClass: Internal error. Aborting...")}}],this)}}return MainClass});