define(["utils/console","utils/basics","lib/stateCtrlInterface"],function(console,basicUtilities,StateCtrlClass){"use strict";function HubUserAccountCtrlClass(aStateId,aStateManager,aSahObj,aViewObj){var fields,onViewEvent=function(aEventId,aData){if(aEventId==="ViewSubmitted"){console.debug("HubUserAccountCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));if(aData.state==="account"){window.location.hash="#account"}else if(aData.state==="journal"){window.location.hash="#journal"}else if(aData.state==="add_user"){basicUtilities.queue([function(aNext){this.addUser(aNext,aData.param)},function(aNext,aResult){var undef;if(aResult.data===undef){aViewObj.displayPopupInfo("success")}else{switch(aResult.data){case-104:aViewObj.displayPopupInfo("error","exist");break;case-105:aViewObj.displayPopupInfo("error","compatible");break;case-106:aViewObj.displayPopupInfo("error","cgu");break;case-108:aViewObj.displayPopupInfo("error","max");break;case-107:aViewObj.displayPopupInfo("error","internet");break;default:aViewObj.displayPopupInfo("error","undefined");break}}basicUtilities.callback(aNext,false,0,null)}],this)}else if(aData.state==="list_user"){basicUtilities.queue([function(aNext,aResult){if(!aResult||aResult.status===0){this.getUsers(aNext)}else{basicUtilities.callback(null,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass: Enabling state '"+this.getId()+"'","rra0027")}},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayUsers(aResult.data.userList)}else{basicUtilities.callback(null,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass getUsers failed","rra0028")}}],this)}else if(aData.state==="update_state"){basicUtilities.queue([function(aNext){this.configureUser(aNext,aData.param)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getUsers(aNext)}else{aViewObj.displayPopupInfo("error","exist");basicUtilities.callback(aNext,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass: Failed to update user account","rra0040")}},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayUsers(aResult.data.userList)}else{basicUtilities.callback(null,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass getUsers failed","rra0041")}}],this)}else if(aData.state==="suspend"){basicUtilities.queue([function(aNext){this.configureUser(aNext,aData.param)},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayPopupInfo("suspend");basicUtilities.callback(aNext,false,0,null)}else{aViewObj.displayPopupInfo("error","exist");basicUtilities.callback(aNext,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass: Failed to suspend user account","rra0040")}}],this)}else if(aData.state==="activate"){basicUtilities.queue([function(aNext){this.configureUser(aNext,aData.param)},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayPopupInfo("activate");basicUtilities.callback(aNext,false,0,null)}else{aViewObj.displayPopupInfo("error","exist");basicUtilities.callback(aNext,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass: Failed to activate user account","rra0040")}}],this)}else if(aData.state==="delete"){basicUtilities.queue([function(aNext){this.deleteUser(aNext,aData.param)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getUsers(aNext)}else{this.getViewObj().notifyError("HubUserAccountCtrlClass: Failed to delete user account","rra0040");basicUtilities.callback(null,false,-1,null)}},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayUsers(aResult.data.userList)}else{basicUtilities.callback(null,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass getUsers failed","rra0041")}}],this)}}else{console.warn("HubUserAccountCtrlClass: Unexpected event '"+aEventId+"'");this.getViewObj().notifyError("HubUserAccountCtrlClass: Unexpected event '"+aEventId+"'","rra0042")}};fields={};StateCtrlClass.call(this,aStateId,aStateManager,aSahObj,aViewObj);this.init=function(aCallback){console.debug("HubUserAccountCtrlClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().subscribeEvents(this.getId(),onViewEvent.bind(this));this.getViewObj().init(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass init failed","rra0024")}}],this)};this.quit=function(aCallback){console.debug("HubUserAccountCtrlClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().quit(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass quit failed","rra0025")}}],this)};this.enable=function(aCallback){console.debug("HubUserAccountCtrlClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().enable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getUsers(aNext)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass: Enabling state '"+this.getId()+"'","rra0027")}},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayUsers(aResult.data.userList)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass getUsers failed","rra0028")}}],this)};this.disable=function(aCallback){console.debug("HubUserAccountCtrlClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().disable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass view disable failed","rra0029")}}],this)};this.getUsers=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.listUsers",aNext,null)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("HubUserAccountCtrlClass: Failed to retrieve list Users");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass: Failed to retrieve list Users","rra0031")}}],this)};this.addUser=function(aCallback,user){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.addUser",aNext,user)},function(aNext,aResult){basicUtilities.callback(aCallback,false,aResult.status,aResult.data)}],this)};this.configureUser=function(aCallback,userInfo){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.configureUser",aNext,userInfo)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("HubUserAccountCtrlClass: Failed to set user state");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass: Failed to set user state","rra0055")}}],this)};this.deleteUser=function(aCallback,user){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.deleteUser",aNext,user)},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("HubUserAccountCtrlClass: Failed to delete user");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubUserAccountCtrlClass: Failed to delete user","rra0055")}}],this)}}return HubUserAccountCtrlClass});