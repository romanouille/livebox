define(["utils/console","utils/basics","lib/eventHandler","lib/stateViewInterface","jquery","text","templates_app/template","text!bootstrap/bootstrap.css","text!app/config/internetRemote.json"],function(console,basicUtilities,EventHandlerClass,StateViewClass,$,Text,TemplateClass,Bootstrap,Config){"use strict";function InternetRemoteViewClass(aStateId,aTranslateObj){var fields;fields={};StateViewClass.call(this,aStateId,aTranslateObj);this.init=function(aCallback){console.debug("InternetRemoteViewClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.quit=function(aCallback){console.debug("InternetRemoteViewClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.unsetStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.enable=function(aCallback){console.debug("InternetRemoteViewClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setAppCloseButton(aNext,"app_close")},function(aNext){this.setAppCloseButton(aNext,"cancel")},function(aNext){this.viewDisplayPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.disable=function(aCallback){console.debug("InternetRemoteViewClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.viewEmptyPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.stripLines=function(aCallback,aString){basicUtilities.callback(aCallback,false,0,aString.replace(/(\r\n|\n|\r|\t)/gm,""))};this.fillTemplate=function(aCallback,template,context){basicUtilities.queue([function(aNext){this.stripLines(aNext,context)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,template(JSON.parse(aResult.data)))}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.setStyle=function(aCallback){basicUtilities.queue([function(aNext){this.stripLines(aNext,Bootstrap)},function(aNext,aResult){if(!aResult||aResult.status===0){if(!$("#app_conf_style_sheet").length){$("head").append('<style id="app_conf_style_sheet">'+aResult.data+"</style>")}if(!$("#bootstrap_style_sheet").length){$("head").append('<style id="bootstrap_style_sheet">'+TemplateClass.style+"</style>")}basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.unsetStyle=function(aCallback){if($("#app_conf_style_sheet").length){$("head").children("#app_conf_style_sheet").remove()}if($("#bootstrap_style_sheet").length){$("head").children("#bootstrap_style_sheet").remove()}basicUtilities.callback(aCallback,false,0,null)};this.viewEmptyPage=function(aCallback){$(window.document.body).html();basicUtilities.callback(aCallback,false,0,null)};this.viewDisplayPage=function(aCallback){basicUtilities.queue([function(aNext){this.fillTemplate(aNext,TemplateClass.template,Config)},function(aNext,aResult){if(!aResult||aResult.status===0){$(window.document.body).html(aResult.data);this.translate();this.setPageTitle(null,$(".header-title").find("h1").find("span").html());$("#admin .checkbox-container").css({"margin-top":"3em","margin-bottom":"2.5em"});console.debug("hide url label");$("#url").parent().hide();console.debug("hide IP label");$("#ip").parent().hide();aNext()}else{basicUtilities.callback(aCallback,false,-1,null)}},function(aNext){this.toggleFormAction();this.toggleSubmitButton(null);$("#login, #password, #port").on("keyup",function(){this.toggleSubmitButton(null)}.bind(this));$("input[name='adminCheckbox']").on("change",function(event){this.toggleFormAction();this.toggleSubmitButton($(event.target));this.displayPortError(true);this.displayPasswordError(true);this.displayLoginError(true);$("#url").parent().hide();$("#ip").parent().hide();if($(event.target).is(":checked")){this.fireEvent("ViewSubmitted",{action:"get"})}}.bind(this));$("#submit").on("click",function(){this.fireEvent("ViewSubmitted",{login:$("#login").val(),password:$("#password").val(),port:$("#port").val(),action:$("input[name='adminCheckbox']").is(":checked")?"activer":"desactiver"});$("#submit").attr("disabled",true)}.bind(this));aNext()},function(){$("#cancel").on("click",function(){this.fireEvent("ViewCancelled",null)}.bind(this));basicUtilities.callback(aCallback,false,0,null)}],this)};this.toggleSubmitButton=function(target){if(target===null){if($("#login").val()===""||$("#password").val()===""||$("#port").val()===""){$("#submit").attr("disabled",true)}else{$("#submit").attr("disabled",false)}}else{console.debug(target.is(":checked")+" is "+fields.isChecked);if(target.is(":checked")===fields.isChecked){$("#submit").attr("disabled",true)}else{$("#submit").attr("disabled",false)}}};this.displayLoginError=function(isValid){if(isValid){$("#login_warning").css("display","none");$("#login_label").css("color","#000000");$("#login").css("color","#000000");$("#login").css("border-color","#999999")}else{$("#login_warning").css("display","inline");$("#login_label").css("color","#CC0000");$("#login").css("color","#CC0000");$("#login").css("border-color","#CC0000")}};this.displayPasswordError=function(isValid){if(isValid){$("#password_warning").css("display","none");$("#password_label").css("color","#000000");$("#password").css("color","#000000");$("#password").css("border-color","#999999")}else{$("#password_warning").css("display","inline");$("#password_label").css("color","#CC0000");$("#password").css("color","#CC0000");$("#password").css("border-color","#CC0000")}};this.displayPortError=function(isValid){if(isValid){$("#port_warning").css("display","none");$("#port_label").css("color","#000000");$("#port").css("color","#000000");$("#port").css("border-color","#999999")}else{$("#port_warning").css("display","inline");$("#port_label").css("color","#CC0000");$("#port").css("color","#CC0000");$("#port").css("border-color","#CC0000")}};this.toggleFormAction=function(){if($("#admin_true").is(":checked")){$("#login").prop("disabled",false);$("#password").prop("disabled",false);$("#port").prop("disabled",false)}else{$("#login").val("");$("#password").val("");$("#port").val("");$("#login").prop("disabled",true);$("#password").prop("disabled",true);$("#port").prop("disabled",true)}};this.initLabelInfo=function(){$("#ip").parent().show();$("#url").parent().show();$("#url").css({display:"inline-block",width:"21.5%"});$("#url_value").css({"font-weight":"bold"});$("#ip").css({display:"inline-block",width:"21.5%"});$("#ip_value").css({"font-weight":"bold"})};this.getUrl=function(url){$("#url_value").html(" "+url)};this.getIP=function(ip){$("#ip_value").html(" "+ip)};this.setCheckbox=function(status){if(status){$("#admin_true").prop("checked",true)}else{$("#admin_true").prop("checked",false)}fields.isChecked=status};this.setFormInfo=function(login,password,port){$("#login").val(login);$("#password").val(password);$("#port").val(port)}}return InternetRemoteViewClass});