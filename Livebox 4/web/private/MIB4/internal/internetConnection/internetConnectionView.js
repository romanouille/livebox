define(["utils/console","utils/basics","lib/eventHandler","lib/stateViewInterface","jquery","text","templates_app/template","text!bootstrap/bootstrap.css","text!app/config/internetConnection.json"],function(console,basicUtilities,EventHandlerClass,StateViewClass,$,Text,TemplateClass,Bootstrap,Config){"use strict";function InternetConnectionViewClass(aStateId,aTranslateObj){var fields,errors,connectionMod;fields={};errors=false;StateViewClass.call(this,aStateId,aTranslateObj);this.init=function(aCallback){console.debug("InternetConnectionViewClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.quit=function(aCallback){console.debug("InternetConnectionViewClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.unsetStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.enable=function(aCallback){console.debug("InternetConnectionViewClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setAppCloseButton(aNext,"app_close")},function(aNext){this.setAppCloseButton(aNext,"cancel")},function(aNext){this.viewDisplayPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.disable=function(aCallback){console.debug("InternetConnectionViewClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.viewEmptyPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.stripLines=function(aCallback,aString){basicUtilities.callback(aCallback,false,0,aString.replace(/(\r\n|\n|\r|\t)/gm,""))};this.fillTemplate=function(aCallback,template,context){basicUtilities.queue([function(aNext){this.stripLines(aNext,context)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,template(JSON.parse(aResult.data)))}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.setStyle=function(aCallback){basicUtilities.queue([function(aNext){this.stripLines(aNext,Bootstrap)},function(aNext,aResult){if(!aResult||aResult.status===0){if(!$("#app_conf_style_sheet").length){$("head").append('<style id="app_conf_style_sheet">'+aResult.data+"</style>")}if(!$("#bootstrap_style_sheet").length){$("head").append('<style id="bootstrap_style_sheet">'+TemplateClass.style+"</style>")}basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.unsetStyle=function(aCallback){if($("#app_conf_style_sheet").length){$("head").children("#app_conf_style_sheet").remove()}if($("#bootstrap_style_sheet").length){$("head").children("#bootstrap_style_sheet").remove()}basicUtilities.callback(aCallback,false,0,null)};this.viewEmptyPage=function(aCallback){$(window.document.body).html();basicUtilities.callback(aCallback,false,0,null)};this.viewDisplayPage=function(aCallback){basicUtilities.queue([function(aNext){this.fillTemplate(aNext,TemplateClass.template,Config)},function(aNext,aResult){if(!aResult||aResult.status===0){$(window.document.body).html(aResult.data);this.translate();this.setPageTitle(null,$(".header-title").find("h1").find("span").html());$("#connecting").parent().hide();$("#restart").parent().hide();$("#connectionOK").hide();$("#connectionKODSL").hide();$("#connectionKOETHERNET").hide();$("#login").css("width","18.75em");$("#login").before("fti/ ");$("#password").attr("placeholder","******");aNext()}else{basicUtilities.callback(aCallback,false,-1,null)}},function(aNext){this.toggleFormAction();this.toggleSubmitButton();$("#login, #password").on("keyup",function(){this.toggleSubmitButton()}.bind(this));$("#admin").on("click",function(){this.toggleFormAction()}.bind(this));$("#submit").on("click",function(){this.testForm();if(!errors){this.fireEvent("ViewSubmitted",{login:$("#login").val(),password:$("#password").val(),action:"connect",choice:$("input[name=internetChoice]:checked").val(),reload:false})}}.bind(this));aNext()},function(){var self=this;$("#reload").on("click keypress",function(event){if(event.which===13||event.type==="click"){self.fireEvent("ViewSubmitted",{action:"connect",choice:$("input[name=internetChoice]:checked").val(),reload:true})}}.bind(this));basicUtilities.callback(aCallback,false,0,null)}],this)};this.toggleSubmitButton=function(){if($("#login").val()===""||$("#password").val()===""){$("#submit").attr("disabled",true)}else{$("#submit").attr("disabled",false)}};this.toggleFormAction=function(){if($("#admin_true").is(":checked")){$("#ConnectionForm").show()}else{$("#ConnectionForm").hide()}};this.showSpinner=function(connection){TemplateClass.spinnerAnimate();if($("#connectionKO"+connection).is(":visible")){$("#connectionKO"+connection).parent().hide()}else if($("#connectionOK").is(":visible")){$("#connectionOK").parent().hide()}$("#connecting").parent().show();window.setTimeout(function(){$("#connecting").parent().hide();$("#connectionOK").show()},1e4)};this.showSpinnerRestart=function(){TemplateClass.spinnerAnimate();$("#restart").parent().show();window.setTimeout(function(){$("#app_close").trigger("click")},1e4)};this.testForm=function(){errors=false;if($("#login").val()!==""&&$("#login").val().length<=15){this.displayLoginError(true)}else{this.displayLoginError(false);errors=true}if($("#password").val()!==""&&$("#login").val().length<=15){this.displayPasswordError(true)}else{this.displayPasswordError(false);errors=true}};this.displayConnectionState=function(state,connection){TemplateClass.spinnerAnimate();$("#connectionKOETHERNET").parent().hide();$("#connectionKODSL").parent().hide();$("#connecting").parent().hide();$("#connectionOK").parent().hide();if(state==="connecting"){$("#connecting").parent().show()}else if(state==="connected"){$("#connectionOK").parent().show();$("#connectionOK").show()}else if(state==="disconnected"){$("#connectionKO"+connection).parent().show();$("#connectionKO"+connection).show()}};this.displayLoginError=function(isValid){if(isValid){$("#login_warning").css("display","none");$("#login_label").css("color","#000000");$("#login").css("color","#000000");$("#login").css("border-color","#999999")}else{$("#login_warning").css("display","inline-block");$("#login_label").css("color","#CC0000");$("#login").css("color","#CC0000");$("#login").css("border-color","#CC0000")}};this.displayPasswordError=function(isValid){if(isValid){$("#password_warning").css("display","none");$("#password_label").css("color","#000000");$("#password").css("color","#000000");$("#password").css("border-color","#999999")}else{$("#password_warning").css("display","inline-block");$("#password_label").css("color","#CC0000");$("#password").css("color","#CC0000");$("#password").css("border-color","#CC0000")}};this.initChoice=function(linkMode){connectionMod=linkMode;if(linkMode==="DSL"||linkMode==="VDSL"){$("input[name=internetChoice]").filter("[value=DSL]").prop("checked",true)}else{$("input[name=internetChoice]").filter("[value=ETHERNET]").prop("checked",true)}};this.initLogin=function(login){$("#login").val(login)};this.leaveApplication=function(){window.setTimeout(function(){$("#app_close").trigger("click")},5e3)}}return InternetConnectionViewClass});