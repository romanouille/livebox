define(["utils/console","utils/basics","lib/eventHandler","lib/stateViewInterface","jquery","text","templates_app/template","text!bootstrap/bootstrap.css","json!app/config/wifiPrivateConfig.json","app/wifiAdvancedSharedView"],function(console,basicUtilities,EventHandlerClass,StateViewClass,$,Text,TemplateClass,Bootstrap,Config,SharedViewClass){"use strict";function WifiAdvancedPrivateViewClass(aStateId,aTranslateObj){var mapSecurityModes=function(securityMode){var knownSecurityModesBase={open:"None",wpamixp:"WPA-WPA2-Personal",wpamixe:"WPA-WPA2-Enterprise",wpa2p:"WPA2-Personal",wpa2e:"WPA2-Enterprise"},knownSecurityModes={},key;for(key in knownSecurityModesBase){if(knownSecurityModesBase.hasOwnProperty(key)){knownSecurityModes[key]=knownSecurityModesBase[key];knownSecurityModes[knownSecurityModesBase[key]]=key}}if(knownSecurityModes.hasOwnProperty(securityMode)){return knownSecurityModes[securityMode]}return false},isValidPinCode=function(code){var codePattern4=/^(\d{4})$/,codePattern8=/^(\d{8})$/,accum;if(code==="00000000"){return false}if(codePattern4.test(code)){return true}accum=0;if(!codePattern8.test(code)){return false}accum+=3*(~~(code/1e7)%10);accum+=1*(~~(code/1e6)%10);accum+=3*(~~(code/1e5)%10);accum+=1*(~~(code/1e4)%10);accum+=3*(~~(code/1e3)%10);accum+=1*(~~(code/100)%10);accum+=3*(~~(code/10)%10);accum+=1*(~~(code/1)%10);return 0===accum%10},wpsCommandToDisplayInitiallyEnabled="#wifi_private_wps_createpin_row, #wifi_private_wps_selfwpspincode_row, #wifi_private_wps_inputwps_row",wpsCommandToDisplayInitiallyDisabled="#wifi_private_wps_askforsave";this.fields={loggedUserBehaviour:{lastFocusedElt:[],lastClickedElt:[],lastRelevantElt:""},wpsPopupTimer:"",currentData:{},wpsHasChanged:false,macHasChanged:false,macAddHasChanged:false,macDelHasChanged:false,vapHasChanged:false,radioHasChanged:false,radioUsageModeHasChanged:false,wpsCommandToDisplay:wpsCommandToDisplayInitiallyDisabled};StateViewClass.call(this,aStateId,aTranslateObj);this.init=function(aCallback){console.debug("WifiAdvancedPrivateViewClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){SharedViewClass.import(aNext,this)},function(aNext,aResult){if(!aResult||aResult.status===0){this.setStyle(aNext)}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedPrivateViewClass: Failed to import shared view class","aba0155")}},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedPrivateViewClass: Failed to set style","aba0156")}}],this)};this.quit=function(aCallback){console.debug("WifiAdvancedPrivateViewClass: Releasing state '"+this.getId()+"'");basicUtilities.callback(aCallback,false,0,null)};this.enable=function(aCallback){console.debug("WifiAdvancedPrivateViewClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.fields.wpsHasChanged=false;this.fields.macHasChanged=false;this.fields.macAddHasChanged=false;this.fields.macDelHasChanged=false;this.fields.vapHasChanged=false;this.fields.radioHasChanged=false;this.fields.radioUsageModeHasChanged=false;$(document).off("click","#app_close");$(document).off("keypress","#app_close");$(document).on("click","#app_close",function(event){event.preventDefault();window.location.hash="#summary"});$(document).on("keypress","#app_close",function(event){var keyCode=event.keyCode||event.which;if(keyCode===13){event.preventDefault();$("#app_close").trigger("click")}});basicUtilities.callback(aNext,false,0,null)},function(aNext,aResult){if(!aResult||aResult.status===0){this.viewDisplayPage(aNext)}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedPrivateViewClass: Failed to set app close button","aba0157")}},function(aNext,aResult){if(!aResult||aResult.status===0){$("#wps_code_input_id_warning").find(".redtxt").css("font-size","2em");basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedPrivateViewClass: Failed to display view","aba0158")}}],this)};this.disable=function(aCallback){console.debug("WifiAdvancedPrivateViewClass: Disabling state '"+this.getId()+"'");basicUtilities.callback(aCallback,false,0,null)};this.viewDisplayPage=function(aCallback){basicUtilities.queue([function(aNext){this.fillTemplate(aNext,TemplateClass.template,Config)},function(aNext,aResult){if(!aResult||aResult.status===0){$(window.document.body).html(aResult.data);this.translate();TemplateClass.enableHover();aNext()}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedPrivateViewClass: Failed to fill template with configuration data","aba0159")}},function(aNext){$("#popup_wpspairing_close").on("click",function(){this.fireEvent("ViewUpdated",{reason:"stopPairing"});TemplateClass.hidePopup($("#popup_wps_pairing"));window.clearTimeout(this.fields.wpsPopupTimer)}.bind(this));$("#popup_wps_cancel").on("click",function(){TemplateClass.hidePopup($("#popup_wps"))}.bind(this));$("#popup_wps_submit").on("click",function(){var accessPointId;if(window.location.hash.substr(1)==="private5"){accessPointId=this.fields.currentData.private5Id}else{accessPointId=this.fields.currentData.private24Id}if(isValidPinCode($("#wps_code_input_id").val())){this.fireEvent("ViewUpdated",{reason:"pinPairing",value:$("#wps_code_input_id").val(),accessPointId:accessPointId});$("#wps_code_input_id_warning").css("display","none");TemplateClass.hidePopup($("#popup_wps"))}else{$("#wps_code_input_id_warning").css("display","inline-block")}}.bind(this));aNext()},function(){var rootvap,rootradio,rootwps,rootmac,index,index2,key,deviceFound,keyCode,tab;if(this.fields.currentData.getPrivateAccessPoints.radioUsageMode==="combined"){$("#submenu_config_wifi_frequency").hide();$("#private_title").show()}else{$("#submenu_config_wifi_frequency").show()}switch(window.location.hash.substr(1)){case"private5":$("#submenu_config_wifi_frequency_24").removeClass("sub-menu-button-selected");$("#submenu_config_wifi_frequency_5").addClass("sub-menu-button-selected");$("#submenu_config_wifi_frequency_24").attr("aria-pressed",false);$("#submenu_config_wifi_frequency_5").attr("aria-pressed",true);$("#submenu_config_wifi_frequency_5").off("click keypress");$("#submenu_config_wifi_frequency_24").on("click",function(event){event.preventDefault();window.location.hash="#private24"}.bind(this));$("#submenu_config_wifi_frequency_24").keypress(function(event){keyCode=event.keyCode||event.which;if(keyCode===13){event.preventDefault();$("#submenu_config_wifi_frequency_24").trigger("click")}}.bind(this));for(index=0;index<this.fields.currentData.getPrivateAccessPoints.accessPointList.length;index=index+1){if(this.fields.currentData.getPrivateAccessPoints.accessPointList[index].accessPointId===this.fields.currentData.private5Id){rootvap=this.fields.currentData.getPrivateAccessPoints.accessPointList[index];break}}for(index=0;index<this.fields.currentData.getPrivateAccessPoints.radioList.length;index=index+1){if(this.fields.currentData.getPrivateAccessPoints.radioList[index].radioId===this.fields.currentData.radio5Id){rootradio=this.fields.currentData.getPrivateAccessPoints.radioList[index];break}}for(index=0;index<this.fields.currentData.getPrivateWpsPairing.accessPointList.length;index=index+1){if(this.fields.currentData.getPrivateWpsPairing.accessPointList[index].accessPointId===this.fields.currentData.private5Id){rootwps=this.fields.currentData.getPrivateWpsPairing.accessPointList[index];break}}for(index=0;index<this.fields.currentData.getPrivateMacFiltering.accessPointList.length;index=index+1){if(this.fields.currentData.getPrivateMacFiltering.accessPointList[index].accessPointId===this.fields.currentData.private5Id){rootmac=this.fields.currentData.getPrivateMacFiltering.accessPointList[index];break}}break;case"private24":case"private":case"default":$("#submenu_config_wifi_frequency_5").removeClass("sub-menu-button-selected");$("#submenu_config_wifi_frequency_24").addClass("sub-menu-button-selected");$("#submenu_config_wifi_frequency_24").attr("aria-pressed",true);$("#submenu_config_wifi_frequency_5").attr("aria-pressed",false);$("#submenu_config_wifi_frequency_24").off("click keypress");$("#submenu_config_wifi_frequency_5").on("click",function(event){event.preventDefault();window.location.hash="#private5"}.bind(this));$("#submenu_config_wifi_frequency_5").keypress(function(event){keyCode=event.keyCode||event.which;if(keyCode===13){event.preventDefault();$("#submenu_config_wifi_frequency_5").trigger("click")}}.bind(this));for(index=0;index<this.fields.currentData.getPrivateAccessPoints.accessPointList.length;index=index+1){if(this.fields.currentData.getPrivateAccessPoints.accessPointList[index].accessPointId===this.fields.currentData.private24Id){rootvap=this.fields.currentData.getPrivateAccessPoints.accessPointList[index];break}}for(index=0;index<this.fields.currentData.getPrivateAccessPoints.radioList.length;index=index+1){if(this.fields.currentData.getPrivateAccessPoints.radioList[index].radioId===this.fields.currentData.radio24Id){rootradio=this.fields.currentData.getPrivateAccessPoints.radioList[index];break}}for(index=0;index<this.fields.currentData.getPrivateWpsPairing.accessPointList.length;index=index+1){if(this.fields.currentData.getPrivateWpsPairing.accessPointList[index].accessPointId===this.fields.currentData.private24Id){rootwps=this.fields.currentData.getPrivateWpsPairing.accessPointList[index];break}}for(index=0;index<this.fields.currentData.getPrivateMacFiltering.accessPointList.length;index=index+1){if(this.fields.currentData.getPrivateMacFiltering.accessPointList[index].accessPointId===this.fields.currentData.private24Id){rootmac=this.fields.currentData.getPrivateMacFiltering.accessPointList[index];break}}break}$(".header-title").children("h1").html($(".header-title").children("h1").html()+this.escapeString("js",this.escapeString("html",rootvap.ssid)));this.setValue(null,"wifi_private_ssid",rootvap.ssid);this.setCheckedInput(null,"wifi_private_broadcastssid_id_1",rootvap.isSsidBroadcasted);$("#wifi_private_securitytype").css({width:"20em"});this.setOptionByValue(null,"wifi_private_securitytype",mapSecurityModes(rootvap.securityMode));this.setValue(null,"wifi_private_securitykey",rootvap.securityKey);if(rootradio.frequencyBand.toLowerCase()==="2.4ghz"){$("#wifi_private_radiochannel_mode2").closest(".row.txtandfield-row.no-margin").hide();$("#wifi_private_radiochannel_mode2").closest(".row.txtandfield-row.no-margin").attr("aria-hidden",true);$("#wifi_private_radiochannel_mode").closest(".row.txtandfield-row.no-margin").show();$("#wifi_private_radiochannel_mode").closest(".row.txtandfield-row.no-margin").attr("aria-hidden",false);$("#wifi_private_radiochannel_mode").closest(".select-container").append("<span id='wifi_private_radiochannel_value' style='padding-left:0.5em;'>"+rootradio.channelNumber.toString()+"</span>")}else{$("#wifi_private_radiochannel_mode").closest(".row.txtandfield-row.no-margin").hide();$("#wifi_private_radiochannel_mode").closest(".row.txtandfield-row.no-margin").attr("aria-hidden",true);$("#wifi_private_radiochannel_mode2").closest(".row.txtandfield-row.no-margin").show();$("#wifi_private_radiochannel_mode2").closest(".row.txtandfield-row.no-margin").attr("aria-hidden",false);$("#wifi_private_radiochannel_mode2").closest(".select-container").append("<span id='wifi_private_radiochannel_value' style='padding-left:0.5em;'>"+rootradio.channelNumber.toString()+"</span>")}if(this.fields.currentData.getPrivateAccessPoints.radioUsageMode==="combined"&&window.location.hash.substr(1)==="private5"){this.setOptionByValue(null,"wifi_private_radiochannel_mode2","auto");this.setDisabledInput(null,"wifi_private_radiochannel_mode2",true)}if(window.location.hash.substr(1)==="private5"){$("#wifi_private_different_ssid").closest(".row.txtandfield-row.no-margin").hide()}else{if(this.fields.currentData.getPrivateAccessPoints.radioUsageMode==="standard"){this.setOptionByValue(null,"wifi_private_different_ssid","0")}else{this.setOptionByValue(null,"wifi_private_different_ssid","1")}}this.setOptionByValue(null,"wifi_private_wps_enable",rootwps.isPairingEnabled?"1":"0");$(wpsCommandToDisplayInitiallyDisabled).hide();if(rootwps.isPairingEnabled){this.fields.wpsCommandToDisplay=wpsCommandToDisplayInitiallyEnabled;$(wpsCommandToDisplayInitiallyEnabled).show();$("#wifi_private_macfiltering_devices").hide()}else{this.fields.wpsCommandToDisplay=wpsCommandToDisplayInitiallyDisabled;$(wpsCommandToDisplayInitiallyEnabled).hide();$("#wifi_private_macfiltering_devices").show()}this.setOptionByValue(null,"wifi_private_macfiltering_enable",rootmac.isActivated?"1":"0");for(index=0;index<rootmac.macAddressList.length;index=index+1){deviceFound=false;for(index2=0;index2<this.fields.currentData.getAllDevices.deviceList.length;index2=index2+1){if(this.fields.currentData.getAllDevices.deviceList[index2].hasOwnProperty("WIFI")){if(this.fields.currentData.getAllDevices.deviceList[index2].WIFI.hasOwnProperty("macAddress")){if(this.fields.currentData.getAllDevices.deviceList[index2].WIFI.macAddress===rootmac.macAddressList[index]){this.addDeviceRow(this.fields.currentData.getAllDevices.deviceList[index2].deviceName||this.fields.currentData.getAllDevices.deviceList[index2].deviceId,this.fields.currentData.getAllDevices.deviceList[index2].WIFI.macAddress);deviceFound=true;break}}else{continue}}else{continue}}if(!deviceFound){this.addDeviceRow(rootmac.macAddressList[index],rootmac.macAddressList[index])}}this.fields.currentData.devicesByMac={};for(index=0;index<this.fields.currentData.getAllDevices.deviceList.length;index=index+1){if(this.fields.currentData.getAllDevices.deviceList[index].hasOwnProperty("WIFI")){if(this.fields.currentData.getAllDevices.deviceList[index].WIFI.hasOwnProperty("macAddress")){deviceFound=false;for(index2=0;index2<rootmac.macAddressList.length;index2=index2+1){if(this.fields.currentData.getAllDevices.deviceList[index].WIFI.macAddress===rootmac.macAddressList[index2]){deviceFound=true;break}}if(!deviceFound){this.fields.currentData.devicesByMac[this.fields.currentData.getAllDevices.deviceList[index].deviceName||this.fields.currentData.getAllDevices.deviceList[index].deviceId]=this.fields.currentData.getAllDevices.deviceList[index].WIFI.macAddress}}else{continue}}else{continue}}tab=[{value:"...",inner:"..."}];for(key in this.fields.currentData.devicesByMac){if(this.fields.currentData.devicesByMac.hasOwnProperty(key)){tab.push({value:key,inner:key})}}this.fillOptions(null,"wifi_private_macfiltering_devices_select_entry",tab);$("#wifi_private_macfiltering_devices_select_entry").change(function(){var value=$("#wifi_private_macfiltering_devices_select_entry option:selected").val();$("#wifi_private_macfiltering_devices_newmac_entry").val(value==="..."?"":this.fields.currentData.devicesByMac[value])}.bind(this));if(rootmac.isActivated){$("#wifi_private_macfiltering_devices").show()}else{$("#wifi_private_macfiltering_devices").hide()}$("#wifi_private_macfiltering_devices_table").on("click",".wifi_private_macfiltering_devices_add",function(event){event.preventDefault();this.viewAddDeviceRow(null)}.bind(this));$("#wifi_private_macfiltering_devices_table").on("click",".wifi_private_macfiltering_devices_delete",function(event){event.preventDefault();this.viewDeleteDeviceRow(null,event.target)}.bind(this));$("#wifi_private_securitytype").change(function(){if($("#wifi_private_securitytype option:selected").val()==="open"){this.setOptionByValue(null,"wifi_private_wps_enable","0");$(this.fields.wpsCommandToDisplay).hide();this.setOptionByValue(null,"wifi_private_macfiltering_enable","1");$("#wifi_private_macfiltering_devices").show();this.setValue(null,"wifi_private_securitykey","")}else{this.setOptionByValue(null,"wifi_private_wps_enable","1");$(this.fields.wpsCommandToDisplay).show();this.setOptionByValue(null,"wifi_private_macfiltering_enable","0");$("#wifi_private_macfiltering_devices").hide();if($("#wifi_private_securitytype option:selected").val()==="wpamixp"||$("#wifi_private_securitytype option:selected").val()==="wpa2p"){this.setValue(null,"wifi_private_securitykey",rootvap.securityKeyList.wpa)}}this.fields.wpsHasChanged=true;this.fields.macHasChanged=true;this.fields.vapHasChanged=true}.bind(this));$("#wifi_private_wps_enable").change(function(){if($("#wifi_private_wps_enable option:selected").val()==="1"){$(this.fields.wpsCommandToDisplay).show();this.setOptionByValue(null,"wifi_private_macfiltering_enable","0");$("#wifi_private_macfiltering_devices").hide()}else{$(this.fields.wpsCommandToDisplay).hide();this.setOptionByValue(null,"wifi_private_macfiltering_enable","1");$("#wifi_private_macfiltering_devices").show()}this.fields.wpsHasChanged=true;this.fields.macHasChanged=true}.bind(this));$("#wifi_private_broadcastssid_id_1").change(function(){if(!$("#wifi_private_broadcastssid_id_1").prop("checked")){this.setOptionByValue(null,"wifi_private_wps_enable","0");$(this.fields.wpsCommandToDisplay).hide();this.setOptionByValue(null,"wifi_private_macfiltering_enable","1");$("#wifi_private_macfiltering_devices").show()}else{this.setOptionByValue(null,"wifi_private_wps_enable","1");$(this.fields.wpsCommandToDisplay).show();this.setOptionByValue(null,"wifi_private_macfiltering_enable","0");$("#wifi_private_macfiltering_devices").hide()}this.fields.wpsHasChanged=true;this.fields.macHasChanged=true;this.fields.vapHasChanged=true}.bind(this));$("#wifi_private_macfiltering_enable").change(function(){if($("#wifi_private_macfiltering_enable option:selected").val()==="1"){$("#wifi_private_macfiltering_devices").show();this.setOptionByValue(null,"wifi_private_wps_enable","0");$(this.fields.wpsCommandToDisplay).hide()}else{$("#wifi_private_macfiltering_devices").hide();this.setOptionByValue(null,"wifi_private_wps_enable","1");$(this.fields.wpsCommandToDisplay).show()}this.fields.macHasChanged=true;this.fields.wpsHasChanged=true}.bind(this));this.setPageTitle(null,$(".header-title").find("h1").html());$("#wifi_private_wps_createpin").on("click",function(event){var accessPointId;if(window.location.hash.substr(1)==="private5"){accessPointId=this.fields.currentData.private5Id}else{accessPointId=this.fields.currentData.private24Id}event.preventDefault();TemplateClass.showPopup($("#popup_wps_pairing"));TemplateClass.spinnerAnimate();this.fireEvent("ViewUpdated",{reason:"selfPinPairing",accessPointId:accessPointId});this.fields.wpsPopupTimer=window.setTimeout(function(){TemplateClass.hidePopup($("#popup_wps_pairing"));this.fireEvent("ViewUpdated",{reason:"stopPairing"})}.bind(this),18e4)}.bind(this));$("#wifi_private_wps_createpin").keypress(function(event){var keyCode=event.keyCode||event.which;if(keyCode===13){event.preventDefault();$("#wifi_private_wps_createpin").trigger("click")}}.bind(this));$("#inputwps_link").on("click",function(event){event.preventDefault();TemplateClass.showPopup($("#popup_wps"));$("#wps_code_input_id").val("");this.setDisabledInput(null,"popup_wps_submit",true)}.bind(this));$("#inputwps_link").keypress(function(event){var keyCode=event.keyCode||event.which;if(keyCode===13){event.preventDefault();$("#inputwps_link").trigger("click")}}.bind(this));$("#cancel").on("click",function(event){event.preventDefault();window.location.hash="#summary"}.bind(this));$("#wps_code_input_id").on("input",function(){this.setDisabledInput(null,"popup_wps_submit",false)}.bind(this));$("#wifi_private_wps_enable").change(function(){this.fields.wpsHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this));$("#wifi_private_macfiltering_enable").change(function(){this.fields.macHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this));$(".wifi_private_macfiltering_devices_add").on("click",function(){this.fields.macAddHasChanged=true;this.fields.macHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this));$(document).on("click",".wifi_private_macfiltering_devices_delete",function(){this.fields.macDelHasChanged=true;this.fields.macHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this));$("#wifi_private_broadcastssid_id_1, #wifi_private_securitytype").change(function(){this.fields.vapHasChanged=true;this.fields.wpsHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this));$("#wifi_private_ssid, #wifi_private_securitykey").on("input",function(){this.fields.vapHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this));if(rootradio.frequencyBand.toLowerCase()==="2.4ghz"){$("#wifi_private_radiochannel_mode").change(function(){this.fields.radioHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this))}else{$("#wifi_private_radiochannel_mode2").change(function(){this.fields.radioHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this))}$("#wifi_private_different_ssid").change(function(){this.fields.radioUsageModeHasChanged=true;this.setDisabledInput(null,"save",false)}.bind(this));$("#save").on("click",null,function(){var value;if(this.viewCheckValues()){if(this.fields.currentData.isWifiUsedByDevices){TemplateClass.showPopup($("#popup_confirm"));$("#popup_confirm_submit").off("click");$("#popup_confirm_submit").on("click",function(){TemplateClass.hidePopup($("#popup_confirm"));value=this.viewRetrieveAndFormatAllValues(null);this.fireEvent("ViewSubmitted",{value:value})}.bind(this))}else{value=this.viewRetrieveAndFormatAllValues(null);this.fireEvent("ViewSubmitted",{value:value})}}}.bind(this));$("#popup_confirm_cancel").on("click",function(){TemplateClass.hidePopup($("#popup_confirm"))});this.setDisabledInput(null,"save",true);basicUtilities.callback(aCallback,false,0,null)}],this)};this.hidePopup=function(aId){TemplateClass.hidePopup($("#"+aId))};this.viewPutWpsPin=function(aCallback,aPin){$("#selfwpspincode").html(aPin);$("#popup_selfwpspincode").html(aPin);basicUtilities.callback(aCallback,false,0,null)};this.viewDeleteDeviceRow=function(aCallback,aButton){if($(aButton)){$(aButton).closest(".conf-table-row").remove();basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedPrivateViewClass: Failed to delete row of device filtered by MAC address","aba0160")}};this.addDeviceRow=function(deviceName,deviceMac){var table,rows,firstRow,buffer;table=$("#wifi_private_macfiltering_devices_table");rows=$(table).children("tbody").children("tr");firstRow=$(rows[1]);buffer="<tr class='conf-table-row'><td class='conf-table-cell'>"+this.escapeString("js",this.escapeString("html",deviceName))+"</td><td class='conf-table-cell'>"+deviceMac+"</td><td class='conf-table-blank-cell'><a href='#' class='wifi_private_macfiltering_devices_delete'><img class='conf-table-button-delete Translation' data-translation='common.delete' src='../../common/img/app_conf/trashbin_666.png'></a></td></tr>";$(firstRow).after(buffer);this.translate(table)};this.viewAddDeviceRow=function(aCallback){var table,rows,firstRow,buffer,deviceName,deviceMac;table=$("#wifi_private_macfiltering_devices_table");rows=$(table).children("tbody").children("tr");firstRow=$(rows[1]);deviceMac=$("#wifi_private_macfiltering_devices_newmac_entry").val();if($("select#wifi_private_macfiltering_devices_select_entry option:selected").val()==="..."){deviceName=deviceMac}else{deviceName=$("select#wifi_private_macfiltering_devices_select_entry option:selected").val()}buffer="<tr class='conf-table-row'><td class='conf-table-cell'>"+this.escapeString("js",this.escapeString("html",deviceName))+"</td><td class='conf-table-cell'>"+deviceMac+"</td><td class='conf-table-blank-cell'><a href='#' class='wifi_private_macfiltering_devices_delete'><img class='conf-table-button-delete Translation' data-translation='common.delete' src='../../common/img/app_conf/trashbin_666.png'></a></td></tr>";$(firstRow).after(buffer);this.translate(table);basicUtilities.callback(aCallback,false,0,null)};this.viewRetrieveAndFormatAllValues=function(){var result={};if(this.fields.wpsHasChanged){result.wps=this.viewRetrieveAndFormatWpsValues()}if(this.fields.macHasChanged){result.mac=this.viewRetrieveAndFormatMacFilteringValues()}if(this.fields.macAddHasChanged){result.macAdd=this.viewRetrieveAndFormatMacFilteringEntriesToAdd()}if(this.fields.macDelHasChanged){result.macDel=this.viewRetrieveAndFormatMacFilteringEntriesToDelete()}if(this.fields.vapHasChanged){result.vap=this.viewRetrieveAndFormatAccessPointValues()}if(this.fields.radioHasChanged){result.radio=this.viewRetrieveAndFormatRadioValues()}if(this.fields.radioUsageModeHasChanged){if($("#wifi_private_different_ssid").css("display").toLowerCase()!=="none"){result.radioUsageMode=$("select#wifi_private_different_ssid option:selected").val()==="0"?"standard":"combined"}}return result};this.viewRetrieveAndFormatWpsValues=function(){var result={};result.accessPointIdList=[];result.accessPointIdList.push(window.location.hash.substr(1)==="private5"?this.fields.currentData.private5Id:this.fields.currentData.private24Id);if($("select#wifi_private_wps_enable option:selected").val()==="1"){result.isPairingEnabled=true}else{result.isPairingEnabled=false}return result};this.viewRetrieveAndFormatMacFilteringValues=function(){var result={};result.accessPointIdList=[];result.accessPointIdList.push(window.location.hash.substr(1)==="private5"?this.fields.currentData.private5Id:this.fields.currentData.private24Id);if($("select#wifi_private_macfiltering_enable option:selected").val()==="1"){result.isActivated=true;result.mode="whiteList"}else{result.isActivated=false}return result};this.viewRetrieveAndFormatMacFilteringEntriesToAdd=function(){var result={},target=$("#wifi_private_macfiltering_devices_table").children("tbody").children("tr"),current,index;result.accessPointIdList=[];result.accessPointIdList.push(window.location.hash.substr(1)==="private5"?this.fields.currentData.private5Id:this.fields.currentData.private24Id);result.macAddressList=[];for(index=2;index<$(target).length;index=index+1){current=$(target[index]).children("td").eq(1).html();result.macAddressList.push(current.toString())}return result};this.viewRetrieveAndFormatMacFilteringEntriesToDelete=function(){var result={},index,aId=this.fields.currentData.private24Id;if(window.location.hash.substr(1)==="private5"){aId=this.fields.currentData.private5Id}result.accessPointIdList=[];result.accessPointIdList.push(aId);result.macAddressList=[];for(index=0;index<this.fields.currentData.getPrivateMacFiltering.accessPointList.length;index=index+1){if(aId===this.fields.currentData.getPrivateMacFiltering.accessPointList[index].accessPointId){result.macAddressList=this.fields.currentData.getPrivateMacFiltering.accessPointList[index].macAddressList.slice(0);break}}return result};this.viewRetrieveAndFormatAccessPointValues=function(){var result={};result.accessPointId=window.location.hash.substr(1)==="private5"?this.fields.currentData.private5Id:this.fields.currentData.private24Id;result.ssid=$("#wifi_private_ssid").val().trim();result.isSsidBroadcasted=$("#wifi_private_broadcastssid_id_1").prop("checked");result.securityMode=mapSecurityModes($("select#wifi_private_securitytype option:selected").val());result.securityKey=$("#wifi_private_securitykey").val();return result};this.viewRetrieveAndFormatRadioValues=function(){var result={};result.radioId=window.location.hash.substr(1)==="private5"?this.fields.currentData.radio5Id:this.fields.currentData.radio24Id;if($("select#wifi_private_radiochannel_mode:visible")){if($("select#wifi_private_radiochannel_mode option:selected").val()==="auto"){result.channelMode=$("select#wifi_private_radiochannel_mode option:selected").val()}else{result.channelMode="manual";result.channelNumber=parseInt($("select#wifi_private_radiochannel_mode option:selected").val(),10)}}else{if($("select#wifi_private_radiochannel_mode2 option:selected").val()==="auto"){result.channelMode=$("select#wifi_private_radiochannel_mode2 option:selected").val()}else{result.channelMode="manual";result.channelNumber=parseInt($("select#wifi_private_radiochannel_mode2 option:selected").val(),10)}}return result};this.viewCheckValues=function(){var selectedSecurityTypeTest=$("select#wifi_private_securitytype option:selected").val()==="wpamixp"||$("select#wifi_private_securitytype option:selected").val()==="wpamixe"||$("select#wifi_private_securitytype option:selected").val()==="wpa2p"||$("select#wifi_private_securitytype option:selected").val()==="wpa2e",index,ssidTest,ssidTest2=true,ssidListToCheck=[],keyTest,usageModeFormValue;$("#wifi_private_ssid_warning").hide();if(this.isValidSSID($("#wifi_private_ssid").val())){ssidTest=true}else{ssidTest=false}if(this.fields.currentData.ssidCollision.hasOwnProperty("guest24")){ssidListToCheck.push(this.fields.currentData.ssidCollision.guest24)}if(this.fields.currentData.ssidCollision.hasOwnProperty("guest5")){ssidListToCheck.push(this.fields.currentData.ssidCollision.guest5)}if(this.fields.currentData.ssidCollision.hasOwnProperty("secureHotspot")){ssidListToCheck.push(this.fields.currentData.ssidCollision.secureHotspot)}if(this.fields.currentData.ssidCollision.hasOwnProperty("openHotspot")){ssidListToCheck.push(this.fields.currentData.ssidCollision.openHotspot)}if($("select#wifi_private_different_ssid option:selected").val()==="0"){usageModeFormValue="standard"}else{usageModeFormValue="combined"}if(!this.fields.radioUsageModeHasChanged||this.fields.currentData.getPrivateAccessPoints.radioUsageMode===usageModeFormValue){if(this.fields.currentData.getPrivateAccessPoints.radioUsageMode==="standard"){if(window.location.hash.substr(1)==="private5"){ssidListToCheck.push(this.fields.currentData.ssidCollision.private24)}else{ssidListToCheck.push(this.fields.currentData.ssidCollision.private5)}}}for(index=0;index<ssidListToCheck.length;index=index+1){if($("#wifi_private_ssid").val().trim()===ssidListToCheck[index].trim()){ssidTest2=false;break}}if(ssidTest===false){if($("#wifi_private_ssid").val().length>32){$("#wifi_private_ssid_warning_txt").attr("data-translation","wifiAdvanced.error2")}else if($("#wifi_private_ssid").val().trim()!==$("#wifi_private_ssid").val()){$("#wifi_private_ssid_warning_txt").attr("data-translation","wifiAdvanced.error2blanks")}else{$("#wifi_private_ssid_warning_txt").attr("data-translation","wifiAdvanced.wificonfiguration.ssid.warning")}this.translate("#wifi_private_ssid_warning");$("#wifi_private_ssid_warning").css("display","inline-block")}if(ssidTest2===false){$("#wifi_private_ssid_warning_txt").attr("data-translation","wifiAdvanced.error1");this.translate("#wifi_private_ssid_warning");$("#conflicting_ssid").html("'"+$("#wifi_private_ssid").val()+"'");$("#wifi_private_ssid_warning").css("display","inline-block")}if(this.isValidWPAKey($("#wifi_private_securitykey").val())&&selectedSecurityTypeTest){$("#wifi_private_securitykey_warning").hide();keyTest=true}else if($("select#wifi_private_securitytype option:selected").val()==="open"){$("#wifi_private_securitykey_warning").hide();keyTest=true}else{$("#wifi_private_securitykey_warning").css("display","inline-block");keyTest=false}return ssidTest&&ssidTest2&&keyTest}}return WifiAdvancedPrivateViewClass});