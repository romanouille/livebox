define(["utils/console","utils/basics","lib/eventHandler","lib/stateViewInterface","jquery","text","templates_app/template","text!bootstrap/bootstrap.css","json!app/config/wifiSummary.json","app/wifiAdvancedSharedView"],function(console,basicUtilities,EventHandlerClass,StateViewClass,$,Text,TemplateClass,Bootstrap,Config,SharedViewClass){"use strict";function WifiAdvancedSummaryViewClass(aStateId,aTranslateObj){this.fields={loggedUserBehaviour:{lastFocusedElt:[],lastClickedElt:[],lastRelevantElt:""},currentData:{},wpsPopupTimer:""};StateViewClass.call(this,aStateId,aTranslateObj);this.init=function(aCallback){console.debug("WifiAdvancedSummaryViewClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){SharedViewClass.import(aNext,this)},function(aNext,aResult){if(!aResult||aResult.status===0){this.setStyle(aNext)}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to import SharedViewClass","aba0028")}},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to set style","aba0029")}}],this)};this.quit=function(aCallback){console.debug("WifiAdvancedSummaryViewClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.unsetStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to set unstyle","aba0030")}}],this)};this.enable=function(aCallback){console.debug("WifiAdvancedSummaryViewClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setAppCloseButton(aNext,"app_close")},function(aNext,aResult){if(!aResult||aResult.status===0){this.viewDisplayPage(aNext)}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to set app close button","aba0031")}},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to display view","aba0032")}}],this)};this.disable=function(aCallback){console.debug("WifiAdvancedSummaryViewClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.viewEmptyPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to empty view","aba0033")}}],this)};this.viewDisplayPage=function(aCallback){var index,subindex,rootvap,rootradio;basicUtilities.queue([function(aNext){this.fillTemplate(aNext,TemplateClass.template,Config)},function(aNext,aResult){if(!aResult||aResult.status===0){$(window.document.body).html(aResult.data);this.translate();this.setPageTitle(aNext,$(".header-title").find("h1").find("span").html())}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to fill template with config data","aba0034")}},function(aNext,aResult){if(!aResult||aResult.status===0){this.setToggleOnOff(aNext,"wifi_global",this.fields.currentData.getGlobalWifiStatus.isActivated)}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to translate and set page title","aba0035")}},function(aNext,aResult){if(!aResult||aResult.status===0){this.setToggleOnOff(aNext,"wifi_scheduler",this.fields.currentData.getGlobalWifiStatus.useSchedule)}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to set toggle of global wifi status","aba0036")}},function(aNext,aResult){var isCombined24Enabled=false,isCombined5Enabled=false,combinedSsid;this.translate("#wifi_global");this.translate("#wifi_scheduler");if(!aResult||aResult.status===0){if(this.fields.currentData.getAccessPoints.radioUsageMode==="standard"){for(index=0;index<this.fields.currentData.getAccessPoints.accessPointList.length;index=index+1){rootvap=this.fields.currentData.getAccessPoints.accessPointList[index];if(rootvap.linkType==="WIFI_2.4_PRIVATE"){for(subindex=0;subindex<this.fields.currentData.getAccessPoints.radioList.length;subindex=subindex+1){rootradio=this.fields.currentData.getAccessPoints.radioList[subindex];if(rootvap.radioId===rootradio.radioId){this.viewSetAccessPointState(null,"private24",rootvap.ssid,rootvap.isEnabled&&rootradio.isEnabled,rootvap.frequencyBand);break}}}else if(rootvap.linkType==="WIFI_5_PRIVATE"){for(subindex=0;subindex<this.fields.currentData.getAccessPoints.radioList.length;subindex=subindex+1){rootradio=this.fields.currentData.getAccessPoints.radioList[subindex];if(rootvap.radioId===rootradio.radioId){this.viewSetAccessPointState(null,"private5",rootvap.ssid,rootvap.isEnabled&&rootradio.isEnabled,rootvap.frequencyBand);break}}}}this.viewSetConfigurationMode(aNext,"standard")}else if(this.fields.currentData.getAccessPoints.radioUsageMode==="combined"){for(index=0;index<this.fields.currentData.getAccessPoints.accessPointList.length;index=index+1){rootvap=this.fields.currentData.getAccessPoints.accessPointList[index];if(rootvap.linkType==="WIFI_2.4_PRIVATE"||rootvap.linkType==="WIFI_5_PRIVATE"){for(subindex=0;subindex<this.fields.currentData.getAccessPoints.radioList.length;subindex=subindex+1){rootradio=this.fields.currentData.getAccessPoints.radioList[subindex];combinedSsid=rootvap.ssid;if(rootvap.radioId===rootradio.radioId&&(rootvap.isEnabled&&rootradio.isEnabled)){if(rootvap.linkType==="WIFI_2.4_PRIVATE"){isCombined24Enabled=true}else if(rootvap.linkType==="WIFI_5_PRIVATE"){isCombined5Enabled=true}}}}}if(!combinedSsid){combinedSsid="Private"}if(isCombined24Enabled&&isCombined5Enabled){this.viewSetAccessPointState(null,"privateboth",combinedSsid,true,"both")}else if(isCombined24Enabled){this.viewSetAccessPointState(null,"privateboth",combinedSsid,true,"2.4ghz")}else if(isCombined5Enabled){this.viewSetAccessPointState(null,"privateboth",combinedSsid,true,"5ghz")}else{this.viewSetAccessPointState(null,"privateboth",combinedSsid,false,"both")}this.viewSetConfigurationMode(aNext,"combined")}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedSummaryViewClass: Radio usage mode does not match a known value","aba0037")}}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to set toggle of wifi scheduler status","aba0038")}},function(aNext,aResult){var isCombined24Enabled=false,isCombined5Enabled=false,combinedSsid;if(!aResult||aResult.status===0){for(index=0;index<this.fields.currentData.getAccessPoints.accessPointList.length;index=index+1){rootvap=this.fields.currentData.getAccessPoints.accessPointList[index];if(rootvap.linkType==="WIFI_2.4_GUEST"||rootvap.linkType==="WIFI_5_GUEST"){combinedSsid=rootvap.ssid;for(subindex=0;subindex<this.fields.currentData.getAccessPoints.radioList.length;subindex=subindex+1){rootradio=this.fields.currentData.getAccessPoints.radioList[subindex];if(rootvap.radioId===rootradio.radioId&&(rootvap.isEnabled&&rootradio.isEnabled)){if(rootvap.linkType==="WIFI_2.4_GUEST"){isCombined24Enabled=true}else if(rootvap.linkType==="WIFI_5_GUEST"){isCombined5Enabled=true}}}}}if(isCombined24Enabled&&isCombined5Enabled){this.viewSetAccessPointState(null,"guest",combinedSsid,true,"both")}else if(isCombined24Enabled){this.viewSetAccessPointState(null,"guest",combinedSsid,true,"2.4ghz")}else if(isCombined5Enabled){this.viewSetAccessPointState(null,"guest",combinedSsid,true,"5ghz")}else{if(!combinedSsid){combinedSsid="Guest"}this.viewSetAccessPointState(null,"guest",combinedSsid,false,"both")}aNext()}else{basicUtilities.callback(aNext,false,0,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to set toggle of wifi guest status","aba0206")}},function(aNext){this.viewSetWPSDisplay(aNext)},function(aNext){this.viewSetHotspotDisplay(aNext,this.fields.currentData.getHotspot.hostspotList)},function(aNext){$("#wifi_wps_pushbutton_link").on("click",function(event){event.preventDefault();TemplateClass.showPopup($("#popup_wps_pairing"));TemplateClass.spinnerAnimate();this.fireEvent("ViewUpdated",{reason:"pushButtonPairing"});this.fields.wpsPopupTimer=window.setTimeout(function(){TemplateClass.hidePopup($("#popup_wps_pairing"));this.fireEvent("ViewUpdated",{reason:"stopPairing"})}.bind(this),18e4)}.bind(this));$("#popup_wpspairing_close").on("click",function(){this.fireEvent("ViewUpdated",{reason:"stopPairing"});TemplateClass.hidePopup($("#popup_wps_pairing"));window.clearTimeout(this.fields.wpsPopupTimer)}.bind(this));$("#wifi_global_link").on("click",function(event){event.preventDefault();window.location.hash="#antenna"});$("#wifi_scheduler_link").on("click",function(event){event.preventDefault();window.location.hash="#scheduler"});$("#wifi_accesspoint24_link").on("click",function(event){event.preventDefault();window.location.hash="#private24"});$("#wifi_accesspoint5_link").on("click",function(event){event.preventDefault();window.location.hash="#private5"});$("#wifi_accesspointboth_link").on("click",function(event){event.preventDefault();window.location.hash="#private24"});$("#wifi_accesspointguest_link").on("click",function(event){event.preventDefault();window.location.hash="#guest"});$("#wifi_accesspointopenhotspot_link").on("click",function(event){event.preventDefault();window.location.hash="#openhotspot"});$("#wifi_accesspointsecurehotspot_link").on("click",function(event){event.preventDefault();window.location.hash="#securehotspot"});$("#wifi_global").on("click",null,function(){var value;if($("#wifi_global").attr("aria-pressed")==="false"){value=1}else{value=0}if(this.fields.currentData.isWifiUsedByDevices&&value===0){TemplateClass.showPopup($("#popup_confirm"));$("#popup_confirm_submit").off("click");$("#popup_confirm_submit").on("click",function(){TemplateClass.hidePopup($("#popup_confirm"));this.fireEvent("ViewSubmitted",{reason:"globalWifiChange",value:value})}.bind(this))}else{this.fireEvent("ViewSubmitted",{reason:"globalWifiChange",value:value})}}.bind(this));$("#wifi_scheduler").on("click",null,function(){var value;if($("#wifi_scheduler").attr("aria-pressed")==="false"){value=1}else{value=0}this.fireEvent("ViewSubmitted",{reason:"wifiSchedulerChange",value:value})}.bind(this));$("#wifi_accesspoint24").on("click",null,function(){var value;if($("#wifi_accesspoint24").attr("aria-pressed")==="false"){value=1}else{value=0}if(this.fields.currentData.isWifiUsedByDevices&&value===0){TemplateClass.showPopup($("#popup_confirm"));$("#popup_confirm_submit").off("click");$("#popup_confirm_submit").on("click",function(){TemplateClass.hidePopup($("#popup_confirm"));this.fireEvent("ViewSubmitted",{reason:"wifiPrivate24Change",value:value})}.bind(this))}else{this.fireEvent("ViewSubmitted",{reason:"wifiPrivate24Change",value:value})}}.bind(this));$("#wifi_accesspoint5").on("click",null,function(){var value;if($("#wifi_accesspoint5").attr("aria-pressed")==="false"){value=1}else{value=0}if(this.fields.currentData.isWifiUsedByDevices&&value===0){TemplateClass.showPopup($("#popup_confirm"));$("#popup_confirm_submit").off("click");$("#popup_confirm_submit").on("click",function(){TemplateClass.hidePopup($("#popup_confirm"));this.fireEvent("ViewSubmitted",{reason:"wifiPrivate5Change",value:value})}.bind(this))}else{this.fireEvent("ViewSubmitted",{reason:"wifiPrivate5Change",value:value})}}.bind(this));$("#wifi_accesspointboth ").on("click",null,function(){var value;if($("#wifi_accesspointboth ").attr("aria-pressed")==="false"){value=1}else{value=0}if(this.fields.currentData.isWifiUsedByDevices&&value===0){TemplateClass.showPopup($("#popup_confirm"));$("#popup_confirm_submit").off("click");$("#popup_confirm_submit").on("click",function(){TemplateClass.hidePopup($("#popup_confirm"));this.fireEvent("ViewSubmitted",{reason:"wifiPrivateBothChange",value:value})}.bind(this))}else{this.fireEvent("ViewSubmitted",{reason:"wifiPrivateBothChange",value:value})}}.bind(this));$("#wifi_accesspointguest").on("click",null,function(){var value;if($("#wifi_accesspointguest").attr("aria-pressed")==="false"){TemplateClass.showPopup($("#popup_guest_confirm"))}else{this.fireEvent("ViewSubmitted",{reason:"wifiGuestChange",value:0})}}.bind(this));$("#popup_guest_confirm_submit").on("click",null,function(){var value;if($("#wifi_accesspointguest").attr("aria-pressed")==="false"){value=1}else{value=0}TemplateClass.hidePopup($("#popup_guest_confirm"));this.fireEvent("ViewSubmitted",{reason:"wifiGuestChange",value:value})}.bind(this));$("#popup_guest_confirm_cancel").on("click",function(){TemplateClass.hidePopup($("#popup_guest_confirm"))});$("#popup_confirm_cancel").on("click",function(){TemplateClass.hidePopup($("#popup_confirm"))});aNext()},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedSummaryViewClass: Failed to display view","aba0039")}}],this)};this.viewSetAccessPointState=function(aCallback,aAccessPointId,aLabel,aToggleValue,aFrequency){switch(aAccessPointId){case"private24":$("#wifi_accesspoint24_link_txt").html(this.escapeString("js",this.escapeString("html",aLabel)));if(aToggleValue){$("#wifi_accesspoint24").attr("aria-pressed","true");$("#wifi_accesspoint24").find("span").html("ON")}else{$("#wifi_accesspoint24").attr("aria-pressed","false");$("#wifi_accesspoint24").find("span").html("OFF")}break;case"private5":$("#wifi_accesspoint5_link_txt").html(this.escapeString("js",this.escapeString("html",aLabel)));if(aToggleValue){$("#wifi_accesspoint5").attr("aria-pressed","true");$("#wifi_accesspoint5").find("span").html("ON")}else{$("#wifi_accesspoint5").attr("aria-pressed","false");$("#wifi_accesspoint5").find("span").html("OFF")}break;case"privateboth":$("#wifi_accesspointboth_link_txt").html(this.escapeString("js",this.escapeString("html",aLabel)));if(aToggleValue){$("#wifi_accesspointboth").attr("aria-pressed","true");$("#wifi_accesspointboth").find("span").html("ON")}else{$("#wifi_accesspointboth").attr("aria-pressed","false");$("#wifi_accesspointboth").find("span").html("OFF")}if(aFrequency.toLowerCase()==="2.4ghz"){$("#wifi_accesspointboth_afterlabel").html('<span class="Translation" data-translation="wifiAdvanced.main.accesspoint.2ghz"></span>');this.translate("#wifi_accesspointboth_afterlabel")}else if(aFrequency.toLowerCase()==="5ghz"){$("#wifi_accesspointboth_afterlabel").html('<span class="Translation" data-translation="wifiAdvanced.main.accesspoint.5ghz"></span>');this.translate("#wifi_accesspointboth_afterlabel")}else if(aFrequency.toLowerCase()==="both"){$("#wifi_accesspointboth_afterlabel").html('<span class="Translation" data-translation="wifiAdvanced.main.accesspoint.both"></span>');this.translate("#wifi_accesspointboth_afterlabel")}break;case"guest":$("#wifi_accesspointguest_link_txt").html(this.escapeString("js",this.escapeString("html",aLabel)));if(aToggleValue){$("#wifi_accesspointguest").attr("aria-pressed","true");$("#wifi_accesspointguest").find("span").html("ON")}else{$("#wifi_accesspointguest").attr("aria-pressed","false");$("#wifi_accesspointguest").find("span").html("OFF")}if(aFrequency.toLowerCase()==="2.4ghz"){$("#wifi_accesspointguest_afterlabel").html('<span class="Translation" data-translation="wifiAdvanced.main.accesspoint.2ghz"></span>');this.translate("#wifi_accesspointguest_afterlabel")}else if(aFrequency.toLowerCase()==="5ghz"){$("#wifi_accesspointguest_afterlabel").html('<span class="Translation" data-translation="wifiAdvanced.main.accesspoint.5ghz"></span>');this.translate("#wifi_accesspointguest_afterlabel")}else if(aFrequency.toLowerCase()==="both"){$("#wifi_accesspointguest_afterlabel").html('<span class="Translation" data-translation="wifiAdvanced.main.accesspoint.both"></span>');this.translate("#wifi_accesspointguest_afterlabel")}break;default:basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedSummaryViewClass: Unknown access point ID submitted to access point setter method","aba0040");break}basicUtilities.callback(aCallback,false,0,null)};this.viewSetConfigurationMode=function(aCallback,aMode){if(aMode.toLowerCase()==="combined"){$("#wifi_accesspoint24").closest(".row.txtandfield-row.no-margin").hide();$("#wifi_accesspoint5").closest(".row.txtandfield-row.no-margin").hide();$("#wifi_accesspointboth").closest(".row.txtandfield-row.no-margin").show()}else if(aMode.toLowerCase()==="standard"){$("#wifi_accesspoint24").closest(".row.txtandfield-row.no-margin").show();$("#wifi_accesspoint5").closest(".row.txtandfield-row.no-margin").show();$("#wifi_accesspointboth").closest(".row.txtandfield-row.no-margin").hide()}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("WifiAdvancedSummaryViewClass: Unknown radio usage mode submitted to configuration mode setter method","aba0041")}basicUtilities.callback(aCallback,false,0,null)};this.viewSetHotspotDisplay=function(aCallback,aData){var index,target,target2;for(index=0;index<aData.length;index=index+1){if(aData[index].isSecured){target="#wifi_accesspointsecurehotspot_link_txt";target2="#wifi_accesspointsecurehotspot"}else{target="#wifi_accesspointopenhotspot_link_txt";target2="#wifi_accesspointopenhotspot"}$(target).closest(".row.txtandfield-row.no-margin").show();if(aData[index].hotSpotServiceState.toLowerCase()==="activated"&&aData[index].isWiFiActivatedOnHotSpot===true){$(target2).html("<span class='Translation' data-translation='wifiAdvanced.main.accesspoint.hotspot'></span> <span class='Translation' data-translation='common.activated'></span>")}else if(aData[index].hotSpotServiceState.toLowerCase()==="activated"&&aData[index].isWiFiActivatedOnHotSpot===false){$(target2).html("<span class='Translation' data-translation='wifiAdvanced.main.accesspoint.hotspot'></span> <span class='Translation' data-translation='common.wifioff'></span>")}else if(aData[index].hotSpotServiceState.toLowerCase()==="error"){$(target2).html("<span class='Translation' data-translation='wifiAdvanced.main.accesspoint.hotspot'></span> <span class='Translation' data-translation='common.error'></span>")}else if(aData[index].hotSpotServiceState.toLowerCase()==="not eligible"){$(target2).html("<span class='Translation' data-translation='wifiAdvanced.main.accesspoint.hotspot'></span> <span class='Translation' data-translation='common.noteligible'></span>")}else{$(target2).html("<span class='Translation' data-translation='wifiAdvanced.main.accesspoint.hotspot'></span> <span class='Translation' data-translation='common.deactivated'></span>")}this.translate(target2);$(target).html(this.escapeString("js",this.escapeString("html",aData[index].ssid)))}basicUtilities.callback(aCallback,false,0,null)};this.viewSetWPSDisplay=function(aCallback){var index,target="#wifi_wps_pushbutton_link";$(target).closest(".row.txtandfield-row.no-margin").hide();if(this.fields.currentData.hasOwnProperty("getAccessPoints")){if(this.fields.currentData.getAccessPoints.hasOwnProperty("accessPointList")){for(index=0;index<this.fields.currentData.getAccessPoints.accessPointList.length;index=index+1){if(this.fields.currentData.getAccessPoints.accessPointList[index].hasOwnProperty("pairing")){if(this.fields.currentData.getAccessPoints.accessPointList[index].pairing.isPairingEnabled){$(target).closest(".row.txtandfield-row.no-margin").show();break}}}}}basicUtilities.callback(aCallback,false,0,null)};this.hidePopup=function(aId){TemplateClass.hidePopup($("#"+aId))}}return WifiAdvancedSummaryViewClass});