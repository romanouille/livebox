define(["utils/console","utils/basics","lib/eventHandler","lib/stateViewInterface","jquery","text","templates_app/template","text!bootstrap/bootstrap.css","text!app/config/hubDiagnostic.json"],function(console,basicUtilities,EventHandlerClass,StateViewClass,$,Text,TemplateClass,Bootstrap,Config){"use strict";function HubDiagnosticViewClass(aStateId,aTranslateObj){var fields;fields={loadingTimer:null,storageTimer:null,language:{id:"",data:{}}};StateViewClass.call(this,aStateId,aTranslateObj);this.init=function(aCallback){console.debug("HubDiagnosticViewClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{this.notifyError("HubDiagnosticViewClass: Initialising state '"+this.getId()+"'","rra0212");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.quit=function(aCallback){console.debug("HubDiagnosticViewClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.unsetStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{this.notifyError("HubDiagnosticViewClass: Releasing state '"+this.getId()+"'","rra0213");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.enable=function(aCallback){console.debug("HubDiagnosticViewClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setAppCloseButton(aNext,"app_close")},function(aNext){this.viewDisplayPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{this.notifyError("HubDiagnosticViewClass: Enabling state '"+this.getId()+"'","rra0214");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.disable=function(aCallback){console.debug("HubDiagnosticViewClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.viewEmptyPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{this.notifyError("HubDiagnosticViewClass: Disabling state '"+this.getId()+"'","rra0215");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.stripLines=function(aCallback,aString){basicUtilities.callback(aCallback,false,0,aString.replace(/(\r\n|\n|\r|\t)/gm,""))};this.fillTemplate=function(aCallback,template,context){basicUtilities.queue([function(aNext){this.stripLines(aNext,context)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,template(JSON.parse(aResult.data)))}else{this.notifyError("HubDiagnosticViewClass: fillTemplate failed","rra0216");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.setStyle=function(aCallback){basicUtilities.queue([function(aNext){this.stripLines(aNext,Bootstrap)},function(aNext,aResult){if(!aResult||aResult.status===0){if(!$("#app_conf_style_sheet").length){$("head").append('<style id="app_conf_style_sheet">'+aResult.data+"</style>")}if(!$("#bootstrap_style_sheet").length){$("head").append('<style id="bootstrap_style_sheet">'+TemplateClass.style+"</style>")}basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("HubDiagnosticViewClass: setStyle failed","rra0217")}}],this)};this.unsetStyle=function(aCallback){if($("#app_conf_style_sheet").length){$("head").children("#app_conf_style_sheet").remove()}if($("#bootstrap_style_sheet").length){$("head").children("#bootstrap_style_sheet").remove()}basicUtilities.callback(aCallback,false,0,null)};this.viewEmptyPage=function(aCallback){$(window.document.body).html();basicUtilities.callback(aCallback,false,0,null)};this.viewDisplayPage=function(aCallback){basicUtilities.queue([function(aNext){this.fillTemplate(aNext,TemplateClass.template,Config)},function(aNext,aResult){if(!aResult||aResult.status===0){$(window.document.body).html(aResult.data);this.translate();this.setPageTitle(null,$(".header-title").find("h1").find("span").html());aNext()}else{basicUtilities.callback(aCallback,false,-1,null);this.notifyError("HubDiagnosticViewClass: Failed to fill template with config data","rra0218")}},function(){$(".conf-table-blank-cell-empty").hide();$("#check").off().on("click",function(event){event.preventDefault();TemplateClass.showPopup($("#popup_check_hub"));this.displayPopupInfo("inprogress_check");this.generateEvent("ViewSubmitted",{origin:fields.id,state:"start_check"});fields.loadingTimer=window.setTimeout(function(){this.generateEvent("ViewSubmitted",{origin:fields.id,state:"get_check_state"})}.bind(this),12e4);this.translate()}.bind(this));$("#popup_check_success_hub_close").off().on("click",function(event){event.preventDefault();TemplateClass.hidePopup($("#popup_check_hub"))}.bind(this));$("#popup_check_error_hub_close").off().on("click",function(event){event.preventDefault();TemplateClass.hidePopup($("#popup_check_hub"))}.bind(this));basicUtilities.callback(aCallback,false,0,null)}],this)};this.displayPopupInfo=function(state){$("#check_inprogress_fourthDesc").css("width","10em");$("#check_inprogress_fourthDesc").css("display","block");$("#check_inprogress_fourthDesc").css("margin","0 auto");if(state==="inprogress_check"){TemplateClass.spinnerAnimate();$("#check_init_title").hide();$("#check_init_firstDesc").hide();$("#check_init_secondDesc").hide();$("#popup_check_init_button").hide();$("#check_inprogress_title").show();$("#check_inprogress_firstDesc").show();$("#check_inprogress_secondDesc").show();$("#check_inprogress_thirdDesc").show();$("#check_inprogress_fourthDesc").show();$("#check_success_title").hide();$("#check_success_firstDesc").hide();$("#popup_check_success_button").hide();$("#check_error_title").hide();$("#check_error_firstDesc").hide();$("#check_error_secondDesc").hide();$("#check_error_thirdDesc").hide();$("#check_error_fourthDesc").hide();$("#popup_check_error_button").hide();$(".spinner").show()}else if(state==="error_check"){if(fields.loadingTimer){window.clearTimeout(fields.loadingTimer)}$("#check_init_title").hide();$("#check_init_firstDesc").hide();$("#check_init_secondDesc").hide();$("#popup_check_init_button").hide();$("#check_inprogress_title").hide();$("#check_inprogress_firstDesc").hide();$("#check_inprogress_secondDesc").hide();$("#check_inprogress_thirdDesc").hide();$("#check_inprogress_fourthDesc").hide();$("#check_success_title").hide();$("#check_success_firstDesc").hide();$("#check_success_secondDesc").hide();$("#check_success_thirdDesc").hide();$("#check_success_fourthDesc").hide();$("#popup_check_success_button").hide();$("#check_error_title").show();$("#check_error_firstDesc").show();$("#check_error_secondDesc").show();$("#check_error_thirdDesc").show();$("#check_error_fourthDesc").show();$("#popup_check_error_button").show();$(".spinner").hide()}else if(state==="success_check"){if(fields.loadingTimer){window.clearTimeout(fields.loadingTimer)}$("#check_init_title").hide();$("#check_init_firstDesc").hide();$("#check_init_secondDesc").hide();$("#popup_check_init_button").hide();$("#check_inprogress_title").hide();$("#check_inprogress_firstDesc").hide();$("#check_inprogress_secondDesc").hide();$("#check_inprogress_thirdDesc").hide();$("#check_inprogress_fourthDesc").hide();$("#check_success_title").show();$("#check_success_firstDesc").show();$("#popup_check_success_button").show();$("#check_error_title").hide();$("#check_error_firstDesc").hide();$("#check_error_secondDesc").hide();$("#check_error_thirdDesc").hide();$("#check_error_fourthDesc").hide();$("#popup_check_error_button").hide();$(".spinner").hide()}TemplateClass.positionPopup($("#popup_check_hub"))};this.displayInfo=function(temperature){$("#hubDiagnostic_Temperature").text(temperature)}}return HubDiagnosticViewClass});