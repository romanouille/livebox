define(["utils/console","utils/basics","lib/stateManager","app/devicesListMapCtrl","app/devicesListMapView","app/devicesListDeviceListCtrl","app/devicesListDeviceListView","jquery"],function(console,basicUtilities,StateManagerClass,DevicesListMapCtrlClass,DevicesListMapViewClass,DevicesListDeviceListCtrlClass,DevicesListDeviceListViewClass,$){"use strict";function MainClass(aSahObj,aConfigObj,aTranslateObj){var fields;fields={sahObj:aSahObj,stateManagerObj:null};fields.stateManagerObj=new StateManagerClass("DevicesListApp",aSahObj,aTranslateObj);this.run=function(){basicUtilities.queue([function(aNext){fields.stateManagerObj.registerState(aNext,"Map",DevicesListMapCtrlClass,DevicesListMapViewClass,false)},function(aNext,aResult){if(!aResult||aResult.status===0){fields.stateManagerObj.registerState(aNext,"DeviceList",DevicesListDeviceListCtrlClass,DevicesListDeviceListViewClass,false)}else{console.error("MainClass: Internal error. Aborting...")}},function(aNext,aResult){if(!aResult||aResult.status===0){window.location.hash="map";fields.stateManagerObj.switchState(aNext,"Map",null)}else{console.error("MainClass: Internal error. Aborting...")}},function(aNext,aResult){var targetDeviceId;if(!aResult||aResult.status===0){$(window).on("hashchange",{},function(){switch(window.location.hash.substr(1)){case"map":fields.stateManagerObj.switchState(null,"Map",null);break;case"devicelist":fields.stateManagerObj.switchState(null,"DeviceList",null);break;default:if(window.location.hash.substr(1).indexOf("devicelist")>-1){targetDeviceId=window.location.hash.substr(12);fields.stateManagerObj.switchState(null,"DeviceList",targetDeviceId)}else{console.error('MainClass: Unknown State "'+window.location.hash.substr(1)+'".');fields.stateManagerObj.requestAppClose(null)}break}});basicUtilities.callback(aNext,false,0,null)}else{console.error("MainClass: Internal error. Aborting...")}}],this)}}return MainClass});