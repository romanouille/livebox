define(["utils/console","utils/basics","lib/stateCtrlInterface"],function(console,basicUtilities,StateCtrlClass){"use strict";function LocalSettingsMainCtrlClass(aStateId,aStateManager,aSahObj,aViewObj){var fields={currentData:{}},onViewEvent=function(aEventId,aData){if(aEventId==="ViewUpdated"){console.debug("LocalSettingsMainCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData))}else if(aEventId==="ViewCancelled"){console.debug("LocalSettingsMainCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData))}else if(aEventId==="ViewSubmitted"){console.debug("LocalSettingsMainCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));basicUtilities.queue([function(aNext){window.parent.postMessage("LANGUAGE_UPDATE_"+aData.value,"*");this.setLanguage(aNext,aData.value)},function(aNext,aResult){if(!aResult||aResult.status===0){this.quit()}}],this)}else{console.warn("LocalSettingsMainCtrlClass: Unexpected event '"+aEventId+"'")}};StateCtrlClass.call(this,aStateId,aStateManager,aSahObj,aViewObj);this.init=function(aCallback){console.debug("LocalSettingsMainCtrlClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().subscribeEvents(this.getId(),onViewEvent.bind(this));this.getViewObj().init(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("LocalSettingsMainCtrlClass init failed","aba0001")}}],this)};this.quit=function(aCallback){console.debug("LocalSettingsMainCtrlClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().quit(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("LocalSettingsMainCtrlClass view quit failed","aba0xxx")}}],this)};this.enable=function(aCallback){console.debug("LocalSettingsMainCtrlClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getLanguage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().fields.currentData=fields.currentData;aNext()}else{console.error("LocalSettingsMainCtrlClass: Internal error")}},function(aNext){this.getViewObj().enable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("LocalSettingsMainCtrlClass view enable failed","aba0xxx")}}],this)};this.disable=function(aCallback){console.debug("LocalSettingsMainCtrlClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().disable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("LocalSettingsMainCtrlClass view disable failed","aba0xxx")}}],this)};this.setLanguage=function(aCallback,aParam){if(typeof aParam==="string"){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Information.setLanguage",aNext,{languageId:aParam})},function(aNext,aResult){if(aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{console.warn("LocalSettingsMainCtrlClass: Failed to set current language");basicUtilities.callback(aCallback,false,0,null);this.getViewObj().notifyError("LocalSettingsMainCtrlClass: Failed to set current language","aba0xxx")}}],this)}else{console.error("LocalSettingsMainCtrlClass: no value was given to set language");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("LocalSettingsMainCtrlClass: setRadio5 failed, no value was given to set language","aba0xxx")}};this.getLanguage=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Information.getLanguage",aNext,{})},function(aNext,aResult){if(aResult.status===0){fields.currentData.getLanguage=aResult.data;basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("LocalSettingsMainCtrlClass: Failed to retrieve current language");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("LocalSettingsMainCtrlClass: Failed to current language","aba0xxx")}}],this)}}return LocalSettingsMainCtrlClass});