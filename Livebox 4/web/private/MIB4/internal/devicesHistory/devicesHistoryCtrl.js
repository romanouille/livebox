define(["utils/console","utils/basics","lib/stateCtrlInterface"],function(console,basicUtilities,StateCtrlClass){"use strict";function DevicesHistoryCtrlClass(aStateId,aStateManager,aSahObj,aViewObj){var fields,devicesList,onViewEvent=function(aEventId,aData){if(aEventId==="ViewUpdated"){console.debug("DevicesHistoryCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));this.removeDevice(aData.deviceId)}else if(aEventId==="ViewCancelled"){console.debug("DevicesHistoryCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));this.deleteHistory()}else if(aEventId==="ViewSubmitted"){console.debug("DevicesHistoryCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));this.goToDevice(aData)}else{console.warn("DevicesHistoryCtrlClass: Unexpected event '"+aEventId+"'")}};fields={};StateCtrlClass.call(this,aStateId,aStateManager,aSahObj,aViewObj);this.init=function(aCallback){console.debug("DevicesHistoryCtrlClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().subscribeEvents(this.getId(),onViewEvent.bind(this));this.getViewObj().init(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.quit=function(aCallback){console.debug("DevicesHistoryCtrlClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().quit(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.enable=function(aCallback){console.debug("DevicesHistoryCtrlClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().enable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getDeviceList(aCallback)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.disable=function(aCallback){console.debug("DevicesHistoryCtrlClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().disable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.goToDevice=function(device){window.device=device;aStateManager.switchState(null,"DevicesHistoryDevice",null)};this.getDeviceList=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.NetworkMap.listDevices",aNext,{filter:{linkModeList:["ETHERNET","WIFI","CATIQ2","PRINTER","DONGLE"],isActive:false}})},function(aNext,aResult){if(!aResult||aResult.status===0){devicesList=aResult.data.deviceList;if(devicesList.length>0){this.getViewObj().listDevices(devicesList)}basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("Failed to list the devices","yke0001");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.deleteHistory=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.NetworkMap.forgetAllInactiveDevices",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getDeviceList(aCallback)}else{this.getViewObj().notifyError("Failed to delete history","yke0002");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.removeDevice=function(deviceId,aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.NetworkMap.forgetInactiveDevices",aNext,{deviceIdList:new Array(deviceId)})},function(aNext,aResult){if(!aResult||aResult.status===0){this.getDeviceList(aCallback)}else{this.getViewObj().notifyError("Failed to forget this device","yke0003");basicUtilities.callback(aCallback,false,-1,null)}}],this)}}return DevicesHistoryCtrlClass});