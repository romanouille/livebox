define(["utils/console","utils/basics","lib/eventHandler","lib/stateViewInterface","jquery","text","templates_app/template","text!bootstrap/bootstrap.css","text!app/config/DNS.json"],function(console,basicUtilities,EventHandlerClass,StateViewClass,$,Text,TemplateClass,Bootstrap,Config){"use strict";function NetworkAdvancedDNSViewClass(aStateId,aTranslateObj){var fields,self;self=this;fields={equipTab:[]};StateViewClass.call(this,aStateId,aTranslateObj);this.init=function(aCallback){console.debug("NetworkAdvancedDNSViewClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.quit=function(aCallback){console.debug("NetworkAdvancedDNSViewClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.unsetStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.enable=function(aCallback){console.debug("NetworkAdvancedDNSViewClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setAppCloseButton(aNext,"app_close")},function(aNext){this.viewDisplayPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.disable=function(aCallback){console.debug("NetworkAdvancedDNSViewClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.viewEmptyPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.stripLines=function(aCallback,aString){basicUtilities.callback(aCallback,false,0,aString.replace(/(\r\n|\n|\r|\t)/gm,""))};this.fillTemplate=function(aCallback,template,context){basicUtilities.queue([function(aNext){this.stripLines(aNext,context)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,template(JSON.parse(aResult.data)))}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.setStyle=function(aCallback){basicUtilities.queue([function(aNext){this.stripLines(aNext,Bootstrap)},function(aNext,aResult){if(!aResult||aResult.status===0){if(!$("#app_conf_style_sheet").length){$("head").append('<style id="app_conf_style_sheet">'+aResult.data+"</style>")}if(!$("#bootstrap_style_sheet").length){$("head").append('<style id="bootstrap_style_sheet">'+TemplateClass.style+"</style>")}basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.unsetStyle=function(aCallback){if($("#app_conf_style_sheet").length){$("head").children("#app_conf_style_sheet").remove()}if($("#bootstrap_style_sheet").length){$("head").children("#bootstrap_style_sheet").remove()}basicUtilities.callback(aCallback,false,0,null)};this.viewEmptyPage=function(aCallback){$(window.document.body).html();basicUtilities.callback(aCallback,false,0,null)};this.viewDisplayPage=function(aCallback){basicUtilities.queue([function(aNext){this.fillTemplate(aNext,TemplateClass.template,Config)},function(aNext,aResult){if(!aResult||aResult.status===0){$(window.document.body).html(aResult.data);this.translate();this.setPageTitle(null,$(".header-title").find("h1").find("span").html());$("#firstTitle").css("margin-top","1.5em");$("#dns_table  tr td:first-child").each(function(){$(this).css({"text-align":"left","text-indent":"10px"})});$("#dns_table tr td:nth-child(2)").each(function(){$(this).addClass("bold")});$("#dns_table").css("width","100%");$("#dchp_ip_list_table").css("width","100%");aNext()}else{basicUtilities.callback(aCallback,false,-1,null)}},function(){$("#tab_information_dhcp").on("click",function(){this.generateEvent("ViewSubmitted",{state:"DHCP"})}.bind(this));$("#tab_information_natpat").on("click",function(){this.generateEvent("ViewSubmitted",{state:"NATPAT"})}.bind(this));$("#tab_information_dns").on("click",function(){this.generateEvent("ViewSubmitted",{state:"DNS"})}.bind(this));$("#tab_information_upnp").on("click",function(){this.generateEvent("ViewSubmitted",{state:"UPnP"})}.bind(this));$("#tab_information_dyndns").on("click",function(){this.generateEvent("ViewSubmitted",{state:"DynDNS"})}.bind(this));$("#tab_information_dmz").on("click",function(){this.generateEvent("ViewSubmitted",{state:"DMZ"})}.bind(this));$("#tab_information_ntp").on("click",function(){this.generateEvent("ViewSubmitted",{state:"NTP"})}.bind(this));$("#tab_template_container").off().on("keydown",function(event){var keyCode=event.keyCode||event.which;if(keyCode===39){event.preventDefault();this.generateEvent("ViewSubmitted",{state:"UPnP"})}else if(keyCode===37){event.preventDefault();this.generateEvent("ViewSubmitted",{state:"NATPAT"})}}.bind(this));basicUtilities.callback(aCallback,false,0,null)}],this)};this.displayInfo=function(listDevice){for(var i=0;i<=listDevice.length-1;i+=1){if(!$.isEmptyObject(listDevice[i].ETHERNET)){fields.equipTab[i]={deviceId:listDevice[i].deviceId,device:listDevice[i].deviceName,dns:listDevice[i].dnsName,ipv4:listDevice[i].ETHERNET.ipIpv4};this.initTab(fields.equipTab[i].deviceId,fields.equipTab[i].device,fields.equipTab[i].ipv4,fields.equipTab[i].dns)}else if(!$.isEmptyObject(listDevice[i].DONGLE)){fields.equipTab[i]={deviceId:listDevice[i].deviceId,device:listDevice[i].deviceName,dns:listDevice[i].dnsName,ipv4:listDevice[i].DONGLE.ipIpv4};this.initTab(fields.equipTab[i].deviceId,fields.equipTab[i].device,fields.equipTab[i].ipv4,fields.equipTab[i].dns)}else if(!$.isEmptyObject(listDevice[i].CATIQ2)){fields.equipTab[i]={deviceId:listDevice[i].deviceId,device:listDevice[i].deviceName,dns:listDevice[i].dnsName,ipv4:listDevice[i].CATIQ2.ipIpv4};this.initTab(fields.equipTab[i].deviceId,fields.equipTab[i].device,fields.equipTab[i].ipv4,fields.equipTab[i].dns)}else if(!$.isEmptyObject(listDevice[i].PRINTER)){fields.equipTab[i]={deviceId:listDevice[i].deviceId,device:listDevice[i].deviceName,dns:listDevice[i].dnsName,ipv4:listDevice[i].PRINTER.ipIpv4};this.initTab(fields.equipTab[i].deviceId,fields.equipTab[i].device,fields.equipTab[i].ipv4,fields.equipTab[i].dns)}else if(!$.isEmptyObject(listDevice[i].WIFI)){fields.equipTab[i]={deviceId:listDevice[i].deviceId,device:listDevice[i].deviceName,dns:listDevice[i].dnsName,ipv4:listDevice[i].WIFI.ipIpv4};this.initTab(fields.equipTab[i].deviceId,fields.equipTab[i].device,fields.equipTab[i].ipv4,fields.equipTab[i].dns)}}this.saveButtonListener()};this.initTab=function(deviceId,deviceName,ipv4,dns){if($("#empty").length>0){$("#empty").parent().hide()}if($("#"+deviceName).length===0){$("#dchp_ip_list_table tr:last").after('<tr class="conf-table-row" id='+deviceId+">"+'<td class="conf-table-cell">'+deviceName+"</td>"+'<td class="conf-table-cell">'+'<input id="'+deviceName+'" class="deviceName" type="text" value="'+(dns!==undefined?dns:"")+'"style="width: 10em;">'+"</td>"+'<td class="conf-table-cell">'+ipv4+'<td class="conf-table-cell">'+'<span role="button" style="display:inline-block;cursor:pointer;"  tabindex="0"><span class="Translation  save txt-underline orangetxt" data-translation="networkAdvanced.DNS.secondSection.submit"></span><span class="Translation axs_hidden" data-translation="networkAdvanced.DNS.secondSection.helperSubmit"></span>'+"</td>"+"</tr>");this.translate()}else{$("#"+deviceName).val(dns!==""?dns:"")}};this.saveButtonListener=function(){$(".save").on("click keypress",function(event){if(event.which===13||event.type==="click"){self.fireEvent("ViewSubmitted",{action:"enregistrer",mac:$(event.currentTarget).closest("tr").attr("id"),value:$(event.currentTarget).closest("tr").find("input.deviceName").val(),name:$(event.currentTarget).closest("tr").find("input.deviceName").attr("id")})}})};this.displayNameError=function(isValid,name){if(isValid){$("#warning span").hide();$("#"+name).css("color","#000000");$("#"+name).css("border-color","#000000")}else{$("#warning span").show();$("#"+name).css("color","#CC0000");$("#"+name).css("border-color","#CC0000")}}}return NetworkAdvancedDNSViewClass});