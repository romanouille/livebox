define(["utils/console","utils/basics","lib/eventHandler","lib/stateViewInterface","jquery","text","templates_app/template","text!bootstrap/bootstrap.css","text!app/config/DynDNS.json"],function(console,basicUtilities,EventHandlerClass,StateViewClass,$,Text,TemplateClass,Bootstrap,Config){"use strict";function NetworkAdvancedDynDNSViewClass(aStateId,aTranslateObj){var fields,self,context;context={"data-translation-target":"placeholder","data-translation":"networkAdvanced.DynDNS.fourthPlaceholder",type:"passwordfield",id:"password",value:""};self=this;fields={};StateViewClass.call(this,aStateId,aTranslateObj);this.init=function(aCallback){console.debug("NetworkAdvancedDynDNSViewClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.quit=function(aCallback){console.debug("NetworkAdvancedDynDNSViewClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.unsetStyle(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.enable=function(aCallback){console.debug("NetworkAdvancedDynDNSViewClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.setAppCloseButton(aNext,"app_close")},function(aNext){this.viewDisplayPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){$("#password").prop("type","password");this.initCustomStyle();basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.disable=function(aCallback){console.debug("NetworkAdvancedDynDNSViewClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.viewEmptyPage(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.stripLines=function(aCallback,aString){basicUtilities.callback(aCallback,false,0,aString.replace(/(\r\n|\n|\r|\t)/gm,""))};this.fillTemplate=function(aCallback,template,context){basicUtilities.queue([function(aNext){this.stripLines(aNext,context)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,template(JSON.parse(aResult.data)))}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.setStyle=function(aCallback){basicUtilities.queue([function(aNext){this.stripLines(aNext,Bootstrap)},function(aNext,aResult){if(!aResult||aResult.status===0){if(!$("#app_conf_style_sheet").length){$("head").append('<style id="app_conf_style_sheet">'+aResult.data+"</style>")}if(!$("#bootstrap_style_sheet").length){$("head").append('<style id="bootstrap_style_sheet">'+TemplateClass.style+"</style>")}basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.unsetStyle=function(aCallback){if($("#app_conf_style_sheet").length){$("head").children("#app_conf_style_sheet").remove()}if($("#bootstrap_style_sheet").length){$("head").children("#bootstrap_style_sheet").remove()}basicUtilities.callback(aCallback,false,0,null)};this.viewEmptyPage=function(aCallback){$(window.document.body).html();basicUtilities.callback(aCallback,false,0,null)};this.viewDisplayPage=function(aCallback){basicUtilities.queue([function(aNext){this.fillTemplate(aNext,TemplateClass.template,Config)},function(aNext,aResult){if(!aResult||aResult.status===0){$(window.document.body).html(aResult.data);this.translate();this.setPageTitle(null,$(".header-title").find("h1").find("span").html());aNext()}else{basicUtilities.callback(aCallback,false,-1,null)}},function(aNext,aResult){if(!aResult||aResult.status===0){$("#tab_information_dhcp").on("click",function(){this.generateEvent("ViewSubmitted",{state:"DHCP"})}.bind(this));$("#tab_information_natpat").on("click",function(){this.generateEvent("ViewSubmitted",{state:"NATPAT"})}.bind(this));$("#tab_information_dns").on("click",function(){this.generateEvent("ViewSubmitted",{state:"DNS"})}.bind(this));$("#tab_information_upnp").on("click",function(){this.generateEvent("ViewSubmitted",{state:"UPnP"})}.bind(this));$("#tab_information_dyndns").on("click",function(){this.generateEvent("ViewSubmitted",{state:"DynDNS"})}.bind(this));$("#tab_information_dmz").on("click",function(){this.generateEvent("ViewSubmitted",{state:"DMZ"})}.bind(this));$("#tab_information_ntp").on("click",function(){this.generateEvent("ViewSubmitted",{state:"NTP"})}.bind(this));$("#tab_template_container").off().on("keydown",function(event){var keyCode=event.keyCode||event.which;if(keyCode===39){event.preventDefault();this.generateEvent("ViewSubmitted",{state:"DMZ"})}else if(keyCode===37){event.preventDefault();this.generateEvent("ViewSubmitted",{state:"UPnP"})}}.bind(this));basicUtilities.callback(aNext,false,0,null)}else{basicUtilities.callback(aNext,false,-1,null)}},function(aNext,aResult){if(!aResult||aResult.status===0){$("#submit").attr("disabled",true);this.toggleSubmitButton();$("#type, #hostName, #mail, #password").on("change keyup",function(){self.toggleSubmitButton()});this.saveButtonListener();basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.initCustomStyle=function(){$("#type").parents(".button-container").css({width:"auto","float":"left",margin:"0 11px 60px 0"});$("#hostName").parents(".txtandfield-container").css({"float":"left",margin:"3px 11px 60px 0"});$("#mail").parents(".txtandfield-container").css({"float":"left",margin:"3px 11px 60px 0"});$("#password").parents(".txtandfield-container").css({"float":"left",margin:"3px 15px 60px 0"});$("#submit").parents(".button-container").css({width:"auto",margin:"3px 0","float":"right"});$("#type").css("min-width","7em");$("#hostName").css("width","11.5em");$("#mail").css("width","11.5em");$("#password").css("width","8em");$("#dydns_services_list").css("clear","left");$("#DyNote").parent().css("margin-bottom","1.5em");$("#dydns_services_list_table").css("width","100%");$(".conf-table-blank-cell-empty").remove();$(".txtandfield-text-input").css("margin-top","1px");$("#dydns_services_list_table .conf-table-row > td:first-child").css("width","7em");$("#dydns_services_list_table .conf-table-row > td:last-child").css("width","35px");$("#hostName_warning").css({"font-size":"14px",left:"8em","max-width":"16em"});$("#mail_warning").css({"font-size":"14px",left:"21em","max-width":"16em"});$("#password_warning").css({"font-size":"14px","max-width":"16em"})};this.toggleSubmitButton=function(){if($("#type").val()!=="No-IP"||$("#hostName").val()!==""||$("#mail").val()!==""||$("#password").val()!==""){$("#submit").attr("disabled",false)}else{$("#submit").attr("disabled",true)}};this.saveButtonListener=function(){$("#submit").on("click keypress",function(event){if(event.which===13||event.type==="click"){self.fireEvent("ViewSubmitted",{action:"enregistrer",service:$("#type").val(),hostname:$("#hostName").val().trim(),mail:$("#mail").val().trim(),password:$("#password").val().trim()})}})};this.displayInfo=function(servicesList){var i;if($("#empty").length>0){$("#empty").parent().hide()}$("#dydns_services_list_table").find("tr:gt(1)").remove();for(i=0;i<=servicesList.length-1;i+=1){$("#dydns_services_list_table tr:last").after('<tr class="conf-table-row" id ="'+servicesList[i].hostname+'">'+'<td class="conf-table-cell">'+servicesList[i].service+"</td>"+'<td class="conf-table-cell">'+servicesList[i].hostname+"</td>"+'<td class="conf-table-cell">'+servicesList[i].login+"</td>"+'<td class="conf-table-cell">'+"*******"+"</td>"+'<td class="conf-table-cell">'+new Date(servicesList[i].lastUpdate).toLocaleString("fr-fr")+"</td>"+'<td class="conf-table-blank-cell">'+'<img alt="supprimer" tabindex="0" class="conf-table-button-delete" src="../../common/img/app_conf/trashbin_666.png">'+"</td>"+"</tr>")}$("#dydns_services_list_table").css("table-layout","fixed");$(".conf-table-cell").attr("class","conf-table-cell nowrap");this.deleteListener()};this.initSelect=function(supportedServicesList){var i;for(i=0;i<=supportedServicesList.length-1;i+=1){$("#type").append('<option value="'+supportedServicesList[i]+'">'+supportedServicesList[i]+"</option")}};this.deleteListener=function(){$(".conf-table-button-delete").on("click keypress",function(event){if(event.which===13||event.type==="click"){self.fireEvent("ViewSubmitted",{action:"supprimer",hostname:$(event.currentTarget).closest("tr").attr("id"),target:$(event.currentTarget).closest("tr")})}})};this.deleteCurrentRow=function(target){target.remove();if($("#dydns_services_list_table tr:last td").is(":hidden")){$("#empty").parent().show()}};this.displayHostError=function(isValid,state){if(isValid){$("#hostName_warning").css("display","none");$("#hostName_label").css("color","#000000");$("#hostName").css("color","#000000");$("#hostName").css("border-color","#999999")}else{if(state==="same"){$("#messageHost").replaceWith("<span id='messageHost' class='Translation' data-translation='networkAdvanced.DynDNS.errors.sameHost'></span>")}else{$("#messageHost").replaceWith("<span id='messageHost' class='Translation' data-translation='networkAdvanced.DynDNS.errors.host'></span>")}this.translate();$("#hostName_warning").css("display","inline-block");$("#hostName_label").css("color","#CC0000");$("#hostName").css("color","#CC0000");$("#hostName").css("border-color","#CC0000")}};this.displayMailError=function(isValid){if(isValid){$("#mail_warning").css("display","none");$("#mail_label").css("color","#000000");$("#mail").css("color","#000000");$("#mail").css("border-color","#999999")}else{$("#mail_warning").css("display","inline-block");$("#mail_label").css("color","#CC0000");$("#mail").css("color","#CC0000");$("#mail").css("border-color","#CC0000")}};this.displaypasswordError=function(isValid){if(isValid){$("#password_warning").css("display","none");$("#password_label").css("color","#000000");$("#password").css("color","#000000");$("#password").css("border-color","#999999")}else{$("#password_warning").css("display","inline-block");$("#password_label").css("color","#CC0000");$("#password").css("color","#CC0000");$("#password").css("border-color","#CC0000")}}}return NetworkAdvancedDynDNSViewClass});