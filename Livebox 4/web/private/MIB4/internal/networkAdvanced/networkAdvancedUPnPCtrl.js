define(["utils/console","utils/basics","lib/stateCtrlInterface"],function(console,basicUtilities,StateCtrlClass){"use strict";function NetworkAdvancedUPnPCtrlClass(aStateId,aStateManager,aSahObj,aViewObj){var fields,globalResult,onViewEvent=function(aEventId,aData){if(aEventId==="ViewUpdated"){console.debug("NetworkAdvancedUPnPCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData))}else if(aEventId==="ViewCancelled"){console.debug("NetworkAdvancedUPnPCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));this.quit()}else if(aEventId==="ViewSubmitted"){console.debug("NetworkAdvancedUPnPCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));if(aData.action==="set"){this.setCurrentState(null,aData.state)}else if(aData.action==="rafraichir"){this.getRulesList(null)}if(aData.state==="DHCP"){window.location.hash="#DHCP"}else if(aData.state==="NATPAT"){window.location.hash="#NATPAT"}else if(aData.state==="DNS"){window.location.hash="#DNS"}else if(aData.state==="UPnP"){window.location.hash="#UPnP"}else if(aData.state==="DynDNS"){window.location.hash="#DynDNS"}else if(aData.state==="DMZ"){window.location.hash="#DMZ"}else if(aData.state==="NTP"){window.location.hash="#NTP"}}else{console.warn("NetworkAdvancedUPnPCtrlClass: Unexpected event '"+aEventId+"'")}};fields={};globalResult={};StateCtrlClass.call(this,aStateId,aStateManager,aSahObj,aViewObj);this.init=function(aCallback){console.debug("NetworkAdvancedUPnPCtrlClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().subscribeEvents(this.getId(),onViewEvent.bind(this));this.getViewObj().init(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.quit=function(aCallback){console.debug("NetworkAdvancedUPnPCtrlClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().quit(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.enable=function(aCallback){console.debug("NetworkAdvancedUPnPCtrlClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().enable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getRulesList(aNext)}else{basicUtilities.callback(aCallback,false,0,null)}},function(aNext,aResult){if(!aResult||aResult.status===0){this.getCurrentState(aNext)}else{basicUtilities.callback(aCallback,false,0,null)}},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.disable=function(aCallback){console.debug("NetworkAdvancedUPnPCtrlClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().disable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("NetworkAdvancedUPnPCtrlClass: Failed to get disable upnp ","yke0001");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.getRulesList=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.Firewall.NatPatIpv4.listRules",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){globalResult.rulesList=aResult.data.upnpRules;if(globalResult.rulesList.length>0){this.getViewObj().displayInfo(globalResult.rulesList)}basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("NetworkAdvancedUPnPCtrlClass: Failed to get rules list ","yke0002");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.getCurrentState=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.UpnpServer.getCurrentState",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().initCheckbox(aResult.data.isUpnpRulesEnabled);basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("NetworkAdvancedUPnPCtrlClass: Failed to get upnp state ","yke0003");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.setCurrentState=function(aCallback,state){basicUtilities.queue([function(aNext){this.callSahApi("sah.HomeNetwork.UpnpServer.setCurrentState",aNext,{isUpnpRulesEnabled:state})},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().initCheckbox(state);basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("NetworkAdvancedUPnPCtrlClass: Failed to set upnp state ","yke0004");basicUtilities.callback(aCallback,false,-1,null)}}],this)}}return NetworkAdvancedUPnPCtrlClass});