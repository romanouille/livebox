define(["utils/console","utils/basics","lib/stateCtrlInterface"],function(console,basicUtilities,StateCtrlClass){"use strict";function HubMaintenanceCtrlClass(aStateId,aStateManager,aSahObj,aViewObj){var fields,globalResult,onViewEvent=function(aEventId,aData){if(aEventId==="ViewUpdated"){console.debug("HubMaintenanceCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData))}else if(aEventId==="ViewCancelled"){console.debug("HubMaintenanceCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));this.quit()}else if(aEventId==="ViewSubmitted"){console.debug("HubMaintenanceCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));if(aData.state==="start_format"){this.startFormatting()}else if(aData.state==="get_format_state"){this.getFormattingState()}else if(aData.state==="get_storage_state"){this.getStorageState()}else if(aData.state==="get_service_state"){this.getServiceState()}else if(aData.state==="start_eject"){this.ejectHub()}else if(aData.state==="start_stopHub"){this.stopHub()}else if(aData.state==="start_startHub"){this.startHub()}else if(aData.state==="start_synchronisation"){this.startSynchronisation()}else if(aData.state==="get_synchronisation_state"){this.getSynchronisationState()}}else{console.warn("HubMaintenanceCtrlClass: Unexpected event '"+aEventId+"'")}};fields={};globalResult={};StateCtrlClass.call(this,aStateId,aStateManager,aSahObj,aViewObj);this.init=function(aCallback){console.debug("HubMaintenanceCtrlClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().subscribeEvents(this.getId(),onViewEvent.bind(this));this.getViewObj().init(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubMaintenanceCtrlClass: Initialising state '"+this.getId()+"'","rra0219")}}],this)};this.quit=function(aCallback){console.debug("HubMaintenanceCtrlClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().quit(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubMaintenanceCtrlClass: Releasing state '"+this.getId()+"'","rra0220")}}],this)};this.enable=function(aCallback){console.debug("HubMaintenanceCtrlClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().enable(aNext)},function(aNext){this.callSahApi("sah.Device.MediaCloud.getServiceState",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().toggleStopButton(aResult.data.isEnabled);basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubMaintenanceCtrlClass: Enabling state '"+this.getId()+"'","rra0221")}}],this)};this.disable=function(aCallback){console.debug("HubMaintenanceCtrlClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().disable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubMaintenanceCtrlClass: Disabling state '"+this.getId()+"'","rra0222")}}],this)};this.getFormattingState=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.getFormattingState",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){if(aResult.data.isRunning){this.getViewObj().displayPopupInfo("error_format")}else{this.getViewObj().displayPopupInfo("success_format")}basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().displayPopupInfo("error_format");this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error getFormattingState failed","rra0225");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.getStorageState=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.getStorage",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){if(aResult.data.volumeList.length===0){this.getViewObj().displayPopupInfo("success_eject")}else{this.getViewObj().displayPopupInfo("error_eject")}basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().displayPopupInfo("error_eject");this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error getGlobalState failed","rra0226");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.getServiceState=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.getServiceState",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){if(!aResult.data.isEnabled){this.getViewObj().displayPopupInfo("success_stop");this.getViewObj().displayPopupInfo("error_start")}else{this.getViewObj().displayPopupInfo("error_stop");this.getViewObj().displayPopupInfo("success_start")}this.getViewObj().toggleStopButton(aResult.data.isEnabled);basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().displayPopupInfo("error_stop");this.getViewObj().displayPopupInfo("error_start");this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error getServiceState failed","rra0226");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.startFormatting=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.startFormatting",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().displayPopupInfo("inprogress_format");basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error startFormatting failed","rra0227");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.ejectHub=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.unmount",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().displayPopupInfo("inprogress_eject");basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error ejectHub failed","rra0227");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.stopHub=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.setServiceState",aNext,{isEnabled:false})},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().displayPopupInfo("inprogress_stop");basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error stopHub failed","rra0227");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.startHub=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.setServiceState",aNext,{isEnabled:true})},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().displayPopupInfo("inprogress_start");basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error startHub failed","rra0227");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.startSynchronisation=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.reset",aNext,{mode:"soft"})},function(aNext,aResult){if(!aResult||aResult.status===0){this.getViewObj().displayPopupInfo("inprogress_synchronisation");basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error startSynchronisation failed","rra0227");basicUtilities.callback(aCallback,false,-1,null)}}],this)};this.getSynchronisationState=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.getFormattingState",aNext,null)},function(aNext,aResult){if(!aResult||aResult.status===0){if(aResult.data.isRunning){this.getViewObj().displayPopupInfo("error_synchronisation")}else{this.getViewObj().displayPopupInfo("success_synchronisation")}basicUtilities.callback(aCallback,false,0,null)}else{this.getViewObj().displayPopupInfo("error_synchronisation");this.getViewObj().notifyError("HubMaintenanceCtrlClass: internal Error getSynchronisationState failed","rra0225");basicUtilities.callback(aCallback,false,-1,null)}}],this)}}return HubMaintenanceCtrlClass});