define(["utils/console","utils/basics","lib/stateCtrlInterface"],function(console,basicUtilities,StateCtrlClass){"use strict";function HubSoftwareVersionCtrlClass(aStateId,aStateManager,aSahObj,aViewObj){var fields,globalResult,onViewEvent=function(aEventId,aData){if(aEventId==="ViewSubmitted"){console.debug("HubSoftwareVersionCtrlClass: View event '"+aEventId+"' with data "+JSON.stringify(aData));if(aData.state==="hubDeviceVersion"){window.location.hash="#hubDeviceVersion"}else if(aData.state==="hubSoftwareVersion"){window.location.hash="#hubSoftwareVersion"}}else{console.warn("HubSoftwareVersionCtrlClass: Unexpected event '"+aEventId+"'");this.getViewObj().notifyError("HubSoftwareVersionCtrlClass: Unexpected event '"+aEventId+"'","rra0023")}};fields={};globalResult={};StateCtrlClass.call(this,aStateId,aStateManager,aSahObj,aViewObj);this.init=function(aCallback){console.debug("HubSoftwareVersionCtrlClass: Initialising state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().subscribeEvents(this.getId(),onViewEvent.bind(this));this.getViewObj().init(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubSoftwareVersionCtrlClass init failed","rra0024")}}],this)};this.quit=function(aCallback){console.debug("HubSoftwareVersionCtrlClass: Releasing state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().quit(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubSoftwareVersionCtrlClass quit failed","rra0025")}}],this)};this.enable=function(aCallback){console.debug("HubSoftwareVersionCtrlClass: Enabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().enable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){this.getSoftwareVersion(aNext)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubSoftwareVersionCtrlClass: Enabling state '"+this.getId()+"'","rra0027")}},function(aNext,aResult){if(!aResult||aResult.status===0){this.getSoftwareDate(aNext)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubSoftwareVersionCtrlClass getSoftwareVersion failed","rra0028")}},function(aNext,aResult){if(!aResult||aResult.status===0){aViewObj.displayHubVersionInfo(globalResult)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubSoftwareVersionCtrlClass getSoftwareDate failed","rra0028")}}],this)};this.disable=function(aCallback){console.debug("HubSoftwareVersionCtrlClass: Disabling state '"+this.getId()+"'");basicUtilities.queue([function(aNext){this.getViewObj().disable(aNext)},function(aNext,aResult){if(!aResult||aResult.status===0){basicUtilities.callback(aCallback,false,0,null)}else{basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubSoftwareVersionCtrlClass view disable failed","rra0029")}}],this)};this.getSoftwareDate=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.Information.getBasicInformation",aNext,null)},function(aNext,aResult){if(aResult.status===0){globalResult.softwareDate=aResult.data.softwareDate;basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("HubSoftwareVersionCtrlClass: Failed to retrieve SoftwareVersion");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubSoftwareVersionCtrlClass: Failed to retrieve SoftwareVersion","rra0031")}}],this)};this.getSoftwareVersion=function(aCallback){basicUtilities.queue([function(aNext){this.callSahApi("sah.Device.MediaCloud.getVersion",aNext,null)},function(aNext,aResult){if(aResult.status===0){globalResult.softwareVersion=aResult.data.softwareVersion;basicUtilities.callback(aCallback,false,0,aResult.data)}else{console.warn("HubSoftwareVersionCtrlClass: Failed to retrieve SoftwareVersion");basicUtilities.callback(aCallback,false,-1,null);this.getViewObj().notifyError("HubSoftwareVersionCtrlClass: Failed to retrieve SoftwareVersion","rra0031")}}],this)}}return HubSoftwareVersionCtrlClass});