
(function(){var g=window.debug||/debug=true/.test(document.location.href)||false,e=window.loglimit||299;window.loglimit=e;window.console||(console={});var k=function(){for(var b="info,error,log,warn".split(","),a=0;a<b.length;a++){var c=b[a],d="_"+b[a];console[d]=console[c];console[c]=function(){var j=d;return function(){e--;e==0&&console._log("***LOG LIMIT OF "+loglimit+" HAS BEEN REACHED***");e<1||console[j](Array.prototype.slice.call(arguments).join(" "))}}()}try{console.clear()}catch(m){}},l=function(){for(var b="info,error,log,warn".split(","),a=0;a<b.length;a++)(function(){var c=b[a],d="_"+b[a];console[d]=console[c];console[c]=function(){console[d](Array.prototype.slice.call(arguments).join(" "))}})()},h=function(b){b=b.split(",");for(var a=0;a<b.length;a++)console[b[a]]=function(){}},i=function(){for(var b="debug,time,timeEnd,assert,count,trace,dir,dirxml,group,groupEnd,groupCollapsed,exception".split(","),a=0;a<b.length;a++)console[b[a]]||(console[b[a]]=function(){})},f=window.navigator.userAgent;if(g&&/Trident/.test(f)){k();h("debug,time,timeEnd,assert,count,trace,dir,dirxml,group,groupEnd,groupCollapsed,exception")}else if(g&&/WebKit|iPad|iPhone/.test(f)){l();i()}else/IE/.test(f)&&!/Trident/.test(f)||!g||!window.console?h("debug,time,timeEnd,assert,count,trace,dir,dirxml,group,groupEnd,groupCollapsed,exception,info,error,log,warn"):i()})();(function($){$.extend($.fn,{caret:function(start,end){var elem=this[0];if(elem){if(typeof start=="undefined"){if(elem.selectionStart!=undefined){start=elem.selectionStart;end=elem.selectionEnd;}
else if(document.selection){var val=this.val();var range=document.selection.createRange().duplicate();range.moveEnd("character",val.length)
start=(range.text==""?val.length:val.lastIndexOf(range.text));range=document.selection.createRange().duplicate();range.moveStart("character",-val.length);end=range.text.length;}}
else{var val=this.val();if(typeof start!="number")start=-1;if(typeof end!="number")end=-1;if(start<0)start=0;if(end>val.length)end=val.length;if(end<start)end=start;if(start>end)start=end;elem.focus();if(elem.selectionStart){elem.selectionStart=start;elem.selectionEnd=end;}
else if(document.selection){var range=elem.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",end-start);range.select();}}
return{start:start,end:end};}}});})(jQuery);(function($){$.fn.dPassword=function(options){var defaults={interval:1000,duration:3000,replacement:'%u25CF',prefix:'password_',debug:false,noreplace:false};var opts=$.extend(defaults,options);var checker=new Array();var timer=new Array();getId=function(id){var pattern=opts.prefix+'(.*)';var regex=new RegExp(pattern);regex.exec(id);id=RegExp.$1;return id;};setPassword=function(id,str){if(opts.debug)console.log('setPassword: ['+id+']');if(str!=undefined){var tmp='';for(var i=0;i<str.length;i++){if(str.charAt(i)==unescape(opts.replacement)){tmp=tmp+$('#'+id).val().charAt(i);}
else{tmp=tmp+str.charAt(i);}}
$('#'+id).val(tmp);$('#'+id).trigger('valueChange');}};check=function(id,oldValue,initialCall,replaceAll){console.log('check: ['+id+']');var bullets=$('#'+opts.prefix+id).val();var input=$('#'+opts.prefix+id);if(bullets!=undefined){if(oldValue!=bullets){setPassword(id,bullets);if(!opts.noreplace){if(bullets.length>0){var tmp='';for(var i=0;i<bullets.length-1;i++){tmp=tmp+unescape(opts.replacement);}
if(replaceAll!=undefined&&replaceAll){tmp=tmp+unescape(opts.replacement);}else{tmp=tmp+bullets.charAt(bullets.length-1);}
var range=input.caret();input.val(tmp);if(input[0].focused){input.caret(range.start,range.end);}}
clearTimeout(timer[id]);timer[id]=setTimeout("convertLastChar('"+id+"')",opts.duration);}else{clearTimeout(timer[id]);}}}
if(opts.debug){$('#debug_'+opts.prefix+id).text($('#'+id).val());}
checker[id]=setTimeout("check('"+id+"', '"+$('#'+opts.prefix+id).val()+"', false)",opts.interval);};convertLastChar=function(id){var value=$('#'+opts.prefix+id).val();if(value!=undefined&&value!=''){var tmp='';for(var i=0;i<value.length;i++){tmp=tmp+unescape(opts.replacement);}
var input=$('#'+opts.prefix+id);var range=input.caret();input.val(tmp);if(input[0].focused){input.caret(range.start,range.end);}}};$(this).each(function(){this.opts=opts;if(opts.debug)console.log('init ['+$(this).attr('id')+']');var name=$(this).attr('name');var id=$(this).attr('id');checker.push(id);timer.push(id);$(this).hide();if(opts.debug){$(this).after('<span id="debug_'+opts.prefix+name+'" style="color: #f00;"></span>');}
$(this).after(' <input id="'+(opts.prefix+id)+'" '+'type="text" '+'autocomplete="off" '+'/>');$('label[for='+id+']').attr('for',opts.prefix+id);$(this).attr('tabindex','');$(this).attr('accesskey','');$('#'+opts.prefix+id)[0].focused=false;$('#'+opts.prefix+id).bind('focus',function(event){this.focused=true;});$('#'+opts.prefix+id).bind('change',function(event){if(opts.debug)console.log('event: change ['+getId($(this).attr('id'))+']');clearTimeout(checker[getId($(this).attr('id'))]);check(id,'',true,true);});$('#'+opts.prefix+id).bind('blur',function(event){if(opts.debug)console.log('event: blur ['+getId($(this).attr('id'))+']');this.focused=false;clearTimeout(checker[getId($(this).attr('id'))]);});$('#'+opts.prefix+id).bind('change input propertyChange',function(event){check(id,'',false,false);});check(id,'',true,true);});};})(jQuery);var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val;};return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=date;date=undefined;}
date=date?new Date(date):new Date;if(isNaN(date))throw SyntaxError("invalid date");mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true;}
var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1);});};}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(mask,utc){return dateFormat(this,mask,utc);};(function($){function Reflection(img,reflHeight,opacity){var reflection,cntx,imageWidth=img.width,imageHeight=img.width,gradient,parent;parent=$(img.parentNode);if($.browser.msie){this.element=reflection=parent.append("<img class='reflection' style='position:absolute'/>").find(':last')[0];reflection.src=img.src;reflection.style.filter="flipv progid:DXImageTransform.Microsoft.Alpha(opacity="+(opacity*100)+", style=1, finishOpacity=0, startx=0, starty=0, finishx=0, finishy="+(reflHeight/imageHeight*100)+")";}else{this.element=reflection=parent.append("<canvas class='reflection' style='position:absolute'/>").find(':last')[0];if(!reflection.getContext)
{return;}
cntx=reflection.getContext("2d");try{$(reflection).attr({width:imageWidth,height:reflHeight});cntx.save();cntx.translate(0,imageHeight-1);cntx.scale(1,-1);cntx.drawImage(img,0,0,imageWidth,imageHeight);cntx.restore();cntx.globalCompositeOperation="destination-out";gradient=cntx.createLinearGradient(0,0,0,reflHeight);gradient.addColorStop(0,"rgba(255, 255, 255, "+(1-opacity)+")");gradient.addColorStop(1,"rgba(255, 255, 255, 1.0)");cntx.fillStyle=gradient;cntx.fillRect(0,0,imageWidth,reflHeight);}catch(e){return;}}
$(reflection).attr({'alt':$(img).attr('alt'),title:$(img).attr('title')});}
var Item=function(imgIn,options)
{this.orgWidth=new Array();this.orgHeight=new Array();this.orgTop=new Array();this.orgLeft=new Array();for(i=0;i<$(imgIn).children('.picture').children('img').length;i++){this.orgWidth[i]=$($(imgIn).children('.picture').children('img')[i]).width();this.orgHeight[i]=$($(imgIn).children('.picture').children('img')[i]).height();if($($(imgIn).children('.picture').children('img')[i]).parent().css('position')=='relative'){this.orgLeft[i]=$($(imgIn).children('.picture').children('img')[i]).parent().css('left');this.orgLeft[i]=parseInt(this.orgLeft[i].substring(0,(this.orgLeft[i].length-2)));this.orgTop[i]=$($(imgIn).children('.picture').children('img')[i]).parent().css('top');this.orgTop[i]=parseInt(this.orgTop[i].substring(0,(this.orgTop[i].length-2)));}}
this.image=imgIn;this.reflection=null;this.alt=imgIn.alt;this.title=imgIn.title;this.imageOK=false;this.options=options;this.imageOK=true;if(this.options.reflHeight>0)
{this.reflection=new Reflection(this.image,this.options.reflHeight,this.options.reflOpacity);}
$(this.image).css('position','absolute');};var Controller=function(container,images,options)
{$(container).parent().css('visibility','hidden');var items=[],funcSin=Math.sin,funcCos=Math.cos,ctx=this;this.controlTimer=0;this.stopped=false;this.container=container;this.xRadius=options.xRadius;this.yRadius=options.yRadius;this.showFrontTextTimer=0;this.autoRotateTimer=0;if(options.xRadius===0)
{this.xRadius=($(container).width()/2.3);}
if(options.yRadius===0)
{this.yRadius=($(container).height()/6);}
this.xCentre=options.xPos;this.yCentre=options.yPos;this.frontIndex=0;this.rotation=this.destRotation=Math.PI/2;this.timeDelay=1000/options.FPS;if(options.altBox!==null)
{$(options.altBox).css('display','block');$(options.titleBox).css('display','block');}
$(container).css({position:'relative',overflow:'visible'});$(options.buttonLeft).css('display','inline');$(options.buttonRight).css('display','inline');$(options.buttonLeft).bind('mouseup',this,function(event){event.data.rotate(-1);return false;});$(options.buttonRight).bind('mouseup',this,function(event){event.data.rotate(1);return false;});if(options.mouseWheel)
{$(container).bind('mousewheel',this,function(event,delta){event.data.rotate(delta);return false;});}
$(container).bind('mouseover click',this,function(event){clearInterval(event.data.autoRotateTimer);var text=$(event.target).attr('alt');if(text!==undefined&&text!==null)
{clearTimeout(event.data.showFrontTextTimer);$(options.altBox).html(($(event.target).attr('alt')));$(options.titleBox).html(($(event.target).attr('title')));if(options.bringToFront&&event.type=='click')
{var idx=$(event.target).data('itemIndex');var frontIndex=event.data.frontIndex;var diff=idx-frontIndex;event.data.rotate(-diff);}}});$(container).bind('mouseout',this,function(event){var context=event.data;clearTimeout(context.showFrontTextTimer);context.showFrontTextTimer=setTimeout(function(){context.showFrontText();},1000);context.autoRotate();});$(container).bind('mousedown',this,function(event){event.data.container.focus();return false;});container.onselectstart=function(){return false;};this.innerWrapper=$(container).wrapInner('<div style="position:absolute;width:100%;height:100%;z-index:2;"/>').children()[0];this.showFrontText=function()
{if(items[this.frontIndex]===undefined){return;}
$(options.titleBox).html($(items[this.frontIndex].image).attr('title'));$(options.altBox).html($(items[this.frontIndex].image).attr('alt'));};this.go=function()
{if(this.controlTimer!==0){return;}
var context=this;this.controlTimer=setTimeout(function(){context.updateAll();},this.timeDelay);};this.stop=function()
{clearTimeout(this.controlTimer);this.controlTimer=0;};this.rotate=function(direction)
{this.frontIndex-=direction;this.frontIndex%=items.length;this.destRotation+=(Math.PI/items.length)*(2*direction);this.showFrontText();this.go();var cloud=new Array();for(var i=0;i<items.length;i++)
{var item=items[i];cloudPosition=$(item.image).data("cloudPosition");cloud[cloudPosition]=$(item.image);cloudPosition+=direction;if(direction==1){if(cloudPosition==0)
cloudPosition=1;else if(cloudPosition==items.length)
cloudPosition=0;}
else if(direction==-1){if(cloudPosition==-1)
cloudPosition=items.length-1;else if(cloudPosition==items.length)
cloudPosition=0;}
$(item.image).data('cloudPosition',cloudPosition);$(item.image).removeClass('front');}
$(container).trigger("startRotate",[cloud]);};this.autoRotate=function()
{if(options.autoRotate!=='no')
{var dir=(options.autoRotate==='right')?1:-1;this.autoRotateTimer=setInterval(function(){ctx.rotate(dir);},options.autoRotateDelay);}};this.updateAll=function()
{var minScale=options.minScale;var smallRange=(1-minScale)*0.5;var w,h,x,y,scale,item,sinVal;var change=(this.destRotation-this.rotation);var absChange=Math.abs(change);this.rotation+=change*options.speed;if(absChange<0.001){this.rotation=this.destRotation;}
var itemsLen=items.length;var spacing=(Math.PI/itemsLen)*2;var radians=this.rotation;var isMSIE=$.browser.msie;this.innerWrapper.style.display='none';var style;var px='px',reflHeight;var context=this;for(var i=0;i<itemsLen;i++)
{item=items[i];sinVal=funcSin(radians);scale=((sinVal+1)*smallRange)+minScale;cssWidth=$(item.image).css('width');cssWidth=cssWidth.substring(0,(cssWidth.length-2));x=this.xCentre+(((funcCos(radians)*this.xRadius)-(cssWidth*0.5)));y=this.yCentre+(((sinVal*this.yRadius))*scale);if(item.imageOK)
{var img=item.image;for(j=0;j<$(img).children('.picture').children('img').length;j++){$($(img).children('.picture')[j]).css('width',item.orgWidth[j]*scale+'px');$($(img).children('.picture')[j]).css('height',item.orgHeight[j]*scale+'px');$($(img).children('.picture').children('img')[j]).attr('width',item.orgWidth[j]*scale);$($(img).children('.picture').children('img')[j]).attr('height',item.orgHeight[j]*scale);if($($(img).children('.picture').children('img')[j]).parent().css('position')=='relative'){$($(img).children('.picture').children('img')[j]).parent().css('left',item.orgLeft[j]*scale+'px');$($(img).children('.picture').children('img')[j]).parent().css('top',item.orgTop[j]*scale+'px');}}
img.style.left=x+px;img.style.top=y+px;if(item.reflection!==null)
{reflHeight=options.reflHeight*scale;style=item.reflection.element.style;style.left=x+px;style.top=y+h+options.reflGap*scale+px;style.width=w+px;if(isMSIE)
{style.filter.finishy=(reflHeight/h*100);}else
{style.height=reflHeight+px;}}}
radians+=spacing;}
this.innerWrapper.style.display='block';if(absChange>=0.001)
{this.controlTimer=setTimeout(function(){context.updateAll();},this.timeDelay);}else
{this.stop();var cloud=new Array();for(var i=0;i<items.length;i++)
{var item=items[i];cloudPosition=$(item.image).data("cloudPosition");cloud[cloudPosition]=$(item.image);}
if(cloud[0])cloud[0].addClass('front');$(container).trigger("endRotate",[cloud]);}};this.checkImagesLoaded=function()
{var i;for(i=0;i<images.children('.picture').children('img').length;i++){if((images.children('.picture').children('img')[i].width===undefined)||((images.children('.picture').children('img')[i].complete!==undefined)&&(!images.children('.picture').children('img')[i].complete)))
{return;}}
for(i=0;i<images.length;i++){items.push(new Item(images[i],options));$(images[i]).data('itemIndex',i);$(images[i]).data('cloudPosition',i);}
clearInterval(this.tt);this.showFrontText();this.autoRotate();this.updateAll();$(container).parent().css('visibility','visible');};this.tt=setInterval(function(){ctx.checkImagesLoaded();},50);};$.fn.CloudCarousel=function(options){this.each(function(){options=$.extend({},{reflHeight:0,reflOpacity:0.5,reflGap:0,minScale:0.5,xPos:0,yPos:0,xRadius:0,yRadius:0,altBox:null,titleBox:null,FPS:30,autoRotate:'no',autoRotateDelay:1500,speed:0.2,mouseWheel:false,bringToFront:false},options);$(this).data('cloudcarousel',new Controller(this,$('.cloudcarousel',$(this)),options));});return this;};})(jQuery);;(function(b){b.fn.simpletooltip=function(f){var e=b.extend({hideOnLeave:true,margin:5,showEffect:false,hideEffect:false,click:false,hideDelay:0,showDelay:0.1,showCallback:function(){},hideCallback:function(){},customTooltip:false,customTooltipCache:true},f);this.each(function(){if(!b.isFunction(e.customTooltip)){b(this).data("$tooltip",c(this).hide())}if(e.click){b(this).bind("click",{options:e,target:this},a)}else{var g;b(this).bind("mouseenter",{options:e,target:this},function(h){var i=h;g=window.setTimeout(function(){a(i)},(e.showDelay*1000))}).bind("mouseleave",function(){window.clearTimeout(g)})}});return this};function c(g){var e=b(g).attr("href").match(/#.+/);if(!!e){var f=b(e[0])}return f}function d(e){e.appendTo(document.body).data("width",e.outerWidth()).data("height",e.outerHeight()).css({position:"absolute",zIndex:"9998",display:"none"}).find("a[rel=close]").click(function(f){f.preventDefault();e.trigger("hide")}).end().data("init",true)}function a(l){if(l.type=="click"){l.preventDefault()}var f=l.data.options;var h=b(l.data.target);if(!f.customTooltipCache&&h.data("$tooltip")){h.data("$tooltip").remove();h.data("$tooltip",false)}if(!h.data("$tooltip")){h.data("$tooltip",b(f.customTooltip(h.get(0))))}var k=h.data("$tooltip");if(!k.data("init")){d(k)}var i=b(window).width();var j=b(window).height();var n=b(window).scrollTop();var p=b(window).scrollLeft();k.unbind("show").unbind("hide");if(f.showEffect&&(f.showEffect.match(/^fadeIn|slideDown|show$/))){k.bind("show",function(){k[f.showEffect](200);f.showCallback(h[0],this)})}else{k.bind("show",function(){k.show();f.showCallback(h[0],this)})}if(f.hideEffect&&(f.hideEffect.match(/^fadeOut|slideUp|hide$/))){k.bind("hide",function(){f.hideCallback(h[0],this);k[f.hideEffect](200)})}else{k.bind("hide",function(){f.hideCallback(h[0],this);k.hide()})}var o=l.pageX-(k.data("width")/2)+100;var m=l.pageY-(k.data("height")/2)-100;if(o<p+f.margin){o=p+f.margin}else{if(o+k.data("width")>(p+i-f.margin)){o=p+i-k.data("width")-f.margin}}if(m<n+f.margin){m=n+f.margin}else{if(m+k.data("height")>(n+j-f.margin)){m=n+j-k.data("height")-f.margin}}if(f.hideDelay>0&&f.hideOnLeave){var g;k.hover(function(){window.clearTimeout(g)},function(){g=window.setTimeout(function(){k.trigger("hide").unbind("mouseenter, mouseleave")},f.hideDelay*1000)})}else{if(f.hideOnLeave){k.bind("mouseleave",function(){k.trigger("hide").unbind("mouseleave")})}}k.css({left:o+"px",top:m+"px"}).trigger("show")}})(jQuery);jQuery.log=function(text){if(window.console&&window.console.log)
window.console.log(text);else{var console=document.getElementById("console");if(!console){console=document.createElement("ul");$(console).attr("id","console");document.body.appendChild(console);}
var li=document.createElement("li");li.appendChild(document.createTextNode(text));console.appendChild(li);}};getInternetExplorerVersion=function(){var array=/MSIE [^;]*/.exec(navigator.userAgent);if(array==undefined||array.length==0)
return;var name=array[0];return parseFloat(name.substring(5,name.length-2));};arrayIndexOf=function(array,element){for(var i in array)
if(array[i]==element)
return i;return-1;};arrayRemove=function(array,element){var i=arrayIndexOf(array,element);var out=i!=-1;if(out)
array.splice(i,1);return out;};arraySortByAttribute=function(array,attribute,undefinedFirst){if(array==undefined||array.length<2)
return;if(undefinedFirst==undefined)
undefinedFirst=true;var nbPermutations;do{nbPermutations=0;for(var i=1;i<array.length;i++)
if((undefinedFirst&&array[i-1][attribute]!=undefined&&array[i][attribute]==undefined)||(!undefinedFirst&&array[i-1][attribute]==undefined&&array[i][attribute]!=undefined)||(array[i-1][attribute]!=undefined&&array[i][attribute]!=undefined&&array[i][attribute]<array[i-1][attribute])){var tmp=array[i];array[i]=array[i-1];array[i-1]=tmp;nbPermutations++;}}while(nbPermutations>0);};moveDOMAttribute=function(nodeFrom,attrName,nodeTo){var jFrom=$(nodeFrom);if(jFrom.attr(attrName)!=undefined){$(nodeTo).attr(attrName,jFrom.attr(attrName));jFrom.removeAttr(attrName);}};getFirstParentWithNodeName=function(node,parentNodeName){if(node==null)
return null;var parent=node.parentNode;while(parent!=null&&parent!=undefined&&parent.nodeName!=parentNodeName)
parent=parent.parentNode;return parent;};$.fn.toggleTitleDisplay=function(display){return this.each(function(){var self=$(this);if(display){if(self.attr("title")==""||self.attr("title")==undefined){self.attr("title",self.data("title"));self.removeData("title");}}else{if(self.attr("title")!=undefined&&self.data("title")==undefined){self.data("title",self.attr("title"));self.removeAttr("title");}}});};parseIntDefault=function(text,defaultvalue){if(text==undefined)
return defaultvalue;var out=parseInt(text);if(out==NaN)
return defaultvalue;return out;};formatDuration=function(format,seconds){if(seconds instanceof String)
seconds=parseInt(seconds);var days=Math.floor(seconds/86400);var remainder=(seconds%86400);var hours=Math.floor(remainder/3600);remainder=(seconds%3600);var minutes=Math.floor(remainder/60);remainder=(seconds%60);if(days>1){format=format.replace("DDD",days+" "+jQuery.orange.config.i18n.map["duration.days"]);}else{format=format.replace("DDD",days+" "+jQuery.orange.config.i18n.map["duration.day"]);}
format=format.replace("DD",days+" "+jQuery.orange.config.i18n.map["duration.d"]);if(hours>1){format=format.replace("HHH",hours+" "+jQuery.orange.config.i18n.map["duration.hours"]);}else{format=format.replace("HHH",hours+" "+jQuery.orange.config.i18n.map["duration.hour"]);}
format=format.replace("HH",hours+" "+jQuery.orange.config.i18n.map["duration.h"]);format=format.replace("H",twoDigits(hours));if(minutes>1){format=format.replace("MMM",minutes+" "+jQuery.orange.config.i18n.map["duration.minutes"]);}else{format=format.replace("MMM",minutes+" "+jQuery.orange.config.i18n.map["duration.minute"]);}
format=format.replace("MM",minutes+" "+jQuery.orange.config.i18n.map["duration.m"]);format=format.replace("M",twoDigits(minutes));if(remainder>1){format=format.replace("SSS",remainder+" "+jQuery.orange.config.i18n.map["duration.seconds"]);}else{format=format.replace("SSS",remainder+" "+jQuery.orange.config.i18n.map["duration.second"]);}
format=format.replace("SS",remainder+" "+jQuery.orange.config.i18n.map["duration.s"]);format=format.replace("S",twoDigits(remainder));return format;};twoDigits=function(value){if(value<10){return"0"+value;}
return""+value;};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'').replace('\r','');};String.prototype.startsWith=function(prefix){return this.substring(0,prefix.length)==prefix;};String.prototype.endsWith=function(suffix){return this.substring(this.length-suffix.length)==suffix;};crudReadOneExpextingUniqueValue=function(id,callback){jQuery.orange.config.api.crud.read([id],function(result){if(result[id].nb!=1){callback();return;}
var i,uniqueValue,values=result[id].values;for(i in values)
uniqueValue=values[i];callback(uniqueValue);});};jQuery.orange={config:{i18n:{baseurl:null,language:null,country:null},api:{crud:null,authorization:null},booleans:[],namedregex:{},areacontent:{},postInit:null,onUnloadWithoutSubmit:null},loadControler:{currentLoadingURL:null}};jQuery.orange.getDataValue=function(node){if(node.getDataValue==undefined)
return undefined;var value=node.getDataValue();var ref=node.dataValueRef;if(ref!=undefined){if(ref===parseInt(ref))
value=parseInt(value);else if(ref===parseFloat(ref))
value=parseFloat(value);else if(ref===false||ref===false)
value=(value===true)||(value==="true");}
return value;};jQuery.orange.setDataValue=function(node,value){var oldValue=node.dataValueRef;node.dataValueRef=value;if(node.setDataValue!=undefined){node.setDataValue(value);}else{var jNode=$(node);var i18nPrefix=jNode.attr("i18nPrefix");if(node.nodeName=="IMG"){jNode.removeAttr("width");jNode.removeAttr("height");jNode.attr("src",jQuery.orange.config.i18n.map[i18nPrefix+"."+value+".img"]);}else
jNode.html((i18nPrefix)?jQuery.orange.config.i18n.map[i18nPrefix+"."+value]:value);if(i18nPrefix){$(node).orangeTranslate();jQuery.orange.setValueClassAndTip(node,value,oldValue,i18nPrefix);}
if(oldValue!=value){$(node).trigger("valueChange",[value]);}}};jQuery.orange.setValueClassAndTip=function(node,newValue,oldValue,i18nPrefix){var jNode=$(node);if(i18nPrefix==undefined)
i18nPrefix=jNode.attr("i18nPrefix");if(i18nPrefix==undefined)
return;if(oldValue!=undefined){var cssClass=jQuery.orange.config.i18n.map[i18nPrefix+"."+oldValue+".class"];if(cssClass)
jNode.removeClass(cssClass);}
var attrI18n=i18nPrefix+"."+newValue;var cssClass=jQuery.orange.config.i18n.map[attrI18n+".class"];if(cssClass!=undefined)
jNode.addClass(cssClass);var tip=jQuery.orange.config.i18n.map[attrI18n+".tip"];if(tip==undefined){tip=jQuery.orange.config.i18n.map[i18nPrefix+".tip"];}
if(tip!=undefined){jNode.attr("title",tip);if(this.nodeName=="IMG")
jNode.attr("alt",tip);}};jQuery.orange.booleanValue=function(value){for(var i in jQuery.orange.config.booleans){var couple=jQuery.orange.config.booleans[i];if(value===couple[0])
return false;if(value===couple[1])
return true;}};jQuery.orange.booleanNot=function(value){for(var i in jQuery.orange.config.booleans){var couple=jQuery.orange.config.booleans[i];if(value===couple[0])
return couple[1];if(value===couple[1])
return couple[0];}};jQuery.orange.onDataChange=function(event){var node=event.target;if(node!=this)
return;var form=getFirstParentWithNodeName(node,"FORM");if(form==undefined)
return;if(form.onDataChange!=undefined)
form.onDataChange(node);else
jQuery.orange.widget.Form.onDataChange.call(form,node);};jQuery.orange.getBoxCodeMsg=function(code){var msg=jQuery.orange.config.i18n.map["box.code."+code];if(msg==undefined)
msg="Box code '"+code+"'";return msg;};jQuery.orange.errorMsgKey=function(msgKey,node){var msg=jQuery.orange.config.i18n.map["error.constraint."+msgKey];var i18nError=$(node).attr("i18nError");if(i18nError!=undefined){var nodeMsg=jQuery.orange.config.i18n.map[i18nError+"."+msgKey];if(nodeMsg!=undefined)
msg=nodeMsg;}
jQuery.orange.errorMsg(msg,node);};jQuery.orange.errorMsg=function(msg,node){var jNode=$(node);if(jNode.attr("errnodeparent")!=undefined){var msgNodeParent=document.getElementById(jNode.attr("errnodeparent"));var subNodeId=jNode.attr("errSubNodeId");if(subNodeId!=undefined){var msgNode=$("[subNodeId="+subNodeId+"]",msgNodeParent)[0];if(msgNode!=undefined){if(msgNode.rawMsg==msg)
return;else{arrayRemove(msgNode.nodeIds,jNode.attr("inputId"));jNode.removeAttr("errSubNodeId");if(msgNode.nodeIds.length==0)
$(msgNode).remove();}}}
if(msg==undefined||msg==null){jNode.removeClass("errorInput");return;}
var msgNode;if(msg!=undefined&&msg!=null){$(">div",msgNodeParent).each(function(){if(this.rawMsg==msg){msgNode=this;subNodeId=$(msgNode).attr("subNodeId");}});}
if(msgNode==undefined){var lastSubNodeId=msgNodeParent.lastSubNodeId;if(lastSubNodeId==undefined)
subNodeId=0;else
subNodeId=lastSubNodeId+1;msgNodeParent.lastSubNodeId=subNodeId;msgNode=document.createElement("div");}
msgNode.rawMsg=msg;$(msgNode).html(msg).addClass("errorMsg").attr("subNodeId",subNodeId);msgNodeParent.appendChild(msgNode);msgNode.nodeIds=new Array();jNode.addClass("errorInput").attr("errSubNodeId",subNodeId);var inputId=jNode.attr("inputId");if(inputId==undefined){var lastInputId=msgNodeParent.lastInputId;if(lastInputId==undefined)
inputId=0;else
inputId=lastInputId+1;msgNodeParent.lastInputId=inputId;jNode.attr("inputId",inputId);}
msgNode.nodeIds.push(inputId);return;}
var msgNode;if(jNode.attr("errnode")!=undefined)
msgNode=document.getElementById(jNode.attr("errnode"));if(msgNode==undefined){msgNode=node.nextSibling;if(msgNode==undefined||!$(msgNode).hasClass("errorMsg")){if(msg==undefined||msg==null)
return;msgNode=document.createElement("div");$(msgNode).addClass("errorMsg");jNode.after(msgNode);}else if(msg==undefined||msg==null){jNode.removeClass("errorInput");node.parentNode.removeChild(msgNode);return;}}
if(msg==undefined||msg==null){jNode.removeClass("errorInput");$(msgNode).html("");}else{jNode.addClass("errorInput");$(msgNode).html(msg);}};jQuery.orange.errorMsg.lastId=0;jQuery.orange.constraint2text=function(constraint,value){return(constraint=="enumerated")?JSON.stringify(value):""+value;};jQuery.orange.treatReadResult=function(node,result){var attr=undefined;if(result.nb==1){var jNode=$(node);if(result.constraints!=undefined){var constraint;for(constraint in result.constraints)
jNode.attr(constraint,jQuery.orange.constraint2text(constraint,result.constraints[constraint]));}
for(attr in result.values)
if(attr!=jNode.attr("dataId"))
jNode.attr("dataId",attr);}
if(node.onDataRead!=undefined){node.dataValueRef=(attr!=undefined)?result.values[attr]:result.values;node.onDataRead(result);}else if(attr!=undefined)
jQuery.orange.setDataValue(node,result.values[attr]);};jQuery.orange.widget={};(function($){function getAreaContentId(element){return $(element.children[0]).attr("id");}
$.fn.setDisabled=function(disabled){return this.each(function(){var form=getFirstParentWithNodeName(this,"FORM");if($(this).attr("dataId")==undefined)
form=undefined;var oldState;if(form!=undefined)
oldState=jQuery.orange.widget.Form.getState.call(form);if(disabled){$(this).attr("disabled","disabled");$(this).data("disabled",true);}else{$(this).removeAttr("disabled");$(this).removeData("disabled");}
if(this.setDisabled!=undefined)
this.setDisabled(disabled);if(form!=undefined){if(disabled){arrayRemove(form.modifsOK,this);arrayRemove(form.dataKO,this);}else if(this.getDataValue!=undefined&&this.dataValueRef!=undefined){var nodeValue=this.getDataValue();if(nodeValue==undefined)
return;var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;if(jQuery.orange.widget.Form.verifyConstraints(this)==GOOD){if(nodeValue!=this.dataValueRef&&arrayIndexOf(form.modifsOK,this)==-1)
form.modifsOK.push(this);}else{if(arrayIndexOf(form.dataKO,this)==-1)
form.dataKO.push(this);}}
var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}});};$.fn.orangeLoad=function(url,substitutions,callback){if(url!=jQuery.orange.loadControler.currentLoadingURL){if(substitutions!=undefined&&callback==undefined&&substitutions instanceof Function){callback=substitutions;substitutions=undefined;}
var countDown=this.size();return this.each(function(){var self=$(this);var this0=this;var loadCallback=function(){jQuery.orange.loadControler.currentLoadingURL=url;var innerHTML=this0.innerHTML;innerHTML=innerHTML.replace(/\r?\n[ \t]*/g,"");if(substitutions!=undefined){for(var attr in substitutions)
innerHTML=innerHTML.replace(new RegExp(attr,"g"),substitutions[attr]);}
this0.innerHTML=innerHTML;var callbacks=undefined;var contentId=getAreaContentId(this0);if(contentId)
callbacks=jQuery.orange.config.areacontent[contentId];if(callbacks&&callbacks.preParse)
callbacks.preParse(this0);self.orangeParse();if(callbacks&&callbacks.postParse)
callbacks.postParse(this0);self.orangeRead(function(){countDown--;if(countDown==0){if(callbacks&&callbacks.postLoad){try{callbacks.postLoad(this0);}catch(err){}}
if(callback!=undefined){callback();}}});jQuery.orange.loadControler.currentLoadingURL=null;};var unsubmitted=false;var contentId=getAreaContentId(this);if(contentId=="ntp"){clearTimeout(gmtTimer);}
if(contentId!=undefined){unsubmitted=false;$("form",this).each(function(){var actions=jQuery.orange.widget.Form.getActions(this);if(actions===false)
unsubmitted=true;else{var i;for(i in actions)
if(actions[i].crud!="read")
unsubmitted=true;}});var clearThenLoad=function(){var callbacks=jQuery.orange.config.areacontent[contentId];if(callbacks!=undefined&&callbacks.preUnload!=undefined)
callbacks.preUnload(this0);self.load(url,loadCallback);};if(unsubmitted&&jQuery.orange.config.onUnloadWithoutSubmit!=null){jQuery.orange.config.onUnloadWithoutSubmit.call(this,function(continueLoad){if(continueLoad)
clearThenLoad();});}else{clearThenLoad();}}else{self.load(url,loadCallback);}});}};$.fn.orangeParse=function(){var htmlWidgetNodes=["Form","Input","Select"];var this0=this;var onParseCallbacks=[];return this.each(function(){var nbNewWidgets;do{nbNewWidgets=0;var widgetParse=function(){if(this.widgetBuilt)
return;var self=$(this);var types=self.attr("widgetType");var args=self.attr("widgetArg");var initWidget=function(type,arg){if(self["widget"+type])
if(arg!=undefined)
self["widget"+type].call(self,arg);else
self["widget"+type].call(self);else
alert("Parse error: widget '"+type+"' unknown");};if(args!=undefined)
args=eval("("+args+")");if(types.indexOf(",")>0){types=types.split(",");var i;for(i in types){var type=types[i];var arg=(args!=undefined&&args[type]!=undefined)?args[type]:undefined;initWidget(type,arg);}}else
initWidget(types,args);this.widgetBuilt=true;if(this.onParse!=undefined)
onParseCallbacks.push({fn:this.onParse,node:this,priority:this.onParse.priority});nbNewWidgets++;};var widgets=$('[widgetType]',this);widgets.filter('[widgetType!="FormInput"]').each(widgetParse);widgets.filter('[widgetType="FormInput"]').each(widgetParse);var i;for(i in htmlWidgetNodes){var htmlWidget=htmlWidgetNodes[i];$(htmlWidget.toLowerCase(),this).each(function(){if(this.widgetBuilt)
return;$(this)["widget"+htmlWidget]();this.widgetBuilt=true;if(this.onParse!=undefined)
onParseCallbacks.push({fn:this.onParse,node:this,priority:this.onParse.priority});nbNewWidgets++;});}}while(nbNewWidgets>0);nbNewWidgets=undefined;$("[i18n]",this0).orangeTranslate();var ieVersion=getInternetExplorerVersion();if(ieVersion!=undefined&&ieVersion<8){$("input",this).removeAttr("width").removeAttr("height");$("*",this).each(function(){if($(this).css("display")=="inline-block"){$(this).css("display","inline");$(this).css("zoom","1");}});}
arraySortByAttribute(onParseCallbacks,"priority",false);for(var i in onParseCallbacks)
onParseCallbacks[i].fn.call(onParseCallbacks[i].node);});};$.fn.orangeRead=function(callback){var countDown=this.size();return this.each(function(){var dataNodeList=new Array();var ids=new Array();$("[dataId]",this).each(function(){var self=$(this);if(this.nodeName=="INPUT"&&self.attr("type")=="submit")
return;var id=self.attr("dataId");dataNodeList.push({node:this,id:id});ids.push(id);});var this0=this;jQuery.orange.config.api.crud.read(ids,function(id2result){for(var i in dataNodeList){var dataNode=dataNodeList[i];var result=id2result[dataNode.id];if(result!=undefined)
jQuery.orange.treatReadResult(dataNode.node,result);}
$(".errorInput",this0).removeClass("errorInput");$(".errorMsg",this0).remove();countDown--;if(countDown==0&&callback!=undefined)
callback();});});};$.fn.orangeTranslate=function(){return this.each(function(){if(this.orangeTranslate!=undefined){this.orangeTranslate();return;}
var self=$(this);var attrI18n=self.attr("i18n");if(attrI18n==undefined){var prefix=self.attr("i18nPrefix");if(prefix==undefined)
return;var value=jQuery.orange.getDataValue(this);if(value==undefined)
value=this.dataValueRef;if(value==undefined)
return;attrI18n=prefix+"."+value;}
if(this.nodeName=="IMG"){var translation=jQuery.orange.config.i18n.map[attrI18n+".img"];if(translation!=undefined){self.attr("src",translation);}}else{var translation=jQuery.orange.config.i18n.map[attrI18n];if(translation!=undefined){if(this.nodeName=="INPUT"){var type=self.attr("type");if(type=="button"||type=="submit"||type=="reset"){self.attr("value",translation);}}else if(this.nodeName!="SELECT"&&this.nodeName!="TEXTAREA"){self.html(translation);}}}
var cssClass=jQuery.orange.config.i18n.map[attrI18n+".class"];if(cssClass!=undefined)
self.addClass(cssClass);var tip=jQuery.orange.config.i18n.map[attrI18n+".tip"];var nodesWithoutTip=["DIV","SPAN","H1","H2","H3","TH"];if(tip!=undefined){if(this.nodeName=="IMG")
self.attr("alt",tip);else if(arrayIndexOf(nodesWithoutTip,this.nodeName)==-1)
self.attr("title",tip);else if(this.parentNode.nodeName=='A')
self.attr("title",tip);}});};})(jQuery);jQuery.orange.init={};jQuery.orange.init.i18n={load:function(callback){var i18nConf=jQuery.orange.config.i18n;i18nConf.map={};var url=i18nConf.baseurl;if(i18nConf.language){url+="_"+i18nConf.language;if(i18nConf.country)
url+="_"+i18nConf.country;}else
i18nConf.country=null;url+=".properties";jQuery.ajax({url:url,error:function(){jQuery.orange.init.i18n.error(callback);},success:function(data){jQuery.orange.init.i18n.success(data,callback);},dataType:"text",cache:false});},error:function(callback){var i18nConf=jQuery.orange.config.i18n;if(i18nConf.language){if(i18nConf.country)
i18nConf.country=null;else
i18nConf.language=null;jQuery.orange.init.i18n.load(callback);}else{alert("Initialization aborted : can not load internationalization data");if(callback!=undefined)
callback(false);}},success:function(data,callback){var i18nConf=jQuery.orange.config.i18n;i18nConf.map={};var i18nMap=i18nConf.map;var props=data.split("\n");for(var i in props){var prop=props[i];if(prop.indexOf("#")!=0){var index=prop.indexOf(":");if(index==-1)
index=prop.indexOf("=");if(index!=-1){i18nMap[prop.substring(0,index).trim()]=prop.substring(index+1).trim();}}}
for(var i=0;i<7;i++){dateFormat.i18n.dayNames[i]=i18nMap["date.day.short."+i];dateFormat.i18n.dayNames[i+7]=i18nMap["date.day.complete."+i];}
for(var i=0;i<12;i++){dateFormat.i18n.monthNames[i]=i18nMap["date.month.short."+i];dateFormat.i18n.monthNames[i+12]=i18nMap["date.month.complete."+i];}
$("[i18n], [widgetType]").add("[i18nPrefix]").orangeTranslate();$("form").each(function(){jQuery.orange.widget.Form.alignFormInputs.call(this);});jQuery.orange.widget.MenuItem.hashManualChange=true;fr.orange.livebox.gui.i18n.I18n.getInstance().changeLanguage(i18nConf.language);if(callback!=undefined)
callback(true);}};jQuery.orangeInit=function(){$("form [dataId]").live("change valueChange",jQuery.orange.onDataChange);$("form input[dataId][type=text]").live("keyup input propertyChange",jQuery.orange.onDataChange);$("form [dataId] input[type=text]").live("keyup",function(event){var node=event.target;while($(node).attr("dataId")==undefined)
node=node.parentNode;jQuery.orange.onDataChange.call(node,{target:node});});jQuery.orange.init.i18n.load(jQuery.orange.config.postInit);};jQuery.orange.widget.Button={setDisabled:function(disabled){var selection=$("input",this);if(disabled)
selection.attr("disabled","disabled");else
selection.removeAttr("disabled");selection.toggleTitleDisplay(!disabled);this.disabled=disabled;}};(function($){$.fn.widgetButton=function(options){return this.each(function(){this.disabled=false;this.setDisabled=jQuery.orange.widget.Button.setDisabled;var self=$(this);if(options==undefined)
options={};var type=options.type;if(type==undefined||(type!="submit"&&type!="reset"))
type="button";var crud=options.crud;var input=document.createElement("input");var jInput=$(input);jInput.attr("type",type);this.appendChild(input);moveDOMAttribute(this,"i18n",input);if(type=="submit"&&crud!=undefined){jInput.attr("crud",crud);moveDOMAttribute(this,"dataId",input);}
if(this.firstChild!=undefined&&this.firstChild.nodeType==3){var text=this.firstChild;this.removeChild(text);jInput.attr("value",text.nodeValue);}
var i18n=jInput.attr("i18n");if(jQuery.orange.config.i18n.map[i18n+".class"]!=undefined){jInput.removeClass(jQuery.orange.config.i18n.map[i18n+".class"]);$(this).addClass(jQuery.orange.config.i18n.map[i18n+".class"]);}else{$(this).addClass("btn");}
var self=this;jInput.bind('click keydown keyup',function(event){if(self.disabled){event.stopPropagation();}});jInput.bind('click',function(event){if(!self.disabled){jInput.trigger('activateButton',event);}});jInput.bind('keyup',function(event){if(!self.disabled){var keycode=(event.which!=undefined)?event.which:event.charCode;if(keycode==13||keycode==32){jInput.trigger('activateButton',event);}}});});};})(jQuery);jQuery.orange.widget.ButtonContainer={onParse:function(){$("[widgetType*=Button] + [widgetType*=Button]",this).filter(function(){return $(this).is(":visible");}).before("<span class='spacer'/>");}};(function($){$.fn.widgetButtonContainer=function(options){return this.each(function(){this.onParse=jQuery.orange.widget.ButtonContainer.onParse;var self=$(this);self.addClass("btnContainer");self.after('<div class="clear"/>');});};})(jQuery);jQuery.orange.widget.ButtonImage={setDisabled:function(disabled){this.disabled=disabled;var selection=$("img",this);if(disabled){selection.attr("disabled","disabled");}else{selection.removeAttr("disabled");}
var i18n=selection.attr("i18n");var src=jQuery.orange.config.i18n.map[i18n+"."+disabled+".img"];var title=jQuery.orange.config.i18n.map[i18n+".tip"];selection.attr("src",src);selection.attr("title",title);selection.toggleTitleDisplay(!disabled);}};(function($){$.fn.widgetButtonImage=function(options){return this.each(function(){this.disabled=false;this.setDisabled=jQuery.orange.widget.ButtonImage.setDisabled;var a=document.createElement("a");var jA=$(a);$(a).attr("href","javascript:;");$(a).addClass("buttonimagelink");this.appendChild(a);var img=document.createElement("img");var jImg=$(img);a.appendChild(img);moveDOMAttribute(this,"i18n",img);$(this).addClass("btnCursor");var i18n=jImg.attr("i18n");var title=jQuery.orange.config.i18n.map[i18n+".tip"];var alternative=jQuery.orange.config.i18n.map[i18n+".alt"];jImg.attr("title",title);if(alternative!=undefined){jImg.attr("alt",alternative);}else if(title!=undefined){jImg.attr("alt",title);}else{jImg.attr("alt","");}
var self=this;jA.bind('click keydown keyup',function(event){if(self.disabled){event.stopPropagation();}});jA.bind('click',function(event){if(!self.disabled){jA.trigger('activateButton',event);}});jA.bind('keyup',function(event){if(!self.disabled){var keycode=(event.which!=undefined)?event.which:event.charCode;if(keycode==13||keycode==32){jA.trigger('activateButton',event);}}});});};})(jQuery);jQuery.orange.widget.Checkbox={getDataValue:function(){return $("input",this)[0].checked?this.checkedValue:this.uncheckedValue;},setDataValue:function(value){if(this.getDataValue()!==value){var checked=value===this.checkedValue;$("input",this)[0].checked=checked;var oldValue=checked?this.uncheckedValue:this.checkedValue;jQuery.orange.setValueClassAndTip(this,value,oldValue);$(this).trigger("valueChange",[value]);}},toggleDataValue:function(){var value=this.getDataValue();value=(value==this.checkedValue)?this.uncheckedValue:this.checkedValue;this.setDataValue(value);},setDisabled:function(disabled){var selection=$("input",this);if(disabled)
selection.attr("disabled","disabled");else
selection.removeAttr("disabled");selection.toggleTitleDisplay(!disabled);},onChange:function(event){event.stopPropagation();var widget=event.target.parentNode;$(widget).trigger("valueChange",[widget.getDataValue()]);},onValueChange:function(event){var widget=event.target.parentNode;var value=widget.getDataValue();var oldValue=(value===widget.checkedValue)?widget.uncheckedValue:widget.checkedValue;jQuery.orange.setValueClassAndTip(widget,value,oldValue);event.stopPropagation();}};(function($){$.fn.widgetCheckbox=function(options){return this.each(function(){this.getDataValue=jQuery.orange.widget.Checkbox.getDataValue;this.setDataValue=jQuery.orange.widget.Checkbox.setDataValue;this.toggleDataValue=jQuery.orange.widget.Checkbox.toggleDataValue;this.setDisabled=jQuery.orange.widget.Checkbox.setDisabled;this.uncheckedValue=options[0];this.checkedValue=options[1];var input=document.createElement("input");var jInput=$(input);jInput.attr("type","checkbox");jInput.bind("change",jQuery.orange.widget.Checkbox.onChange);jInput.bind("valueChange",jQuery.orange.widget.Checkbox.onValueChange);this.appendChild(input);});};})(jQuery);jQuery.orange.widget.Collapsible={isCollapsed:function(){var jBanner=$($(".collapsible-banner",this)[0]);return jBanner.hasClass("collapsible-banner-collapsed");},toggle:function(){var jBanner=$($(".collapsible-banner",this)[0]);var content=$(".collapsible-content",this)[0];if(this.isCollapsed()){jBanner.removeClass("collapsible-banner-collapsed");content.style.display="block";}else{jBanner.addClass("collapsible-banner-collapsed");content.style.display="none";}
$(this).trigger("collapseToggle",[this.isCollapsed()]);},onClick:function(){this.toggle();}};(function($){$.fn.widgetCollapsible=function(options){return this.each(function(){var self=$(this);var content=document.createElement("div");while(this.childNodes.length>0)
content.appendChild(this.childNodes[0]);this.appendChild(content);var banner=document.createElement("span");var jBanner=$(banner);var i18n=self.attr("i18n");if(i18n!=undefined){jBanner.attr("i18n",i18n);self.removeAttr("i18n");}
this.insertBefore(banner,content);this.isCollapsed=jQuery.orange.widget.Collapsible.isCollapsed;this.toggle=jQuery.orange.widget.Collapsible.toggle;this.onClick=jQuery.orange.widget.Collapsible.onClick;var this0=this;jBanner.click(function(){this0.onClick.apply(this0,arguments);});self.bind("collapseToggle",function(event){event.stopPropagation();});self.addClass("collapsible");jBanner.addClass("collapsible-banner");$(content).addClass("collapsible-content");if(options==false){this.onParse=function(){this0.toggle();};this.onParse.priority=20;}});};})(jQuery);jQuery.orange.widget.Dialog={createButton:function(index,text){var parent=this.parentNode;var span=document.createElement("span");$(span).html("&#160;");$(span).addClass("ui-button-submit");parent.appendChild(span);var button=document.createElement("input");var jButton=$(button);jButton.attr("type","button");jButton.attr("i18n",text);jButton.addClass("ui-widget ui-button ui-button-theme");parent.appendChild(button);var self=$(this);jButton.click(function(){self.trigger("choice",[index]);self.dialog("widget").remove();self.remove();});},orangeTranslate:function(){var self=$(this);var i18n=self.attr("i18n");var title=(i18n!=undefined)?jQuery.orange.config.i18n.map[i18n]:"";self.attr("title",title);}};(function($){$.fn.widgetDialog=function(options){return this.each(function(){if(options==undefined||!options instanceof Array)
return;this.orangeTranslate=jQuery.orange.widget.Dialog.createButton.orangeTranslate;$(this).dialog({resizable:false,modal:true});for(var i in options)
jQuery.orange.widget.Dialog.createButton.call(this,i,options[i]);$("[i18n]",this.parentNode).orangeTranslate();});};})(jQuery);jQuery.orange.widget.Duration={orangeTranslate:function(){var format=jQuery.orange.config.i18n.map[$(this).attr("i18nPrefix")];$(this).html(formatDuration(format,this.dataValueRef));},updateOnPeriodic:function(value){this.dataValueRef=value;}};(function($){$.fn.widgetDuration=function(options){return this.each(function(){this.orangeTranslate=jQuery.orange.widget.Duration.orangeTranslate;this.updateOnPeriodic=jQuery.orange.widget.Duration.updateOnPeriodic;});};})(jQuery);jQuery.orange.widget.ElapsedTime={setDataValue:function(value){var date=(value instanceof Date)?date:dataDateParse(value);var diff=new Date().getTime()-date.getTime();var format=jQuery.orange.config.i18n.map[$(this).attr("i18nPrefix")];$(this).html(formatDuration(format,new Date(diff/1000)));}};(function($){$.fn.widgetElapsedTime=function(options){return this.each(function(){this.setDataValue=jQuery.orange.widget.ElapsedTime.setDataValue;});};})(jQuery);jQuery.orange.widget.EnumInput={counter:0,getDataValue:function(){var type=this.enumInputType;var res=undefined;switch(type){case"radio":res=$("input:checked",this);return(res!=undefined&&res.size()>0)?res[0].rawValue:undefined;case"button":return this.dataValueCurrent;case"select":res=$("select",this);return(res!=undefined&&res.size()>0)?res[0].getDataValue():undefined;case"icons":res;$("img",this).each(function(){var td=this.parentNode;if(!$(td).hasClass("enuminput-icons-hidden"))
res=td.rawValue;});return res;}},setDataValue:function(value){if(value==this.getDataValue())
return;var type=this.enumInputType;switch(type){case"radio":$("input",this).each(function(){if(this.rawValue==value)
$(this).attr("checked","checked");});break;case"button":this.dataValueCurrent=value;if(!$(this).attr("disabled"))
$("input",this).each(function(){if(this.rawValue==value)
$(this).attr("disabled","disabled");else
$(this).removeAttr("disabled");});break;case"select":$("select",this)[0].setDataValue(value);break;case"icons":$("img",this).each(function(){var td=this.parentNode;if(td.rawValue==value)
$(td).removeClass("enuminput-icons-hidden");else{$(td).addClass("enuminput-icons-hidden");}});}
$(this).trigger("change",[value]);},setDisabled:function(disabled){var type=this.enumInputType;var selection=undefined;switch(type){case"radio":selection=$("input",this);break;case"button":selection=$("input",this);var value=this.dataValueCurrent;var button=undefined;selection.each(function(){if(this.rawValue==value)
button=this;});selection=selection.not(button);break;case"select":$("select",this).setDisabled(disabled);break;case"icons":if(disabled)
$(this).addClass("enuminput-disabled");else
$(this).removeClass("enuminput-disabled");}
if(selection!=undefined){if(disabled)
selection.attr("disabled","disabled");else
selection.removeAttr("disabled");selection.toggleTitleDisplay(!disabled);}}};(function($){$.fn.widgetEnumInput=function(options){return this.each(function(){this.getDataValue=jQuery.orange.widget.EnumInput.getDataValue;this.setDataValue=jQuery.orange.widget.EnumInput.setDataValue;this.setDisabled=jQuery.orange.widget.EnumInput.setDisabled;if(options==undefined)
options="select";this.enumInputType=options;var buildFromEnumerated=function(){var self=$(this);var enumerated=self.attr("enumerated");var values=eval("("+enumerated+")");var name="enuminput"+(jQuery.orange.widget.EnumInput.counter++);switch(options){case"radio":var html="";var i18nPrefix=self.attr("i18nPrefix");self.removeAttr("i18nPrefix");for(var i in values){var id=name+"-"+i;html+="<span class='enuminput-item'><input id='"+id+"' type='radio' name='"+name+"'/><label for='"+id+"'";var value=values[i];if(i18nPrefix!=undefined)
html+=" i18n='"+i18nPrefix+"."+value+"'/>";else
html+=">"+value+"</label>";html+="</span>";}
self.html(html);if(i18nPrefix!=undefined)
$("[i18n]",this).orangeTranslate();var radios=$("input",this);var j=0;var onClick=function(){self.trigger("change",[this.rawValue]);};for(var i in values){var value=values[i];radios[j].rawValue=value;$(radios[j]).click(onClick);jQuery.orange.setValueClassAndTip(radios[j].parentNode,value,undefined,i18nPrefix);j++;}
break;case"button":var buttons=[];var onClick=function(event){event.stopPropagation();this.parentNode.dataValueCurrent=this.rawValue;for(var i in buttons){var b=buttons[i];if(b!=this)
$(b).removeAttr("disabled");else
$(b).attr("disabled","disabled");}
self.trigger("change",[this.rawValue]);};var i18nPrefix=self.attr("i18nPrefix");self.removeAttr("i18nPrefix");for(var i in values){var value=values[i];var button=document.createElement("input");var jButton=$(button);jButton.attr("type","button");jButton.attr("name",name);button.rawValue=value;buttons.push(button);if(i18nPrefix!=undefined)
jButton.attr("i18n",i18nPrefix+"."+value);else
jButton.attr("value",value);jQuery.orange.setValueClassAndTip(button,value,undefined,i18nPrefix);jButton.click(onClick);self.append(button);}
if(i18nPrefix!=undefined)
$("[i18n]",this).orangeTranslate();break;case"icons":self.addClass("enuminput-icons");var html='<table><tr><td class="enuminput-icons-prev" i18n="enuminput.previous"/>';var i18nPrefix=self.attr("i18nPrefix");for(var i in values){html+='<td class="enuminput-icons-hidden"><img i18n="'+i18nPrefix+'.'+values[i]+'"/></td>';}
html+='<td class="enuminput-icons-next" i18n="enuminput.next"/></tr></table>';self.html(html);$("td:eq(1)",this).removeClass("enuminput-icons-hidden");$("[i18n]",this).orangeTranslate();var tr=this.firstChild.firstChild.firstChild;var j=1;for(i in values){if(j<tr.childNodes.length){tr.childNodes[j++].rawValue=values[i];}}
var onClick=function(event,incr){var tr=event.target.parentNode;var children=tr.childNodes;var current=0;for(var i=1;i<children.length-1;i++)
if(!$(children[i]).hasClass("enuminput-icons-hidden"))
current=i;current+=incr;if(current==0||current==children.length-1)
return;for(i=1;i<children.length-1;i++)
if(i==current)
$(children[i]).removeClass("enuminput-icons-hidden");else
$(children[i]).addClass("enuminput-icons-hidden");self.trigger("change",[children[current].rawValue]);};$(".enuminput-icons-prev",this).click(function(event){if(!self.attr("disabled"))
onClick(event,-1);});$(".enuminput-icons-next",this).click(function(event){if(!self.attr("disabled"))
onClick(event,1);});}};if(options=="select"){var select=document.createElement("select");moveDOMAttribute(this,"enumerated",select);moveDOMAttribute(this,"dataId",select);moveDOMAttribute(this,"i18n",select);moveDOMAttribute(this,"i18nPrefix",select);var self=$(this);self.append(select);self.orangeParse();$(select).bind("valueChange",function(event,newValue){self.trigger("change",[newValue]);});}else{$(this).removeAttr("i18n");if($(this).attr("enumerated")!=undefined)
buildFromEnumerated.call(this);else{this.onDataRead=function(data){if(data.nb!=1)
return;var value=undefined;for(var i in data.values)
value=data.values[i];if(this.childNodes.length==0)
buildFromEnumerated.call(this);this.setDataValue(value);};}}});};})(jQuery);jQuery.orange.widget.Form={STATE_NO_MODIF:0,STATE_MODIF_OK:1,STATE_KO:2,STATE_ONCREATE:3,getState:function(){if(this.getState!=undefined){return this.getState();}
if(this.dataKO.length>0){return jQuery.orange.widget.Form.STATE_KO;}
var state=jQuery.orange.widget.Form.STATE_NO_MODIF;if(this.lineRemoved===true){state=jQuery.orange.widget.Form.STATE_MODIF_OK;}
for(var i in this.subForms){var subState=jQuery.orange.widget.Form.getState.call(this.subForms[i]);if(subState==jQuery.orange.widget.Form.STATE_KO){return jQuery.orange.widget.Form.STATE_KO;}else if(subState==jQuery.orange.widget.Form.STATE_MODIF_OK){state=jQuery.orange.widget.Form.STATE_MODIF_OK;}}
if(this.modifsOK.length>0){state=jQuery.orange.widget.Form.STATE_MODIF_OK;}
return state;},constraint:{required:function(isRequired,value){if(isRequired&&value.length<=0){return fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;}
return fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;},minlength:function(min,value){if(value.length<min){return fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;}
return fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;},minvalue:function(min,value){var syntaxCheck=jQuery.orange.widget.Form.constraint.regex(jQuery.orange.config.namedregex["float"],value);if(syntaxCheck!=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD){return fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;}
var x=parseFloat(value);var threshold=parseFloat(min);if(x==NaN){return fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;}else if(x>=threshold){return fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;}else if(Math.abs(x).toString().length<Math.abs(threshold).toString().length){return fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;}
return fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;},maxvalue:function(max,value){var syntaxCheck=jQuery.orange.widget.Form.constraint.regex(jQuery.orange.config.namedregex["float"],value);if(syntaxCheck!=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD){return fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;}
var x=parseFloat(value);var threshold=parseFloat(max);if(x==NaN){return fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;}else if(x<=threshold){return fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;}
return fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;},enumerated:function(values,value){if(value.length==0)
return fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var values2=eval("("+values+")");if(arrayIndexOf(values2,value)==-1){return fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;}else{return fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;}},regex:function(regexPattern,value){var progressiveregex=fr.orange.livebox.gui.api.ProgressiveRegexp.getInstance(regexPattern);return progressiveregex.exec(value);},namedregex:function(name,value){return jQuery.orange.widget.Form.constraint.regex(jQuery.orange.config.namedregex[name],value);}},verifyConstraints:function(node,showErrorMsg){var NOT_GOOD_NOT_WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;if(node.getDataValue==undefined){return GOOD;}
var value=node.getDataValue();if(value==undefined){return NOT_GOOD_NOT_WRONG;}
if(node.getAttribute("disabled")=="disabled"){return GOOD;}
var syntheticResult=GOOD;var i18nError=$(node).attr("i18nError");var hasFocus=false;if($.isFunction(node.hasFocus)){hasFocus=node.hasFocus();}
var msg=undefined;if($.isFunction(node.validate)&&$.isFunction(node.getError)){syntheticResult=node.validate();if(syntheticResult==WRONG||(syntheticResult==NOT_GOOD_NOT_WRONG&&!hasFocus)){var suffix=node.getError();if(suffix!=undefined){msg=jQuery.orange.config.i18n.map["error.constraint."+suffix];if(i18nError!=undefined){var nodeMsg=jQuery.orange.config.i18n.map[i18nError+"."+suffix];if(nodeMsg!=undefined)
msg=nodeMsg;}}}}
if(syntheticResult==GOOD){var constraint=jQuery.orange.widget.Form.constraint;for(var i in node.attributes){var attr=node.attributes[i];if(msg==undefined&&attr!=undefined){var attrName=attr.nodeName;if(attrName!=undefined&&constraint[attrName]!=undefined){var constraintResult=constraint[attrName](attr.nodeValue,value);if(syntheticResult==GOOD||(syntheticResult==NOT_GOOD_NOT_WRONG&&constraintResult==WRONG)){syntheticResult=constraintResult;}
if(constraintResult==WRONG||(constraintResult==NOT_GOOD_NOT_WRONG&&!hasFocus)){msg=jQuery.orange.config.i18n.map["error.constraint."+attrName];if(i18nError!=undefined){var nodeMsg=jQuery.orange.config.i18n.map[i18nError+"."+attrName];if(nodeMsg!=undefined)
msg=nodeMsg;}
var param=(attrName=="namedregex")?jQuery.orange.config.i18n.map["namedregex."+attr.nodeValue]:attr.nodeValue;msg=msg.replace("{0}",param);}}}}}
if(showErrorMsg==undefined||showErrorMsg==true){if(value!=undefined&&(""+value).length>0){jQuery.orange.errorMsg(msg,node,true);}else{jQuery.orange.errorMsg(undefined,node);}}else if(syntheticResult==GOOD){jQuery.orange.errorMsg(undefined,node);}
return syntheticResult;},isFirstActionNodeContaining:function(actionNode,node){var parent=node;while(parent!=undefined&&parent!=actionNode){if(parent.crudAction!=undefined)
return false;parent=parent.parentNode;}
return true;},setButtonsDisabled:function(newState){var autoDisableButtons=$(this).attr("autodisablebuttons");if(autoDisableButtons!=undefined||autoDisableButtons=="false")
return;if(newState==undefined)
newState=jQuery.orange.widget.Form.STATE_NO_MODIF;if(newState==jQuery.orange.widget.Form.STATE_NO_MODIF){this.modifsOK=new Array();this.dataKO=new Array();this.subForms=new Array();this.lineRemoved=false;}
var this0=this;$("input[type='reset']",this).each(function(){if(getFirstParentWithNodeName(this,"FORM")==this0){$(this).setDisabled(newState==jQuery.orange.widget.Form.STATE_NO_MODIF||newState==jQuery.orange.widget.Form.STATE_ONCREATE);}});$("input[type='submit']",this).each(function(){if(getFirstParentWithNodeName(this,"FORM")==this0){var crudAction=$(this).attr("crud");if(crudAction==undefined||crudAction=="create"||crudAction=="update"){$(this).setDisabled(newState!=jQuery.orange.widget.Form.STATE_MODIF_OK);}}});},onStateChange:function(oldState,newState){if(this.setButtonsDisabled!=undefined)
this.setButtonsDisabled(newState);else
jQuery.orange.widget.Form.setButtonsDisabled.call(this,newState);var parentForm=getFirstParentWithNodeName(this,"FORM");if(parentForm!=undefined)
jQuery.orange.widget.Form.onSubFormStateChange.call(parentForm,this,oldState,newState);},onSubFormStateChange:function(subForm,subOldState,subNewState){arrayRemove(this.subForms,subForm);var withoutState=jQuery.orange.widget.Form.getState.call(this);var oldState=withoutState;if(subOldState==jQuery.orange.widget.Form.STATE_KO)
oldState=jQuery.orange.widget.Form.STATE_KO;else if(withoutState!=jQuery.orange.widget.Form.STATE_KO&&subOldState==jQuery.orange.widget.Form.STATE_MODIF_OK)
oldState=jQuery.orange.widget.Form.STATE_MODIF_OK;var newState=withoutState;if(subNewState==jQuery.orange.widget.Form.STATE_KO)
newState=jQuery.orange.widget.Form.STATE_KO;else if(withoutState!=jQuery.orange.widget.Form.STATE_KO&&subNewState==jQuery.orange.widget.Form.STATE_MODIF_OK)
newState=jQuery.orange.widget.Form.STATE_MODIF_OK;this.subForms.push(subForm);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(this,oldState,newState);}
jQuery.orange.widget.Form.setButtonsDisabled.call(this,newState);},onDataChange:function(node,showErrorMsg){if(this.onDataChange!=undefined&&$(this).attr("creation")){return this.onDataChange(node,showErrorMsg);}
if(node.getDataValue==undefined)
return;var nodeValue=node.getDataValue();if(nodeValue==undefined)
return;var oldState=jQuery.orange.widget.Form.getState.call(this);var modif=nodeValue!=node.dataValueRef;var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var ok=jQuery.orange.widget.Form.verifyConstraints(node,showErrorMsg)==GOOD;var i=arrayIndexOf(this.modifsOK,node);if(i!=-1)
if(modif&&ok)
return;else
this.modifsOK.splice(i,1);i=arrayIndexOf(this.dataKO,node);if(i!=-1)
if(!ok)
return;else
this.dataKO.splice(i,1);if(modif&&ok)
this.modifsOK.push(node);if(!ok)
this.dataKO.push(node);var newState=jQuery.orange.widget.Form.getState.call(this);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(this,oldState,newState);},onSubmit:function(event){if($("#dhcpdns div form")[0]!=undefined){function verifyNatPatIpAdressWithcurrentValue(tr){var boolresult=false;var adressNatPat="Device/NAT/PortMappings/PortMapping[InternalClient='"+tr.children[1].children[0].dataValueRef+"']";jQuery.orange.config.api.crud.read([adressNatPat],function(result){if(result[adressNatPat]!=undefined){if(tr.children[1].children[0].dataValueRef!=tr.children[1].children[0].value){$("#natpatRuleForIp").css('display','block');boolresult=false;}
else{boolresult=true;}}
else{boolresult=true;}});return boolresult;}
var innerNatPatIpAdress=true;function tableValid(){var i=0;while(this[i]){var haschangedAndnatPat=verifyNatPatIpAdressWithcurrentValue(this[i]);innerNatPatIpAdress=innerNatPatIpAdress&&haschangedAndnatPat;i++;}}
var child=$("#dhcpdnsTable form table tbody").children();if(child){tableValid.apply(child);}
jQuery.orange.widget.Table.NatPatIpAdress=innerNatPatIpAdress;if(!innerNatPatIpAdress){$("#dhcpdnsTable form").action=false;event.stopPropagation();return;}}
event.preventDefault();$("input[type='submit']",this).setDisabled(true);$("input[type='reset']",this).setDisabled(true);var crudAction=this.crudAction;var error=false;var actions=jQuery.orange.widget.Form.getActions(this,crudAction);if(actions===false){error=true;actions=new Array();}
var forms=new Array();if(actions.length>0&&this.crudCallback!=undefined)
forms.push(this);$("form",this).each(function(){var subActions=jQuery.orange.widget.Form.getActions(this,crudAction);if(subActions===false){error=true;return;}
if(subActions.length>0&&this.crudCallback!=undefined)
forms.push(this);for(var i in subActions)
actions.push(subActions[i]);this.dataKO=[];this.modifsOK=[];this.lineRemoved=false;});if(error)
return false;var order=["update","delete","create","read"];var orderedActions=new Array();for(var i in order){var crud=order[i];for(var j in actions){var action=actions[j];if(action.crud==crud){var notFound=true;for(var k in orderedActions){var orderedAction=orderedActions[k];if(orderedAction.id==action.id&&orderedAction.crud==action.crud&&action.crud!="create"){notFound=false;orderedAction.nodes.push(action.node);}}
if(notFound)
orderedActions.push({id:action.id,crud:action.crud,nodes:[action.node],value:action.value,attrs:action.attrs});}}}
var this0=this;var callback=function(results){var error=false;for(var i in orderedActions){var action=orderedActions[i];var nodes=action.nodes;var result=results[i];if(action.crud=="create"){if(result.error!=undefined){error=true;var msg=jQuery.orange.getBoxCodeMsg(result.error);for(var j in nodes)
jQuery.orange.errorMsg(msg,nodes[j],true);}else{for(var j in nodes){jQuery.orange.errorMsg(null,nodes[j],true);}}
for(var j in nodes){var node=nodes[j];if(node.onDataCreate!=undefined)
node.onDataCreate.call(node,action.attrs,result);}}else if(action.crud=="read"){for(var j in nodes){var node=nodes[j];jQuery.orange.treatReadResult(node,result);var form=getFirstParentWithNodeName(node,"FORM");if(form!=undefined)
jQuery.orange.widget.Form.onDataChange.call(form,node);}}else if(action.crud=="update"){if(result!=undefined){error=true;var msg=jQuery.orange.getBoxCodeMsg(result);for(var j in nodes)
jQuery.orange.errorMsg(msg,nodes[j],true);}else{for(var j in nodes){var node=nodes[j];jQuery.orange.errorMsg(null,node,true);if($(node).attr("dataid")!=action.id){if(node.getDataValue!=undefined)
node.dataValueRef=node.getDataValue();}
else{node.dataValueRef=action.value;}
var form=getFirstParentWithNodeName(node,"FORM");if(form!=undefined)
jQuery.orange.widget.Form.onDataChange.call(form,node);}}
for(var j in nodes){var node=nodes[j];if(node.onDataUpdate!=undefined)
node.onDataUpdate.call(node,action.value,result);}}else{if(result!=undefined){error=true;var msg=jQuery.orange.getBoxCodeMsg(result);for(var j in nodes)
jQuery.orange.errorMsg(msg,nodes[j],true);}else{for(var j in nodes)
jQuery.orange.errorMsg(null,nodes[j],true);}
for(var j in nodes){var node=nodes[j];if(node.onDataDelete!=undefined)
node.onDataDelete.call(node,result);}}}
$("form",this0).andSelf().each(function(){if(crudAction=="read"||(crudAction==undefined&&this.crudAction=="read"))
if(this.setButtonsDisabled!=undefined)
this.setButtonsDisabled();else
jQuery.orange.widget.Form.setButtonsDisabled.call(this);$(this).trigger("submitted",[error]);});for(var i in forms){var form=forms[i];if(form.crudCallback!=undefined)
form.crudCallback.call(form,result);}};if(this.crudCallDelegate!=undefined)
this.crudCallDelegate(function(){jQuery.orange.config.api.crud.exec(orderedActions,callback);});else
jQuery.orange.config.api.crud.exec(orderedActions,callback);return false;},getActions:function(actionNode,crudAction){if(actionNode.getActions!=undefined)
return actionNode.getActions(crudAction);if(crudAction==undefined)
crudAction=actionNode.crudAction;var crudDataId=$(actionNode).attr("dataId");if(actionNode.crudDataId!=undefined)
crudDataId=actionNode.crudDataId;var actions=new Array();if(crudAction=="read"){$("[dataId]",actionNode).each(function(){if(!jQuery.orange.widget.Form.isFirstActionNodeContaining(actionNode,this)){return;}
var self=$(this);if(this.nodeName=="INPUT"&&(self.attr("type")=="submit"||self.attr("type")=="button"))
return;actions.push({id:self.attr("dataId"),crud:"read",node:this});});return actions;}
if($(actionNode).attr("disabled"))
return actions;if(crudAction=="delete"){actions.push({id:crudDataId,crud:"delete",node:actionNode});return actions;}
var notOK=false;$("[dataId]",actionNode).each(function(){if(jQuery.orange.widget.Form.isFirstActionNodeContaining(actionNode,this)&&!$(this).attr("disabled")&&jQuery.orange.widget.Form.verifyConstraints(this,false)!=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD){notOK=true;}});if(notOK)
return false;if(crudAction=="create"){var attrs=new Object();$("[dataId]",actionNode).each(function(){var isdisabled=false;if(($(this).attr("disabled")!=undefined&&$(this).attr("disabled")=="disabled")||(this.getAttribute("disabled")!=null&&this.getAttribute("disabled")=="disabled")){isdisabled=true;}
if((!jQuery.orange.widget.Form.isFirstActionNodeContaining(actionNode,this))||isdisabled){return;}
var self=$(this);if(this.nodeName=="INPUT"&&(self.attr("type")=="submit"||self.attr("type")=="button"))
return;var value=jQuery.orange.getDataValue(this);if(value!=undefined)
attrs[self.attr("dataId")]=value;});actions.push({id:crudDataId,crud:"create",node:actionNode,attrs:attrs});return actions;}
$("[dataId]",actionNode).each(function(){var isdisabled=false;if(($(this).attr("disabled")!=undefined&&$(this).attr("disabled")=="disabled")||(this.getAttribute("disabled")!=null&&this.getAttribute("disabled")=="disabled")){isdisabled=true;}
if((!jQuery.orange.widget.Form.isFirstActionNodeContaining(actionNode,this))||isdisabled){return;}
var value=jQuery.orange.getDataValue(this);if(value!=undefined&&this.dataValueRef!=undefined&&value!=this.dataValueRef){actions.push({id:$(this).attr("dataId"),crud:"update",node:this,value:value});}});return actions;},onReset:function(){if(this.onReset!=undefined){this.onReset.call(this);return false;}
var this0=this;$("form",this).each(function(){if(!jQuery.orange.widget.Form.isFirstActionNodeContaining(this0,this))
return;this.dataKO=[];this.modifsOK=[];this.lineRemoved=false;jQuery.orange.widget.Form.onReset.call(this);});$("[dataId]",this).each(function(){if(!jQuery.orange.widget.Form.isFirstActionNodeContaining(this0,this))
return;if(this.onReset!=undefined)
this.onReset.call(this);else if(this.dataValueRef!=undefined)
jQuery.orange.setDataValue(this,this.dataValueRef);});this.modifsOK=new Array();this.dataKO=new Array();this.subForms=new Array();this.lineRemoved=false;jQuery.orange.widget.Form.setButtonsDisabled.call(this,jQuery.orange.widget.Form.STATE_NO_MODIF);return false;},onParse:function(){if(this.setButtonsDisabled!=undefined)
this.setButtonsDisabled();else
jQuery.orange.widget.Form.setButtonsDisabled.call(this);jQuery.orange.widget.Form.alignFormInputs.call(this);},alignFormInputs:function(){var formInputs=$("[widgetType='FormInput']",this);var this0=this;this0.formInputMaxWidth=0;formInputs.each(function(){var width=this.getLabelWidth(this0);if(width>this0.formInputMaxWidth)
this0.formInputMaxWidth=width;});formInputs.each(function(){this.setLabelWidth(this0,this0.formInputMaxWidth);});}};jQuery.orange.widget.Form.onParse.priority=10;(function($){$.fn.widgetForm=function(options){return this.each(function(){this.modifsOK=new Array();this.dataKO=new Array();this.subForms=new Array();this.lineRemoved=false;$(this).submit(jQuery.orange.widget.Form.onSubmit);$(this).bind("reset",jQuery.orange.widget.Form.onReset);this.onParse=jQuery.orange.widget.Form.onParse;});};})(jQuery);jQuery.orange.widget.FormInput={counter:0,getLabelWidth:function(ref){var offset=$(this).offset().left;return offset+this.firstChild.offsetWidth;},setLabelWidth:function(ref,width){var offset=$(this).offset().left;var label=this.firstChild;if(label.offsetWidth!=0){if(this.align){label.style.marginRight=(width-offset-label.offsetWidth)+"px";}else{label.style.marginLeft=(width-offset-label.offsetWidth)+"px";}}}};(function($){$.fn.widgetFormInput=function(options){return this.each(function(){this.getLabelWidth=jQuery.orange.widget.FormInput.getLabelWidth;this.setLabelWidth=jQuery.orange.widget.FormInput.setLabelWidth;if(options!=undefined){this.align=options.align;}
var content=document.createElement("span");while(this.childNodes.length>0)
content.appendChild(this.childNodes[0]);var contentContainer=document.createElement("div");contentContainer.appendChild(content);this.appendChild(contentContainer);var label=document.createElement("label");$(label).html("&#160;");moveDOMAttribute(this,"i18n",label);var inputs=$("input[type!='button'],textarea,select",this);if(inputs.size()==1){var inputId=inputs.attr("id");if(inputId==undefined||inputId.length==0){inputId="EnumInput-"+(jQuery.orange.widget.FormInput.counter++);inputs.attr("id",inputId);}
$(label).attr("for",inputId);}
this.insertBefore(label,this.firstChild);var last=document.createElement("div");this.appendChild(last);$(this).addClass("forminput");$(label).addClass("forminput-label");$(content).addClass("forminput-content");$(last).addClass("forminput-last");$(contentContainer).addClass("forminput-contentContainer");});};})(jQuery);jQuery.orange.widget.I18nable={orangeTranslate:function(){$(this).attr(this.attribute,jQuery.orange.config.i18n.map[this.i18n]);}};(function($){$.fn.widgetI18nable=function(options){return this.each(function(){if(options==undefined){return;}
if(options.attribute==undefined||options.i18n==undefined){if(options.I18nable!=undefined){options=options.I18nable;}else{return;}}
if(options.attribute==undefined||options.i18n==undefined){return;}
var jNode=$(this);this.attribute=options.attribute;this.i18n=options.i18n;jNode.attr(this.attribute,jQuery.orange.config.i18n.map[this.i18n]);});};})(jQuery);jQuery.orange.widget.IPAddress={BROADCAST_IP:"0.0.0.0",BROADCAST_I18N:"ipaddress.broadcast",getDataValue:function(){var txt=$("input",this)[0].value;if(txt==jQuery.orange.config.i18n.map[jQuery.orange.widget.IPAddress.BROADCAST_I18N])
return jQuery.orange.widget.IPAddress.BROADCAST_IP;return txt;},setDataValue:function(value){if(value==jQuery.orange.config.i18n.map[jQuery.orange.widget.IPAddress.BROADCAST_I18N])
value=jQuery.orange.widget.IPAddress.BROADCAST_IP;if(this.currentValue!==value){if(value==jQuery.orange.widget.IPAddress.BROADCAST_IP)
$("input",this)[0].value=jQuery.orange.config.i18n.map[jQuery.orange.widget.IPAddress.BROADCAST_I18N];else
$("input",this)[0].value=value;jQuery.orange.setValueClassAndTip(this,value,this.currentValue);this.currentValue=value;$(this).trigger("valueChange",[value]);}},setDisabled:function(disabled){var selection=$("input",this);if(disabled)
selection.attr("disabled","disabled");else
selection.removeAttr("disabled");selection.toggleTitleDisplay(!disabled);},validate:function(){$(this).removeAttr("regex");$(this).removeAttr("namedregex");this.error=undefined;var WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;var NOT_GOOD_NOT_WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var value=this.getDataValue();var BROADCAST=jQuery.orange.config.i18n.map[jQuery.orange.widget.IPAddress.BROADCAST_I18N];var regex=jQuery.orange.config.namedregex[this.namedregex];if(regex==undefined){regex=jQuery.orange.config.namedregex.ipaddress;}
if(this.allowAny){regex="("+BROADCAST+")|("+regex+")";}
var regexResult=jQuery.orange.widget.Form.constraint.regex(regex,value);if(regexResult==WRONG||regexResult==NOT_GOOD_NOT_WRONG){this.error="ip";return regexResult;}
return GOOD;},getError:function(){return this.error;},hasFocus:function(){return this.focused;},orangeTranslate:function(){var oldvalue=this.currentValue;this.currentValue=undefined;this.setDataValue(oldvalue);}};(function($){$.fn.widgetIPAddress=function(options){return this.each(function(){this.getDataValue=jQuery.orange.widget.IPAddress.getDataValue;this.setDataValue=jQuery.orange.widget.IPAddress.setDataValue;this.setDisabled=jQuery.orange.widget.IPAddress.setDisabled;this.validate=jQuery.orange.widget.IPAddress.validate;this.getError=jQuery.orange.widget.IPAddress.getError;this.hasFocus=jQuery.orange.widget.IPAddress.hasFocus;this.orangeTranslate=jQuery.orange.widget.IPAddress.orangeTranslate;this.focused=false;this.error=undefined;this.currentValue=undefined;this.allowAny=false;this.namedregex="ipaddress";if(options!=undefined){if(options.namedregex!=undefined){this.namedregex=options.namedregex;}
if(options.allowAny!=undefined){this.allowAny=(options.allowAny==true);}}
var input=document.createElement("input");moveDOMAttribute(this,"i18n",input);var self=this;$(input).attr("type","text").bind("change",function(event){event.stopPropagation();self.setDataValue(event.target.value);});$(input).bind("focus",function(event){self.focused=true;});$(input).bind("blur",function(event){self.focused=false;var value=self.getDataValue();if(value==jQuery.orange.widget.IPAddress.BROADCAST_IP){var any=jQuery.orange.config.i18n.map[jQuery.orange.widget.IPAddress.BROADCAST_I18N];if($("input",self)[0].value!=any){$("input",self)[0].value=any;}}
jQuery.orange.widget.Form.verifyConstraints(self);});$(this).append(input);});};})(jQuery);jQuery.orange.widget.Image={};(function($){$.fn.widgetImage=function(options){return this.each(function(){var jImg=$(this);var i18n=jImg.attr("i18n");var title=jQuery.orange.config.i18n.map[i18n+".tip"];var alternative=jQuery.orange.config.i18n.map[i18n+".alt"];if(alternative!=undefined){jImg.attr("alt",alternative);}else if(title!=undefined){jImg.attr("alt",title);}else{jImg.attr("alt","");}});};})(jQuery);jQuery.orange.widget.Input={defaultGetDataValue:function(){return this.value;},defaultSetDataValue:function(value){if(this.value!==value){this.value=value;$(this).trigger("change",[value]);$(this).trigger("valueChange",[value]);}},submitGetDataValue:function(){return undefined;},submitSetDataValue:function(value){},submitOnClick:function(){var self=$(this);var crudAction=self.attr("crud");var parentForm=getFirstParentWithNodeName(this,"FORM");if(parentForm==undefined)
return;parentForm.crudAction=crudAction;if(this.crudCallback!=undefined){parentForm.crudCallback=this.crudCallback;}
if(crudAction=="create"||crudAction=="delete"){parentForm.crudDataId=self.attr("dataId");}},submitCrudCreateCallbackCreate:function(input){return function(object){var msg=(object.error!=undefined)?jQuery.orange.getBoxCodeMsg(object.error):null;jQuery.orange.errorMsg(msg,input,true);this.crudCallback=undefined;};},submitCrudCreateCallbackDelete:function(input){return function(error){var msg=(error!=undefined)?jQuery.orange.getBoxCodeMsg(error):null;jQuery.orange.errorMsg(msg,input,true);this.crudCallback=undefined;};},checkboxGetDataValue:function(){var out=this.checked;if(this.dataValueRef!=undefined&&!(this.dataValueRef===false||this.dataValueRef===true)){var booleanRef=jQuery.orange.booleanValue(this.dataValueRef);out=(out==booleanRef)?this.dataValueRef:jQuery.orange.booleanNot(this.dataValueRef);}
return out;},checkboxSetDataValue:function(value){var oldValue=this.checked;var checked=value;if(!(value===false||value===true)){checked=jQuery.orange.booleanValue(value);oldValue=jQuery.orange.booleanNot(value);}
this.checked=checked;jQuery.orange.setValueClassAndTip(this,value,oldValue);$(this).trigger("valueChange",[value]);},checkboxToggleDataValue:function(){var oldValue=this.getDataValue();var newValue,checked;if(!(oldValue===false||oldValue===true)){newValue=jQuery.orange.booleanNot(oldValue);this.checked=!jQuery.orange.booleanValue(oldValue);}else{newValue=!oldValue;this.checked=newValue;}
jQuery.orange.setValueClassAndTip(this,newValue,oldValue);$(this).trigger("valueChange",[newValue]);},checkboxOnChange:function(event){var value=this.getDataValue();var oldValue=jQuery.orange.booleanNot(value);jQuery.orange.setValueClassAndTip(this,value,oldValue);$(this).trigger("valueChange",[value]);},setDisabled:function(disabled){var type=$(this).attr("type");if(type!="submit"&&type!="reset"&&type!="button"){if(disabled){jQuery.orange.errorMsg(undefined,this);}else{jQuery.orange.widget.Form.verifyConstraints(this);}}
$(this).toggleTitleDisplay(!disabled);},setFocus:function(newFocus){this.focused=newFocus;},hasFocus:function(){if(this.focused!=undefined)
return this.focused;return false;}};(function($){$.fn.widgetInput=function(options){return this.each(function(){this.setDisabled=jQuery.orange.widget.Input.setDisabled;var self=$(this);var type=self.attr("type");if(type=="submit"||type=="button"){this.getDataValue=jQuery.orange.widget.Input.submitGetDataValue;this.setDataValue=jQuery.orange.widget.Input.submitSetDataValue;var crudAction=self.attr("crud");if(crudAction!=undefined){var dataId=self.attr("dataId");if((crudAction=="create"&&dataId!=undefined)||crudAction=="read"||crudAction=="update"||(crudAction=="delete"&&dataId!=undefined)){$(this).click(jQuery.orange.widget.Input.submitOnClick);if(this.crudCallback==undefined&&crudAction=="create")
this.crudCallback=jQuery.orange.widget.Input.submitCrudCreateCallbackCreate(this);else if(this.crudCallback==undefined&&crudAction=="delete")
this.crudCallback=jQuery.orange.widget.Input.submitCrudCreateCallbackDelete(this);}}}else if(type=="checkbox"){if(this.getDataValue==undefined)
this.getDataValue=jQuery.orange.widget.Input.checkboxGetDataValue;if(this.setDataValue==undefined)
this.setDataValue=jQuery.orange.widget.Input.checkboxSetDataValue;if(this.toggleDataValue==undefined)
this.toggleDataValue=jQuery.orange.widget.Input.checkboxToggleDataValue;jQuery.orange.widget.Input.checkboxOnChange.call(this);$(this).bind("change",jQuery.orange.widget.Input.checkboxOnChange);}else{if(this.getDataValue==undefined)
this.getDataValue=jQuery.orange.widget.Input.defaultGetDataValue;if(this.setDataValue==undefined)
this.setDataValue=jQuery.orange.widget.Input.defaultSetDataValue;}
if(this.hasFocus==undefined){this.hasFocus=jQuery.orange.widget.Input.hasFocus;};if(this.setFocus==undefined){this.setFocus=jQuery.orange.widget.Input.setFocus;};$(this).bind("focus",function(){this.setFocus(true);});$(this).bind("blur",function(event){this.setFocus(false);});});};})(jQuery);jQuery.orange.widget.MenuItem={HASH_SUBSTITUTION_SEPARATOR:",",HASH_KEY_VALUE_SEPARATOR:":",hashManualChange:false,current:undefined,setCurrent:function(menuId,substitutions,manualChange){if(menuId==undefined)
return;if(substitutions===false||substitutions===true){manualChange=substitutions;substitutions=undefined;}
if(manualChange==undefined)
manualChange=true;if(!jQuery.orange.config.api.authorization.isAuthorized(menuId,substitutions))
return;var path=menuId.split("\.");var currentPath=(jQuery.orange.widget.MenuItem.current!=undefined)?jQuery.orange.widget.MenuItem.current.split("\."):[];var submenu,newCurrent,i=0;do{var menu=(submenu!=undefined)?submenu:jQuery.orange.config.menu;submenu=menu.items[path[i]];if(submenu==undefined)
return;newCurrent=(newCurrent==undefined)?path[i]:newCurrent+"."+path[i];if(currentPath.length<=i||currentPath[i]!=path[i]){var url=(submenu.constructor==String)?submenu:submenu.url;var callback=function(){jQuery.orange.widget.MenuItem.current=newCurrent;$("[widgetType*='MenuItem']").each(function(){var menuItem=$(this);if(!newCurrent.startsWith(this.menuId)){menuItem.removeClass("menuitem-selected");jQuery.orange.widget.MenuItem.onChangeBackground(menuItem,false);}else if(!menuItem.hasClass("menuitem-selected")){menuItem.addClass("menuitem-selected");if(this.background)
jQuery.orange.widget.MenuItem.onChangeBackground(menuItem,true);}});jQuery.orange.widget.MenuItem.setCurrent(menuId,substitutions,manualChange);};if(substitutions!=undefined&&newCurrent==menuId){$("#"+menu.target).orangeLoad(url,substitutions,callback);}else{$("#"+menu.target).orangeLoad(url,callback);}
return;}
i++;}while(i<path.length);if(submenu.defaultItem!=undefined){jQuery.orange.widget.MenuItem.setCurrent(menuId+"."+submenu.defaultItem);return;}
jQuery.orange.widget.MenuItem.current=menuId;var hash=menuId,key;if(substitutions!=undefined)
for(key in substitutions)
hash+=jQuery.orange.widget.MenuItem.HASH_SUBSTITUTION_SEPARATOR+key+jQuery.orange.widget.MenuItem.HASH_KEY_VALUE_SEPARATOR+substitutions[key];jQuery.orange.widget.MenuItem.hashManualChange=manualChange;if(hash=='m0'){window.location.hash="HomePlace:";}else{window.location.hash="LegacyEnginePlace:"+"/"+hash;}
$("body").trigger("menuChange",[menuId,substitutions]);},parseHash:function(hash){if(hash!=undefined){hash=unescape(hash);}
if(hash!=undefined&&hash.length>2&&hash.charAt(0)=='#')
hash=hash.substring(1);if(hash!=undefined&&hash.startsWith("LegacyEnginePlace:")){hash=hash.substring("LegacyEnginePlace:".length);}
if(hash==undefined||hash.length<2||hash.charAt(0)!='/')
return;var i=hash.indexOf(jQuery.orange.widget.MenuItem.HASH_SUBSTITUTION_SEPARATOR);if(i==-1)
return{menuId:hash.substring(1)};var menuId=hash.substring(1,i);var substitutions=new Object();do{i++;var j=hash.indexOf(jQuery.orange.widget.MenuItem.HASH_KEY_VALUE_SEPARATOR,i);var k=hash.indexOf(jQuery.orange.widget.MenuItem.HASH_SUBSTITUTION_SEPARATOR,j+1);substitutions[hash.substring(i,j)]=(k==-1)?hash.substring(j+1):hash.substring(j+1,k);i=k;}while(i!=-1);return{menuId:menuId,substitutions:substitutions};},onChangeBackground:function(menuItem,menuItemSelected){if(menuItemSelected){menuItem.parent().addClass('menuitem-selected-background');menuItem.removeClass('menuitem-selected');menuItem.addClass('menuitem-smenu-selected');}else{menuItem.parent().removeClass('menuitem-selected-background');}}};(function($){$.fn.widgetMenuItem=function(options){return this.each(function(){if(options==undefined)
return;if(options.menu==undefined)
options={menu:options};this.menuId=options.menu;this.substitutions=options.subst;this.background=options.background;var menuId=options.menu;if(!jQuery.orange.config.menu.showUnauthorized&&!jQuery.orange.config.api.authorization.isAuthorized(menuId)){this.style.display="none";return;}
if(jQuery.orange.config.menu.notInOffer!=undefined){var i;for(i in jQuery.orange.config.menu.notInOffer){var m=jQuery.orange.config.menu.notInOffer[i];if(menuId==m||menuId.startsWith(m+".")){this.style.display="none";return;}}}
var self=$(this);self.addClass("menuitem");self.click(function(){if($(this).parent().hasClass("expert")&&$(this).parent().parent().parent().parent()[0].id=="sitemap"){jQuery.orange.config.areacontent.footer.loadAdvancedMenu(this.menuId,this.substitutions,function(menuid,substitutions){jQuery.orange.widget.MenuItem.veto=false;$("body").trigger("vetoableMenuChange",[menuid,substitutions]);if(!jQuery.orange.widget.MenuItem.veto){jQuery.orange.widget.MenuItem.setCurrent(menuId,substitutions);}});}else{jQuery.orange.widget.MenuItem.veto=false;$("body").trigger("vetoableMenuChange",[this.menuId,this.substitutions]);if(!jQuery.orange.widget.MenuItem.veto){jQuery.orange.widget.MenuItem.setCurrent(this.menuId,this.substitutions);}}});});};})(jQuery);jQuery.orange.widget.Password={DEFAULT_CHAR:"*",DEFAULT_PERIOD:3000,setDisabled:function(disabled){var selection=$("input",this).add(this);if(disabled){jQuery.orange.errorMsg(undefined,this);selection.attr("disabled","disabled");}else{selection.removeAttr("disabled");jQuery.orange.widget.Form.verifyConstraints(this);}
$(this).toggleTitleDisplay(!disabled);},getDataValue:function(){return $("input[type='password']",this).val();},setDataValue:function(value){var jPasswordNode=$("input[type='password']",this);$("input[type='password']",this).val(value);$("input[type='text']",this).val(value);check(jPasswordNode.attr("id"),'',false,true);$(this).trigger("valueChange",[value]);},orangeTranslate:function(){var self=$(this);var attrI18n=self.attr("i18n");if(attrI18n==undefined)
return;var tip=jQuery.orange.config.i18n.map[attrI18n+".tip"];if(tip!=undefined)
self.attr("title",tip);},mask:function(mask){var jPasswordNode=$("input[type='password']",this);if(mask){jPasswordNode[0].opts.noreplace=false;check(jPasswordNode.attr("id"),'',false,true);}else{jPasswordNode[0].opts.noreplace=true;$("input[type='text']",this).val(jPasswordNode.val());check(jPasswordNode.attr("id"),'',false,true);}},hasFocus:function(){return(this.firstSubInputHasFocus||this.secondSubInputHasFocus);}};(function($){$.fn.widgetPassword=function(options){return this.each(function(){this.getDataValue=jQuery.orange.widget.Password.getDataValue;this.setDataValue=jQuery.orange.widget.Password.setDataValue;this.setDisabled=jQuery.orange.widget.Password.setDisabled;this.orangeTranslate=jQuery.orange.widget.Password.orangeTranslate;this.mask=jQuery.orange.widget.Password.mask;this.hasFocus=jQuery.orange.widget.Password.hasFocus;this.firstSubInputHasFocus=false;this.secondSubInputHasFocus=false;var self=this;var hideChar=(options!=undefined&&options.char!=undefined)?options.char:jQuery.orange.widget.Password.DEFAULT_CHAR;var timerPeriod=(options!=undefined&&options.period!=undefined)?parseInt(options.period):jQuery.orange.widget.Password.DEFAULT_PERIOD;$(this).empty();if($(this).attr("id")==undefined){var date=new Date();$(this).attr("id",date.getTime());}
$(this).append("<input type='password' id='password_"+$(this).attr("id")+"'/>");$("input[type='password']",this).dPassword({replacement:hideChar,duration:timerPeriod});$("input[type='password']",this).bind("focus",function(event){self.firstSubInputHasFocus=true;console.log("firstSubInputHasFocus="+self.firstSubInputHasFocus+" secondSubInputHasFocus="+self.secondSubInputHasFocus);});$("input[type='password']",this).bind("blur",function(event){self.firstSubInputHasFocus=false;console.log("firstSubInputHasFocus="+self.firstSubInputHasFocus+" secondSubInputHasFocus="+self.secondSubInputHasFocus);jQuery.orange.widget.Form.verifyConstraints(self);});$("input[type='text']",this).bind("focus",function(event){self.secondSubInputHasFocus=true;console.log("firstSubInputHasFocus="+self.firstSubInputHasFocus+" secondSubInputHasFocus="+self.secondSubInputHasFocus);});$("input[type='text']",this).bind("blur",function(event){self.secondSubInputHasFocus=false;console.log("firstSubInputHasFocus="+self.firstSubInputHasFocus+" secondSubInputHasFocus="+self.secondSubInputHasFocus);jQuery.orange.widget.Form.verifyConstraints(self);});$(self).bind("change valueChange",jQuery.orange.onDataChange);$("input[type='text']",this).bind("keyup input propertyChange",function(event){$(self).trigger("valueChange");});$("input[type='password']",this).bind("valueChange",function(){$(self).trigger("valueChange");});});};})(jQuery);jQuery.orange.widget.PortRange={ALL_VALUE:"0",ALL_I18N:"portrange.all",getDataValue:function(){var txt=$("input",this)[0].value;if(txt==jQuery.orange.config.i18n.map[jQuery.orange.widget.PortRange.ALL_I18N])
return jQuery.orange.widget.PortRange.ALL_VALUE;return txt;},setDataValue:function(value){if(value==jQuery.orange.config.i18n.map[jQuery.orange.widget.PortRange.ALL_I18N]){value=jQuery.orange.widget.PortRange.ALL_VALUE;}
var i=value.indexOf("-");if(i!=-1&&value.substring(0,i)==parseInt(value.substring(i+1)))
value=value.substring(0,i);if(this.currentValue!==value){if(value==jQuery.orange.widget.PortRange.ALL_VALUE)
$("input",this)[0].value=jQuery.orange.config.i18n.map[jQuery.orange.widget.PortRange.ALL_I18N];else
$("input",this)[0].value=value;jQuery.orange.setValueClassAndTip(this,value,this.currentValue);this.currentValue=value;$(this).trigger("valueChange",[value]);}},setDisabled:function(disabled){var selection=$("input",this);if(disabled)
selection.attr("disabled","disabled");else
selection.removeAttr("disabled");selection.toggleTitleDisplay(!disabled);},validate:function(){this.error=undefined;var WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;var NOT_GOOD_NOT_WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var value=this.getDataValue();if(value===jQuery.orange.widget.PortRange.ALL_VALUE){return GOOD;}
var ALL_I18N=jQuery.orange.config.i18n.map[jQuery.orange.widget.PortRange.ALL_I18N];var regex=jQuery.orange.widget.Form.constraint.regex("("+ALL_I18N+")|("+jQuery.orange.config.namedregex.portrange+")",value);if(regex==WRONG||regex==NOT_GOOD_NOT_WRONG){this.error="portrangeformat";return regex;}
if(regex==GOOD){var i=value.indexOf("-");if(i==-1)
return GOOD;var minStr=value.substring(0,i);var maxStr=value.substring(i+1);if(parseInt(minStr)<=parseInt(maxStr)){return GOOD;}else{this.error="portrangeorder";return NOT_GOOD_NOT_WRONG;}}
return GOOD;},getError:function(){return this.error;},hasFocus:function(){return this.focused;},orangeTranslate:function(){var oldvalue=this.currentValue;this.currentValue=undefined;this.setDataValue(oldvalue);}};(function($){$.fn.widgetPortRange=function(options){return this.each(function(){this.getDataValue=jQuery.orange.widget.PortRange.getDataValue;this.setDataValue=jQuery.orange.widget.PortRange.setDataValue;this.setDisabled=jQuery.orange.widget.PortRange.setDisabled;this.validate=jQuery.orange.widget.PortRange.validate;this.getError=jQuery.orange.widget.PortRange.getError;this.hasFocus=jQuery.orange.widget.PortRange.hasFocus;this.orangeTranslate=jQuery.orange.widget.PortRange.orangeTranslate;this.currentValue=undefined;this.focused=false;this.error=undefined;jQuery.orange.setValueClassAndTip(this);var input=document.createElement("input");moveDOMAttribute(this,"i18n",input);var self=this;$(input).attr("type","text");$(input).bind("change",function(event){event.stopPropagation();self.setDataValue(event.target.value);});$(input).bind("focus",function(event){self.focused=true;});$(input).bind("blur",function(event){self.focused=false;var value=self.getDataValue();if(value==jQuery.orange.widget.PortRange.ALL_VALUE){var any=jQuery.orange.config.i18n.map[jQuery.orange.widget.PortRange.ALL_I18N];if($("input",self)[0].value!=any){$("input",self)[0].value=any;}}
jQuery.orange.widget.Form.verifyConstraints(self);});$(this).append(input);});};})(jQuery);jQuery.orange.widget.ProgressBar={getDataValue:function(){var self=$(this);var minvalue=parseIntDefault(self.attr("minvalue"),0);var maxvalue=parseIntDefault(self.attr("maxvalue"),100);return(self.progressbar("value")*(maxvalue-minvalue))/100+minvalue;},setDataValue:function(value){var self=$(this);var minvalue=parseIntDefault(self.attr("minvalue"),0);var maxvalue=parseIntDefault(self.attr("maxvalue"),100);if(value>maxvalue)
value=maxvalue;if(value<minvalue)
value=minvalue;value=(value-minvalue)*100/(maxvalue-minvalue);self.progressbar("value",value);}};(function($){$.fn.widgetProgressBar=function(options){return this.each(function(){this.getDataValue=jQuery.orange.widget.ProgressBar.getDataValue;this.setDataValue=jQuery.orange.widget.ProgressBar.setDataValue;var self=$(this);self.progressbar({value:0});var divTheme=document.createElement("div");$(divTheme).html("&#160;");self.append(divTheme);var text=document.createElement("div");self.append(text);$(divTheme).addClass("progressbar-left");$(text).addClass("progressbar-text");self.bind("progressbarchange",function(event,ui){$(".progressbar-text",this).text(this.getDataValue());});});};})(jQuery);jQuery.orange.widget.RunnerBar={DEFAULT_DURATION:3000,DEFAULT_WIDTH:500,DEFAULT_HEIGHT:17,DEFAULT_BG_WIDTH:100,doMove:function(duration,bgWidth){var this0=this;var child=$(this.firstChild);child.animate({"background-position":child.css("width")},duration,"linear",function(){child.css("background-position","-"+bgWidth+"px");jQuery.orange.widget.RunnerBar.doMove.call(this0,duration,bgWidth);});}};(function($){$.fn.widgetRunnerBar=function(options){return this.each(function(){var width=(options!=undefined&&options.width!=undefined)?options.width:jQuery.orange.widget.RunnerBar.DEFAULT_WIDTH;var height=(options!=undefined&&options.height!=undefined)?options.height:jQuery.orange.widget.RunnerBar.DEFAULT_HEIGHT;var duration=(options!=undefined&&options.duration!=undefined)?options.duration:jQuery.orange.widget.RunnerBar.DEFAULT_DURATION;var bgWidth=(options!=undefined&&options.bgWidth!=undefined)?options.bgWidth:jQuery.orange.widget.RunnerBar.DEFAULT_BG_WIDTH;$(this).html('<div class="runnerBar"/>');$(this.firstChild).css('width',width+'px').css('height',height+'px');jQuery.orange.widget.RunnerBar.doMove.call(this,duration,bgWidth);});};})(jQuery);jQuery.orange.widget.Select={setDisabled:function(disabled){$(this).toggleTitleDisplay(!disabled);},getDataValue:function(){if(this.selectedIndex==-1)
return undefined;var value=this.options[this.selectedIndex].dataValue;if(value==undefined)
value=this.options[this.selectedIndex].value;return value;},setDataValue:function(value){if(this.currentValue!=undefined&&value===this.getDataValue()){return;}
var oldValue=this.currentValue;var found=-1;for(var i=0;i<this.options.length;i++){if(this.options[i].dataValue==value){found=i;break;}}
if(found==-1){}else{this.selectedIndex=found;this.currentValue=this.options[this.selectedIndex].dataValue;jQuery.orange.setValueClassAndTip(this,this.currentValue,oldValue);$(this).trigger("valueChange",[this.currentValue]);}},buildFromEnumerated:function(){var self=$(this);var enumerated=self.attr("enumerated");var values=eval("("+enumerated+")");var i18nPrefix=self.attr("i18nPrefix");for(var i in values){var value=values[i];var option=document.createElement("option");option.setAttribute("value","_option_"+i);option.dataValue=value;if(i18nPrefix!=undefined&&jQuery.orange.config.i18n.map[i18nPrefix+"."+value]!=undefined){$(option).attr("i18n",i18nPrefix+"."+value);}else{$(option).html(value);}
jQuery.orange.setValueClassAndTip(option,value,undefined,i18nPrefix);this.appendChild(option);}
if(i18nPrefix!=undefined)
$("[i18n]",this).orangeTranslate();}};(function($){$.fn.widgetSelect=function(options){return this.each(function(){this.setDisabled=jQuery.orange.widget.Select.setDisabled;this.getDataValue=jQuery.orange.widget.Select.getDataValue;this.setDataValue=jQuery.orange.widget.Select.setDataValue;jQuery.orange.setValueClassAndTip(this);var self=$(this);if(self.attr("enumerated")!=undefined)
jQuery.orange.widget.Select.buildFromEnumerated.call(this);self.bind("change",function(event){event.stopPropagation();var oldValue=this.currentValue;var newValue=this.getDataValue();jQuery.orange.setValueClassAndTip(this,newValue,oldValue);this.currentValue=newValue;$(this).trigger("valueChange",[newValue]);});this.onDataRead=function(data){if($(this).attr("enumerated")==undefined||data==undefined||data.nb!=1)
return;if(this.childNodes.length==0)
jQuery.orange.widget.Select.buildFromEnumerated.call(this);for(var i in data.values){this.setDataValue(data.values[i]);}};});};})(jQuery);jQuery.orange.widget.Slider={build:function(options){var self=$(this);self.slider("destroy");var minvalue=undefined;var maxvalue=undefined;var step=1;var self=$(this);var enumerated=self.attr("enumerated");if(enumerated){var values=eval("("+enumerated+")");minvalue=0;maxvalue=values.length-1;}else{minvalue=self.attr("minvalue");minvalue=(minvalue!=undefined)?parseInt(minvalue):0;maxvalue=self.attr("maxvalue");maxvalue=(maxvalue!=undefined)?parseInt(maxvalue):1;if(options!=undefined&&options.step!=undefined)
step=options.step;}
self.slider({min:minvalue,max:maxvalue,step:step,range:true,value:minvalue});$("a:first",this).remove();},getDataValue:function(){var value=$(this).slider("values",1);var enumerated=$(this).attr("enumerated");if(enumerated){var values=eval("("+enumerated+")");value=values[value];}
return value;},setDataValue:function(value){var integer=value;var enumerated=$(this).attr("enumerated");if(enumerated){var values=eval("("+enumerated+")");var i;for(i in values)
if(value==values[i])
integer=i;}
$(this).slider("values",1,integer);}};(function($){$.fn.widgetSlider=function(options){return this.each(function(){this.getDataValue=jQuery.orange.widget.Slider.getDataValue;this.setDataValue=jQuery.orange.widget.Slider.setDataValue;this.onDataRead=function(data){if(data.nb!=1)
return;jQuery.orange.widget.Slider.build.call(this,options);var i;for(i in data.values)
this.setDataValue(data.values[i]);};jQuery.orange.widget.Slider.build.call(this,options);});};})(jQuery);jQuery.orange.widget.Table={setDisabled:function(disabled){this.disabled=disabled;var form=$("form",this)[0];var parentForm=getFirstParentWithNodeName(this,"FORM");if(parentForm!=undefined)
if(disabled)
arrayRemove(parentForm.subForms,form);else
parentForm.subForms.push(form);var selection=$("tr:not([class*='table-row-deleted']) [dataId]",form).add(".table-add-button img",form).add("th[class*='table-col-'] input[type=checkbox]",form).add(form);var i18n=$(".table-add-button img").attr("i18n");var src=jQuery.orange.config.i18n.map[i18n+"."+disabled+".img"];var title=jQuery.orange.config.i18n.map[i18n+".tip"];$(".table-add-button img").attr("src",src);$(".table-add-button img").attr("title",title);selection.setDisabled(disabled);},onSortClick:function(event){var sort=event.target;var orderAsc=$(sort)[0].className=="table-sortable"||$(sort)[0].className=="table-sortDesc";var sortIndex=undefined;var thSort=sort.parentNode;var trHead=thSort.parentNode;for(var i=0;i<trHead.childNodes.length;i++){var th=trHead.childNodes[i];if(th==thSort){sortIndex=i;$("div",th).attr("class",orderAsc?"table-sortAsc":"table-sortDesc");}else if(th.sortable)
$("div",th).attr("class","table-sortable");}
jQuery.orange.widget.Table.sort.call(trHead.parentNode.parentNode,sortIndex,orderAsc);},sort:function(sortIndex,orderAsc){if(orderAsc==undefined)
orderAsc=true;var tbody=$("tbody",this)[0];var array=tbody.childNodes;if(array==undefined||array.length<2)
return;var nbPermutations;do{nbPermutations=0;for(var i=1;i<array.length;i++){var tr0=array[i-1];var td0=tr0.childNodes[sortIndex];var valueNode0=(td0.firstChild.nodeType==3)?td0:td0.firstChild;var value0=jQuery.orange.getDataValue(valueNode0);if(value0==undefined)
value0=valueNode0.dataValueRef;if(value0 instanceof String)
value0=value0.toLowerCase();var tr1=array[i];var td1=tr1.childNodes[sortIndex];var valueNode1=(td1.firstChild.nodeType==3)?td1:td1.firstChild;var value1=jQuery.orange.getDataValue(valueNode1);if(value1==undefined)
value1=valueNode1.dataValueRef;if(value1 instanceof String)
value1=value1.toLowerCase();if((orderAsc&&((value0!=undefined&&value1==undefined)||(value0!=undefined&&value1!=undefined&&value0>value1)))||(!orderAsc&&((value0==undefined&&value1!=undefined)||(value0!=undefined&&value1!=undefined&&value0<value1)))){tbody.removeChild(tr1);tbody.insertBefore(tr1,tr0);nbPermutations++;}}}while(nbPermutations>0);$(".table-paging-current",tbody.parentNode).each(function(){jQuery.orange.widget.Table.pagingGoTo.call(tbody.parentNode,this.value-1);});},onBooleanSetAll:function(event){var input=event.target;var checked=input.checked;var th=input.parentNode;var tr=th.parentNode;var index;var i;for(i in tr.childNodes)
if(tr.childNodes[i]==th)
index=i;var table=tr.parentNode.parentNode;$("tbody tr",table).each(function(){$("input[type=checkbox]"+(checked?":not(:checked)":":checked"),this.childNodes[index]).not(input).each(function(){if(!$(this).attr("disabled"))
this.toggleDataValue();});});},onSelectClick:function(event){var td=event.target,parent=td.parentNode;while(parent.nodeName!="TR"){td=parent;parent=parent.parentNode;}
if($(td).hasClass("table-delete")||td.nodeName!="TD")
return;var tr=td.parentNode;var jTr=$(tr);var tbody=tr.parentNode;if(jTr.hasClass("table-selected"))
return;$(".table-selected",tbody).removeClass("table-selected");jTr.addClass("table-selected");var widget=tbody.parentNode.parentNode.parentNode;$(widget).trigger("rowSelect",[tr]);},crudCallbackCreate:function(attrs,result){if(result.error!=undefined)
return;var self=$(this);self.attr("dataId",result.id);this.crudAction="update";self.removeClass("table-row-added");var form=getFirstParentWithNodeName(this,"FORM");var oldState=jQuery.orange.widget.Table.getState.call(form);$("[dataId]",this).each(function(){arrayRemove(form.modifsOK,this);});arrayRemove(form.addPending,this);var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);var widget=form.parentNode;var tr;if(widget.addRow!=undefined)
tr=widget.addRow(result.id,attrs);else
tr=jQuery.orange.widget.Table.addRow.call(widget,result.id,attrs);$(this).after(tr).remove();jQuery.orange.widget.Table.pagingUpdate.call(widget);},crudCallbackDelete:function(error){if(error!=undefined)
return;var form=getFirstParentWithNodeName(this,"FORM");var oldState=jQuery.orange.widget.Table.getState.call(form);arrayRemove(form.deletePending,this);var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);jQuery.orange.widget.Table.deleteRow(this);jQuery.orange.widget.Table.pagingUpdate.call(form.parentNode);},createDeleteTd:function(){var td=document.createElement("td");var jTd=$(td);jTd.attr("i18n","table.col.delete").orangeTranslate();jTd.addClass("table-delete");jTd.html("&nbsp;");jTd.attr("tabindex","0");var clickHandler=function(event){var widget=getFirstParentWithNodeName(event.target,"FORM").parentNode;var listener;if(widget.onDeleteClick!=undefined)
listener=widget.onDeleteClick;else
listener=jQuery.orange.widget.Table.onDeleteClick;listener(event);};jTd.click(clickHandler);jTd.keyup(function(event){var keycode=(event.which!=undefined)?event.which:event.charCode;if(keycode==13||keycode==32){clickHandler(event);}});return td;},onDeleteClick:function(event){var td=event.target;if($(td).data("disabled")==true)
return;var widget=getFirstParentWithNodeName(td,"TABLE").parentNode.parentNode;if($(widget).data("disabled")==true)
return;var tr=td.parentNode;var form=tr.parentNode.parentNode.parentNode;var oldState=jQuery.orange.widget.Table.getState.call(form);var jTr=$(tr);if(jTr.hasClass("table-row-added"))
jQuery.orange.widget.Table.deleteRow(tr);else if(jTr.hasClass("table-row-deleted")){$("[dataId]",tr).setDisabled(false);arrayRemove(form.deletePending,tr);jTr.removeClass("table-row-deleted");tr.crudAction="update";}else{widget.veto=false;$(widget).trigger("vetoableRowDelete",[tr]);if(widget.veto===true)
return;jQuery.orange.widget.Table.markToDelete(tr);return;}
var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);},markToDelete:function(tr){var form=tr.parentNode.parentNode.parentNode;var oldState=jQuery.orange.widget.Table.getState.call(form);form.lineRemoved=true;$("[dataId]",tr).each(function(){var value=jQuery.orange.getDataValue(this);if(value!=undefined&&this.dataValueRef!=undefined&&value!=this.dataValueRef)
jQuery.orange.setDataValue(this,this.dataValueRef);arrayRemove(form.modifsOK,this);arrayRemove(form.dataKO,this);}).setDisabled(true);oldState=jQuery.orange.widget.Table.getState.call(form);form.deletePending.push(tr);$(tr).addClass("table-row-deleted");tr.crudAction="delete";var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);$(form.parentNode).trigger("rowMarkedToDelete",[tr]);},deleteRow:function(tr,updateState){if(updateState==undefined)
updateState=true;var tbody=tr.parentNode;var table=tbody.parentNode;var form=table.parentNode;form.lineRemoved=true;var oldState;if(updateState)
oldState=jQuery.orange.widget.Table.getState.call(form);$("[dataId],[dataId] input",tr).each(function(){jQuery.orange.errorMsg(undefined,this);});if($(tr).hasClass("table-row-added")){$("[dataId],[dataId] input",tr).each(function(){arrayRemove(form.modifsOK,this);arrayRemove(form.dataKO,this);});arrayRemove(form.addPending,tr);}
arrayRemove(form.deletePending,tr);if(updateState){var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}
var previousSibling=tr.previousSibling;tbody.removeChild(tr);var pagingTotal=$(".table-paging-total",table)[0];if(pagingTotal!=undefined){var paging=$("tfoot",table)[0].paging;var last=parseInt((tbody.childNodes.length-1)/paging);$(pagingTotal).text("/"+(last+1));var pagingCurrent=$(".table-paging-current",table)[0];var page=parseInt(pagingCurrent.value)-1;jQuery.orange.widget.Table.pagingGoTo.call(table,(page>last)?last:page);}
$(form.parentNode).trigger("rowDeleted",[tr,previousSibling]);},pagingGoTo:function(page){var paging=$("tfoot",this)[0].paging;var min=page*paging;var max=min+paging-1;var tbody=$("tbody",this)[0];var i;for(i=0;i<tbody.childNodes.length;i++)
$(tbody.childNodes[i]).removeClass("table-row-hidden");for(i=0;i<min;i++)
$(tbody.childNodes[i]).addClass("table-row-hidden");for(i=max+1;i<tbody.childNodes.length;i++)
$(tbody.childNodes[i]).addClass("table-row-hidden");$(".table-paging-current",this)[0].value=page+1;},pagingUpdate:function(){var pagingTotal=$(".table-paging-total",this);if(pagingTotal[0]==undefined)
return;var tbody=$("tbody",this)[0];var total=parseInt((tbody.childNodes.length-1)/this.conf.options.paging+1);pagingTotal.text("/"+total);jQuery.orange.widget.Table.pagingGoTo.call(tbody.parentNode,$(".table-paging-current",this)[0].value-1);},addRow:function(id,attrs){var conf=this.conf;var constraints=$("form",this)[0].dataConstraints;var options=conf.options;var columns=conf.columns;var tr=document.createElement("tr");var jTr=$(tr);jTr.addClass("table-row");tr.onDataDelete=jQuery.orange.widget.Table.crudCallbackDelete;if(id!=undefined){tr.crudAction="update";jTr.attr("dataId",id);}else{tr.crudAction="create";tr.onDataCreate=jQuery.orange.widget.Table.crudCallbackCreate;jTr.attr("dataId",$(this).attr("dataId"));jTr.addClass("table-row-added");}
if(attrs!=undefined)
tr.dataValueRef=attrs;if(options.selectable)
jTr.addClass("table-selectable");var table=this.firstChild.firstChild;var tbody=$("tbody",table)[0];var trHead=$("thead tr",table)[0];var trIndex=tbody.childNodes.length;tbody.appendChild(tr);var colIndex=0;for(var i in columns){var td=document.createElement("td");tr.appendChild(td);var th=trHead.childNodes[i];var column=columns[i];var editable=attrs==undefined||column.editable;var value=(attrs!=undefined)?attrs[column.attr]:undefined;var nodeName,nodeAttrs,widgetType,widgetArg;if(editable){nodeName=column.editNodeName;nodeAttrs=column.editNodeAttrs;widgetType=column.editWidgetType;widgetArg=column.editWidgetArg;}else{nodeName=column.viewNodeName;nodeAttrs=column.viewNodeAttrs;widgetType=column.viewWidgetType;widgetArg=column.viewWidgetArg;}
var node=undefined;if(nodeName!=undefined||widgetType!=undefined){nodeName=(nodeName!=undefined)?nodeName:"div";node=document.createElement(nodeName);if(widgetType!=undefined){$(node).attr("widgetType",widgetType);if(widgetArg!=undefined)
$(node).attr("widgetArg",JSON.stringify(widgetArg));}}else if(editable){if($(th).attr("enumerated")!=undefined)
node=document.createElement("select");else{node=document.createElement("input");$(node).attr("type","text");}}else if(value!=undefined){td.appendChild(document.createTextNode(value));}
var viewNode=(node!=undefined)?node:td;var jViewNode=$(viewNode);for(var j in th.attributes){if(th.attributes[j]!=undefined){var name=th.attributes[j].nodeName;if(name!=undefined&&name.toLowerCase()!="widgettype"&&name.toLowerCase()!="widgetarg"&&name.toLowerCase()!="i18n"&&name.toLowerCase()!="tabindex"){viewNode.setAttribute(name,th.getAttribute(name));}}}
if(viewNode.nodeName.toLowerCase()=="input"&&jViewNode.attr("i18n")==undefined){var i18n=$(th).attr("i18n");if(i18n==undefined)
i18n=$(th.firstChild).attr("i18n");if(i18n!=undefined)
jViewNode.attr("i18n",i18n);}
if(widgetType!=undefined&&jViewNode.attr("i18nprefix")==undefined){var i18n=$(th).attr("i18n");if(i18n==undefined)
i18n=$(th.firstChild).attr("i18n");if(i18n!=undefined)
jViewNode.attr("i18nprefix",i18n);}
if(nodeAttrs!=undefined){for(var j in nodeAttrs)
jViewNode.attr(j,nodeAttrs[j]);}
if(constraints!=undefined&&constraints[column.attr]!=undefined){var attrConstraints=constraints[column.attr];for(var attrConstraint in attrConstraints)
jViewNode.attr(attrConstraint,jQuery.orange.constraint2text(attrConstraint,attrConstraints[attrConstraint]));}
$(td).addClass("table-col-"+(colIndex++));if(node!=undefined){td.appendChild(node);$(td).orangeParse();}
if(id!=undefined)
jViewNode.attr("dataId",id+"/"+column.attr);else
jViewNode.attr("dataId",column.attr);if(value!=undefined)
jQuery.orange.setDataValue(viewNode,value);}
if(options.deletable==true)
tr.appendChild(jQuery.orange.widget.Table.createDeleteTd());if(options.paging>0&&trIndex>=options.paging)
jTr.addClass("table-row-hidden");$(".table-paging-total",table).text("/"+parseInt((tbody.childNodes.length-1)/options.paging+1));return tr;},getState:function(){if($(this.parentNode).attr("disabled"))
return jQuery.orange.widget.Form.STATE_NO_MODIF;if(this.dataKO.length>0)
return jQuery.orange.widget.Form.STATE_KO;if(this.modifsOK.length>0||this.addPending.length>0||this.deletePending.length>0)
return jQuery.orange.widget.Form.STATE_MODIF_OK;return jQuery.orange.widget.Form.STATE_NO_MODIF;},setButtonsDisabled:function(newState){if(newState==undefined||newState==jQuery.orange.widget.Form.STATE_NO_MODIF){this.addPending=new Array();this.deletePending=new Array();}
jQuery.orange.widget.Form.setButtonsDisabled.call(this,newState);},getActions:function(crudAction){if(crudAction=="read")
return[];var hasDoublet=false;var tbody=$("tbody",this)[0];var form=this;hasDoublet=jQuery.orange.widget.Table.checkDoublet(form,false);var actions=new Array();$("tr",tbody).each(function(){var subActions=jQuery.orange.widget.Form.getActions(this);if(subActions===false){hasDoublet=true;return;}
var i;for(i in subActions)
actions.push(subActions[i]);});if(hasDoublet){return false;}
return actions;},checkDoublet:function(form,hasToUpdateButton){var doublet=false;var tbody=$("tbody",form)[0];var widget=form.parentNode;var uniqueGroups=widget.conf.options.uniqueGroups;if(uniqueGroups!=undefined){$("tr",tbody).removeClass("table-row-doublet");jQuery.orange.errorMsg(undefined,widget);var i;for(i in uniqueGroups){var uniqueCols=uniqueGroups[i];var id2tr=new Object();$("tr",tbody).each(function(){var j,sep="#$",id="";for(j in uniqueCols){var td=$("td:eq("+uniqueCols[j]+")",this)[0];var value=(td.getDataValue!=undefined)?td.getDataValue():$("[dataId]",td)[0].getDataValue();id+=sep+value;}
if(id2tr[id]==undefined){id2tr[id]=this;}else if(!doublet){doublet=true;$(id2tr[id]).add(this).addClass("table-row-doublet");jQuery.orange.errorMsgKey("doublet",widget);$(widget).removeClass("errorInput");}});}}
var parentform=getFirstParentWithNodeName(widget,"FORM");if(doublet){jQuery.orange.widget.Form.setButtonsDisabled.call(parentform,jQuery.orange.widget.Form.STATE_KO);}else if(hasToUpdateButton){jQuery.orange.widget.Form.setButtonsDisabled.call(parentform,jQuery.orange.widget.Form.getState.call(parentform));}
return doublet;},onReset:function(){var columns=this.parentNode.conf.columns;var oldState=jQuery.orange.widget.Table.getState.call(this);var form=this;jQuery.orange.errorMsg(undefined,form.parentNode);$("tr",this).removeClass("table-row-doublet").each(function(){if(this.crudAction=="delete"){$("[dataId]",this).setDisabled(false);arrayRemove(form.deletePending,this);$(this).removeClass("table-row-deleted");this.crudAction="update";}else if(this.crudAction=="create")
jQuery.orange.widget.Table.deleteRow(this);});var newState=jQuery.orange.widget.Table.getState.call(this);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(this,oldState,newState);}
$("tr [dataId]",this).each(function(){jQuery.orange.setDataValue(this,this.dataValueRef);});},onDataChange:function(node){var form=this;jQuery.orange.widget.Form.onDataChange.call(this,node);var td=getFirstParentWithNodeName(node,"TD");if(td==null)
return;var tr=td.parentNode;if($(tr).hasClass('table-row-doublet')){var inutilemaispratique=jQuery.orange.widget.Table.checkDoublet(form,true);}
var index=arrayIndexOf(tr.children,td);var columns=this.parentNode.conf.columns;if(columns[index].booleanSetAll){var tbody=tr.parentNode;var total=tbody.children.length;var nb=0;$(">tr",tbody).each(function(){$(">td:eq("+index+") [dataId]",this).each(function(){if(this.getDataValue())
nb++;});});var ckAll=$("thead th:eq("+index+") input[type=checkbox]",tbody.parentNode);ckAll[0].checked=(nb==total);ckAll.attr("title",jQuery.orange.config.i18n.map[ckAll.prev().attr("i18n")+"."+(ckAll[0].checked?"false":"true")+".tip"]);}},orangeTranslate:function(){var attrI18n=$(this).attr("i18n");var summary=jQuery.orange.config.i18n.map[attrI18n+".summary"];var caption=summary;if(summary!=undefined){$("table",this).attr("summary",summary);}else{$("table",this).attr("summary","");}
if(!$.browser.msie||$.browser.version>"8.0"){if(caption!=undefined){$("caption",this)[0].innerHTML=caption;}else{$("caption",this)[0].innerHTML="";}}}};(function($){$.fn.widgetTable=function(options){return this.each(function(){this.disabled=false;this.setDisabled=jQuery.orange.widget.Table.setDisabled;this.orangeTranslate=jQuery.orange.widget.Table.orangeTranslate;$(this).addClass("table");if(options==undefined)
options=new Object();if(options.selectable==undefined)
options.selectable=false;if(options.extendable==undefined)
options.extendable=false;if(options.deletable==undefined)
options.deletable=false;if(options.paging==undefined)
options.paging=-1;if(options.limit==undefined||options.paging>0)
options.limit=-1;var form=document.createElement("form");form.getActions=jQuery.orange.widget.Table.getActions;form.setButtonsDisabled=jQuery.orange.widget.Table.setButtonsDisabled;form.onReset=jQuery.orange.widget.Table.onReset;form.onDataChange=jQuery.orange.widget.Table.onDataChange;form.addPending=new Array();form.deletePending=new Array();var table=document.createElement("table");var caption=document.createElement("caption");table.appendChild(caption);$(caption).attr("style","display:none");var columns=new Array();var thead=document.createElement("thead");var trHead=document.createElement("tr");var colIndex=0;$("[widgetType='TableColumn']",this).each(function(){var arg=$(this).attr("widgetArg");var self=$(this);if(arg==undefined)
return;arg=eval("("+arg+")");if(arg.attr==undefined)
return;if(arg.sortable==undefined)
arg.sortable=true;if(arg.editable==undefined)
arg.editable=false;if(arg.editable){if(arg.booleanSetAll==undefined)
arg.booleanSetAll=false;}else
arg.booleanSetAll=false;columns.push(arg);var i18n=self.attr("i18n");var th=document.createElement("th");th.dataAttrName=arg.attr;if(arg.sortable||arg.booleanSetAll){th.sortable=true;if(i18n!=undefined){var span=document.createElement("span");$(span).attr("i18n",i18n);th.appendChild(span);}}else if(i18n!=undefined){$(th).attr("i18n",i18n);}
if(arg.sortable){var sort=document.createElement("div");$(sort).addClass("table-sortable");$(sort).attr("tabindex","0");$(sort).click(jQuery.orange.widget.Table.onSortClick);$(sort).keyup(function(event){var keycode=(event.which!=undefined)?event.which:event.charCode;if(keycode==13||keycode==32){jQuery.orange.widget.Table.onSortClick(event);}});th.appendChild(sort);}
if(arg.booleanSetAll){var setAll=document.createElement("input");$(setAll).attr("type","checkbox");th.appendChild(setAll);$(setAll).bind("click",jQuery.orange.widget.Table.onBooleanSetAll);$(setAll).bind("change valueChange",function(event){$(this).attr("title",jQuery.orange.config.i18n.map[i18n+"."+($(this).attr("checked")?"false":"true")+".tip"]);event.stopPropagation();});}
for(var i in this.attributes)
if(this.attributes[i]!=undefined){var name=this.attributes[i].nodeName;if(name!=undefined&&name.toLowerCase()!="widgettype"&&name.toLowerCase()!="widgetarg"&&name.toLowerCase()!="i18n")
th.setAttribute(name,this.getAttribute(name));}
$(th).addClass("table-col-"+(colIndex++));trHead.appendChild(th);th.removeAttribute("tabIndex");});this.conf={options:options,columns:columns};if(options.deletable){var th=document.createElement("th");$(th).attr("i18n","table.col.deletable");$(th).addClass("table-delete");trHead.appendChild(th);}
thead.appendChild(trHead);table.appendChild(thead);var tbody=document.createElement("tbody");table.appendChild(tbody);if(options.selectable)
$(table).click(jQuery.orange.widget.Table.onSelectClick);if(options.paging>0){var tfoot=document.createElement("tfoot");tfoot.paging=options.paging;var tr=document.createElement("tr");var td=document.createElement("td");var jTd=$(td);jTd.attr("colSpan",trHead.childNodes.length);jTd.addClass("table-paging");tr.appendChild(td);tfoot.appendChild(tr);table.appendChild(tfoot);jTd.html("<div class='table-paging-first'></div><div class='table-paging-previous'></div><input class='table-paging-current' type='text' value='1' maxlength='2'/><span class='table-paging-total'>/0</span><div class='table-paging-next'></div><div class='table-paging-last'></div>");var pagingCurrent=$("input",td)[0];$(".table-paging-first",td).click(function(){var page=parseInt(pagingCurrent.value);if(page>1)
jQuery.orange.widget.Table.pagingGoTo.call(table,0);});$(".table-paging-previous",td).click(function(){var page=parseInt(pagingCurrent.value);if(page>1)
jQuery.orange.widget.Table.pagingGoTo.call(table,page-2);});$(".table-paging-current",td).change(function(){var page=parseInt(pagingCurrent.value);if(page!=pagingCurrent.value)
return;page=page-1;var last=parseInt((tbody.childNodes.length-1)/options.paging);if(page>=0&&page<=last)
jQuery.orange.widget.Table.pagingGoTo.call(table,page);});$(".table-paging-next",td).click(function(){var page=parseInt(pagingCurrent.value);var last=parseInt((tbody.childNodes.length-1)/options.paging);if(page<=last)
jQuery.orange.widget.Table.pagingGoTo.call(table,page);});$(".table-paging-last",td).click(function(){var page=parseInt(pagingCurrent.value);var last=parseInt((tbody.childNodes.length-1)/options.paging);if(page<=last)
jQuery.orange.widget.Table.pagingGoTo.call(table,last);});}
form.appendChild(table);this.appendChild(form);if(options.extendable==true){var divAdd=document.createElement("div");$(divAdd).attr("widgetType","ButtonContainer");$(divAdd).addClass("table-add-container");var spanAdd=document.createElement("span");$(spanAdd).attr("i18n","table.button.add");$(spanAdd).attr("widgetType","ButtonImage");$(spanAdd).addClass("table-add-button");if(jQuery.orange.config.i18n.map["table.button.add.class"]!=undefined){$(spanAdd).removeClass("btn");$(spanAdd).addClass(jQuery.orange.config.i18n.map["table.button.add.class"]);}
var self=this;$(spanAdd).bind("activateButton",function(event){if(self.disabled){event.stopPropagation();}else{var oldState=jQuery.orange.widget.Table.getState.call(form);var widget=form.parentNode;var tr;if(widget.addRow!=undefined){tr=widget.addRow();}else{tr=jQuery.orange.widget.Table.addRow.call(widget);}
form.addPending.push(tr);if(options.paging>0){var last=parseInt((tbody.childNodes.length-1)/options.paging);jQuery.orange.widget.Table.pagingGoTo.call(table,last);}
var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);$(tr).find(":input").each(function(){jQuery.orange.widget.Form.onDataChange.call(form,this,false);});}});$(divAdd).append(spanAdd);$(table).after(divAdd);}
var initId=$(this).attr("dataId");this.onDataRead=function(data){this.dataValueRef=undefined;$(this).attr("dataId",initId);form.dataConstraints=data.constraints;$(tbody).empty();var trIndex=0;for(var id in data.values){if(options.limit>0&&trIndex==options.limit)
return;trIndex++;var widget=form.parentNode;if(widget.addRow!=undefined)
widget.addRow(id,data.values[id]);else
jQuery.orange.widget.Table.addRow.call(widget,id,data.values[id]);}};});};})(jQuery);(function($){$.fn.widgetTableColumn=function(options){return this.each(function(){$(this).remove();});};})(jQuery);jQuery.orange.widget.Timestamp={setDataValue:function(value){var date=(value instanceof Date)?date:dataDateParse(value);$(this).html(date.format(this.dateFormat));}};(function($){$.fn.widgetTimestamp=function(options){return this.each(function(){this.dateFormat=options;this.setDataValue=jQuery.orange.widget.Timestamp.setDataValue;});};})(jQuery);jQuery.orange.widget.TimestampOperation={setDataValue:function(value){var date=(value instanceof Date)?date:dataDateParse(value);var dataIdParent=$(this).closest("tr").attr("dataid");var dataId=dataIdParent+"/"+this.operationDataId;var operationType=this.operationType;var this0=this;jQuery.orange.config.api.crud.read([dataId],function(result){var operationValue=result[dataId].values[dataId];if(operationType=="+"){date.setTime(date.getTime()+(operationValue*1000));}else if(operationType=="-"){date.setTime(date.getTime()-(operationValue*1000));}
$(this0).html(date.format(this0.dateFormat));});}};(function($){$.fn.widgetTimestampOperation=function(options){return this.each(function(){this.dateFormat=options[0];this.operationType=options[1];this.operationDataId=options[2];this.setDataValue=jQuery.orange.widget.TimestampOperation.setDataValue;});};})(jQuery);jQuery.orange.widget.VisibleDependent={setDataValue:function(value){var visible=value===this.dependenceValue;if(this.dependenceEquals===false)
visible=!visible;if(visible){classToAdd="visibledependent-display";classToRemove="visibledependent-hide";}else{classToAdd="visibledependent-hide";classToRemove="visibledependent-display";}
if($(this).hasClass('parentDependent')&&classToAdd=="visibledependent-hide"){$(this).parent().removeClass(classToRemove).addClass(classToAdd);}else{$(this).removeClass(classToRemove).addClass(classToAdd);}
$("[dataId]",this).setDisabled(!visible);$(this).trigger("visibilityChange",[visible]);},onParse:function(){if(this.dependenceId!=undefined){var node=document.getElementById(this.dependenceId);this.setDataValue(jQuery.orange.getDataValue(node));var this0=this;$("#"+this.dependenceId).bind(this.dependenceEvent,function(event){this0.setDataValue(jQuery.orange.getDataValue(node));});}}};(function($){$.fn.widgetVisibleDependent=function(options){return this.each(function(){var dataId=$(this).attr("dataId");var id=options.id;var value=options.value;if((id==undefined&&dataId==undefined)||(id!=undefined&&document.getElementById(id)==undefined)||value==undefined)
return;this.onParse=jQuery.orange.widget.VisibleDependent.onParse;this.setDataValue=jQuery.orange.widget.VisibleDependent.setDataValue;this.dependenceId=id;this.dependenceEvent=(options.event!=undefined)?options.event:"change";this.dependenceValue=value;this.dependenceEquals=(options.equals!=undefined)?options.equals:true;});};})(jQuery);jQuery.orange.widget.Waiting=function(action,timeout){if(action==undefined)
action="display";if(action=="display")
jQuery.orange.widget.Waiting.display(timeout);else if(action=="remove")
jQuery.orange.widget.Waiting.remove();};jQuery.orange.widget.Waiting.display=function(timeout){timeout=(timeout!=undefined)?parseInt(timeout):0;var glasspane=document.createElement("div");$(glasspane).attr("id","widgetWaiting");$(glasspane).addClass("ui-widget-overlay");var animation=document.createElement("div");$(animation).attr("id","widgetWaitingAnim");glasspane.appendChild(animation);document.body.appendChild(glasspane);if(timeout>0)
jQuery.orange.widget.Waiting.timer=setTimeout(function(){jQuery.orange.widget.Waiting.remove();},timeout);};jQuery.orange.widget.Waiting.remove=function(){if(jQuery.orange.widget.Waiting.timer!=undefined){clearTimeout(jQuery.orange.widget.Waiting.timer);jQuery.orange.widget.Waiting.timer=undefined;}
$("#widgetWaiting").remove();};apiCrudSagem={constraintMapping:{"min-length":"minlength","max-length":"maxlength","min-value-inclusive":"minvalue","max-value-inclusive":"maxvalue","enum-values":"enumerated","reg-exp":"regex"},errors:{XMO_NO_ERR:jQuery.gui.XMO_NO_ERR},capability2constraints:function(capability){if(capability==undefined||capability.restrictions==undefined)
return undefined;var constraints={};var restrictions=capability.restrictions;for(var restriction in restrictions){var constraint=this.constraintMapping[restriction];if(constraint!=null){constraints[constraint]=restrictions[restriction];if(constraint=="enumerated"){var enumeration=constraints[constraint];constraints[constraint]=new Array();for(var i in enumeration)
if(enumeration[i].name!=null&&enumeration[i].name!=undefined)
constraints[constraint].push(enumeration[i].name);else
constraints[constraint].push(enumeration[i].value);}else if(constraint=="regex")
constraints[constraint]=constraints[constraint].pattern;}}
return constraints;},createActionAnalyser:function(action){var callback=action.callbacks[0];if(callback.result.code!=jQuery.gui.XMO_NO_ERR)
return{error:callback.result.code};else
return{id:callback.parameters.uid};},create:function(id,attrs,callback){if(id==undefined||id==null||attrs==undefined||attrs==null||!attrs instanceof Object){if(callback!=undefined)
callback();return;}
jQuery.orange.config.api.client.verifyConnection();var req=jQuery.orange.config.api.client.newRequest();var i=id.lastIndexOf("/");var value=new Object();value[id.substring(i+1)]=attrs;req.addChild(id.substring(0,i),value);var okCallback=function(object){if(callback!=undefined)
callback(apiCrudSagem.createActionAnalyser(object.actions[0]));};req.send(okCallback,function(error,object){jQuery.log(error);okCallback(object);});},valueChangeCallback:function(xpath,value){jQuery.log(xpath+" : "+value);$("[dataid]").each(function(){if(xpath==$(this).attr("dataid")&&$(this).attr("noautorefresh")==undefined){jQuery.orange.setDataValue(this,value);}});},notificationEventsCallback:function(event){},readActionAnalyser:function(action){var result=new Object();var callbacks=action.callbacks;if(callbacks==undefined)
return;result.nb=callbacks.length;if(callbacks.length>0){result.values=new Object();if(callbacks[0].parameters!=undefined&&callbacks[0].parameters.capability!=undefined){var capability0=callbacks[0].parameters.capability;result.isNode=capability0.attributes!=undefined;if(result.isNode){result.constraints=new Object();for(var i in capability0.attributes){var attr=capability0.attributes[i];var constraints=apiCrudSagem.capability2constraints(attr);if(constraints!=undefined){result.constraints[attr.name]=constraints;}}}else{result.constraints=apiCrudSagem.capability2constraints(capability0);}
for(var i in callbacks){if(result.isNode){for(var j in callbacks[i].parameters.value){var value=callbacks[i].parameters.value[j];var attrs=new Object();for(var k in value){if(!(value[k]instanceof Object)){attrs[k]=value[k];}}
result.values[callbacks[i].xpath]=attrs;}}else{result.values[callbacks[i].xpath]=callbacks[i].parameters.value;}}}else{result.values[callbacks[0].xpath]=callbacks[0].result.description;}}
return result;},read:function(ids,callback){if(ids==undefined||ids==null||!ids instanceof Array||ids.length==0){if(callback!=undefined)
callback(new Object());return;}
var tmp=new Array();for(var i in ids)
if(ids[i].indexOf("/")!=-1)
tmp.push(ids[i]);ids=tmp;if(ids.length==0){if(callback!=undefined)
callback(new Object());return;}
jQuery.orange.config.api.client.verifyConnection();var MAX_ACTIONS_IN_REQUEST=100;var nbRequest=Math.ceil(ids.length/MAX_ACTIONS_IN_REQUEST);var result=new Object();for(var currentRequestIndex=0;currentRequestIndex<nbRequest;currentRequestIndex++){var req=jQuery.orange.config.api.client.newRequest({synchronous:true});for(var i=0;i<MAX_ACTIONS_IN_REQUEST;i++){var index=currentRequestIndex*MAX_ACTIONS_IN_REQUEST+i;if(index<ids.length){req.getValue(ids[index]);}else{break;}}
function buildOkCallback(currentRequestIndex){return function(object){if(callback==undefined)
return;var actions=object.actions;var reqAutoRefresh=jQuery.orange.config.api.client.newRequest();var nbLeaves=0;for(var i=0;i<MAX_ACTIONS_IN_REQUEST;i++){var index=currentRequestIndex*MAX_ACTIONS_IN_REQUEST+i;if(index>=ids.length){break;}
var value=apiCrudSagem.readActionAnalyser(actions[i]);if(value!=undefined){var xpath=ids[index];result[xpath]=value;if(!value.isNode){if(/@uid$/.test(xpath)){}else{reqAutoRefresh.onValueChange(xpath,function(newvalue,anObject,rawXPath){apiCrudSagem.valueChangeCallback(rawXPath,newvalue);},undefined,undefined,{"current-value":false});nbLeaves++;}}}}
if(nbLeaves>0)
reqAutoRefresh.send();if(currentRequestIndex>=nbRequest-1){callback(result);}};};var okCallback=buildOkCallback(currentRequestIndex);req.send(okCallback,function(error,object){jQuery.log(error);okCallback(object);});}
jQuery.orange.config.api.client.getNotificationEvents(apiCrudSagem.notificationEventsCallback);},updateActionAnalyser:function(action){var callbacks=action.callbacks;if(callbacks==undefined)
return action.error.code;else if(callbacks[0].result.code!=jQuery.gui.XMO_NO_ERR)
return callbacks[0].result.code;},update:function(id2value,callback){jQuery.orange.config.api.client.verifyConnection();var req=jQuery.orange.config.api.client.newRequest();for(var id in id2value){req.setValue(id,id2value[id]);}
var okCallback=function(object){if(callback==undefined)
return;var actions=object.actions;var errors=new Object();var i=0;for(var id in id2value){var error=apiCrudSagem.updateActionAnalyser(actions[i]);if(error!=undefined)
errors[id]=error;i++;}
callback(errors);};req.send(okCallback,function(error,object){jQuery.log(error);okCallback(object);});},delActionAnalyser:function(action){var callback=action.callbacks[0];if(callback!=undefined&&callback.result.code!=jQuery.gui.XMO_NO_ERR)
return callback.result.code;},del:function(id,callback){jQuery.orange.config.api.client.verifyConnection();var req=jQuery.orange.config.api.client.newRequest();req.deleteElements(id);var okCallback=function(object){if(callback!=undefined)
callback(apiCrudSagem.delActionAnalyser(object.actions[0]));};req.send(okCallback,function(error,object){jQuery.log(error);okCallback(object);});},exec:function(actions,callback){jQuery.orange.config.api.client.verifyConnection();var MAX_ACTIONS_IN_REQUEST=100;var nbRequest=Math.ceil(actions.length/MAX_ACTIONS_IN_REQUEST);var result=new Object();for(var currentRequestIndex=0;currentRequestIndex<nbRequest;currentRequestIndex++){var req=jQuery.orange.config.api.client.newRequest();for(var i=0;i<MAX_ACTIONS_IN_REQUEST;i++){var index=currentRequestIndex*MAX_ACTIONS_IN_REQUEST+i;if(index<actions.length){var action=actions[index];if(action.crud=="create"){var id=action.id;var pos=id.lastIndexOf("/");var value=new Object();value[id.substring(pos+1)]=action.attrs;req.addChild(id.substring(0,pos),value);}else if(action.crud=="read")
req.getValue(action.id);else if(action.crud=="update")
req.setValue(action.id,action.value);else if(action.crud=="delete")
req.deleteElements(action.id);}else{break;}}
function buildOkCallback(currentRequestIndex){return function(object){if(callback==undefined)
return;for(var i=0;i<MAX_ACTIONS_IN_REQUEST;i++){var index=currentRequestIndex*MAX_ACTIONS_IN_REQUEST+i;if(index>=actions.length){break;}
var action=actions[index];if(action.crud=="create")
result[index]=apiCrudSagem.createActionAnalyser(object.actions[i]);else if(action.crud=="read")
result[index]=apiCrudSagem.readActionAnalyser(object.actions[i]);else if(action.crud=="update")
result[index]=apiCrudSagem.updateActionAnalyser(object.actions[i]);else if(action.crud=="delete")
result[index]=apiCrudSagem.delActionAnalyser(object.actions[i]);}
if(currentRequestIndex>=nbRequest-1){callback(result);}};};var okCallback=buildOkCallback(currentRequestIndex);req.send(okCallback,function(error,object){jQuery.log(error);okCallback(object);});}}};apiAuthorizationSagem={profile:undefined,userlogin:undefined,isHTTPS:false,accessRemoteDisable:false,init:function(callback){var gui=jQuery.gui;gui.init();var client=new gui.api.Client({request:{errFunc:function(error,reply){console.log("ERROR: new Client(): "+error.description);},synchronous:true}});client.verifyConnection=function(){if(!client.isConnected()){console.log("ERROR: Client is not connected");}};jQuery.orange.config.api.client=client;},login:function(login,password,callback){jQuery.orange.config.api.client.removeEvent();for(var pendingRequest in jQuery.orange.config.api.client._pendingRequests){jQuery.orange.config.api.client._pendingRequests[pendingRequest].ajaxRequest.abort();}
jQuery.orange.config.api.client.closeSession();jQuery.orange.config.api.client.openSession(login,password);if(this.isConnected()){jQuery.orange.config.api.authorization.userlogin=login;if(callback!=undefined){callback(true);}}else{jQuery.orange.config.api.authorization.userlogin=undefined;if(callback!=undefined){callback(false);}}},getLogin:function(){return this.userlogin;},getProfileName:function(){return this.profile;},isAuthorized:function(menuId){return true;},isConnected:function(){return jQuery.orange.config.api.client.isConnected();},disconnect:function(callback){jQuery.orange.config.api.client.close(function(){if(callback!=undefined)
callback();});}};apiRPCSagem={reboot:function(xpath,remoteCall_respFunc,remoteCall_errFunc){console.log("rpc call::reboot");var req=jQuery.orange.config.api.client.newRequest();if(xpath==undefined){xpath="Device";}
req.remoteCall(xpath,"reboot",null,null,remoteCall_respFunc,remoteCall_errFunc,null);req.send();},reinitialize:function(xpath,type,remoteCall_respFunc,remoteCall_errFunc){var req=jQuery.orange.config.api.client.newRequest();if(xpath==undefined){xpath="Device";}
req.remoteCall(xpath,"reinitialize",{"RestoreMode":type},null,remoteCall_respFunc,remoteCall_errFunc,null);req.send();},requestDownload:function(XpathRPC,successCallback,errorCallback){console.log("rpc call::requestDownload");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall(XpathRPC,"requestDownload",null,function(arg1,arg2,arg3){console.log("requestDownload::eventFunction arg1="+arg1+", arg2="+arg2+", arg3="+arg3);},function(){console.log("requestDownload::respFunction");if(successCallback!=undefined&&$.isFunction(successCallback)){successCallback(true);}},function(error,xpath){console.log("requestDownload::errorFunction");if(error.code==$.gui.XMO_REQUEST_NO_ERR){if(successCallback!=undefined&&$.isFunction(successCallback)){successCallback(true);}}else if(error.code==$.gui.XMO_NO_UPDATE_ERR){if(successCallback!=undefined&&$.isFunction(successCallback)){successCallback(false);}}else{if(errorCallback!=undefined&&$.isFunction(errorCallback)){errorCallback(error);}}},null);req.send();},getSaveUrl:function(){console.log("rpc call::getSaveUrl");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/DeviceInfo/VendorConfigFile","getSaveURL",null,function(){console.log("getSaveUrl::eventFunction");},function(){console.log("getSaveUrl::respFunction");},function(){console.log("getSaveUrl::errorFunction");},null);req.send();},saveTo:function(destination){console.log("rpc call::saveTo");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/DeviceInfo/VendorConfigFile","saveTo",destination,function(){console.log("saveTo::eventFunction");},function(){console.log("saveTo::respFunction");},function(){console.log("saveTo::errorFunction");},null);req.send(function(){console.log("saveTo [SEND] :: respFunction");},function(){console.log("saveTo [SEND] :: errFunction");},null);},unlockWithPassword:function(clearPassword,callback){console.log("rpc call::unlockWithPassword");var hashedPassword=jQuery.orange.config.api.client.hashPassword(clearPassword);var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/DeviceInfo/SmartCard","unlock",{"Type":"PASSWORD","Value":hashedPassword},function(){console.log("unlockWithPassword::eventFunction");},function(){console.log("unlockWithPassword::respFunction");if(callback!=undefined&&$.isFunction(callback)){callback(true);}},function(error,reply){console.log("unlockWithPassword::errorFunction");if(error!=undefined)console.log(error.code);if(callback!=undefined&&$.isFunction(callback)){callback(false);}},null);req.send();},unlockWithSecretAnswer:function(secretAnswer,callback){console.log("rpc call::unlockWithSecretAnswer");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/DeviceInfo/SmartCard","unlock",{"Type":"SECRET_ANSWER","Value":secretAnswer},function(){console.log("unlockWithSecretAnswer::eventFunction");},function(){console.log("unlockWithSecretAnswer::respFunction");if(callback!=undefined&&$.isFunction(callback)){callback(true);}},function(error,reply){console.log("unlockWithSecretAnswer::errorFunction");if(error!=undefined)console.log(error.code);if(callback!=undefined&&$.isFunction(callback)){callback(false);}},null);req.send();},restoreFirewall:function(callback){console.log("rpc call::restoreFirewall");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/Firewall","restore",null,function(){console.log("restoreFirewall::eventFunction");},function(){console.log("restoreFirewall::respFunction");if(callback!=undefined&&$.isFunction(callback)){callback();}},function(){console.log("restoreFirewall::errorFunction");},null);req.send();},restartConnection:function(callback){console.log("rpc call::restartConnection");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/Networks/WAN[@name='WAN']/PPP","restartConnection",null,function(){console.log("restartConnection::eventFunction");callback();},function(){console.log("restartConnection::respFunction");callback();},function(){console.log("restartConnection::errorFunction");callback();},null);req.send();callback();},testPhones:function(){console.log("rpc call::testPhones");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/VOIPService","testPhones",null,function(){console.log("testPhones::eventFunction");},function(){console.log("testPhones::respFunction");},function(){console.log("testPhones::errorFunction");},null);req.send();},startWPS:function(lanname,respFunction){console.log("rpc call::startWPS");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/Networks/LAN[@name='"+lanname+"']/LANPorts/LANWiFiPort","startWPS",null,function(){console.log("startWPS::eventFunction");},function(){console.log("startWPS::respFunction");respFunction();},function(){console.log("startWPS::errorFunction");},null);req.send();},ping:function(host,count,protocol,lanname){console.log("rpc call::ping");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device","ping",[host,count,protocol],function(){console.log("ping::eventFunction");},function(pTransmitted,pReceived,roundTripMin,rountTripAvg,roundTripMax){console.log("ping::respFunction");},function(){console.log("ping::errorFunction");},null);req.send();},eject:function(force,equip,remoteCall_errFunc){console.log("rpc call::eject");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall(equip,"eject",force,null,null,remoteCall_errFunc,null);req.send();},check:function(xpath,remoteCall_respFunc,remoteCall_errFunc){console.log("rpc call::check");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall(xpath,"check",null,null,remoteCall_respFunc,remoteCall_errFunc,null);req.send();},format:function(xpath,type,remoteCall_respFunc,remoteCall_errFunc){console.log("rpc call::format");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall(xpath,"format",type,null,remoteCall_respFunc,remoteCall_errFunc,null);req.send();},sleep:function(xpath){console.log("rpc call::sleep");var req=jQuery.orange.config.api.client.newRequest();if(xpath==undefined){xpath="Device";}
req.remoteCall("Device/Networks/LAN[@name='"+lanname+"']/ConnectedDevice/"+equip+"","sleep",null,function(){console.log("sleep::eventFunction");},function(){console.log("sleep::respFunction");},function(){console.log("sleep::errorFunction");},null);req.send();},clear:function(){console.log("rpc call::clear");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/DeviceInfo/SmartCard","clear",null,function(){console.log("clear::eventFunction");},function(){console.log("clear::respFunction");},function(){console.log("clear::errorFunction");},null);req.send();},checkSecretAnswer:function(login,answer,callback){console.log("rpc call::checkSecretAnswer");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/UserAccounts/ManagedUsers/ManagedUser[Login='"+login+"']","checkSecretAnswer",{"answer":answer},null,function(match){callback(match);},function(){console.log("checkSecretAnswer::errorFunction");},null);req.send();},generatePinCode:function(lanname,setLBPinCode){console.log("rpc call::generatePinCode");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/Networks/LAN[@name='"+lanname+"']/LANPorts/LANWiFiPort","generatePinCode",null,function(){console.log("generatePinCode::eventFunction");},function(pincode){console.log("generatePinCode::respFunction");setLBPinCode(pincode.PinCode);},function(){console.log("generatePinCode::errorFunction");},null);req.send();},getLogsURL:function(filename){console.log("rpc call::getLogsURL");var req=jQuery.orange.config.api.client.newRequest();req.downloadFile("Device/DeviceInfo/Logs/AdvancedLogs",filename,function(){console.log("getLogsURL::respFunction");},function(){console.log("getLogsURL::errorFunction");},null);req.send();},syncNetwork:function(callback){console.log("rpc call::syncNetwork");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall("Device/MESH","syncNetwork",null,null,function(){if(callback!=undefined){callback(true);}},function(){console.log("syncNetwork::errorFunction");if(callback!=undefined){callback(false);}},null);req.send();},unpair:function(xpath,callback){console.log("rpc call::unPair");var req=jQuery.orange.config.api.client.newRequest();req.remoteCall(xpath,"unPair",null,null,function(){if(callback!=undefined){callback();}},function(){console.log("unPair::errorFunction");if(callback!=undefined){callback();}},null);req.send();}};menu={};menu.mapping={js_loader:"index.xml",header:"html/main/header.xml",footer:"html/main/footer.xml",popups:"html/main/popups.xml",mainMenu:"menu/mainMenu.xml",secondaryMenu:"html/main/menu/wifi.xml",subContainer:"html/subContainer.xml",permanentPreferenceSettings:"html/main/header/permanentPreferenceSettings.xml",connectionManagement:"html/main/header/connectionManagement.xml",global:'global',content:'content',subcontent:'subcontent',home:"html/home/home.xml",installation:"html/installation/installation.xml",installation_step_1:"html/installation/installation_step_1.xml",installation_step_2:"html/installation/installation_step_2.xml",installation_step_3:"html/installation/installation_step_3.xml",installation_step_3_1:"html/installation/installation_step_3_1.xml",installation_step_4:"html/installation/installation_step_4.xml",securisation_step_1:"html/installation/securisation_step_1.xml",securisation_step_2:"html/installation/securisation_step_2.xml",securisation_step_3:"html/installation/securisation_step_3.xml",securisation_step_3:"html/installation/securisation_step_3.xml",reinstallation_step_1:"html/installation/reinstallation_step_1.xml",reinstallation_step_1_1:"html/installation/reinstallation_step_1_1.xml",reinstallation_step_1_2:"html/installation/reinstallation_step_1_2.xml",reinstallation_step_2:"html/installation/reinstallation_step_2.xml",simplereboot_oninstall:"html/installation/simplereboot_oninstall.xml",firmware_upgrade_inprogress:"html/installation/firmware_upgrade_inprogress.xml",firmware_upgrade_failed:"html/installation/firmware_upgrade_failed.xml",auth:"html/main/authentication.xml",servicesMenu:"menu/servicesMenu.xml",networkMenu:"menu/networkMenu.xml",equipmentMenu:"menu/equipmentMenu.xml",diagnosticMenu:"menu/diagnosticMenu.xml",accountMenu:"menu/accountMenu.xml",emptyMenu:"menu/emptyMenu.xml",internetConnection:"html/myServices/internetConnection.xml",phone:"html/myServices/phone.xml",phoneTest:"html/myServices/phoneTest.xml",wifiVisitorAccess:"html/myServices/wifiVisitorAccess.xml",wifiVisitorAccessFirst:"html/myServices/wifiVisitorAccessFirst.xml",wifiVisitorAccessForm:"html/myServices/wifiVisitorAccessForm.xml",wifiVisitorAccessFormSuivi:"html/myServices/wifiVisitorAccessFormSuivi.xml",wifiVisitorAccessError:"html/myServices/wifiVisitorAccessError.xml",wifiVisitorAccessStatus:"html/myServices/wifiVisitorAccessStatus.xml",services_meshLb:"html/myServices/services_meshLb.xml",wifiConfiguration:"html/myNetworks/wifiConfiguration.xml",firewall:"html/myNetworks/firewall.xml",firewallCustom:"html/myNetworks/firewallCustom.xml",firewallCustomRule1:"html/myNetworks/firewallCustomRule1.xml",firewallCustomRule2:"html/myNetworks/firewallCustomRule2.xml",firewallCustomRule3:"html/myNetworks/firewallCustomRule3.xml",vpn:"html/myNetworks/vpn.xml",vpnSts:"html/myNetworks/vpnSts.xml",vpnNomade:"html/myNetworks/vpnNomade.xml",vpnUser:"html/myNetworks/vpnUser.xml",vpnMail:"html/myNetworks/vpnMail.xml",dhcpdns:"html/myNetworks/dhcpdns.xml",natpat:"html/myNetworks/natpat.xml",ntp:"html/myNetworks/ntp.xml",upnp:"html/myNetworks/upnp.xml",dmz:"html/myNetworks/dmz.xml",dyndns:"html/myNetworks/dyndns.xml",routing:"html/myNetworks/routing.xml",network_meshLb:"html/myNetworks/network_meshLb.xml",caiq:"html/myNetworks/caiq.xml",liveboxEnvironment:"html/myEquipments/liveboxEnvironment.xml",userEquipment:"html/myEquipments/userEquipment.xml",officeCustomization:"html/myEquipments/officeCustomization.xml",restart:"html/myEquipments/restart.xml",restartInProgress:"html/myEquipments/restartInProgress.xml",reinitialisation:"html/myEquipments/reinitialisation.xml",reinitialisationAP:"html/myEquipments/reinitialisationAP.xml",update:"html/myEquipments/update.xml",updateInProgress:"html/myEquipments/updateInProgress.xml",save:"html/myEquipments/save.xml",restore:"html/myEquipments/restore.xml",standby:"html/myEquipments/standby.xml",customEquipmentEth:"html/myEquipments/customEquipmentEth.xml",customEquipmentUsb:"html/myEquipments/customEquipmentUsb.xml",customEquipmentStd:"html/myEquipments/customEquipmentStd.xml",customEquipmentTHD:"html/myEquipments/customEquipmentTHD.xml",restriction:"html/myEquipments/restriction.xml",infoSystem:"html/diagnostic/infoSystem.xml",telephoneHD:"html/diagnostic/telephoneHD.xml",infoSystemADSL:"html/diagnostic/infoSystemADSL.xml",infoSystemVoIP:"html/diagnostic/infoSystemVoIP.xml",infoSystemTV:"html/diagnostic/infoSystemTV.xml",infoSystemWiFi:"html/diagnostic/infoSystemWiFi.xml",infoSystemLAN:"html/diagnostic/infoSystemLAN.xml",infoSystemUSB:"html/diagnostic/infoSystemUSB.xml",infoSystemMesh:"html/diagnostic/infoSystemMesh.xml",infoSystemMeshSynchro:"html/diagnostic/infoSystemMeshSynchro.xml",basiclogs:"html/diagnostic/basiclogs.xml",advancedlogs:"html/diagnostic/advancedlogs.xml",snmp:"html/diagnostic/snmp.xml",distantaccessservice:"html/diagnostic/distantaccessservice.xml",ping:"html/diagnostic/ping.xml",password:"html/myAccount/password.xml",accountdistantAccess:"html/myAccount/distantAccess.xml",preferences:"html/myAccount/preference.xml",forgetPassword:"html/forgetPassword/forgetPassword1.xml",forgetPassword2:"html/forgetPassword/forgetPassword2.xml"};jQuery.orange.config.menu={showUnauthorized:true,target:menu.mapping.global,items:{m0:menu.mapping.home,m1:{url:menu.mapping.servicesMenu,target:menu.mapping.content,defaultItem:"m10",items:{m10:menu.mapping.internetConnection,m11:{url:menu.mapping.subContainer,target:menu.mapping.subcontent,defaultItem:"m110",items:{m110:menu.mapping.phone,m111:menu.mapping.phoneTest}},m13:menu.mapping.wifiVisitorAccess,m14:menu.mapping.services_meshLb}},m2:{url:menu.mapping.networkMenu,target:menu.mapping.content,defaultItem:"m31",items:{m20:menu.mapping.wifiConfiguration,m21:menu.mapping.firewall,m211:menu.mapping.firewallCustom,m2111:menu.mapping.firewallCustomRule1,m2112:menu.mapping.firewallCustomRule2,m2113:menu.mapping.firewallCustomRule3,m22:menu.mapping.dhcpdns,m23:menu.mapping.natpat,m24:menu.mapping.ntp,m25:menu.mapping.upnp,m26:menu.mapping.dmz,m27:menu.mapping.vpn,m271:menu.mapping.vpnSts,m272:menu.mapping.vpnNomade,m273:menu.mapping.vpnUser,m274:menu.mapping.vpnMail,m28:menu.mapping.dyndns,m29:menu.mapping.routing,m30:menu.mapping.network_meshLb,m31:menu.mapping.caiq}},m3:{url:menu.mapping.equipmentMenu,target:menu.mapping.content,defaultItem:"m30",items:{m30:{url:menu.mapping.subContainer,target:menu.mapping.subcontent,defaultItem:"m300",items:{m300:menu.mapping.liveboxEnvironment,m301:menu.mapping.restart,m302:menu.mapping.restartInProgress,m303:menu.mapping.reinitialisation,m308:menu.mapping.reinitialisationAP,m304:menu.mapping.update,m3041:menu.mapping.updateInProgress,m305:menu.mapping.save,m306:menu.mapping.restore,m307:menu.mapping.standby}},m31:{url:menu.mapping.subContainer,target:menu.mapping.subcontent,defaultItem:"m310",items:{m310:menu.mapping.userEquipment,m311:menu.mapping.customEquipmentEth,m312:menu.mapping.customEquipmentUsb,m313:menu.mapping.customEquipmentStd,m314:menu.mapping.restriction,m315:menu.mapping.customEquipmentTHD}},m32:menu.mapping.officeCustomization}},m4:{url:menu.mapping.diagnosticMenu,target:menu.mapping.content,defaultItem:"m40",items:{m40:{url:menu.mapping.subContainer,target:menu.mapping.subcontent,defaultItem:"m400",items:{m400:menu.mapping.infoSystem,m401:menu.mapping.infoSystemADSL,m402:menu.mapping.infoSystemVoIP,m403:menu.mapping.infoSystemTV,m404:menu.mapping.infoSystemWiFi,m405:menu.mapping.infoSystemLAN,m406:menu.mapping.infoSystemUSB,m407:menu.mapping.infoSystemMesh,m408:menu.mapping.infoSystemMeshSynchro,m409:menu.mapping.telephoneHD}},m41:menu.mapping.distantaccessservice,m42:{url:menu.mapping.subContainer,target:menu.mapping.subcontent,defaultItem:"m420",items:{m420:menu.mapping.basiclogs,m421:menu.mapping.advancedlogs}},m43:menu.mapping.ping}},m5:{url:menu.mapping.accountMenu,target:menu.mapping.content,defaultItem:"m50",items:{m50:menu.mapping.password,m51:menu.mapping.preferences,m52:menu.mapping.accountdistantAccess}}}};jQuery.orange.config.postInit=function(){$.ajaxSetup({cache:false});$("#header_container").orangeLoad(menu.mapping.header);$("#mainMenu").orangeLoad(menu.mapping.mainMenu,null,function(){$('#tabsMenu ul li:eq(0) a').addClass('menuitem-selected');});if($("#popups_container").children().size()==0)
$("#popups_container").orangeLoad(menu.mapping.popups);$("body").bind("vetoableMenuChange",function(event,targetMenuId,substitutions){if((!jQuery.orange.config.api.authorization.isConnected()||jQuery.orange.config.api.authorization.getLogin()=="guest")&&(targetMenuId.indexOf("m1")==0||targetMenuId.indexOf("m2")==0||targetMenuId.indexOf("m3")==0||targetMenuId.indexOf("m4")==0||targetMenuId.indexOf("m5")==0)){jQuery.orange.widget.MenuItem.veto=true;showAuthenticationPopup(targetMenuId,substitutions);}});$("body").live("submitted",function(event,error){var crudAction=undefined;if(event.liveFired.activeElement.attributes.crud!=undefined){crudAction=event.liveFired.activeElement.attributes['crud'].value;}else{var submitButtons=$("input[type='submit']",event.target);if(submitButtons.length==1){crudAction=submitButtons[0].attributes.crud;}}
if(!error&&!$(event.target).attr("autodisablebuttons")&&crudAction!=undefined&&crudAction!='read'){$('#saved_popup').orangeRead();$("#saved_popup").dialog('open');setTimeout("$('#saved_popup').dialog('close')",4000);}});$("input[namedregex], input[regex], input[required=true]").live("focus",function(event){if($!=undefined&&$.isFunction(this.hasFocus)){this.setFocus(true);}});$("input[namedregex], input[regex], input[required=true]").live("blur",function(event){console.log(event.currentTarget);if($!=undefined&&$.isFunction(this.hasFocus)){this.setFocus(false);jQuery.orange.widget.Form.verifyConstraints(this,true);}});};checkAuthNeeds=function(targetMenuId,substitutions){if((!jQuery.orange.config.api.authorization.isConnected()||jQuery.orange.config.api.authorization.getLogin()=="guest")&&(targetMenuId.indexOf("m1")==0||targetMenuId.indexOf("m2")==0||targetMenuId.indexOf("m3")==0||targetMenuId.indexOf("m4")==0||targetMenuId.indexOf("m5")==0)){showAuthenticationPopup(targetMenuId,substitutions);return true;}else{return false;}};showAuthenticationPopup=function(menuId,substitutions){targetMenuIdAfterLogin=menuId;targetSubstitutionsAfterLogin=substitutions;$("#authDialog").orangeLoad(menu.mapping.auth);$("#authDialog").dialog({autoOpen:true,modal:true,width:"410px",minHeight:"110px",open:function(){jQuery.orange.widget.Form.alignFormInputs.call($("#auth form")[0]);}});};showAuthentificationRemote=function(callback){$("#authDialog").load("html/main/authentificationRemote.html",function(){authentificationRemoteInit(callback);});$("#authDialog").dialog({autoOpen:true,modal:true,width:"410px",minHeight:"110px"});};jQuery.orange.config.onUnloadWithoutSubmit=function(callback){if(this.popupOnUnsubmitted===false){callback(true);return;}
var hasModif=false;$('#content form').each(function(){var state=jQuery.orange.widget.Form.getState.call(this);if(state==jQuery.orange.widget.Form.STATE_KO||state==jQuery.orange.widget.Form.STATE_MODIF_OK){hasModif=true;}});if(hasModif){var PopupStatus="Device/UserInterface/WebUI/PopupStatus";jQuery.orange.config.api.crud.read([PopupStatus],function(result){if(result[PopupStatus].values[PopupStatus]==true){openConfirmationPopup('popup.cancelmodif.title','popup.cancelmodif.text',function(){callback(true);},function(){callback(false);});}else{callback(true);}});}else{callback(true);}};jQuery.gui.api.Client.defaults.ajaxErrorFunc=function(error){return true;};jQuery.gui.api.Client.defaults.authenticationErrorFunc=function(error,reply){};jQuery.orange.config.i18n.baseurl="resources/i18n";jQuery.orange.config.i18n.language="fr";jQuery.orange.config.connectedmode=true;if(jQuery.orange.config.connectedmode){jQuery.orange.config.api.crud=apiCrudSagem;jQuery.orange.config.api.authorization=apiAuthorizationSagem;jQuery.orange.config.api.rpc=apiRPCSagem;}else{jQuery.orange.config.api.crud=apiCrudMock;jQuery.orange.config.api.authorization=apiAuthorizationMock;jQuery.orange.config.api.rpc=apiRPCMock;}
jQuery.orange.config.namedregex.integer="(-[1-9][0-9]*)|0|([1-9][0-9]*)";jQuery.orange.config.namedregex.positiveinteger="0|([1-9][0-9]*)";jQuery.orange.config.namedregex.negativeinteger="-[1-9][0-9]*";jQuery.orange.config.namedregex.positiveintegerlifeTime="[0-9]|[0-9][0-9]|[0-9][0-9][0-9]|[0-9][0-9][0-9][0-9]|[0-9][0-9][0-9][0-9][0-9]|[0-9][0-9][0-9][0-9][0-9][0-9]|[0-9][0-9][0-9][0-9][0-9][0-9][0-9]|[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]|[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]|[1-2][0-1][0-4][0-7][0-4][0-8][0-3][0-6][0-5][0-9]";jQuery.orange.config.namedregex["float"]="-?([0-9]+|[0-9]+\\.[0-9]+|[0-9]+\\.|\\.[0-9]+)";jQuery.orange.config.namedregex.positivefloat="([0-9]+|[0-9]+\\.[0-9]+|[0-9]+\\.|\\.[0-9]+)";jQuery.orange.config.namedregex.negativefloat="-([0-9]+|[0-9]+\\.[0-9]+|[0-9]+\\.|\\.[0-9]+)";jQuery.orange.config.namedregex.alpha="[a-zA-Z]+";jQuery.orange.config.namedregex.alphanum="[a-z0-9]+";jQuery.orange.config.namedregex.email="[a-zA-Z0-9\\._%\\-]+\\@([a-zA-Z0-9\\-]+\\.)+[a-zA-Z]{2,4}";jQuery.orange.config.namedregex.macaddress="[0-9a-fA-F][0-9a-fA-F]:[0-9a-fA-F][0-9a-fA-F]:[0-9a-fA-F][0-9a-fA-F]:[0-9a-fA-F][0-9a-fA-F]:[0-9a-fA-F][0-9a-fA-F]:[0-9a-fA-F][0-9a-fA-F]";jQuery.orange.config.namedregex.port="(6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3})";jQuery.orange.config.namedregex.portrange="(6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3})(-(6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3}))?";jQuery.orange.config.namedregex.ipaddress="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)";jQuery.orange.config.namedregex.nullableipaddress="()|((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))";jQuery.orange.config.namedregex.maskaddress="255\\.255\\.255\\.255|255\\.255\\.255\\.0|255\\.255\\.0\\.0|255\\.0\\.0\\.0|0\\.0\\.0\\.0";jQuery.orange.config.namedregex.strictmaskaddress="((128|192|224|240|248|252|254|255)\\.0\\.0\\.0)|(255\\.(128|192|224|240|248|252|254|255)\\.0\\.0)|(255\\.255\\.(128|192|224|240|248|252|254|255)\\.0)|(255\\.255\\.255\\.(128|192|224|240|248|252|254|255))";jQuery.orange.config.namedregex.firewallmaskaddress="(0\\.0\\.0\\.0)|((128|192|224|240|248|252|254|255)\\.0\\.0\\.0)|(255\\.(128|192|224|240|248|252|254|255)\\.0\\.0)|(255\\.255\\.(128|192|224|240|248|252|254|255)\\.0)|(255\\.255\\.255\\.(128|192|224|240|248|252|254))";jQuery.orange.config.namedregex.firewallmaskaddress2="(0\\.0\\.0\\.0)|((128|192|224|240|248|252|254|255)\\.0\\.0\\.0)|(255\\.(128|192|224|240|248|252|254|255)\\.0\\.0)|(255\\.255\\.(128|192|224|240|248|252|254|255)\\.0)|(255\\.255\\.255\\.(128|192|224|240|248|252|254|255))";function dataDateParse(text){if(text==undefined||text==""){text="0001-01-01T00:00:00Z";}
return new Date(parseInt(text.substr(0,4),10),parseInt(text.substr(5,2),10)-1,parseInt(text.substr(8,2),10),parseInt(text.substr(11,2),10),parseInt(text.substr(14,2),10),parseInt(text.substr(17,2),10));};jQuery.orange.widget.Table.oldMarkToDelete=jQuery.orange.widget.Table.markToDelete;jQuery.orange.widget.Table.NatPatIpAdress=false;jQuery.orange.widget.Table.markToDelete=function(tr){openConfirmationPopup('popup.confirm.title','popup.confirm.text',function(){$(tr).trigger("verifyNatPatIpAdress");if(!jQuery.orange.widget.Table.NatPatIpAdress){jQuery.orange.widget.Table.oldMarkToDelete(tr);}});};function createDeviceBloc(result,device){return $("<div class='device hidden'/>").append($("<div class='top'/>").append($("<span class='devicename'/>").attr("dataId",device+"/UserFriendlyName"))).append($("<div class='content'/>").append($("<div class='status'/>").attr("dataId",device+"/Active").attr("i18nPrefix","data.device.connectionstatus").bind('valueChange',function(event,newValue){var device=$(this).parent().parent();device.removeClass("disconnected");device.removeClass("hidden");$('.top>.removedevice',device).remove();if(newValue=='DISCONNECTED'&&$("#home")[0]!=undefined){device.addClass("disconnected");$('.top',device).append($('<span/>').attr('class','removedevice'));device.addClass("hidden");}else if(newValue=='DISCONNECTED'){device.addClass("disconnected");$('.top',device).append($('<span/>').attr('class','removedevice'));}})).append($("<div class='icon'/>")).append($("<div class='infos'/>"))).append($("<div class='bottom'/>"));}
function showDevice(element,deviceClass,Xpath,box,type,status,location){if(box!='ALL'){Xpath=Xpath+"[Peer='"+box+"']";}
jQuery.orange.config.api.crud.read([Xpath],function(result){if(result[Xpath]!=undefined){var device;for(device in result[Xpath].values){if(((type=="ALL"||result[Xpath].values[device]["DeviceType"]==type)&&(status=="ALL"||result[Xpath].values[device]["Active"]==status)&&(location=="ALL"||result[Xpath].values[device]["Location"]==location))&&(result[Xpath].values[device]["Hide"]==false)){var XpathRouter;if(result[Xpath].values[device]["Peer"]=='GWC'){XpathRouter="Device/DeviceInfo";}else{XpathRouter="Device/MESH/AccessPoints/AccessPoint[Alias='"+result[Xpath].values[device]["Peer"]+"']/DeviceInfo";}
var bloc=createDeviceBloc(result,device);$(element).append(bloc);var jBloc=$(bloc);jBloc.addClass(deviceClass);if(result[Xpath].values[device]["Active"]=="DISCONNECTED"){jBloc.addClass('disconnected');var span=$('<span/>');span.attr('class','removedevice');span.attr('xpathid',device);$('.top',bloc).append(span);}
if(result[Xpath].values[device]["Icon"]!=''&&result[Xpath].values[device]["Icon"]!=null&&result[Xpath].values[device]["Icon"]!=undefined){$('.icon',bloc).append($('<img/>').attr('src',result[Xpath].values[device]["Icon"]));}else{if(device.indexOf("USBDevice")!=-1){$('.icon',bloc).append($('<img/>').attr('src','theme/webCorporate/image/device/usb.png'));}else if(device.indexOf("StorageDrive")!=-1){$('.icon',bloc).append($('<img/>').attr('src','theme/webCorporate/image/device/usb.png'));}else{$('.icon',bloc).append($('<img/>').attr('src','theme/webCorporate/image/device/default.png'));}}
var li;if(deviceClass=="eth")
li=$('<li class="last">').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m311", subst: {i18n_title: "page.myEquipments.customEquipmentEth.title" ,i18n_subtilte: "page.myEquipments.customEquipmentEth.subtitle", XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'", CONNECTIONTYPE: "page.myEquipments.customEquipmentEth.connection.ethernet"}}').attr('i18n','popup.device.config'));else if(deviceClass=="wifi")
li=$('<li class="last">').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m311", subst: {i18n_title: "page.myEquipments.customEquipmentWiFi.title" , i18n_subtilte: "page.myEquipments.customEquipmentWiFi.subtitle" , XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'", CONNECTIONTYPE: "page.myEquipments.customEquipmentEth.connection.wifi"}}').attr('i18n','popup.device.config'));else if(deviceClass=="usb"){if(Xpath.indexOf("StorageDrive")>0){li=$('<li class="last">').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m312", subst: {XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'"}}').attr('i18n','popup.device.config'));}
else if(Xpath.indexOf("USBDevice")>0||Xpath.indexOf("LivePhone")>0){li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m313", subst: {XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'"}}').attr('i18n','popup.device.config'));}}
if(li!=undefined)
$('.icon',bloc).append($('<div class="popup leftMenu"/>').append($('<ul>').append(li)));if(Xpath.indexOf("LivePhone")==-1){var jInfos=$('.infos',bloc);if(Xpath.indexOf("USBDevice")>0){}else if(Xpath.indexOf("StorageDrive")>0){jInfos.append($('<span/>').attr('i18n','device.size'));jInfos.append('&#160;');jInfos.append($('<span class="totalspace"/>'));jInfos.append('<div class="usedspace" widgetType="ProgressBar"></div>');}else{jInfos.append($('<span/>').attr('i18n','device.ip'));jInfos.append('&#160;');jInfos.append($('<span/>').attr('dataId',device+'/IPAddress'));}}
jBloc.orangeParse().orangeRead();if(Xpath.indexOf("StorageDrive")>0){var Volume=device+"/Volumes/Volume";jQuery.orange.config.api.crud.read([Volume],function(result){var Capacity=0;var UsedSpace=0;for(var vol in result[Volume].values){Capacity+=result[Volume].values[vol]['Capacity'];UsedSpace+=result[Volume].values[vol]['UsedSpace'];}
$('.infos .totalspace',bloc).html(Capacity);var jUsedspace=$('.infos .usedspace',bloc);jUsedspace[0].setDataValue(Math.round((UsedSpace/Capacity)*100));$('.progressbar-text',jUsedspace[0]).append('%');});}}}}});}
function showHiddenDevice(element,deviceClass,Xpath,box,type,status,location){if(box!='ALL'){Xpath=Xpath+"[Peer='"+box+"']";}
jQuery.orange.config.api.crud.read([Xpath],function(result){if(result[Xpath]!=undefined){var device;for(device in result[Xpath].values){if((result[Xpath].values[device]["Hide"]==true)&&(status=="ALL"||result[Xpath].values[device]["Active"]==status)&&(location=="ALL"||result[Xpath].values[device]["Location"]==location)){var XpathRouter;if(result[Xpath].values[device]["Peer"]=='GWC')
XpathRouter="Device/DeviceInfo";else
XpathRouter="Device/MESH/AccessPoints/AccessPoint[Alias='"+result[Xpath].values[device]["Peer"]+"']/DeviceInfo";var bloc=createDeviceBloc(result,device);$(element).append(bloc);var jBloc=$(bloc);jBloc.addClass(deviceClass);if(result[Xpath].values[device]["Active"]=="DISCONNECTED"){jBloc.addClass('disconnected');$('.top',bloc).append($('<span/>').attr('class','removedevice'));}
if(result[Xpath].values[device]["Icon"]!=''&&result[Xpath].values[device]["Icon"]!=null&&result[Xpath].values[device]["Icon"]!=undefined){$('.icon',bloc).append($('<img/>').attr('src',result[Xpath].values[device]["Icon"]));}else{$('.icon',bloc).append($('<img/>').attr('src','theme/webCorporate/image/device/default.png'));}
var li;if(deviceClass=="eth")
li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m311", subst: {i18n_title: "page.myEquipments.customEquipmentEth.title", XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'", CONNECTIONTYPE: "page.myEquipments.customEquipmentEth.connection.ethernet"}}').attr('i18n','popup.device.config'));else if(deviceClass=="wifi")
li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m311", subst: {i18n_title: "page.myEquipments.customEquipmentWiFi.title", XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'", CONNECTIONTYPE: "page.myEquipments.customEquipmentEth.connection.wifi"}}').attr('i18n','popup.device.config'));else if(deviceClass=="usb"){if(Xpath.indexOf("StorageDrive")>0){li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m312", subst: {XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'"}}').attr('i18n','popup.device.config'));}
else if(Xpath.indexOf("USBDevice")>0||Xpath.indexOf("LivePhone")>0){li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m313", subst: {XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'"}}').attr('i18n','popup.device.config'));}}
if(li!=undefined)
$('.icon',bloc).append($('<div class="popup leftMenu"/>').append($('<ul>').append(li)));if(Xpath.indexOf("LivePhone")==-1){var jInfos=$('.infos',bloc);if(Xpath.indexOf("USBDevice")>0){jInfos.append($('<span/>').attr('i18n','device.url'));jInfos.append('&#160;');jInfos.append($('<span/>').attr('dataId',device+'/IPAddress'));}else if(Xpath.indexOf("StorageDrive")>0){jInfos.append($('<span/>').attr('i18n','device.size'));jInfos.append('&#160;');jInfos.append($('<span class="totalspace"/>'));jInfos.append('<div class="usedspace" widgetType="ProgressBar"></div>');}else{jInfos.append($('<span/>').attr('i18n','device.ip'));jInfos.append('&#160;');jInfos.append($('<span/>').attr('dataId',device+'/IPAddress'));}}
jBloc.orangeParse().orangeRead();if(Xpath.indexOf("StorageDrive")>0){var Volume=device+"/Volumes/Volume";jQuery.orange.config.api.crud.read([Volume],function(result){var Capacity=0;var UsedSpace=0;for(var vol in result[Volume].values){Capacity+=result[Volume].values[vol]['Capacity'];UsedSpace+=result[Volume].values[vol]['UsedSpace'];}
$('.infos .totalspace',bloc).html(Capacity);var jUsedspace=$('.infos .usedspace',bloc);jUsedspace[0].setDataValue(Math.round((UsedSpace/Capacity)*100));$('.progressbar-text',jUsedspace[0]).append('%');});}}}}});}
function showBlacklistedDevice(element,deviceClass,Xpath,box,type,status,location){if(box!='ALL'){Xpath=Xpath+"[Peer='"+box+"']";}
jQuery.orange.config.api.crud.read([Xpath],function(result){if(result[Xpath]!=undefined){var device;for(device in result[Xpath].values){if((result[Xpath].values[device]["BlackListedLAN"]==true)&&(status=="ALL"||result[Xpath].values[device]["Active"]==status)&&(location=="ALL"||result[Xpath].values[device]["Location"]==location)){var XpathRouter;if(result[Xpath].values[device]["Peer"]=='GWC')
XpathRouter="Device/DeviceInfo";else
XpathRouter="Device/MESH/AccessPoints/AccessPoint[Alias='"+result[Xpath].values[device]["Peer"]+"']/DeviceInfo";var bloc=createDeviceBloc(result,device);$(element).append(bloc);var jBloc=$(bloc);jBloc.addClass(deviceClass);if(result[Xpath].values[device]["Active"]=="DISCONNECTED"){jBloc.addClass('disconnected');$('.top',bloc).append($('<span/>').attr('class','removedevice'));}
if(result[Xpath].values[device]["Icon"]!=''&&result[Xpath].values[device]["Icon"]!=null&&result[Xpath].values[device]["Icon"]!=undefined){$('.icon',bloc).append($('<img/>').attr('src',result[Xpath].values[device]["Icon"]));}else{$('.icon',bloc).append($('<img/>').attr('src','theme/webCorporate/image/device/default.png'));}
var li;if(deviceClass=="eth")
li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m311", subst: {i18n_title: "page.myEquipments.customEquipmentEth.title", XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'", CONNECTIONTYPE: "page.myEquipments.customEquipmentEth.connection.ethernet"}}').attr('i18n','popup.device.config'));else if(deviceClass=="wifi")
li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m311", subst: {i18n_title: "page.myEquipments.customEquipmentWiFi.title", XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'", CONNECTIONTYPE: "page.myEquipments.customEquipmentEth.connection.wifi"}}').attr('i18n','popup.device.config'));else if(deviceClass=="usb"){if(Xpath.indexOf("StorageDrive")>0){li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m312", subst: {XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'"}}').attr('i18n','popup.device.config'));}
else if(Xpath.indexOf("USBDevice")>0||Xpath.indexOf("LivePhone")>0){li=$('<li>').append($('<a href="javascript:;" widgetType="MenuItem"/>').attr('widgetArg','{menu: "m3.m31.m313", subst: {XpathRouter: "'
+XpathRouter+'", XpathDevice: "'+device+'"}}').attr('i18n','popup.device.config'));}}
if(li!=undefined)
$('.icon',bloc).append($('<div class="popup leftMenu"/>').append($('<ul>').append(li)));if(Xpath.indexOf("LivePhone")==-1){var jInfos=$('.infos',bloc);if(Xpath.indexOf("USBDevice")>0){jInfos.append($('<span/>').attr('i18n','device.url'));jInfos.append('&#160;');jInfos.append($('<span/>').attr('dataId',device+'/IPAddress'));}else if(Xpath.indexOf("StorageDrive")>0){jInfos.append($('<span/>').attr('i18n','device.size'));jInfos.append('&#160;');jInfos.append($('<span class="totalspace"/>'));jInfos.append('<div class="usedspace" widgetType="ProgressBar"></div>');}else{jInfos.append($('<span/>').attr('i18n','device.ip'));jInfos.append('&#160;');jInfos.append($('<span/>').attr('dataId',device+'/IPAddress'));}}
jBloc.orangeParse().orangeRead();if(Xpath.indexOf("StorageDrive")>0){var Volume=device+"/Volumes/Volume";jQuery.orange.config.api.crud.read([Volume],function(result){var Capacity=0;var UsedSpace=0;for(var vol in result[Volume].values){Capacity+=result[Volume].values[vol]['Capacity'];UsedSpace+=result[Volume].values[vol]['UsedSpace'];}
$('.infos .totalspace',bloc).html(Capacity);var jUsedspace=$('.infos .usedspace',bloc);jUsedspace[0].setDataValue(Math.round((UsedSpace/Capacity)*100));$('.progressbar-text',jUsedspace[0]).append('%');});}}}}});}
function grayDisabledOptionsIE7(id){$('#'+id+' option').css({'color':'black'});$('#'+id+' option[disabled]').css({'color':'#ACB8AD'});$('#'+id+' select').change(function(){if(this.options[this.selectedIndex].disabled){if(this.options.length==0){this.selectedIndex=-1;}else{if(this.selectedIndex-1<=0){this.selectedIndex++;}else{this.selectedIndex--;}}
$(this).trigger('change');}});}
function ValidateChecksum(inPIN){var accum=0;var PIN=parseInt(parseFloat(inPIN));accum+=3*(parseInt((PIN/10000000))%10);accum+=(parseInt((PIN/1000000))%10);accum+=3*(parseInt((PIN/100000))%10);accum+=(parseInt((PIN/10000))%10);accum+=3*(parseInt((PIN/1000))%10);accum+=(parseInt((PIN/100))%10);accum+=3*(parseInt((PIN/10))%10);accum+=parseInt((PIN%10));return(0==(accum%10));}
function arrayIndexOf2(array,element){for(var i in array){if(array[i][0]==element[0]){return i;}}
return-1;}
function showRebootPage(boxName){var rebootPage='';rebootPage+='<div id="restartInProgress" xmlns="http://www.orange.com/xhtml/engine/loose">';rebootPage+='<div class="boxType3">';rebootPage+='<h1 class="logo_EnvLiveBox">';rebootPage+='<span i18n="page.myEquipments.restart.title"/>&#160;<span >'+boxName+'</span>';rebootPage+='</h1>';rebootPage+='<div class="margin-left-40 margin-top-m8">';rebootPage+='<strong i18n="page.myEquipments.restart.subtitle"/>';rebootPage+='</div>';rebootPage+='</div>';rebootPage+='<div class="maindiv">';rebootPage+='<div class="boxType4 margin-top-10  border-bottom-3">';rebootPage+='<form>';rebootPage+='<span class="h3Text" i18n="page.myEquipments.restartinprogress.reboot"/>';rebootPage+='<div i18n="page.myEquipments.restartinprogress.reboot.label"/>';rebootPage+='</form>';rebootPage+='<div class="centered">';rebootPage+='<span class="waitLabel oneline" i18n="page.myEquipments.restartinprogress.reboot.wait"/>';rebootPage+='</div>';rebootPage+='<div widgetType="RunnerBar" widgetArg="{duration:3000, width:500, height:17}"/>';rebootPage+='</div>';rebootPage+='</div">';rebootPage+='</div>';$("#content").empty();$("#content").append(rebootPage);$("#content").orangeParse();var timer=setInterval(tryToShowRebootPage,10000);function tryToShowRebootPage(){var connectionStatus="Device/Networks/WAN[@uid='3']/ConnectionStatus";jQuery.orange.config.api.crud.read([connectionStatus],function(result){if(result!=undefined){var pathname="/";var pathnameElements=window.location.pathname.split('/');for(var i=1;i<pathnameElements.length;i++){if(pathnameElements[i]=="gui"){pathname+="gui/index.html";break;}
pathname+=pathnameElements[i]+"/";}
window.location=window.location.protocol+"//"+window.location.host
+((window.location.port==null)?":"+window.location.port:"")+pathname;window.clearInterval(timer);}});}}
function waitForRebootAndReload(){var NO_REBOOT="NO_REBOOT";var REBOOTING="REBOOTING";var REBOOT_DONE="REBOOT_DONE";var state=NO_REBOOT;var onePoll=function(){$.ajax("version.txt",{async:true,cache:false,complete:function(jqXHR,textStatus){if(textStatus=="success"){if(state==NO_REBOOT){onePoll();}else if(state==REBOOTING){state=REBOOT_DONE;window.location.reload();}}else if(textStatus=="timeout"||textStatus=="error"){if(state==NO_REBOOT){state=REBOOTING;onePoll();}else if(state==REBOOTING){onePoll();}}},global:false,timeout:5000});};onePoll();}
function onRebootStart(action){var pollingPeriod=2000;var lastAliveTime=new Date().getTime();onRebootStart.poll=function(){$.ajax("version.txt",{async:true,cache:false,complete:function(jqXHR,textStatus){if(textStatus=="success"){lastAliveTime=new Date().getTime();setTimeout("onRebootStart.poll()",pollingPeriod);}else if(textStatus=="timeout"||textStatus=="error"){var now=new Date().getTime();if((now-lastAliveTime)>10*1000){action();}else{onRebootStart.poll();}}},global:false,timeout:pollingPeriod});};onRebootStart.poll();}
function onRebootDone(action){var pollingPeriod=2000;var firstAliveTime=undefined;onRebootDone.poll=function(){$.ajax("version.txt",{async:true,cache:false,complete:function(jqXHR,textStatus){if(textStatus=="success"){if(firstAliveTime==undefined){firstAliveTime=new Date().getTime();setTimeout("onRebootDone.poll()",pollingPeriod);}else{var now=new Date().getTime();if((now-firstAliveTime)>10*1000){action();}else{setTimeout("onRebootDone.poll()",pollingPeriod);}}}else if(textStatus=="timeout"||textStatus=="error"){firstAliveTime=undefined;onRebootDone.poll();}},global:false,timeout:pollingPeriod});};onRebootDone.poll();}
function openConfirmationPopup(i18nTitle,i18nText,yesCallback,noCallback){$("#confirmation_popup h1").attr('i18n',i18nTitle);$("#confirmation_popup .text").attr('i18n',i18nText);$('#confirmation_popup').orangeParse();$("#confirmation_popup").orangeTranslate();$("#confirmation_popup").dialog('open');$("#confirmation_popup #yes").unbind('activateButton');$("#confirmation_popup #yes").bind('activateButton',function(event){$("#confirmation_popup").dialog('close');if(yesCallback!=undefined)
yesCallback();});$("#confirmation_popup #no").unbind('activateButton');$("#confirmation_popup #no").bind('activateButton',function(event){$("#confirmation_popup").dialog('close');if(noCallback!=undefined)
noCallback();});}
function openErrorPopup(i18nTitle,i18nText){if(i18nTitle==undefined){i18nTitle='popup.systemerror.title';}
if(i18nText==undefined){i18nText='popup.systemerror.text';}
$("#error_popup h1").attr('i18n',i18nTitle);$("#error_popup .text").attr('i18n',i18nText);$('#error_popup').orangeParse();$("#error_popup").orangeTranslate();$("#error_popup").dialog('open');$("#error_popup #ok").unbind('click');$("#error_popup #ok").click(function(){$("#error_popup").dialog('close');$("#error_popup").trigger("closePopup");});}
function openHelpPopup(){$('#help_popup').orangeParse();$("#help_popup").orangeTranslate();$("#help_popup").dialog('open');$("#help_popup > a.close").unbind('click');$("#help_popup > a.close").click(function(){$("#help_popup").dialog('close');});}
function helpPopup(url){newwindowJquery=window.open(url,'name1','height=600 ,width=600 , left=70, scrollbars=1');if(window.focus){newwindowJquery.focus();};}
function stringToIP32(stringIP){var arrayIP=stringIP.split('.');var result=new Number(0);for(var i=0;i<4;i++){result=result*256;result+=new Number(arrayIP[i]);}
return result;}
function ip32ToString(ip32){var result="";for(var i=3;i>=0;i--){var value=(ip32>>(i*8));value=value&0xFF;result+=value;if(i!=0){result+=".";}}
return result;}
function header_displayPopup(callback){var hasModif=false;$('#content form').each(function(){if(this.modifsOK.length>0||this.dataKO.length>0){hasModif=true;}});if(hasModif){var PopupStatus="Device/UserInterface/WebUI/PopupStatus";jQuery.orange.config.api.crud.read([PopupStatus],function(result){if(result[PopupStatus].values[PopupStatus]==true){openConfirmationPopup('popup.cancelmodif.title','popup.cancelmodif.text',function(){$('#content')[0].popupOnUnsubmitted=false;callback();$('#content')[0].popupOnUnsubmitted=true;},function(){$("#levelSelector")[0].setDataValue('expert');});}else{callback();}});}
else{callback();}}
jQuery.orange.config.areacontent.header={postParse:function(){$("#headerLogo").bind('click',function(){if(jQuery.orange.widget.MenuItem.current!=undefined)
jQuery.orange.widget.MenuItem.setCurrent('m0');});$("#icoHelp").attr('title',jQuery.orange.config.i18n.map['data.help.standard']);$("#levelSelector")[0].setDataValue('standard');$("#levelSelector").bind("change",function(event,newvalue){if(newvalue=="standard"){if(jQuery.orange.widget.MenuItem.current in{"m2.m22":1,"m2.m23":1,"m2.m24":1,"m2.m25":1,"m2.m26":1,"m2.m27":1,"m2.m28":1,"m2.m29":1,"m2.m30":1}){header_displayPopup(function(){jQuery.orange.widget.MenuItem.setCurrent('m2.m20');});}
else if(jQuery.orange.widget.MenuItem.current=="m3.m32"){header_displayPopup(function(){jQuery.orange.widget.MenuItem.setCurrent('m3.m30');});}
else if(jQuery.orange.widget.MenuItem.current in{"m4.m42":1,"m4.m42.m420":1,"m4.m42.m421":1,"m4.m43":1,"m4.m44":1}){header_displayPopup(function(){jQuery.orange.widget.MenuItem.setCurrent('m4.m40');});}
else if(jQuery.orange.widget.MenuItem.current=="m5.m52"){header_displayPopup(function(){jQuery.orange.widget.MenuItem.setCurrent('m5.m50');});}}
if(newvalue!="standard"){$("#icoHelp").attr('title',jQuery.orange.config.i18n.map['data.help.avance']);}else{$("#icoHelp").attr('title',jQuery.orange.config.i18n.map['data.help.standard']);}});if((!jQuery.orange.config.api.authorization.isConnected())||jQuery.orange.config.api.authorization.userlogin=='guest'){$('#isConnected').hide();}
$("#langSelector").bind("change",function(event,newvalue){if(newvalue!=undefined){jQuery.orange.config.i18n.language=newvalue;jQuery.orange.init.i18n.load(function(){try{$("HTML").attr("lang",newvalue);}catch(err){}});}});$("#preloadRunnerBar").hide();var meshEnabled="Device/MESH/Enable";jQuery.orange.config.api.crud.read([meshEnabled],function(result){if(result["Device/MESH/Enable"].values["Device/MESH/Enable"]==true){$("#meshEnabled").val("true");}
else{$("#meshEnabled").val("false");}});if(window.location.protocol=="https:"){$("#menuserviceinternet").val("false");}
else{$("#menuserviceinternet").val("true");}},postLoad:function(){$("#langSelector").children()[0].setAttribute('id',$("#langSelector").attr("id")+"select");$("#levelSelector").children()[0].setAttribute('id',$("#levelSelector").attr("id")+"select");}};jQuery.orange.config.areacontent.footer={preParse:function(){try{fr.orange.livebox.gui.pages.engine.FooterPresenter.initWidget();}catch(err){}},postLoad:function(){$("#sitemap").dialog({autoOpen:false,modal:true,width:"550px",minHeight:"110px",open:function(){$('.close').blur();}});$("#legalinfo").dialog({autoOpen:false,modal:true,width:"650px",open:function(){$('.close').blur();}});$("#contact").dialog({autoOpen:false,modal:true,width:"255px",minHeight:"110px",open:function(){$('.close').blur();}});$("#recommandations").dialog({autoOpen:false,modal:true,width:"450px",minHeight:"200px",open:function(){$('.close').blur();}});$("#recommandations>a.close").bind("click",function(){$("#recommandations").dialog('close');});$("#contact>a.close").bind("click",function(){$("#contact").dialog('close');});$("#legalinfo>a.close").bind("click",function(){$("#legalinfo").dialog('close');});$("#sitemap a").bind("click",function(){$("#sitemap").dialog('close');});if(window.location.protocol!="https:"){$("#menuserviceinternet").hide();}
else{$("#menuserviceinternet").show();}},loadAdvancedMenu:function(menuid,substitutions,callback){openConfirmationPopup('popup.goExpert.title','popup.goExpert.text',function(){callback(menuid,substitutions);},function(){$('#sitemap').dialog('open');});}};function popups_crudCallback(result){$("#saved_popup").dialog('open');setTimeout("$('#saved_popup').dialog('close')",1000);}
jQuery.orange.config.areacontent.popups={postLoad:function(){$("#cm_abs").dialog({autoOpen:false,modal:true,width:"310px",minHeight:"110px"});$("#cm_abs #cm_abs_btnOk").bind("click",function(){$("#cm_abs").dialog('close');});$("#cm_removed").dialog({autoOpen:false,modal:true,width:"310px",minHeight:"110px"});$("#cm_removed #cm_removed_btnOk").bind("click",function(){$("#cm_removed").dialog('close');});$("#saved_popup").dialog({autoOpen:false,modal:false,width:"350px",minHeight:"110px"});$("#confirmation_popup").dialog({autoOpen:false,modal:true,width:"405px",minHeight:"225px",open:function(){$('#no img').blur();}});$("#error_popup").dialog({autoOpen:false,modal:true,width:"405px",minHeight:"225px",open:function(){$('#ok img').blur();}});}};function installation_reinstall_setEnabled(enabled){if(enabled){$(".reinstallstart.installbutton>img.puce_arrow").attr('src','theme/webCorporate/image/installation/puce_arrow.gif');$(".reinstallstart").bind('click',function(){$("#global").orangeLoad(menu.mapping.reinstallation_step_1);});$(".reinstallstart.installbutton").removeClass('disabled');$(".reinstallstart.installlink").removeClass('disabled');}else{$(".reinstallstart.installbutton>img.puce_arrow").attr('src','theme/webCorporate/image/installation/puce_arrow_off.gif');$(".reinstallstart.installbutton").addClass('disabled');$(".reinstallstart").unbind('click');$(".reinstallstart.installlink").addClass('disabled');}}
jQuery.orange.config.areacontent.installation={preParse:function(){installation_toggleDisplay(false);},postParse:function(area){},postLoad:function(area){$(".myInfo").simpletooltip({showEffect:"fadeIn",hideEffect:"fadeOut"});$(".installstart").bind('click',function(){$("#global").orangeLoad(menu.mapping.installation_step_1);});if($("#memoryCardStatus").val()=='VALID_LOCK'){installation_reinstall_setEnabled(true);}else{installation_reinstall_setEnabled(false);}
$("#memoryCardStatus").bind('change',function(event){var newValue=event.target.value;if(newValue=='VALID'){$("#global").orangeLoad(menu.mapping.reinstallation_step_2);}else if(newValue=='VALID_SECURE'){$("#global").orangeLoad(menu.mapping.reinstallation_step_2);}else if(newValue=='VALID_LOCK'){installation_reinstall_setEnabled(true);}else if(newValue=='CONF_VERSION_NOT_SUPPORTED'){$("#global").orangeLoad(menu.mapping.firmware_upgrade_inprogress);}else{installation_reinstall_setEnabled(false);}});}};jQuery.orange.config.areacontent.installation_step_1={postParse:function(area){$("#container").removeData('detectedStatus');},postLoad:function(){var dsl=$("#dslenable")[0].getDataValue();var ftth=$("#ftthenable")[0].getDataValue();if(dsl=="ENABLE"){$("input.conntype[value=ADSL]").attr('checked',true);}else{$("input.conntype[value=FTTH]").attr('checked',true);}
$(".conntype").bind('change',function(event){if(event.target.value=="ADSL"){$("#dslenable")[0].setDataValue("ENABLE");$("#ftthenable")[0].setDataValue("DISABLE");if($("#dslenable")[0].getDataValue()==$("#dslenable")[0].dataValueRef){$("#selectChangeWarning").css('display','none');}else{$("#selectChangeWarning").css('display','block');}}else if(event.target.value=="FTTH"){$("#dslenable")[0].setDataValue("DISABLE");$("#ftthenable")[0].setDataValue("ENABLE");if($("#ftthenable")[0].getDataValue()==$("#ftthenable")[0].dataValueRef){$("#selectChangeWarning").css('display','none');}else{$("#selectChangeWarning").css('display','block');}}});$("#jump2installation").bind('click',function(){jQuery.orange.config.api.authorization.login("guest","guest");$("#global").orangeLoad(menu.mapping.installation);});$("#jump2installation_step_2").bind('click',function(){var adslEnable="Device/Networks/WAN[@name='WAN']/WANPorts/DSL/Enable";var id2value={};id2value[adslEnable]=$("#dslenable2")[0].getDataValue();if((id2value[adslEnable]=="ENABLE"&&!$("#connOptions").children()[0].children.item(1).checked)||(id2value[adslEnable]=="DISABLE"&&$("#connOptions").children()[0].children.item(1).checked)){if($("#connOptions").children()[0].children.item(1).checked){id2value[adslEnable]="ENABLE";}
else{id2value[adslEnable]="DISABLE";}}
var ftthEnable="Device/Networks/WAN[@name='WAN']/WANPorts/FTTH/Enable";id2value[ftthEnable]=$("#ftthenable2")[0].getDataValue();if((id2value[ftthEnable]=="ENABLE"&&!$("#connOptions").children()[1].children.item(1).checked)||(id2value[ftthEnable]=="DISABLE"&&$("#connOptions").children()[1].children.item(1).checked)){if($("#connOptions").children()[1].children.item(1).checked){id2value[ftthEnable]="ENABLE";}
else{id2value[ftthEnable]="DISABLE";}
jQuery.orange.config.api.crud.update(id2value);}
if($("#selectChangeWarning").css('display')=='block'){$("#global").orangeLoad(menu.mapping.simplereboot_oninstall);}else{$("#global").orangeLoad(menu.mapping.installation_step_2);}});}};var authenticationFailed=false;jQuery.orange.config.areacontent.installation_step_2={preParse:function(){},postParse:function(area){$("#jump2installation_step_1").bind('click',function(){$("#global").orangeLoad(menu.mapping.installation_step_1);});var onClickNext=function(){var pppUser="Device/Networks/WAN[@name='WAN']/PPP/Username";var id2value={};var newInternalUsername=$("#username")[0].getDataValue();if(newInternalUsername.substring(0,4)!="fti/"){newInternalUsername="fti/"+newInternalUsername;}
id2value[pppUser]=newInternalUsername;jQuery.orange.config.api.crud.update(id2value);var pppPaswword="Device/Networks/WAN[@name='WAN']/PPP/Password";var id2value={};id2value[pppPaswword]=$("#password")[0].getDataValue();jQuery.orange.config.api.crud.update(id2value);$("#global").orangeLoad(menu.mapping.installation_step_3);};$("#letter_std").dialog({autoOpen:false,modal:true,minHeight:"586px",width:"681px",marginTop:"70px",marginBottom:"70px",border:"1px solid #F60",open:function(){$('.close').blur();}});$("#letter_link").bind("click",function(){$('#letter_std').dialog('open');});$("#letter_std a").bind("click",function(){$("#letter_std").dialog('close');});$("#username").add($("#password")).bind('change keyup',function(){var userlength=$("#username").val().length;if($("#username").val().substring(0,4)=="fti/"){userlength=userlength-4;}
if(userlength<4||userlength>64||$("#password input[type='password']").val().length<4||$("#password input[type='password']").val().length>29){$("#jump2installation_step_3").addClass("disabled");$("#jump2installation_step_3").unbind('click');$("#jump2installation_step_3 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');}else{$("#jump2installation_step_3").removeClass("disabled");$("#jump2installation_step_3").unbind('click');$("#jump2installation_step_3").bind('click',onClickNext);$("#jump2installation_step_3 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante.gif');}});if($("#container").data('detectedStatus')=="PPP_AUTHENTICATION_FAILED"){$("#ppperror").css('display','block');authenticationFailed=true;}
else{authenticationFailed=false;}},postLoad:function(area){if(authenticationFailed){$("#username").addClass('errorInput');$("#password").addClass('errorInput');}}};jQuery.orange.config.areacontent.installation_step_3={postParse:function(area){},postLoad:function(){$(".restest").bind('click',function(){$("#global").orangeLoad(menu.mapping.installation_step_2);});$(".stopinstall").bind('click',function(){jQuery.orange.config.api.authorization.login("guest","guest");installation_toggleDisplay(true);jQuery.orange.widget.MenuItem.setCurrent('m0');});var newStatusCheck=function(){var detectedStatus=$("#bdConnectionStatus")[0].getDataValue();$("#container").data('detectedStatus',detectedStatus);if(detectedStatus=="MODEM_CONNECTED"){$("#global").orangeLoad(menu.mapping.installation_step_4);}else if(detectedStatus=="PPP_AUTHENTICATION_FAILED"){$("#global").orangeLoad(menu.mapping.installation_step_2);}else{$("#global").orangeLoad(menu.mapping.installation_step_3_1);}};var timeoutId=window.setTimeout(newStatusCheck,15000);var t0=new Date().getTime();$("#bdConnectionStatus").bind('change',function(event,newValue){var dt=new Date().getTime()-t0;if(newValue=="MODEM_CONNECTED"||dt>15000){window.clearTimeout(timeoutId);newStatusCheck();}});}};jQuery.orange.config.areacontent.installation_step_3_1={postParse:function(area){},postLoad:function(){$(".restest").bind('click',function(){$("#global").orangeLoad(menu.mapping.installation_step_3);});$(".stopinstall").bind('click',function(){jQuery.orange.config.api.authorization.login("guest","guest");installation_toggleDisplay(true);jQuery.orange.widget.MenuItem.setCurrent('m0');});if($("#container").data('detectedStatus')=="ADSL_LINE_NOT_SYNCHRONISED"){$("#synchroerror").css('display','block');}else if($("#container").data('detectedStatus')=="BAS_NOT_REPLY"){$("#connerror").css('display','block');}else if($("#container").data('detectedStatus')=="ONT_DOWN"){$("#fibreerror").css('display','block');}}};jQuery.orange.config.areacontent.installation_step_4={postParse:function(area){},postLoad:function(){$(".myInfo").simpletooltip({showEffect:"fadeIn",hideEffect:"fadeOut"});$(".gohome").bind('click',function(){jQuery.orange.config.api.authorization.login("guest","guest");installation_toggleDisplay(true);jQuery.orange.widget.MenuItem.setCurrent('m0');});$(".gonet").bind('click',function(){window.location.href="http://www.pro.orange.fr";});$("#memoryCardStatus").bind('change',function(event){var newValue=event.target.value;if(newValue=='VALID'||newValue=='VALID_SECURE'||newValue=='VALID_LOCK'){$(".gosecure.installbutton>img.puce_arrow").attr('src','theme/webCorporate/image/installation/puce_arrow.gif');$(".gosecure").bind('click',function(){$("#global").orangeLoad(menu.mapping.securisation_step_1);});$(".gosecure.installbutton").removeClass('disabled');$(".gosecure.installlink").removeClass('disabled');}else{$(".gosecure.installbutton>img.puce_arrow").attr('src','theme/webCorporate/image/installation/puce_arrow_off.gif');$(".gosecure.installbutton").addClass('disabled');$(".gosecure").unbind('click');$(".gosecure.installlink").addClass('disabled');}});$("#memoryCardStatus").trigger('change');}};jQuery.orange.config.areacontent.securisation_step_1={postParse:function(area){},postLoad:function(){$(".myInfo").simpletooltip({showEffect:"fadeIn",hideEffect:"fadeOut"});$("#jump2installation_step_4").bind('click',function(){$("#global").orangeLoad(menu.mapping.installation_step_4);});var onClickNext=function(){var id2value={};var userlogin="admin";var XPassword="Device/UserAccounts/ManagedUsers/ManagedUser[Login='"+userlogin+"']/Password";var hashPass=jQuery.orange.config.api.client.hashPassword($("#newPassword")[0].getDataValue());id2value[XPassword]=hashPass;jQuery.orange.config.api.crud.update(id2value);$("#global").orangeLoad(menu.mapping.securisation_step_2);};var validationDisable=function(){$("#jump2securisation_step_2").addClass("disabled");$("#jump2securisation_step_2").unbind('click');$("#jump2securisation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');};var validationEnable=function(){$("#jump2securisation_step_2").removeClass("disabled");$("#jump2securisation_step_2").unbind('click');$("#jump2securisation_step_2").bind('click',onClickNext);$("#jump2securisation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante.gif');};var password_checkCurrent=function(hasFocus){var oldHashPassword=jQuery.orange.config.api.client.getPassword();var password=$("#oldPassword input[type='password']").val();var hashPassword=jQuery.orange.config.api.client.hashPassword(password);var isCorrect=hashPassword==oldHashPassword;if(hasFocus!=undefined){if(isCorrect||hasFocus||password==""){$("#errorcurrent").hide();$("#oldPassword").removeClass('errorInput');}else{$("#errorcurrent").show();$("#oldPassword").addClass('errorInput');}}
return isCorrect;};var password_checkNew=function(hasFocus){var newpasswordValue=$("#newPassword input[type='password']").val();var isCorrect=newpasswordValue!=""&&4<=newpasswordValue.length&&newpasswordValue.length<=32;if(hasFocus!=undefined){if(isCorrect||newpasswordValue==""){$("#newPassword").removeClass('errorInput');$("#erroronsize").hide();}else{if(hasFocus&&newpasswordValue.length<4){}else{$("#newPassword").addClass('errorInput');$("#erroronsize").show();}}}
return isCorrect;};var password_checkConfirm=function(hasFocus){var newpasswordValue=$("#newPassword input[type='password']").val();var confirmValue=$("#confirmPassword input[type='password']").val();var isCorrect=(newpasswordValue==confirmValue);if(hasFocus!=undefined){if(isCorrect||confirmValue==""||newpasswordValue==""||hasFocus&&newpasswordValue.startsWith(confirmValue)){$("#erroronsamepass").hide();$("#confirmPassword").removeClass('errorInput');}else{$("#erroronsamepass").show();$("#confirmPassword").addClass('errorInput');}}
return isCorrect;};var password_enableDisableWigets=function(){var allCorrect=password_checkCurrent()&&password_checkNew()&&password_checkConfirm();if(allCorrect){validationEnable();}else{validationDisable();}};$("#oldPassword input[type='text']").bind("blur",function(){password_checkCurrent(false);});$("#oldPassword").bind('change keyup',function(){password_checkCurrent(true);password_enableDisableWigets();});$("#newPassword").bind('keyup',function(){password_checkNew(true);password_checkConfirm(true);password_enableDisableWigets();});$("#newPassword input[type='text']").bind('blur',function(event){password_checkNew(false);});$("#confirmPassword").bind('keyup',function(){password_checkConfirm(true);password_enableDisableWigets();});$("#confirmPassword input[type='text']").bind('blur',function(){password_checkConfirm(false);});$("#oldPassword input[type='text']").bind('focus',function(){password_checkConfirm(false);});customizeInstallForm();}};jQuery.orange.config.areacontent.securisation_step_2={postParse:function(area){},postLoad:function(){$(".myInfo").simpletooltip({showEffect:"fadeIn",hideEffect:"fadeOut"});try{var XsecretQuery="Device/UserAccounts/ManagedUsers/ManagedUser[Login=\'"+jQuery.orange.config.api.client.user+"\']/SecretQuery";if($("#sQuery")[0].dataValueRef==""){var id2value={};id2value[XsecretQuery]=jQuery.orange.config.i18n.map["page.myAccount.password.secretquery.defaultcontent"];jQuery.orange.config.api.crud.update(id2value);}}catch(err){}
$("#jump2securisation_step_1").bind('click',function(){$("#global").orangeLoad(menu.mapping.securisation_step_1);});var onClickNext=function(){var id2value={};var userlogin=$("#userlogin")[0].getDataValue();var XsAnswer="Device/UserAccounts/ManagedUsers/ManagedUser[Login='"+userlogin+"']/SecretAnswer";var sAnswer=$("#sAnswer")[0].getDataValue();id2value[XsAnswer]=sAnswer;jQuery.orange.config.api.crud.update(id2value);$("#global").orangeLoad(menu.mapping.securisation_step_3);};$("#sAnswer").bind('keyup blur',function(event){$("#emptySecretAnswer").hide();$("#sAnswer").removeClass('errorInput');$("#jump2securisation_step_3").removeClass("disabled");$("#jump2securisation_step_3").unbind('click');$("#jump2securisation_step_3").bind('click',onClickNext);$("#jump2securisation_step_3 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante.gif');if(event.type="blur"&&$("#sAnswer")[0].getDataValue()==""){$("#emptySecretAnswer").show();$("#sAnswer").addClass('errorInput');$("#jump2securisation_step_3").addClass("disabled");$("#jump2securisation_step_3").unbind('click');$("#jump2securisation_step_3 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');}});customizeInstallForm();}};jQuery.orange.config.areacontent.securisation_step_3={postParse:function(area){},postLoad:function(){$(".myInfo").simpletooltip({showEffect:"fadeIn",hideEffect:"fadeOut"});$(".gohome").bind('click',function(){jQuery.orange.config.api.authorization.login("guest","guest");installation_toggleDisplay(true);jQuery.orange.widget.MenuItem.setCurrent('m0');});$(".gonet").bind('click',function(){window.location.href="http://www.pro.orange.fr";});}};jQuery.orange.config.areacontent.reinstallation_step_1={preParse:function(){},postLoad:function(){$(".myInfo").simpletooltip({showEffect:"fadeIn",hideEffect:"fadeOut"});var passStatus=false;$("#jump2installation").bind('click',function(){$("#global").orangeLoad(menu.mapping.installation);});var onClickNext=function(){var password=$("#uPassword")[0].getDataValue();$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');jQuery.orange.config.api.rpc.unlockWithPassword(password,function(successful){if(successful){$("#global").orangeLoad(menu.mapping.reinstallation_step_2);}else{$("#erroronpasswordp1").show();$("#erroronpasswordp2").show();$("#uPassword").addClass('errorInput');}});};$("#passforget").bind('click',function(){$("#global").orangeLoad(menu.mapping.reinstallation_step_1_1);});$("#uPassword input[type='text']").bind("keyup blur",function(event){$("#erroronpasswordp1").hide();$("#erroronpasswordp2").hide();$("#uPassword").removeClass('errorInput');$("#jump2reinstallation_step_2").removeClass("disabled");$("#jump2reinstallation_step_2").unbind('click');$("#jump2reinstallation_step_2").bind('click',onClickNext);$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante.gif');passStatus=true;if(event.target.getDataValue().length>32){$("#erroronpasswordp1").show();$("#erroronpasswordp2").show();$("#uPassword").addClass('errorInput');$("#jump2reinstallation_step_2").addClass("disabled");$("#jump2reinstallation_step_2").unbind('click');$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');passStatus=false;}else if(event.target.getDataValue().length<4){if(event.type=="blur"){$("#erroronpasswordp1").show();$("#erroronpasswordp2").show();$("#uPassword").addClass('errorInput');}
$("#jump2reinstallation_step_2").addClass("disabled");$("#jump2reinstallation_step_2").unbind('click');$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');passStatus=false;}});$("#memoryCardStatus").bind('change',function(){$("#erroronpasswordp1").hide();$("#erroronpasswordp2").hide();$("#uPassword").removeClass('errorInput');if($("#memoryCardStatus").val()=='VALID_LOCK'){if(passStatus){$("#jump2reinstallation_step_2").removeClass("disabled");$("#jump2reinstallation_step_2").unbind('click');$("#jump2reinstallation_step_2").bind('click',onClickNext);$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante.gif');}else{$("#jump2reinstallation_step_2").addClass("disabled");$("#jump2reinstallation_step_2").unbind('click');$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');}}else{$("#jump2reinstallation_step_2").addClass("disabled");$("#jump2reinstallation_step_2").unbind('click');$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');}});$("#memoryCardStatus").trigger('change');customizeInstallForm();}};jQuery.orange.config.areacontent.reinstallation_step_1_1={postLoad:function(){$(".myInfo").simpletooltip({showEffect:"fadeIn",hideEffect:"fadeOut"});$("#jump2reinstallation_step_1").bind('click',function(){$("#global").orangeLoad(menu.mapping.reinstallation_step_1);});var onClickNext=function(){var sanswer=$("#sAnswer")[0].getDataValue();$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');jQuery.orange.config.api.rpc.unlockWithSecretAnswer(sanswer,function(successful){if(successful){$("#global").orangeLoad(menu.mapping.reinstallation_step_2);}else{$("#failedSecretAnswer").show();$("#sAnswer").addClass('errorInput');}});};$("#sAnswer input[type='text']").bind('keyup blur',function(event){$("#failedSecretAnswer").hide();$("#sAnswer").removeClass('errorInput');$("#jump2reinstallation_step_2").removeClass("disabled");$("#jump2reinstallation_step_2").unbind('click');$("#jump2reinstallation_step_2").bind('click',onClickNext);$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante.gif');if(event.type="blur"&&$("#sAnswer")[0].getDataValue()==""){$("#failedSecretAnswer").show();$("#sAnswer").addClass('errorInput');$("#jump2reinstallation_step_2").addClass("disabled");$("#jump2reinstallation_step_2").unbind('click');$("#jump2reinstallation_step_2 img").attr('src','theme/webCorporate/image/installation/btn_etape_suivante_off.gif');}});customizeInstallForm();}};jQuery.orange.config.areacontent.reinstallation_step_2={postLoad:function(){waitForRebootAndReload();}};jQuery.orange.config.areacontent.simplereboot_oninstall={postLoad:function(){waitForRebootAndReload();}};function installation_clickOnThisLink(){jQuery.orange.config.api.authorization.login("guest","guest");installation_toggleDisplay(true);jQuery.orange.widget.MenuItem.setCurrent('m0');}
installation_toggleDisplay=function(showHeader){if(showHeader){$("#header_container").show();$("#mainMenu").show();}else{$("#header_container").hide();$("#mainMenu").hide();}
jQuery.orange.init.i18n.load();};customizeInstallForm=function(){$(".forminput-label").each(function(){this.style.fontWeight="bold";});};function firmware_upgrade_inprogress_goToError(){try{fr.orange.livebox.gui.pages.installation.InstallationController.displayFirmwareUpgradeFailed();}catch(err){alert(err);}}
jQuery.orange.config.areacontent.firmware_upgrade_inprogress={postLoad:function(){try{fr.orange.livebox.gui.pages.installation.InstallationController.displayFirmwareUpgradeInProgress();}catch(err){alert(err);}
jQuery.orange.config.api.rpc.requestDownload("Device",function(isUpdateInProgress){if(isUpdateInProgress){}else{firmware_upgrade_inprogress_goToError();}},function(error,reply){firmware_upgrade_inprogress_goToError();});}};function auth_grayBtn(){$('#btnAuth').setDisabled($('#uLogin').val()==""||$('#uPassword').val()=="");}
jQuery.orange.config.areacontent.auth={postParse:function(){if($.cookie("orangeliveboxauth")!=null){var obj=jQuery.parseJSON($.cookie("orangeliveboxauth"));$('#uLogin').val(obj.login);$('#uPassword').val(obj.password);$("#rememberpassword")[0].checked=true;}
auth_grayBtn();$("#auth>a.close").bind("click",function(){$("#authDialog").dialog('close');if(typeof targetMenuIdAfterLogin!="undefined"){delete targetMenuIdAfterLogin;delete targetSubstitutionsAfterLogin;}
jQuery.orange.widget.MenuItem.setCurrent("m0");});$('#uLogin').focus();$('#uLogin').add($('#uPassword')).bind('keyup change',function(){auth_grayBtn();});$('#uLogin').add($('#uPassword')).bind('keypress',function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(keycode==13&&($('#btnAuth').attr('disabled')==undefined||$('#btnAuth').attr('disabled')==false)){$('#btnAuth').trigger('click');}});$('#btnAuth').bind("click",function(){jQuery.orange.config.areacontent.auth.authenticate();if(window.location.hash.indexOf("m2.m2112")!=-1||window.location.hash.indexOf("m2.m2113")!=-1){setTimeout(function(){jQuery.orange.widget.MenuItem.setCurrent('m2.m211');},1000);}});$("#forgetPassword").bind("click",function(){var SecretQuery="Device/UserAccounts/ManagedUsers/ManagedUser[Login='admin']/SecretQuery";jQuery.orange.config.api.crud.read([SecretQuery],function(result){if(result[SecretQuery]){$('#authDialog').dialog('close');$("#authDialog").orangeLoad(menu.mapping.forgetPassword,{LOGIN:$("#uLogin").val()});$("#authDialog").dialog({autoOpen:true,modal:true,width:"500px",minHeight:"200px",open:function(){jQuery.orange.widget.Form.alignFormInputs.call($("#forgetPassword1 form")[0]);}});}});});},authenticate:function(){uLogin=$("#uLogin").val();uPassword=$("#uPassword").val();jQuery.orange.config.api.authorization.login(uLogin,uPassword,function(connected){if(!connected){$("#failedAuthMsg").removeClass('hidden');$("errAuth").show();$("#uLogin").addClass('errorInput');$("#uPassword").addClass('errorInput');jQuery.orange.config.api.authorization.login("guest","guest");return;}
if($("#rememberpassword")[0].checked){$.cookie("orangeliveboxauth",'{"login":"'+uLogin+'", "password":"'+uPassword+'"}',{expires:365});}else{$.cookie("orangeliveboxauth",null);}
$("#uLogin").removeClass('errorInput');$("#uPassword").removeClass('errorInput');$("#authDialog").dialog('close');$('#isConnected').show();$("#authenticationPanel").hide();if(typeof targetMenuIdAfterLogin!="undefined"){jQuery.orange.widget.MenuItem.setCurrent(targetMenuIdAfterLogin,targetSubstitutionsAfterLogin);delete targetMenuIdAfterLogin;delete targetSubstitutionsAfterLogin;}
lastActionTime=new Date().getTime();});}};function mainMenu_reload(){$("#tabsMenu").orangeLoad(menu.mapping.mainMenu,function(){setTimeout("mainMenu_check()",100);});setTimeout("mainMenu_check()",100);}
function mainMenu_check(){var jItem=$("#tabsMenu [i18n='menuNetwork.dhcpdns']").parent();if(jItem.length>0){if(!jItem.hasClass("visibledependent-display")&&!jItem.hasClass("visibledependent-hide")){setTimeout("mainMenu_reload()",10);}}else{setTimeout("mainMenu_check()",100);}
if(window.location.protocol=="https:"){$("#menuserviceinternet")[0].setDataValue('false');}
else{$("#menuserviceinternet")[0].setDataValue('true');}}
jQuery.orange.config.areacontent.tabsMenu={postLoad:function(){$("#tabsMenu ul li ul").hover(function(){$(this).prev().addClass('menuitem-hover');},function(){$(this).prev().removeClass('menuitem-hover');});$("#tabsMenu ul li").bind("click",function(){$(this).children('ul').css('display','none');$(this).bind('mouseout',function(){$(this).children('ul').removeAttr('style');$(this).unbind('mouseout');});});mainMenu_check();if(jQuery.orange.config.api.authorization.accessRemoteDisable){jQuery.orange.config.menu.items.m1.defaultItem='m11';}}};jQuery.orange.config.areacontent.home={preParse:function(){if(!jQuery.orange.config.api.authorization.isConnected()){jQuery.orange.config.api.authorization.login("guest","guest");}},postLoad:function(){var showPopupSCStatus=function(){var PopupSCStatus="Device/UserInterface/WebUI/PopupSCStatus";jQuery.orange.config.api.crud.read([PopupSCStatus],function(result){if(result[PopupSCStatus].values[PopupSCStatus]==false){var SmartCardStatus="Device/DeviceInfo/SmartCard/Status";jQuery.orange.config.api.crud.read([SmartCardStatus],function(result){var cm_status=result[SmartCardStatus].values[SmartCardStatus];if(cm_status=='NOT_PRESENT'){$('#cm_abs').orangeRead();$('#cm_abs').dialog('open');}
else if(cm_status=='REMOVED'||cm_status=='ERROR'){$('#cm_removed').orangeRead();$('#cm_removed').dialog('open');}});}});};showPopupSCStatus();}};function password_focus(){$("#password")[0].setDataValue("");$(this).unbind('focus',password_focus);}
jQuery.orange.config.areacontent.internetConnection={postParse:function(){$("#visibleUsername").keyup(function(event){var newInternalUsername=$("#visibleUsername")[0].getDataValue();if(newInternalUsername.substring(0,4)!="fti/"){newInternalUsername="fti/"+newInternalUsername;}
if($("#internalUsername")[0].getDataValue()!=newInternalUsername){$("#internalUsername")[0].setDataValue(newInternalUsername);}});$("#internalUsername").change(function(event){var newVisibleUserName=$("#internalUsername")[0].getDataValue();if(newVisibleUserName.substring(0,4)=="fti/"){newVisibleUserName=newVisibleUserName.substring(4);}
if($("#visibleUsername")[0].getDataValue()!=newVisibleUserName){$("#visibleUsername")[0].setDataValue(newVisibleUserName);}});},postLoad:function(){$("#visibleUsername").attr("title",jQuery.orange.config.i18n.map["page.myServices.internet.ident.login.tip"]);var form=$("#internetConnection form")[0];var passwordNode=$("#password");$("#password")[0].dataValueRef="aaaaaaa";$("#password")[0].setDataValue(passwordNode[0].dataValueRef);$("#password input[type='text']").bind("focus",password_focus);jQuery.orange.widget.Form.onStateChange.call(form,0,3);$("#password").attr("dataId","Device/Networks/WAN[@name='WAN']/PPP/Password");$("#internalUsername").bind("keyup change",function(){if($("#password")[0].getDataValue()==""){if(arrayIndexOf2($("#internetConnection form")[0].dataKO,$("#password")[0])==-1){$("#internetConnection form")[0].dataKO.push(passwordNode[0]);}}});$("#cancelButton").bind("click",function(){$("#password input[type='password']").val("");$("#password").trigger('change');jQuery.orange.widget.Form.onStateChange.call(form,0,3);});$("#help").bind("click",function(){helpPopup("html/main/help_internet.html");});$("#radioDSL").bind("change",function(event,newValue){if(newValue!=undefined){var radioDSL=$("#radioDSL input[type='radio']").attr('checked');if(radioDSL==true)
$("#FTTHval input[type='text']").val('DISABLE');else
$("#FTTHval input[type='text']").val('ENABLE');}});$("#internetConnection form")[0].crudCallDelegate=function(crudExec){var ref=$("#radioDSL")[0].dataValueRef;var cur=$("#radioDSL")[0].getDataValue();var password=$("#password")[0].getDataValue();var passwordGui="Device/Networks/WAN[@name='WAN']/PPP/Password";var id2value={};if(password!="aaaaaaa"&&password.length>0){id2value[passwordGui]=$("#password")[0].getDataValue();}
jQuery.orange.config.api.crud.update(id2value);if(ref!=cur){openConfirmationPopup('popup.rebootlivebox.title','popup.rebootlivebox.text',function(){crudExec();jQuery.orange.widget.MenuItem.setCurrent('m3.m30.m302',{XpathRouter:'Device/DeviceInfo'});},function(){$("#internetConnection form")[0].reset();});}else{crudExec();}};var CurrentlyRemoteAccess="Device/UserAccounts/ManagedUsers/ManagedUser[Login='"+jQuery.orange.config.api.authorization.getLogin()+"']/CurrentlyRemoteAccess";jQuery.orange.config.api.crud.read([CurrentlyRemoteAccess],function(result){if(result[CurrentlyRemoteAccess].values[CurrentlyRemoteAccess]==true)
{$("#btnReboot").setDisabled(true);$("#radioDSL").setDisabled(true);$("#visibleUsername").setDisabled(true);$("#password").setDisabled(true);}
else
{$("#btnReboot").setDisabled(false);$("#radioDSL").setDisabled(false);$("#visibleUsername").setDisabled(false);$("#password").setDisabled(false);}});$('#btnReboot').click(function(){jQuery.orange.config.api.rpc.restartConnection(function(){$("#additionalPPPinfo").orangeParse();$("#additionalPPPinfo").orangeLoad();$("#additionalPPPinfo").orangeTranslate();});});var internatStatusSurveyRequest=jQuery.orange.config.api.client.newRequest();internatStatusSurveyRequest.onPeriodicValue("Device/Networks/WAN[@name='WAN']/PPP/UpTime",function(newvalue){if($("#PPPUptime")[0]!=undefined){$("#PPPUptime")[0].updateOnPeriodic(newvalue);$("#PPPUptime")[0].orangeTranslate();}},function(){},function(){},{timer:5});internatStatusSurveyRequest.send();}};jQuery.orange.config.areacontent.phone={preParse:function(){var phonenumber="Device/VOIPService/Lines/Line/@number";jQuery.orange.config.api.crud.read([phonenumber],function(result){if(result[phonenumber].values[phonenumber]=="")
{$("#phonenumber").replaceWith('<span id="phonenumber" class="bold" i18n="page.myServices.phone.status.phonenumbernotassigned"/>');$("#phonenumberMsg").show();}
else
{$("#phonenumberMsg").hide();}});$("#ftthEnable").bind("change valueChange",function(){var newValue=$("#ftthEnable")[0].getDataValue();if(newValue=='ENABLE'){$("#simultring").setDisabled(true);}else{$("#simultring").setDisabled(false);}});},postParse:function(){if(jQuery.orange.config.api.authorization.getProfileName()=="orangeadmin")
$(".userSupport").show();else
$(".userSupport").hide();},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_phone.html");});$("#helpTestPhone").bind("click",function(){helpPopup("html/main/help_phoneTest.html");});$("#testPhonesButton").click(function(){jQuery.orange.config.api.rpc.testPhones(function(){});});}};jQuery.orange.config.areacontent.wifiVisitorAccess={postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_wifiVisitor.html");});}};jQuery.orange.config.areacontent.wifiVisitorAccessFirst={postParse:function(){var HotspotStatus="Device/Networks/LAN[@name='LAN']/LANPorts/HotspotWiFiPort[@Name='Hotspot']/HotspotStatus";jQuery.orange.config.api.crud.read([HotspotStatus],function(result){if(result[HotspotStatus].values[HotspotStatus]=='DEACTIVATION_IN_PROGRESS'){$("#wifiVisitorAccessFirst form input").setDisabled(true);}});$("#wifiVisitorAccessFirst form")[0].crudCallDelegate=function(crudExec){crudExec();jQuery.orange.widget.MenuItem.setCurrent("m1.m13.m132");};$("#ckWiFiVA").bind('valueChange',function(event,newValue){$("#btnReg").setDisabled(!newValue);$("#btnCancel").setDisabled(!newValue);});$("#btnCancel").bind('click',function(){$("#ckWiFiVA").removeAttr('checked');$("#ckWiFiVA").trigger('valueChange');});},postLoad:function(){}};function wifiVisitorAccessForm_disableValidBtn(){if($("#ckWiFiDir").attr('checked')==false)
{$('#btnValid').setDisabled(true);}
else
{if($("#wifiVisitorAccessForm input.errorInput").length==0){$('#btnValid').setDisabled(false);}
else{$('#btnValid').setDisabled(true);}}
$("#btnCancel").setDisabled(false);}
jQuery.orange.config.areacontent.wifiVisitorAccessForm={postParse:function(){$("#ckWiFiDir").bind("valueChange",function(event,newValue){wifiVisitorAccessForm_disableValidBtn();});$("#wifiVisitorAccessForm form")[0].crudCallDelegate=function(crudExec){crudExec();var HotspotStatus="Device/Networks/LAN[@name='LAN']/LANPorts/HotspotWiFiPort[@Name='Hotspot']/HotspotStatus";var id2value={};id2value[HotspotStatus]="IN_PROGRESS";jQuery.orange.config.api.crud.update(id2value);jQuery.orange.widget.MenuItem.setCurrent("m1.m13.m133");};$("#wifiVisitorAccessForm input").add($("#wifiVisitorAccessForm select")).bind('change keyup',function(){wifiVisitorAccessForm_disableValidBtn();});},postLoad:function(){wifiVisitorAccessForm_disableValidBtn();$("#btnCancel").setDisabled(true);}};jQuery.orange.config.areacontent.wifiVisitorAccessStatus={postLoad:function(){if($("#UsersConnected")[0].dataValueRef<=1){$("#UsersConnectedLabel").attr('i18n','page.myServices.wifiaccessstatus.nbuser2');}
else{$("#UsersConnectedLabel").attr('i18n','page.myServices.wifiaccessstatus.nbuser2_pluriel');}
$("#UsersConnectedLabel").orangeTranslate();$("#disableBtn").bind('click',function(){openConfirmationPopup('popup.wifiguestaccessdeactivation.title','popup.wifiguestaccessdeactivation.text',function(){var HotspotStatus="Device/Networks/LAN[@name='LAN']/LANPorts/HotspotWiFiPort[@Name='Hotspot']/HotspotStatus";var id2value={};id2value[HotspotStatus]="DEACTIVATION_IN_PROGRESS";jQuery.orange.config.api.crud.update(id2value);jQuery.orange.widget.MenuItem.setCurrent("m1.m13.m131");});});}};jQuery.orange.config.areacontent.servicesMeshLb={postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_serviceMeshLb.html");});}};var TABLE_MAX_MACADDRESS_FILTER=1000;function wificonfiguration_enableDisableAll(){var noWifiAtAll=($("#boxList input:checked").length<=0);var securityMode=$('#SecurityMode')[0].getDataValue();var wpsMode=$("#WPSModeValue")[0].getDataValue();var activateWPS=$("#ActivateWPS")[0].getDataValue();var macFilteringEnabled=$("#MACAddressControlEnabled2")[0].getDataValue();$(".desactivable input, .desactivable select, #password").setDisabled(noWifiAtAll);if(securityMode=="NONE"||securityMode=="WPA_ENTERPRISE"||securityMode=="WPA2_ENTERPRISE"||securityMode=="WPA_WPA2_ENTERPRISE"||noWifiAtAll){$("#password").setDisabled(true);}else{$("#password").setDisabled(false);}
var radiusItems=$("#radiusserver").add("#radiusport").add("#radiuspassword");if(securityMode=="NONE"||securityMode=="WEP128"||securityMode=="WPA_PERSONAL"||securityMode=="WPA2_PERSONAL"||securityMode=="WPA_WPA2_PERSONAL"||noWifiAtAll){radiusItems.setDisabled(true);}else{radiusItems.setDisabled(false);}
if(wpsMode=="MODE_EQP_PIN"){$("#WPSPassword").setDisabled(false);}else if(wpsMode=="MODE_LIVEBOX_PIN"){$("#WPSPassword").setDisabled(true);}
if(securityMode=="WPA_PERSONAL"||securityMode=="WPA2_PERSONAL"||securityMode=="WPA_WPA2_PERSONAL"){if(activateWPS){$("#MACAddressControlEnabled2")[0].setDataValue(false);}}
$("#ActivateWPS").setDisabled(macFilteringEnabled||noWifiAtAll);$("#MACAddressControlEnabled2").setDisabled(activateWPS||noWifiAtAll);$("#wifiConfigurationTable tr:not([class*='table-delete'])").setDisabled(!macFilteringEnabled);$("#wifiConfigurationTable").setDisabled(noWifiAtAll);var src=jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.add."+!macFilteringEnabled+".img"];$("#wifiConfigurationTable .table-add-button").setDisabled(!macFilteringEnabled);}
function wificonfiguration_checkckAll(){var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){MeshEnable=result[MeshEnable].values[MeshEnable];});var nbAPDevice=0;if(MeshEnable==true){var APDevice="Device/MESH/AccessPoints/AccessPoint[Alias!='GWC']";jQuery.orange.config.api.crud.read([APDevice],function(result){nbAPDevice=result[APDevice].nb;});}
if($("#boxList input:checked").length>0){$("#WpsWiFiDisabledLabel2").hide();$("#WpsWiFiDisabledLabel").hide();}else{$("#WpsWiFiDisabledLabel").show();jQuery.orange.config.api.crud.read(["Device/Networks/LAN[@name='LAN']/LANPorts/HotspotWiFiPort/HotspotStatus"],function(result){for(r in result["Device/Networks/LAN[@name='LAN']/LANPorts/HotspotWiFiPort/HotspotStatus"].values){if(r!=null&&result["Device/Networks/LAN[@name='LAN']/LANPorts/HotspotWiFiPort/HotspotStatus"].values[r]=='ENABLED'){$("#WpsWiFiDisabledLabel2").show();}else{$("#WpsWiFiDisabledLabel2").hide();}}});}
if($("#ckAll")[0].getAttribute("checked")=='checked'){var HotspotStatus="Device/Networks/LAN[@name='LAN']/LANPorts/HotspotWiFiPort/HotspotStatus";jQuery.orange.config.api.crud.read([HotspotStatus],function(result){for(r in result[dataId].values){if(r!=null&&status=='DISABLED'){$("#WpsWiFiDisabledLabel").show();}else{$("#WpsWiFiDisabledLabel").hide();}}});}else{$("#WpsWiFiDisabledLabel").hide();}
if($("#boxList input:checked").length==nbAPDevice+1){$("#ckAll").attr('checked','checked');$("#ckAll").attr('title',jQuery.orange.config.i18n.map['page.myNetwork.wifi.configuration.activatewifi.all.true.tip']);}else{$("#ckAll").removeAttr('checked');$("#ckAll").attr('title',jQuery.orange.config.i18n.map['page.myNetwork.wifi.configuration.activatewifi.all.false.tip']);}
if($("#boxList input:checked").length==0){$("#noWifi").css('display','block');var wpsEnabled=$("#ActivateWPS")[0].getDataValue();if(wpsEnabled){$("#WpsWiFiDisabledLabel").css('display','inline');}else{$("#WpsWiFiDisabledLabel").css('display','none');}}else{$("#noWifi").css('display','none');$("#WpsWiFiDisabledLabel").css('display','none');}
wificonfiguration_enableDisableAll();}
function wificonfiguration_displayWifiScanChannel(element){if($("#id"+element+"_autochannelDataValue")[0].checked==false){$("#id"+element+'_wifiChannel').val($("#id"+element+"_channelDataValue").val());$("#id"+element+"_wifiAutoChannel").css('display','none');$("#id"+element+"_wifiAutoChannelScan").css('display','none');}else{$("#id"+element+'_wifiChannel').val('AUTO');$("#id"+element+"_wifiAutoChannel").css('display','inline');$("#id"+element+"_wifiAutoChannelScan").css('display','inline-block');}}
function wificonfiguration_displayWifiBoxName(uid,dnsName){$("#id"+uid+'_wifiChannelLabel > label').text(jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.techparams.channel_mesh"]+" "+dnsName);}
function wificonfiguration_wifiChannelValueChange(element,newValue){if(newValue=="AUTO"){$("#id"+element+"_autochannelDataValue").attr('checked','checked');$("#id"+element+"_autochannelDataValue").trigger('valueChange');$("#id"+element+"_wifiAutoChannel").css('display','inline');$("#id"+element+"_wifiAutoChannelScan").css('display','inline-block');}else{$("#id"+element+"_autochannelDataValue").removeAttr('checked');$("#id"+element+"_channelDataValue").val(newValue);$("#id"+element+"_autochannelDataValue").trigger('valueChange');$("#id"+element+"_channelDataValue").trigger('valueChange');$("#id"+element+"_wifiAutoChannel").css('display','none');$("#id"+element+"_wifiAutoChannelScan").css('display','none');}}
function wificonfiguration_wifiChannelDoBinds(element){$("#id"+element+'_wifiChannel').bind("valueChange",function(event,newValue){wificonfiguration_wifiChannelValueChange(element,newValue);});$("#id"+element+"_channelDataValue").bind("change",function(event,newValue){$("#id"+element+'_wifiChannel').val(newValue);$("#id"+element+"_wifiAutoChannel").css('display','none');$("#id"+element+"_wifiAutoChannelScan").css('display','none');});$("#id"+element+"_autochannelDataValue").bind("valueChange",function(event,newValue){wificonfiguration_displayWifiScanChannel(element);});$("#id"+element+"_wifiAutoChannelScan").bind("click",function(){wificonfiguration_autoScan(element);});}
function wificonfiguration_autoScan(element){var XAutoScan="Device/Networks/LAN[@name='LAN']/LANPorts/LANWiFiPort/AutoChannelEnable";if(element!="master"){XAutoScan="Device/MESH/AccessPoints/AccessPoint[@uid=\'"+element+"\']/Ports/LANWiFiPort/AutoChannelEnable";}
var id2value={};id2value[XAutoScan]=true;jQuery.orange.config.api.crud.update(id2value,function(){});}
function wificonfiguration_OperatingStandardsChange(newValue){if(newValue=="BGN"){var oldSelection=$('#SecurityMode')[0].getDataValue();if(oldSelection=="WEP128"||oldSelection=="WPA_PERSONAL"){$('#SecurityMode')[0].setDataValue("WPA_WPA2_PERSONAL");}else if(oldSelection=="WPA_ENTERPRISE"){$('#SecurityMode')[0].setDataValue("WPA_WPA2_ENTERPRISE");}
$('#SecurityMode option[i18n$="NONE"]').removeAttr('disabled');$('#SecurityMode option[i18n$="WEP128"]').attr('disabled','disabled');$('#SecurityMode option[i18n$="WPA_PERSONAL"]').attr('disabled','disabled');$('#SecurityMode option[i18n$="WPA2_PERSONAL"]').removeAttr('disabled');$('#SecurityMode option[i18n$="WPA_WPA2_PERSONAL"]').removeAttr('disabled');$('#SecurityMode option[i18n$="WPA_ENTERPRISE"]').attr('disabled','disabled');$('#SecurityMode option[i18n$="WPA2_ENTERPRISE"]').removeAttr('disabled');$('#SecurityMode option[i18n$="WPA_WPA2_ENTERPRISE"]').removeAttr('disabled');}else{$('#SecurityMode option').removeAttr('disabled');}
grayDisabledOptionsIE7('SecurityMode');}
function wificonfiguration_SecurityModeChange(newValue){if(newValue==undefined)
return;if(newValue=="NONE"){$('#t16').css('height','0');$('#t16').css('display','none');$('#t16').css('overflow','hidden');}else{$('#t16').css('height','auto');$('#t16').css('display','block');$('#t16').css('overflow','visible');$('#t16').addClass('forminput');}
if(newValue=="NONE"||newValue=="WPA_ENTERPRISE"||newValue=="WPA2_ENTERPRISE"||newValue=="WPA_WPA2_ENTERPRISE"){$('#t10, #t11').css('height','0');$('#t10, #t11').css('overflow','hidden');$('#t10, #t11').css('display','none');$('#t10, #t11').removeClass('forminput');}else{$('#t10, #t11').css('height','auto');$('#t10, #t11').css('overflow','visible');$('#t10, #t11').css('display','block');$('#t10, #t11').addClass('forminput');}
var radiusItems=$("#radiusserver").add("#radiusport").add("#radiuspassword");if(newValue=="NONE"||newValue=="WEP128"||newValue=="WPA_PERSONAL"||newValue=="WPA2_PERSONAL"||newValue=="WPA_WPA2_PERSONAL"){$('#t13, #t14, #t15').css('height','0');$('#t13, #t14, #t15').css('overflow','hidden');$('#t13, #t14, #t15').removeClass('forminput');radiusItems.setDisabled(true);}else{$('#t13, #t14, #t15').css('height','auto');$('#t13, #t14, #t15').css('overflow','visible');$('#t13, #t14, #t15').addClass('forminput');radiusItems.setDisabled(false);}
if(newValue=="NONE"||newValue=="WEP128"||newValue=="WPA_ENTERPRISE"||newValue=="WPA2_ENTERPRISE"||newValue=="WPA_WPA2_ENTERPRISE"){if(!$.browser.msie){$('#wpsZone').css('height','0');$('#wpsZone').css('overflow','hidden');$('#wpsZone').removeClass('border-bottom-1');$('#wpsZone').removeClass('padding-20');}else{$('#wpsZone').css('display','none');}}else{$('#wpsZone').addClass('border-bottom-1');$('#wpsZone').addClass('padding-20');if(!$.browser.msie){$('#wpsZone').css('height','auto');$('#wpsZone').css('overflow','visible');}else{$('#wpsZone').css('display','block');}}
var asciiRegex="[A-Za-z0-9\\ \\!\"#\\$%&'\\(\\)\\*\\+\\,\\-\\.\\/:;<=>\\?@\\[\\\\\\]\\^_`\\{\\}\\|~]+";var wepHexaRegex='[0-9a-fA-F]{26}';if(newValue=="WEP128"){$("#password").attr('regex',wepHexaRegex);$("#password").attr('minlength','0');$("#password input").attr('maxlength','26');$("#password").attr('required','true');$("#password").attr('i18n','page.myNetwork.wifi.configuration.securityparams.wifikey.WEP');$("#password").parent().prev().attr('i18n','page.myNetwork.wifi.configuration.securityparams.wifikey.WEP');$("#password").attr('i18nError','page.myNetwork.wifi.configuration.securityparams.wifikey.WEP.error');$("#password").parent().parent().orangeParse();}
else if(newValue=="WPA_PERSONAL"||newValue=="WPA2_PERSONAL"||newValue=="WPA_WPA2_PERSONAL"){$("#password").attr('regex',asciiRegex);$("#password").attr('minlength','8');$("#password input").attr('maxlength','63');$("#password").attr('required','true');$("#password").attr('i18n','page.myNetwork.wifi.configuration.securityparams.wifikey.WPA');$("#password").parent().prev().attr('i18n','page.myNetwork.wifi.configuration.securityparams.wifikey.WPA');$("#password").attr('i18nError','page.myNetwork.wifi.configuration.securityparams.wifikey.WPA.error');$("#password").parent().parent().orangeParse();}
$("#password")[0].setDataValue($("#password")[0].dataValueRef);$("#radiusserver")[0].setDataValue($("#radiusserver")[0].dataValueRef);$("#radiusport")[0].setDataValue($("#radiusport")[0].dataValueRef);$("#radiuspassword")[0].setDataValue($("#radiuspassword")[0].dataValueRef);$("#radiuspassword").attr('minlength','8');$("#radiuspassword").attr('maxlength','128');$("#radiuspassword").attr('regex',asciiRegex);wificonfiguration_enableDisableAll();jQuery.orange.widget.Form.alignFormInputs.call($("#wifiConfiguration form")[0]);}
function wificonfiguration_displayWPSElements(){var display=$("#ActivateWPS")[0].getDataValue();var newValue=$("#WPSMode")[0].getDataValue();wificonfiguration_stopTimer();if(display){$(".wps").css('display','block');if(newValue=="MODE_WPS_BUTTON"){$("#device_box_pin").hide();$("#b6 label").attr('i18n','page.myNetwork.wifi.configuration.wps.softpushlabel');$("#b6").orangeParse();$("#b6").css('height','auto');$("#b6").css('overflow','visible');$("#b6").addClass('forminput');$("#WPSPassword").parent().parent().css('height','0');$("#WPSPassword").parent().parent().css('overflow','hidden');$("#WPSPassword").parent().parent().removeClass('forminput');}else if(newValue=="MODE_EQP_PIN"){$("#device_box_pin").show();$("#device_box_pin label").attr('i18n','page.myNetwork.wifi.configuration.wps.devicepinlabel');$("#device_box_pin").orangeParse();$("#device_box_pin").css('padding-bottom','8px');$("#b6").css('height','0');$("#b6").css('overflow','hidden');$("#b6").removeClass('forminput');$("#WPSPassword").parent().parent().css('height','auto');$("#WPSPassword").parent().parent().css('overflow','visible');$("#WPSPassword").parent().parent().css('padding-left','0');$("#WPSPassword").parent().parent().css('clear','none');$("#WPSPassword").parent().parent().addClass('forminput');$("#WPSPassword").attr("maxlength","8");$("#b7").css('display','inline-block');$("#b8").css('display','none');$("#WPSPassword").setDisabled(false);}if(newValue=="MODE_LIVEBOX_PIN"){$("#device_box_pin").show();$("#device_box_pin label").attr('i18n','page.myNetwork.wifi.configuration.wps.liveboxpinlabel');$("#device_box_pin").orangeParse();$("#device_box_pin").css('padding-bottom','8px');$("#b6").css('height','0');$("#b6").css('overflow','hidden');$("#b6").removeClass('forminput');$("#WPSPassword").parent().parent().css('height','auto');$("#WPSPassword").parent().parent().css('overflow','visible');$("#WPSPassword").parent().parent().css('padding-left','0');$("#WPSPassword").parent().parent().css('clear','none');$("#WPSPassword").parent().parent().addClass('forminput');$("#WPSPassword").removeAttr("maxlength");$("#b7").css('display','none');$("#b8").css('display','inline-block');$("#WPSPassword").setDisabled(true);}}else{$(".wps").css('display','none');}
jQuery.orange.widget.Form.alignFormInputs.call($("#wifiConfiguration form")[0]);}
var wificonfiguration_timeoutId;var wificonfiguration_seconds;function wificonfiguration_updateTimerWPS(){if(wificonfiguration_seconds>=0){$("#InfoDeviceConnecting #timer").empty();$("#InfoDeviceConnecting #timer").append(wificonfiguration_seconds+'s...');wificonfiguration_timeoutId=setTimeout("wificonfiguration_updateTimerWPS()",1000);wificonfiguration_seconds-=1;}else{var hasBeenAdded=false;if(hasBeenAdded){wificonfiguration_stopTimer();$("#InfoDeviceConnecting").css('display','block');$("#InfoDeviceConnecting").empty();$("#InfoDeviceConnecting").append('<span class="okStatus" i18n="page.myNetwork.wifi.configuration.wps.addingdevicetimeout"/>');$("#InfoDeviceConnecting").orangeParse();$("#InfoDeviceConnecting").orangeTranslate();}else{wificonfiguration_stopTimer();$("#InfoDeviceConnecting").css('display','block');$("#InfoDeviceConnecting").empty();$("#InfoDeviceConnecting").append('<span class="error" i18n="page.myNetwork.wifi.configuration.wps.wpsBtnfail"/>');$("#InfoDeviceConnecting").orangeParse();$("#InfoDeviceConnecting").orangeTranslate();}}}
function wificonfiguration_updateTimerB7(){if(wificonfiguration_seconds>=0){wificonfiguration_timeoutId=setTimeout("wificonfiguration_updateTimerB7()",1000);wificonfiguration_seconds-=1;}else{wificonfiguration_stopTimer();$("#valmsg").remove();$("#InfoDeviceConnecting_BoxPin").append('<span class="error" i18n="page.myNetwork.wifi.configuration.wps.addingdevicetimeout"/>');$("#InfoDeviceConnecting_BoxPin").orangeParse();$("#InfoDeviceConnecting_BoxPin").orangeTranslate();}}
function wificonfiguration_stopTimer(){clearTimeout(wificonfiguration_timeoutId);$("#InfoDeviceConnecting").empty();$("#InfoDeviceConnecting").css('display','none');}
function wificonfiguration_WPSBtnClick(){var id2value={};var WPSMode=$("#WPSModeValue").attr("dataId");id2value[WPSMode]=$("#WPSModeValue").val();jQuery.orange.config.api.crud.update(id2value,function(errors){var isError=false;for(var e in errors){if(e!=undefined&&e==WPSMode){isError=true;}}
if(!isError){jQuery.orange.config.api.rpc.startWPS("LAN",function(){clearTimeout(wificonfiguration_timeoutId);wificonfiguration_seconds=120;$("#InfoDeviceConnecting").css('display','block');$("#InfoDeviceConnecting").empty();$("#InfoDeviceConnecting").append('<span class="orangeStatus" i18n="page.myNetwork.wifi.configuration.wps.timeremaining"/>&#160;<span class="orangeStatus" id="timer"/>');$("#InfoDeviceConnecting").orangeParse();$("#InfoDeviceConnecting").orangeTranslate();wificonfiguration_updateTimerWPS();});}});}
function wificonfiguration_b7BtnClick(){canSaveWPSPassword=false;clearTimeout(wificonfiguration_timeoutId);wificonfiguration_seconds=120;$("#InfoDeviceConnecting_BoxPin").css('display','block');$("#InfoDeviceConnecting_BoxPin").empty();if($("#WPSPassword").val().length==8){if(ValidateChecksum($("#WPSPassword").val())){canSaveWPSPassword=true;}
else{$("#InfoDeviceConnecting_BoxPin").append('<span id="valmsg" class="error" i18n="page.myNetwork.wifi.configuration.wps.errorchecksum"/>');$("#InfoDeviceConnecting_BoxPin").orangeParse();$("#InfoDeviceConnecting_BoxPin").orangeTranslate();}}
else if($("#WPSPassword").val().length==4){canSaveWPSPassword=true;}
else{$("#InfoDeviceConnecting_BoxPin").append('<span id="valmsg" class="error" i18n="page.myNetwork.wifi.configuration.wps.errorpinsize"/>');$("#InfoDeviceConnecting_BoxPin").orangeParse();$("#InfoDeviceConnecting_BoxPin").orangeTranslate();}
if(canSaveWPSPassword){var id2value={};var WPSMode=$("#WPSModeValue").attr("dataId");var WPSPassword=$("#WPSPassword").attr("dataId");id2value[WPSMode]=$("#WPSModeValue").val();id2value[WPSPassword]=$("#WPSPassword").val();jQuery.orange.config.api.crud.update(id2value,function(errors){var isError=false;for(var e in errors){if(e!=undefined&&(e==WPSMode||e==WPSPassword)){isError=true;}}
$("#WPSModeValue").trigger("change");$("#WPSPassword").trigger("valueChange");if(!isError){$("#InfoDeviceConnecting_BoxPin").append('<span id="valmsg" class="okStatus" i18n="page.myNetwork.wifi.configuration.wps.addingdevice"/>');$("#InfoDeviceConnecting_BoxPin").orangeParse();$("#InfoDeviceConnecting_BoxPin").orangeTranslate();wificonfiguration_updateTimerB7();}});}}
function wificonfiguration_btnGeneratePinCodeClick(){var id2value={};var WPSMode=$("#WPSModeValue").attr("dataId");id2value[WPSMode]=$("#WPSModeValue").val();jQuery.orange.config.api.crud.update(id2value,function(errors){var isError=false;for(var e in errors){if(e!=undefined&&e==WPSMode){isError=true;}}
if(!isError){jQuery.orange.config.api.rpc.generatePinCode("LAN",setWPSLiveBoxPINCode);}});}
function setWPSLiveBoxPINCode(newLBPinCode){$("#WPSPassword")[0].setDataValue(newLBPinCode);}
function wifiConfiguration_tableAddRow(id,attrs){var unknown=jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.table.unknown"];if(id!=undefined){if(attrs.UserFriendlyName==undefined||attrs.IPAddress==undefined||attrs.Active==undefined){var dataId="Device/Networks/LAN[@name='LAN']/ConnectedDevices/WiFiDevice[PhysAddress='"+attrs.PhysAddress+"']";jQuery.orange.config.api.crud.read([dataId],function(result){if(result[dataId]!=undefined){for(r in result[dataId].values){var equip=result[dataId].values[r];attrs.UserFriendlyName=equip.UserFriendlyName;attrs.IPAddress=equip.IPAddress;attrs.Active=equip.Active;}}});}
if(attrs.UserFriendlyName==undefined)
attrs.UserFriendlyName=unknown;if(attrs.IPAddress==undefined)
attrs.IPAddress=unknown;if(attrs.Active==undefined)
attrs.Active="DISCONNECTED";}
var tr=jQuery.orange.widget.Table.addRow.call(this,id,attrs);$(tr).attr("noAutoRefresh","true");$("td:eq(2)",tr)[0].getDataValue=function(){if($("input",this)[0]!=undefined){return $("input",this)[0].getDataValue();}else{return this.dataValueRef;}};if(id!=undefined){if(attrs.Active=="CONNECTED"){$("td:eq(4)",tr).attr("disabled","disabled");$("td:eq(4)",tr).data("disabled",true);$("td:eq(4)",tr).attr("i18n","page.myNetwork.wifi.configuration.allowed.cantdelete");$("td:eq(4)",tr).orangeTranslate();}else{$("td:eq(4)",tr).attr("i18n","page.myNetwork.wifi.configuration.allowed.delete");$("td:eq(4)",tr).orangeTranslate();}
return tr;}
$("span,img",tr).removeAttr("dataId");$("span",tr).html(unknown);jQuery.orange.setDataValue($("img",tr)[0],"DISCONNECTED");return tr;}
function wifiConfiguration_addWifiDevice(data){var this0=this;var arrayMACAddress=new Array();for(var i in data.values){if(data.values[i]!=""){arrayMACAddress=data.values[i].split(',');}}
var dataId="Device/Networks/LAN[@name='LAN']/ConnectedDevices/WiFiDevice";jQuery.orange.config.api.crud.read([dataId],function(result){var devices=result[dataId];var builtData={nb:data.nb,values:{},constraints:data.constraints};if(devices!=undefined){for(var i in devices.values){var index=arrayIndexOf(arrayMACAddress,devices.values[i].PhysAddress);if(index!=-1){builtData.values[i]={PhysAddress:arrayMACAddress[index],UserFriendlyName:devices.values[i].UserFriendlyName,IPAddress:devices.values[i].IPAddress,Active:devices.values[i].Active};arrayMACAddress.splice(index,1);}else{if(devices.values[i].PhysAddress!=""&&devices.values[i].PhysAddress!=undefined){arrayMACAddress.push(devices.values[i].PhysAddress);}}}}
for(var i=0;i<arrayMACAddress.length;i++){builtData.values[i]={PhysAddress:arrayMACAddress[i]};}
this0.onDataReadOri(builtData);});}
function wifiConfiguration_tableOnDataRead(data){var this0=this;var arrayMACAddress;for(var i in data.values){if(data.values[i]!=""){arrayMACAddress=data.values[i].split(',');}}
var dataId="Device/Networks/LAN[@name='LAN']/ConnectedDevices/WiFiDevice";jQuery.orange.config.api.crud.read([dataId],function(result){var devices=result[dataId];var builtData={nb:data.nb,values:{},constraints:data.constraints};var unknown=jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.table.unknown"];if(devices!=undefined){for(var i in devices.values){var index=arrayIndexOf(arrayMACAddress,devices.values[i].PhysAddress);if(index!=-1){builtData.values[i]={PhysAddress:arrayMACAddress[index],UserFriendlyName:devices.values[i].UserFriendlyName,IPAddress:devices.values[i].IPAddress,Active:devices.values[i].Active};arrayMACAddress.splice(index,1);}}}
for(var i=0;i<arrayMACAddress.length;i++){builtData.values[i]={PhysAddress:arrayMACAddress[i]};}
this0.onDataReadOri(builtData);});}
function wifiConfiguration_formGetActions(crudAction){var retActions=new Array();var dataIdToUpdate=$(this).parent().attr("dataid");var arrayMACAddress;jQuery.orange.config.api.crud.read([dataIdToUpdate],function(result){for(r in result[dataIdToUpdate].values){var oldValue=result[dataIdToUpdate].values[r];arrayMACAddress=oldValue.split(',');break;}});for(var i=0;i<$("#wifiConfigurationTable tr").length-1;i++){var addressMac=$("td:eq("+i+").table-col-2")[0].getDataValue();var index=arrayIndexOf(arrayMACAddress,addressMac);if(index==-1){arrayMACAddress.push(addressMac);}}
var actions=this.getActionsOri(crudAction);if(actions===false)
return false;for(a in actions){if(actions[a].crud=="delete"){var addrToRemove=actions[a].node.dataValueRef.PhysAddress;for(var i=0;i<arrayMACAddress.length;i++){if(arrayMACAddress[i]==addrToRemove){arrayMACAddress[i]="";}}}else if(actions[a].crud=="create"){if($("table tbody tr",this).size()>TABLE_MAX_MACADDRESS_FILTER){var widget=this.parentNode;jQuery.orange.errorMsgKey("tablefull",widget);$(widget).removeClass("errorInput");var parentform=getFirstParentWithNodeName(widget,"FORM");jQuery.orange.widget.Form.setButtonsDisabled.call(parentform,jQuery.orange.widget.Form.STATE_KO);return false;}
var addrToAdd=actions[a].attrs.PhysAddress;var index=arrayIndexOf(arrayMACAddress,addrToAdd);if(index==-1){arrayMACAddress[arrayMACAddress.length]=addrToAdd;}}}
var newAllowedMACAddresses="";for(var i=0;i<arrayMACAddress.length;i++){if(arrayMACAddress[i]!=""){newAllowedMACAddresses+=arrayMACAddress[i]+",";}}
newAllowedMACAddresses=newAllowedMACAddresses.substring(0,newAllowedMACAddresses.length-1);var node=$("#DummyNode")[0];retActions.push({id:dataIdToUpdate,crud:"update",node:node,value:newAllowedMACAddresses});return retActions;}
function wifiConfiguration_formCrudCallback(){var widget=this.parentNode;for(var n in this.addPending){var node=this.addPending[n];var attrs={PhysAddress:$("[dataid='PhysAddress']",node).val().toLowerCase()};var result={id:1};var tr=widget.addRow(result.id,attrs);$(node).after(tr).remove();}
this.addPending=[];for(var n in this.deletePending){var node=this.deletePending[n];var tbody=node.parentNode;tbody.removeChild(node);}
this.deletePending=[];}
jQuery.orange.config.areacontent.wifiConfiguration={preParse:function(){var RouterName="Device/DeviceInfo/RouterName";jQuery.orange.config.api.crud.read([RouterName],function(result){$("#boxList").append('<span i18nPrefix="page.myNetwork.wifi.configuration.activatewifi.masterlb" widgetType="Checkbox" widgetArg="[false, true]" dataId="Device/Networks/LAN[@name=\'LAN\']/LANPorts/LANWiFiPort/Enable"/><span>'+result[RouterName].values[RouterName]+'</span>');$("#boxList").append('&#160;&#160;');});var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){MeshEnable=result[MeshEnable].values[MeshEnable];});$("#boxList").addClass("hidden");$("#multiBox").addClass("hidden");if(MeshEnable==true){var APDevice="Device/MESH/AccessPoints/AccessPoint[Alias!='GWC']";jQuery.orange.config.api.crud.read([APDevice],function(result){nbAPDevice=result[APDevice].nb;if(result[APDevice].nb>0){for(var box in result[APDevice].values){var uid=result[APDevice].values[box]["uid"];var RouterName="Device/MESH/AccessPoints/AccessPoint[@uid='"+uid+"']/DeviceInfo/RouterName";jQuery.orange.config.api.crud.read([RouterName],function(result){for(var routername in result[RouterName].values){$("#boxList").append('<span widgetType="Checkbox" widgetArg="[false, true]" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/Ports/LANWiFiPort/Enable" i18nPrefix="page.myNetwork.wifi.configuration.activatewifi.meshlb"/><span>'+result[RouterName].values[routername]+'</span>');$("#boxList").append('&#160;&#160;');var channelSelection="";channelSelection+='<div id="id'+uid+'_wifiChannelLabel" class="desactivable w100px" widgetType="FormInput" i18n="page.myNetwork.wifi.configuration.techparams.channel_mesh">';channelSelection+='<select id="id'+uid+'_wifiChannel">';channelSelection+='<option value="AUTO">Auto</option>';channelSelection+='<option value="1">1</option>';channelSelection+='<option value="2">2</option>';channelSelection+='<option value="3">3</option>';channelSelection+='<option value="4">4</option>';channelSelection+='<option value="5">5</option>';channelSelection+='<option value="6">6</option>';channelSelection+='<option value="7">7</option>';channelSelection+='<option value="8">8</option>';channelSelection+='<option value="9">9</option>';channelSelection+='<option value="10">10</option>';channelSelection+='<option value="11">11</option>';channelSelection+='<option value="12">12</option>';channelSelection+='<option value="13">13</option>';channelSelection+='</select>';channelSelection+='<span class="wifiAutoChannel" id="id'+uid+'_wifiAutoChannel" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/Ports/LANWiFiPort/Channel"/>';channelSelection+='<div widgetType="ButtonContainer" class="inline">';channelSelection+='<span id="id'+uid+'_wifiAutoChannelScan" widgetType="ButtonImage" i18n="page.myNetwork.wifi.configuration.techparams.scan"/>';channelSelection+='</div>';channelSelection+='<input style="display:none" id="id'+uid+'_channelDataValue" type="text" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/Ports/LANWiFiPort/Channel"/>';channelSelection+='<input style="display:none" id="id'+uid+'_autochannelDataValue" type="checkbox" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/Ports/LANWiFiPort/AutoChannelEnable"/>';channelSelection+='</div>';$("#meshChannel").append(channelSelection);}});}
$("#boxList").removeClass("hidden");$("#multiBox").removeClass("hidden");}});}else{$("#boxList").removeClass("hidden");$("#multiBox").addClass("hidden");}},postParse:function(){var HotSpotWiFiPortEnableValue=false;var HotSpotWiFiPortEnable="Device/Networks/LAN[@name='LAN']/LANPorts/HotspotWiFiPort[@Name='Hotspot']/Enable";jQuery.orange.config.api.crud.read([HotSpotWiFiPortEnable],function(result){for(resultValue in result[HotSpotWiFiPortEnable].values){console.log(result[HotSpotWiFiPortEnable].values[resultValue]["Enable"]);HotSpotWiFiPortEnableValue=result[HotSpotWiFiPortEnable].values[resultValue];}});$("#boxList input").bind('change',function(event){if(!$(this).attr("checked")){if(HotSpotWiFiPortEnableValue){$("#noWifiHotspot").css('display','block');}}else{$("#noWifiHotspot").css('display','none');}});$("#wifiConfiguration form").bind("reset",function(){$("#noWifiHotspot").css('display','none');});$("#boxList").bind("valueChange",function(event,newValue){wificonfiguration_checkckAll();});$('#ckAll').bind("change",function(event,newValue){if(newValue){$("#boxList input").each(function(){$(this).removeAttr('disabled');$(this).attr('checked','checked');$(this).trigger("change",[true]);});}else if(newValue!=undefined){$("#boxList input").each(function(){$(this).removeAttr('checked');$(this).attr('disabled','disabled');$(this).trigger("change",[false]);});}});if($('#ckAll').attr('checked')){$('#ckAll').attr('title',jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.activatewifi.all.true.tip"]);}else{$('#ckAll').attr('title',jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.activatewifi.all.false.tip"]);}
$('#ckKeyReadable').bind("change",function(event,newValue){if(newValue!=undefined)
$("#password")[0].mask(!newValue);});wificonfiguration_wifiChannelDoBinds("master");var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){MeshEnable=result[MeshEnable].values[MeshEnable];});if(MeshEnable==true){var APDevice="Device/MESH/AccessPoints/AccessPoint[Alias!='GWC']";jQuery.orange.config.api.crud.read([APDevice],function(result){nbAPDevice=result[APDevice].nb;if(result[APDevice].nb>0){for(var box in result[APDevice].values){var uid=result[APDevice].values[box]["uid"];wificonfiguration_wifiChannelDoBinds(uid);var RouterName="Device/MESH/AccessPoints/AccessPoint[@uid='"+uid+"']/DeviceInfo/RouterName";jQuery.orange.config.api.crud.read([RouterName],function(result){$("#id"+uid+"_wifiChannel").parent().prev().append(" "+result[RouterName].values[RouterName]);});}}});}
var table=$("#wifiConfigurationTable")[0];table.onDataReadOri=table.onDataRead;table.onDataRead=wifiConfiguration_tableOnDataRead;table.addRow=wifiConfiguration_tableAddRow;var form=$("form",table)[0];form.getActionsOri=form.getActions;form.getActions=wifiConfiguration_formGetActions;form.crudCallback=wifiConfiguration_formCrudCallback;$("#MACAddressControlEnabled2").bind("valueChange change",function(event,newValue){wificonfiguration_enableDisableAll();if(newValue==false){table.onDataRead=wifiConfiguration_addWifiDevice;}});$('#SecurityMode').bind("change",function(event,newValue){wificonfiguration_SecurityModeChange(newValue);});$('#OperatingStandards').bind("change",function(event,newValue){wificonfiguration_OperatingStandardsChange(newValue);});$("#WPSModeValue").bind('valueChange',function(event){var newValue=$("#WPSModeValue")[0].getDataValue();if(newValue.startsWith("SOFTPUSH")){$("#WPSMode")[0].setDataValue("MODE_WPS_BUTTON");}else if(newValue.startsWith("ENROLLEEPIN")){$("#WPSMode")[0].setDataValue("MODE_EQP_PIN");}else if(newValue.startsWith("GATEWAYPIN")){$("#WPSMode")[0].setDataValue("MODE_LIVEBOX_PIN");}
if(newValue.endsWith("_HWPUSH")){$("#ActivateWPSbyBox")[0].setDataValue(true);}else{$("#ActivateWPSbyBox")[0].setDataValue(false);}});function wpsGui2Datamodel(event){var wpsActivateWPSbyBox=$("#ActivateWPSbyBox")[0].getDataValue();var wpsMode=$("#WPSMode")[0].getDataValue();var newDataModelValue="";switch(wpsMode){case"MODE_WPS_BUTTON":newDataModelValue="SOFTPUSH";break;case"MODE_EQP_PIN":newDataModelValue="ENROLLEEPIN";break;case"MODE_LIVEBOX_PIN":newDataModelValue="GATEWAYPIN";break;}
if(wpsActivateWPSbyBox){newDataModelValue+="_HWPUSH";}
$("#WPSModeValue")[0].setDataValue(newDataModelValue);}
$("#WPSMode").bind("change",wpsGui2Datamodel);$("#ActivateWPSbyBox").bind("change",wpsGui2Datamodel);$("#WPSMode").bind("valueChange",wpsGui2Datamodel);$("#ActivateWPSbyBox").bind("valueChange",wpsGui2Datamodel);$("#ActivateWPSbyBox").bind("valueChange",function(event,newValue){if(newValue){$("#WPSMode")[0].setDataValue("MODE_WPS_BUTTON");}});$("#WPSModeValue").bind('valueChange change',function(event){wificonfiguration_displayWPSElements();});$("#ActivateWPS").bind("change valueChange",function(){var wpsEnabled=$("#ActivateWPS")[0].getDataValue();wificonfiguration_displayWPSElements();if(wpsEnabled){$("#MACAddressControlEnabled2")[0].setDataValue(false);}
wificonfiguration_enableDisableAll();});$("#WPSMode").bind("change",function(){var wpsMode=$("#WPSMode")[0].getDataValue();if(wpsMode=="MODE_WPS_BUTTON"){$("#ActivateWPSbyBox")[0].setDataValue(true);}else if(wpsMode=="MODE_EQP_PIN"){$("#ActivateWPSbyBox")[0].setDataValue(false);}else if(wpsMode=="MODE_LIVEBOX_PIN"){$("#ActivateWPSbyBox")[0].setDataValue(false);}});$("#wifiConfigurationTable .table-add-button img").attr('i18n','page.myNetwork.wifi.configuration.add');$("#wifiConfigurationTable .table-add-button").orangeParse();},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_wifiConfiguration.html");});if(!$("#multiBox").hasClass("hidden")){$("#boxList label").css('visibility','hidden');}
if($("#boxList input:checked").length==0)
$("#noWifi").css('display','block');wificonfiguration_checkckAll();wificonfiguration_displayWifiScanChannel("master");var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){MeshEnable=result[MeshEnable].values[MeshEnable];});if(MeshEnable==true){var APDevice="Device/MESH/AccessPoints/AccessPoint[Alias!='GWC']";jQuery.orange.config.api.crud.read([APDevice],function(result){nbAPDevice=result[APDevice].nb;if(result[APDevice].nb>0){nbAPDevice=result[APDevice].nb;if(result[APDevice].nb>0){$("#ckAll > span > input")[0].setAttribute('checked','checked');for(var box in result[APDevice].values){var DNSName=result[APDevice].values[box]["DNSName"];var uid=result[APDevice].values[box]["uid"];wificonfiguration_displayWifiScanChannel(uid);wificonfiguration_displayWifiBoxName(uid,DNSName);}}
else{$("#ckAll > span > input")[1].setAttribute('checked','checked');}}});}
var elem=$("#ckAll > span:first");var pere=$("#ckAll > span").parent();elem.remove();elem.appendTo(pere);var HotspotSSID=$("#hotspotSSID").val();if(HotspotSSID!=""){var lbname_tip=jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.techparams.lbname.tip"];lbname_tip=lbname_tip.replace("HotspotWiFiPortSSID",HotspotSSID);$(".desactivable input:eq(0)").attr('title',lbname_tip);$(".desactivable input:eq(0)").parent().prev().attr('title',lbname_tip);$("#lanSSID").bind('keyup change',function(){var form=$("#wifiConfiguration form")[0];var currentlanSSIDNode=$("#lanSSID");var currentlanSSID=$("#lanSSID")[0].getDataValue();if(currentlanSSID==HotspotSSID&&jQuery.orange.widget.Form.verifyConstraints(currentlanSSIDNode[0])){$("#identicalSSIDerror").css('display','inline');currentlanSSIDNode.addClass('supErrorInput');var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO.push(currentlanSSIDNode);var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}else if(currentlanSSID!=HotspotSSID){$("#identicalSSIDerror").css('display','none');var oldState=jQuery.orange.widget.Form.getState.call(form);if(jQuery.orange.widget.Form.verifyConstraints(currentlanSSIDNode[0])){currentlanSSIDNode.removeClass('supErrorInput');form.dataKO.splice(arrayIndexOf2(form.dataKO,currentlanSSIDNode),1);}
var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}});}
$("#master_wifiChannel").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.techparams.channel.tip"]);$("#meshChannel select").each(function(){$(this).attr('title',jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.techparams.channel.tip"]);});$('#WPSMode').bind("change",function(event){$("#InfoDeviceConnecting_BoxPin").css('display','none');jQuery.orange.widget.Form.alignFormInputs.call($("#wifiConfiguration form")[0]);});$("#b7").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.wps.add.tip"]);$(".wpsBtn").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.wps.wpsBtn.tip"]);$(".wpsBtn").bind("click",function(event){wificonfiguration_WPSBtnClick();});$("#b7").bind("click",function(event){wificonfiguration_b7BtnClick();});$("#b8").bind("click",function(event){wificonfiguration_btnGeneratePinCodeClick();});$("#wifiConfigurationTable .table-add-button input").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.wifi.configuration.allowed.add.tip"]);$("#password input").css('width','auto');$("#password input").attr('size','38');$("#password").bind('paste',function(){$("#password").trigger('valueChange');});$("#WPSPassword").bind("keyup",function(){$("#valmsg").remove();});$("#wifiConfiguration form")[0].crudCallDelegate=function(crudExec){var id2value={};var ActivateWPS=$("#ActivateWPS").attr("dataId");id2value[ActivateWPS]=$("#ActivateWPS")[0].getDataValue();var MACAddressControlEnabled2=$("#MACAddressControlEnabled2").attr("dataId");id2value[MACAddressControlEnabled2]=$("#MACAddressControlEnabled2")[0].getDataValue();jQuery.orange.config.api.crud.update(id2value,function(errors){for(var e in errors){if(e!=undefined&&(e==ActivateWPS||e==MACAddressControlEnabled2)){alert("wificonfiguration.js: "+e);}}});crudExec();};wificonfiguration_SecurityModeChange($('#SecurityMode')[0].getDataValue());$("#wifiConfigurationTableErr").insertAfter($("#wifiConfigurationTable table"));jQuery.orange.widget.Form.alignFormInputs.call($("#wifiConfiguration form")[0]);}};jQuery.orange.config.areacontent.firewall={postParse:function(){$("#radioFWL span:eq(0)").after('<div class="fwdescription" i18n="data.firewallmodedescription.LOW"/>');$("#radioFWL span:eq(1)").after('<div class="fwdescription" i18n="data.firewallmodedescription.MEDIUM"/>');$("#radioFWL span:eq(2)").after('<div class="fwdescription" i18n="data.firewallmodedescription.HIGH"/>');$("#radioFWL span:eq(3)").after('<div class="fwdescription" i18n="data.firewallmodedescription.CUSTOM"/>');$("#radioFWL").orangeParse();$("#radioFWL").bind("change",function(event,newValue){if(newValue!=undefined){if(newValue!="CUSTOM")
{$(".customfw").hide();}
else
{var fwConfig="Device/Firewall/Config";jQuery.orange.config.api.crud.read([fwConfig],function(result){if(result[fwConfig].values[fwConfig]=='CUSTOM')
$(".customfw").show();else
$(".customfw").hide();});}}});$("#firewall form")[0].crudCallDelegate=function(crudExec){crudExec();};$("#firewall form")[0].crudCallback=function(){var fwConfig="Device/Firewall/Config";jQuery.orange.config.api.crud.read([fwConfig],function(result){if(result[fwConfig].values[fwConfig]=='CUSTOM')
$(".customfw").show();else
$(".customfw").hide();});};$("#help").bind("click",function(){helpPopup("html/main/help_firewall.html");});}};firewallCustom_tableDefaultValues={"DNS":{protocol:"ALL",port:"53"},"HTTP":{protocol:"TCP",port:"80"},"HTTPS":{protocol:"TCP",port:"443"},"FTP-Data":{protocol:"TCP",port:"20"},"FTP":{protocol:"TCP",port:"21"},"POP3":{protocol:"TCP",port:"110"},"POP3S":{protocol:"TCP",port:"995"},"IMAP":{protocol:"TCP",port:"143"},"IMAPS":{protocol:"TCP",port:"993"},"SMTP":{protocol:"TCP",port:"25"},"SMTP-Auth":{protocol:"TCP",port:"587"},"SSMTP":{protocol:"TCP",port:"465"},"NTP":{protocol:"UDP",port:"123"},"NNTP":{protocol:"TCP",port:"119"},"SNMP":{protocol:"UDP",port:"161-162"},"Telnet":{protocol:"TCP",port:"23"},"SSH":{protocol:"TCP",port:"22"},"Traceroute":{protocol:"UDP",port:"32769-65535"},"Ping":{protocol:"ICMP",port:""},"UNIK":{protocol:"ALL",port:""},"IPsec":{protocol:"ALL",port:""},"GRE":{protocol:"IP",port:"47"},"L2TP":{protocol:"UDP",port:"1701"},"H323 host call":{protocol:"ALL",port:""},"SIP":{protocol:"ALL",port:"5060-5061"},"ICA":{protocol:"ALL",port:"1494"},"MS Remote Desktop":{protocol:"TCP",port:"3389"},"VNC":{protocol:"TCP",port:"5900-5910"}};function isEnterOrSpace(event){var res=false;if(event!=undefined){var keycode=(event.which!=undefined)?event.which:event.charCode;if(keycode==13||keycode==32){res=true;}}
return res;}
jQuery.orange.widget.FirewallOrder={getDataValue:function(){return parseInt(this.dataValue);},setDataValue:function(value){this.dataValue=value;$(this).trigger("valueChange",[value]);}};(function($){$.fn.widgetFirewallOrder=function(options){return this.each(function(){this.getDataValue=jQuery.orange.widget.FirewallOrder.getDataValue;this.setDataValue=jQuery.orange.widget.FirewallOrder.setDataValue;var up=$("<span class='arrowup' tabindex='0'>&#160;</span>");up.attr("title",jQuery.orange.config.i18n.map["table.order.up.tip"]);up.click(firewallCustom_tableSortUp);up.keyup(function(event){if(isEnterOrSpace(event)){firewallCustom_tableSortUp(event);}});$(this).append(up[0]);var down=$("<span class='arrowdown' tabindex='0'>&#160;</span>");down.attr("title",jQuery.orange.config.i18n.map["table.order.down.tip"]);down.click(firewallCustom_tableSortDown);down.keyup(function(event){if(isEnterOrSpace(event)){firewallCustom_tableSortDown(event);}});$(this).append(down[0]);});};})(jQuery);var autoCompleteDivId=0;AUTOCOMPLETE_EMPTYTEXT_CSS_CLASS="emptyText";AUTOCOMPLETE_EMPTYTEXT_I18N_SUFFIX=".emptyText";function makeAutoComplete(jNode,emptyText,completionArray,stringInItalic){var divId="combobox-autocomplete-"+autoCompleteDivId;autoCompleteDivId++;$("<div></div>",{id:divId}).appendTo("#content");jNode[0].focused=false;jNode[0].unfolded=false;jNode.autocomplete({minLength:0,appendTo:("#"+divId),source:completionArray});jNode.focus(function(){this.focused=true;if(jNode[0].value==emptyText)
jNode[0].value="";jNode.removeClass(AUTOCOMPLETE_EMPTYTEXT_CSS_CLASS);});jNode.blur(function(){this.focused=false;if(this.getDataValue()==""){if(this.value!=emptyText){this.value=emptyText;}
$(this).addClass(AUTOCOMPLETE_EMPTYTEXT_CSS_CLASS);}else{$(this).removeClass(AUTOCOMPLETE_EMPTYTEXT_CSS_CLASS);}});jNode.bind("autocompleteopen",function(event,ui){this.unfolded=true;if(stringInItalic!=undefined){$(".ui-autocomplete > li:last > a",$("#"+divId)).filter(function(){return this.text==stringInItalic;}).css("font-style","italic");}});jNode.bind("autocompleteclose",function(event,ui){this.unfolded=false;});jNode.click(function(){if(this.unfolded){jNode.autocomplete("close");}else{jNode.autocomplete("search","");}});jNode.bind("change valueChange",function(){if(this.focused){}else{if(this.getDataValue()==""){if(this.value!=emptyText){this.value=emptyText;}
$(this).addClass(AUTOCOMPLETE_EMPTYTEXT_CSS_CLASS);}else{$(this).removeClass(AUTOCOMPLETE_EMPTYTEXT_CSS_CLASS);}}});jNode.bind("autocompletechange",function(event,ui){if(ui.item!=null){this.setDataValue(ui.item.value);}});jNode.bind("autocompleteselect",function(event,ui){if(ui.item!=null){if(ui.item.value==emptyText){this.setDataValue("");}else{this.setDataValue(ui.item.value);}}});jNode[0].getDataValue=function(){return(this.value==emptyText)?"":this.value;};jNode.trigger("change");}
function firewallCustom_tableOnDataRead(data){this.onDataReadOri.call(this,{nb:data.nb,constraints:data.constraints,values:data.values});jQuery.orange.widget.Table.sort.call(this,9);firewallCustom_tableArrowsDisable.call(this);}
function firewallCustom_tableArrowsDisable(){$('.arrowup.disabled',this).removeClass('disabled').attr("title",jQuery.orange.config.i18n.map["table.order.up.tip"]);$('.arrowdown.disabled',this).removeClass('disabled').attr("title",jQuery.orange.config.i18n.map["table.order.down.tip"]);var notDeleted=$("tbody tr:not(.table-row-deleted)",this);$(".table-col-9 .arrowup",notDeleted[0]).addClass('disabled').removeAttr("title");$(".table-col-9 .arrowdown",notDeleted[notDeleted.length-1]).addClass('disabled').removeAttr("title");}
function firewallCustom_tableResetOrder(){var orderList=$("div.table-col-9[widgettype='FirewallOrder']");for(var i=0;i<orderList.length;i++){orderList[i].setDataValue(i);}}
function firewallCustom_tableSortUp(event){var widget=event.target.parentNode;var tr=widget.parentNode.parentNode;var trPrev=tr.previousSibling;if(trPrev==undefined)
return;var order=widget.getDataValue();widget.setDataValue(order-1);$("td:eq(9)",trPrev)[0].firstChild.setDataValue(order);var tbody=tr.parentNode;tbody.removeChild(tr);tbody.insertBefore(tr,trPrev);firewallCustom_tableArrowsDisable.call(tbody.parentNode);firewallCustom_tableResetOrder();}
function firewallCustom_tableSortDown(event){var widget=event.target.parentNode;var tr=widget.parentNode.parentNode;var trNext=tr.nextSibling;if(trNext==undefined)
return;var order=widget.getDataValue();widget.setDataValue(order+1);$("td:eq(9)",trNext)[0].firstChild.setDataValue(order);var tbody=tr.parentNode;tbody.removeChild(trNext);tbody.insertBefore(trNext,tr);firewallCustom_tableArrowsDisable.call(tbody.parentNode);firewallCustom_tableResetOrder();}
function firewallCustom_tableRangeOnDataUpdate(value,result){if(result!=undefined)
return;this.dataValueRef=this.getDataValue();jQuery.orange.widget.Form.onDataChange.call(getFirstParentWithNodeName(this,"FORM"),this);}
function firewallCustom_tableDescSelectChange(event,ui){var input=event.target;var value=(ui!=undefined)?ui:input.value;var td=input.parentNode;if(value!=jQuery.orange.config.i18n.map[$(input).attr("i18n")+AUTOCOMPLETE_EMPTYTEXT_I18N_SUFFIX]){var protocolAndPort=firewallCustom_tableDefaultValues[value];if(protocolAndPort!=undefined){var tr=td.parentNode;select=$("td:eq(1) select",tr)[0];var protocol=protocolAndPort.protocol;if(protocol==undefined){protocol="ALL";}
if(protocol=="ALL"){protocol=jQuery.orange.config.i18n.map["page.myNetwork.firewallCustom.customrules.ipsrc.protocol.ALL"];}
for(var i=0;i<select.length;i++){if(select.item(i).text==protocol){select.item(i).selected=true;}}
$("td:eq(7) input",tr)[0].setDataValue(protocolAndPort.port);}}
else{var tr=td.parentNode;$("td:eq(1) select",tr)[0].setDataValue("TCP");$("td:eq(7) input",tr)[0].setDataValue("");}}
function firewallCustom_tableAddRow(id,attrs){if(attrs!=undefined){if(attrs.SourcePort!=undefined){if(attrs.SourcePortRangeEnd!=undefined&&parseInt(attrs.SourcePortRangeEnd)>0){attrs.SourcePortRange=attrs.SourcePort+"-"+attrs.SourcePortRangeEnd;}else{attrs.SourcePortRange=""+attrs.SourcePort;}}
if(attrs.DestinationPort!=undefined){if(attrs.DestinationPortRangeEnd!=undefined&&parseInt(attrs.DestinationPortRangeEnd)>0){attrs.DestinationPortRange=attrs.DestinationPort+"-"+attrs.DestinationPortRangeEnd;}else{attrs.DestinationPortRange=""+attrs.DestinationPort;}}}
var currentId;var tr;if(attrs!=undefined&&attrs.uid!=undefined){currentId=$("#firewallTable").attr("dataid")+"[@uid='"+attrs.uid+"']";}
else if(id!=undefined){currentId=$("#firewallTable").attr("dataid")+"[@uid='"+id+"']";}
else{currentId=id;}
tr=jQuery.orange.widget.Table.addRow.call(this,currentId,attrs);$("td:eq(1) select",tr).each(function(){if(this.dataValueRef!=undefined&&this.getDataValue()!=this.dataValueRef){var value=this.dataValueRef;$(this).empty().attr("enumerated","['"+value+"']").append("<option value='"+value+"'>"+value+"</option>");this.setDataValue(value);}});$("td:eq(4) input",tr)[0].onDataUpdate=firewallCustom_tableRangeOnDataUpdate;$("td:eq(7) input",tr)[0].onDataUpdate=firewallCustom_tableRangeOnDataUpdate;firewallCustom_tableArrowsDisable.call(this);var name,source=new Array();for(name in firewallCustom_tableDefaultValues)
source.push(name);var inputAppli=$("td:eq(0) input",tr);var emptyText=jQuery.orange.config.i18n.map[inputAppli.attr("i18n")+AUTOCOMPLETE_EMPTYTEXT_I18N_SUFFIX];makeAutoComplete(inputAppli,emptyText,source);if(attrs!=undefined)
jQuery.orange.setDataValue(inputAppli[0],attrs['Description']);inputAppli.bind("valueChange",firewallCustom_tableDescSelectChange);if(attrs!=undefined)
return tr;$("td:eq(2) input",tr)[0].setDataValue("192.168.1.0");$("td:eq(3) input",tr)[0].setDataValue("255.255.255.0");$("td:eq(4) input",tr)[0].setDataValue("0");$("td:eq(5) input",tr)[0].setDataValue("0.0.0.0");$("td:eq(6) input",tr)[0].setDataValue("0.0.0.0");$("td:eq(7) input",tr)[0].setDataValue("0");if($("td:eq(8) select",tr)[0].item(0).text=="Rejeter"){$("td:eq(8) select",tr)[0].item(1).selected=true;}
var order;if(tr.previousSibling!=undefined)
order=parseInt($("td:eq(9)",tr.previousSibling)[0].firstChild.getDataValue())+1;else
order=2;$("td:eq(9) div",tr)[0].setDataValue(order);$("td:eq(10) input",tr)[0].setDataValue(true);return tr;}
function firewallCustom_tableGetActions(crudAction){var actions=jQuery.orange.widget.Table.getActions.call(this,crudAction);if(actions===false)
return false;var i;for(i in actions){var action=actions[i];if(action.crud=="update"){if(action.id.endsWith("Range")){var prefix=action.id.substring(0,action.id.length-5);action.id=prefix;var index=action.value.indexOf("-");if(index!=-1){var end=action.value.substring(index+1);action.value=action.value.substring(0,index);actions.push({id:action.id+"RangeEnd",crud:"update",node:action.node,value:end});}else
actions.push({id:action.id+"RangeEnd",crud:"update",node:action.node,value:""});}}else if(action.crud=="create"){var attrs=action.attrs,newAttrs={};var name;for(name in attrs){var value=attrs[name];if(name.endsWith("Range")){var prefix=name.substring(0,name.length-5);var index=value.indexOf("-");if(index!=-1){var end=value.substring(index+1);newAttrs[prefix]=value.substring(0,index);newAttrs[prefix+"RangeEnd"]=value.substring(index+1);}else
newAttrs[prefix]=value;}else
newAttrs[name]=value;}
action.attrs=newAttrs;}}
return actions;}
function firewallCustom_tableOnReset(){jQuery.orange.widget.Table.onReset.call(this);jQuery.orange.widget.Table.sort.call(this.parentNode.parentNode,9);firewallCustom_tableArrowsDisable.call(this);jQuery.orange.widget.Form.onStateChange.call(this,jQuery.orange.widget.Form.STATE_MODIF_OK,jQuery.orange.widget.Form.STATE_NO_MODIF);}
jQuery.orange.config.areacontent.firewallCustom={postParse:function(area){var table=$("#firewallTable",area)[0];$(".table-add-container",table).append('<span class="spacer"/>');$(".table-add-container",table).append($("#firewallStep",area)[0]);$(".table-add-container",table).before($("#firewallStepLabel",area)[0]);table.addRow=firewallCustom_tableAddRow;table.onDataReadOri=table.onDataRead;table.onDataRead=firewallCustom_tableOnDataRead;$(table).bind("rowMarkedToDelete",function(event,tr){var form=getFirstParentWithNodeName(tr,"FORM");firewallCustom_tableArrowsDisable.call(form);});$(table).bind("rowDeleted",function(event,tr,previousSibling){var form=getFirstParentWithNodeName(previousSibling,"FORM");firewallCustom_tableArrowsDisable.call(form);});var form=$("form",table)[0];form.getActions=firewallCustom_tableGetActions;form.onReset=firewallCustom_tableOnReset;},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_firewallCustom.html");});$("#firewallTableErr").insertAfter($("#firewallTable table"));$("#firewallTable .table-add-button a").attr('i18n','page.myNetwork.firewallCustom.customrules.add2').parent().orangeParse();$("#firewallTable .table-add-button img").attr('i18n','page.myNetwork.firewallCustom.customrules.add').parent().orangeParse();$("#restorebtn").click(function(){openConfirmationPopup('popup.confirm.title','popup.confirm.text',function(){jQuery.orange.config.api.rpc.restoreFirewall(function(){$("#content").orangeLoad(menu.mapping.firewallCustom,function(){popups_crudCallback();});});});});$("#firewallCustom form")[0].crudCallDelegate=function(crudExec){crudExec();};$(".table-col-9 > div").css("width","30px");}};jQuery.orange.config.areacontent.firewallCustomRule1={postParse:function(){var name,source=new Array();for(name in firewallCustom_tableDefaultValues)
source.push(name);var inputAppli=$("#applicationInput");var emptyText=jQuery.orange.config.i18n.map[inputAppli.attr("i18n")+AUTOCOMPLETE_EMPTYTEXT_I18N_SUFFIX];makeAutoComplete(inputAppli,emptyText,source);var jSelect=$("#protocol select");var select=jSelect[0];inputAppli.bind("valueChange autocompletechange autocompleteclose",function(event,ui){var enumerated="['ALL','TCP','UDP','ICMP','GRE','ESP','AH']";var appliName=event.target.getDataValue();if(appliName!=""){if(appliName=='Ping'){enumerated="['ICMP']";}else if(appliName=='GRE'){enumerated="['GRE']";}
jSelect.empty().attr("enumerated",enumerated);jQuery.orange.widget.Select.buildFromEnumerated.call(select);if(firewallCustom_tableDefaultValues[appliName]!=undefined){select.setDataValue(firewallCustom_tableDefaultValues[appliName]['protocol']);}
$(".application").html(appliName);$("#btnNext").setDisabled(false);}else{jSelect.attr("enumerated",enumerated);jQuery.orange.widget.Select.buildFromEnumerated.call(select);$(".application").html("&#160;");$("#btnNext").setDisabled(true);}});$("#btnNext").setDisabled(true);if($("#content").data('Description')!=undefined){$("#applicationInput").val($("#content").data('Description'));$("#applicationInput").trigger('valueChange');$("#applicationInput").removeClass(AUTOCOMPLETE_EMPTYTEXT_CSS_CLASS);}
if($("#content").data('Protocol')!=undefined){$("#protocol select")[0].setDataValue($("#content").data('Protocol'));}
$("#btnBack").bind('click',function(){$("#content").removeData('Description');$("#content").removeData('Protocol');$("#content").removeData('SourceIP');$("#content").removeData('SourceMask');$("#content").removeData('SourcePort');$("#content").removeData('DestinationIP');$("#content").removeData('DestinationMask');$("#content").removeData('DestinationPort');jQuery.orange.widget.MenuItem.setCurrent('m2.m211');});$("#btnNext").bind('click',function(){$("#content").data('Description',$("#applicationInput")[0].getDataValue());$("#content").data('Protocol',$("#protocol select")[0].getDataValue());jQuery.orange.widget.MenuItem.setCurrent('m2.m2112');});$("#help").bind("click",function(){helpPopup("html/main/help_firewallCustomRule1.html");});}};function firewallCustomRule2_setForm(dataId,area){var val=$("#content").data(dataId);var element=$("#"+dataId,area).attr("dataId",dataId)[0];if(val!=undefined){element.dataValueRef=val;element.setDataValue(val);}else{element.dataValueRef="";$("#btnNext").setDisabled(true);}}
jQuery.orange.config.areacontent.firewallCustomRule2={postLoad:function(area){area.popupOnUnsubmitted=false;$("form",area)[0].setButtonsDisabled=function(newState){var notModif=true;$("[dataId]",this).each(function(){if(this.getDataValue()!=this.dataValueRef)
notModif=false;});$("#btnCancel",this).setDisabled(notModif);var error=false;$("[dataId]",this).each(function(){if($(this).hasClass('errorInput'))
error=true;});$("#btnNext",this).setDisabled(error);};if($("#content").data('Description')!=undefined){$(".application").html($("#content").data('Description'));}
firewallCustomRule2_setForm('SourceIP',area);firewallCustomRule2_setForm('SourceMask',area);firewallCustomRule2_setForm('SourcePort',area);firewallCustomRule2_setForm('DestinationIP',area);firewallCustomRule2_setForm('DestinationMask',area);firewallCustomRule2_setForm('DestinationPort',area);if($("#content").data('SourceIP')==undefined){$("#SourceIP")[0].dataValueRef="192.168.1.0";$("#SourceIP")[0].setDataValue("192.168.1.0");$("#SourceIP").trigger('change');$("#from").html($("#SourceIP")[0].getDataValue());}
if($("#content").data('SourceMask')==undefined){$("#SourceMask")[0].dataValueRef="255.255.255.0";$("#SourceMask")[0].setDataValue("255.255.255.0");$("#SourceMask").trigger('change');}
if($("#content").data('SourcePort')==undefined){$("#SourcePort")[0].dataValueRef="0";$("#SourcePort")[0].setDataValue("0");$("#SourcePort").trigger('change');$("#port").html($("#SourcePort input").val());}
if($("#content").data('DestinationPort')==undefined){if(firewallCustom_tableDefaultValues[$("#content").data('Description')]!=undefined&&firewallCustom_tableDefaultValues[$("#content").data('Description')]['port']!=""){$("#DestinationPort")[0].setDataValue(firewallCustom_tableDefaultValues[$("#content").data('Description')]['port']);$("#DestinationPort")[0].dataValueRef=firewallCustom_tableDefaultValues[$("#content").data('Description')]['port'];}
else{$("#DestinationPort")[0].dataValueRef="0";$("#DestinationPort")[0].setDataValue("0");}
$("#DestinationPort").trigger('change');}
if($("#content").data('DestinationIP')==undefined){$("#DestinationIP")[0].dataValueRef="0.0.0.0";$("#DestinationIP")[0].setDataValue("0.0.0.0");$("#DestinationIP").trigger('change');}
if($("#content").data('DestinationMask')==undefined){$("#DestinationMask")[0].dataValueRef="0.0.0.0";$("#DestinationMask")[0].setDataValue("0.0.0.0");$("#DestinationMask").trigger('change');}
if($("#content").data('SourceIP')!=undefined){$("#from").html($("#SourceIP input").val());}
if($("#content").data('SourcePort')!=undefined){$("#port").html($("#SourcePort input").val());}
$("#SourceIP input").bind('change',function(event){if($("#SourceIP").hasClass("errorInput")==false)
$("#from").html(event.target.value);});$("#SourcePort input").bind('change',function(event){if($("#SourcePort").hasClass("errorInput")==false)
$("#port").html(event.target.value);});$("#btnBack").bind('click',function(){$("#content").removeData('Description');$("#content").removeData('Protocol');$("#content").removeData('SourceIP');$("#content").removeData('SourceMask');$("#content").removeData('SourcePort');$("#content").removeData('DestinationIP');$("#content").removeData('DestinationMask');$("#content").removeData('DestinationPort');jQuery.orange.widget.MenuItem.setCurrent('m2.m211');});$("#btnPreviousStep").bind('click',function(){jQuery.orange.widget.MenuItem.setCurrent('m2.m2111');});$("#btnNext").bind('click',function(){$("#content").data('SourceIP',$("#SourceIP")[0].getDataValue());$("#content").data('SourceMask',$("#SourceMask")[0].getDataValue());$("#content").data('SourcePort',$("#SourcePort")[0].getDataValue());$("#content").data('DestinationIP',$("#DestinationIP")[0].getDataValue());$("#content").data('DestinationMask',$("#DestinationMask")[0].getDataValue());$("#content").data('DestinationPort',$("#DestinationPort")[0].getDataValue());jQuery.orange.widget.MenuItem.setCurrent('m2.m2113');});$("form",area)[0].setButtonsDisabled();$("#help").bind("click",function(){helpPopup("html/main/help_firewallCustomRule2.html");});}};jQuery.orange.config.areacontent.firewallCustomRule3={postParse:function(){$("#allow")[0].setDataValue(true);$("#Target")[0].setDataValue("ACCEPT");$("#activate")[0].setDataValue(true);if($("#content").data('Description')!=undefined){$(".application").html($("#content").data('Description'));}
if($("#content").data('SourceIP')!=undefined){if($("#content").data('SourceIP')=="0.0.0.0"){$("#from").attr('i18n','ipaddress.broadcast');$("#from").orangeTranslate();}
else
$("#from").html($("#content").data('SourceIP'));}
if($("#content").data('SourcePort')!=undefined){if($("#content").data('SourcePort')=="0"){$("#port").attr('i18n','portrange.all');$("#port").orangeTranslate();}
else
$("#port").html($("#content").data('SourcePort'));}
$(".firewallCustomRuleRight").addClass('allow');$("#allow").bind('change',function(event,newValue){if($("#activate")[0].getDataValue()){if(newValue){$(".firewallCustomRuleRight").removeClass('disallow');$(".firewallCustomRuleRight").addClass('allow');$("#Target")[0].setDataValue("ACCEPT");}else if(newValue!=undefined){$(".firewallCustomRuleRight").removeClass('allow');$(".firewallCustomRuleRight").addClass('disallow');$("#Target")[0].setDataValue("DROP");}}});$("#activate").bind('change',function(event,newValue){if(newValue){if($("#allow")[0].getDataValue()){$(".firewallCustomRuleRight").removeClass('disallow');$(".firewallCustomRuleRight").addClass('allow');}else{$(".firewallCustomRuleRight").removeClass('allow');$(".firewallCustomRuleRight").addClass('disallow');}}else if(newValue!=undefined){$(".firewallCustomRuleRight").removeClass('allow');$(".firewallCustomRuleRight").removeClass('disallow');}});$("#help").bind("click",function(){helpPopup("html/main/help_firewallCustomRule3.html");});$("#btnBack").bind('click',function(){$("#content").removeData('Description');$("#content").removeData('Protocol');$("#content").removeData('SourceIP');$("#content").removeData('SourceMask');$("#content").removeData('SourcePort');$("#content").removeData('DestinationIP');$("#content").removeData('DestinationMask');$("#content").removeData('DestinationPort');jQuery.orange.widget.MenuItem.setCurrent('m2.m211');});$("#btnPreviousStep").bind('click',function(){jQuery.orange.widget.MenuItem.setCurrent('m2.m2112');});var Description=$("#content").data('Description');var Protocol=$("#content").data('Protocol');var SourceIP=$("#content").data('SourceIP');var SourceMask=$("#content").data('SourceMask');var SourcePort_input=$("#content").data('SourcePort');var SourcePort;var SourcePortRangeEnd;if(SourcePort_input.indexOf("-")!=-1){SourcePort=jQuery.trim(SourcePort_input.substring(0,SourcePort_input.indexOf("-")));SourcePortRangeEnd=jQuery.trim(SourcePort_input.substring(SourcePort_input.indexOf("-")+1,SourcePort_input.length));}else{SourcePort=SourcePort_input;SourcePortRangeEnd="";}
var DestinationIP=$("#content").data('DestinationIP');var DestinationMask=$("#content").data('DestinationMask');var DestinationPort_input=$("#content").data('DestinationPort');var DestinationPort;var DestinationPortRangeEnd;if(DestinationPort_input.indexOf("-")!=-1){DestinationPort=jQuery.trim(DestinationPort_input.substring(0,DestinationPort_input.indexOf("-")));DestinationPortRangeEnd=jQuery.trim(DestinationPort_input.substring(DestinationPort_input.indexOf("-")+1,DestinationPort_input.length));}else{DestinationPort=DestinationPort_input;DestinationPortRangeEnd="";}
$("#Description")[0].setDataValue(Description);$("#Protocol")[0].setDataValue(Protocol);$("#SourceIP")[0].setDataValue(SourceIP);$("#SourceMask")[0].setDataValue(SourceMask);$("#SourcePort")[0].setDataValue(SourcePort);$("#SourcePortRangeEnd")[0].setDataValue(SourcePortRangeEnd);$("#DestinationIP")[0].setDataValue(DestinationIP);$("#DestinationMask")[0].setDataValue(DestinationMask);$("#DestinationPort")[0].setDataValue(DestinationPort);$("#DestinationPortRangeEnd")[0].setDataValue(DestinationPortRangeEnd);var Rule="Device/Firewall/Rules/Rule";jQuery.orange.config.api.crud.read([Rule],function(result){$("#Order")[0].setDataValue(result[Rule].nb+1);});$("#firewallCustomRule3 form").bind("submitted",function(){$("#content").removeData('Description');$("#content").removeData('Protocol');$("#content").removeData('SourceIP');$("#content").removeData('SourceMask');$("#content").removeData('SourcePort');$("#content").removeData('DestinationIP');$("#content").removeData('DestinationMask');$("#content").removeData('DestinationPort');jQuery.orange.widget.MenuItem.setCurrent('m2.m211');});}};function dhcpdns_disableElements(){var disabled=$("#ckDHCP")[0].getDataValue()==false;$("#dhcpSlotStart").setDisabled(disabled);$("#dhcpSlotEnd").setDisabled(disabled);$("#dnsmode").setDisabled(disabled);var isAutomaticDNS=($("#dnsmode")[0].getDataValue()=="AUTOMATIC");$("#primaryDNS").setDisabled(disabled||isAutomaticDNS);$("#secondaryDNS").setDisabled(disabled||isAutomaticDNS);$("#ipvpnstart").setDisabled(disabled);$("#ipvpnend").setDisabled(disabled);$("#dhcpdnsTable").setDisabled(disabled);$("#tableStaticIP").setDisabled(disabled);}
dhcpdns_tableId0="Device/Networks/LAN[@name='LAN']/ConnectedDevices/EthernetDevice";dhcpdns_tableId1="Device/Networks/LAN[@name='LAN']/ConnectedDevices/WiFiDevice";dhcpdns_tableId2="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='']";function dhcpdns_tableSelectChange(event){var select=event.target;var id=select.options[select.selectedIndex].value;var tr=select.parentNode.parentNode;$(tr).attr("dataId",id);var widget=getFirstParentWithNodeName(tr,"FORM").parentNode;var values=widget.mapping[id];var input=document.createElement("input");$(input).attr("dataId",values.nameAttr).attr("value",values.name).css('display','none');input.dataValueRef=values.name;var form=getFirstParentWithNodeName(select,"FORM");var oldState=jQuery.orange.widget.Table.getState.call(form);arrayRemove(form.dataKO,select);var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);$("td:eq(0)",tr).empty().append(input).orangeParse();$("td:eq(0)",tr).append(values.name);var jInput=$("td:eq(1) input",tr).attr("dataId",values.ipAttr).attr("value",values.ip);jInput.trigger("change");$("td:eq(2) span",tr).empty().text(values.mac);}
function dhcpdns_tableCheckIPSubnet_Validate(node){var NOT_GOOD_NOT_WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;var dependentFuncs=[dhcpdns_checkBusinessRules_single_routerIp,dhcpdns_checkBusinessRules_single_subnetMask];var businessRule=function(value){var iprouter=$("#iprouter")[0].getDataValue();var subnetmask=$("#subnetMask")[0].getDataValue();var iprouter32=stringToIP32(iprouter);var subnet32=stringToIP32(subnetmask);var ipvpnstart=$("#ipvpnstart")[0].getDataValue();var ipvpnstart32=stringToIP32(ipvpnstart);var value32=stringToIP32(value);return((iprouter32&subnet32)==(value32&subnet32));};function verifyNatPatIpAdressWithcurrentValue(node){var boolresult=false;var adressNatPat="Device/NAT/PortMappings/PortMapping[InternalClient='"+node.dataValueRef+"']";jQuery.orange.config.api.crud.read([adressNatPat],function(result){if(result[adressNatPat]!=undefined){if(node.dataValueRef!=node.value){$("#natpatRuleForIp").css('display','block');boolresult=false;}
else{boolresult=true;}}
else{boolresult=true;}});return boolresult;}
var hasNatPatAdressAssociated=!verifyNatPatIpAdressWithcurrentValue(node);var res=false;var depFuncsResult=true;for(var i=0;i<dependentFuncs.length;i++){if(dependentFuncs[i].call(this)!=GOOD){depFuncsResult=false;break;}}
var regex=jQuery.orange.config.namedregex.ipaddress;var regexResult=jQuery.orange.widget.Form.constraint.regex(regex,node.getDataValue());if(regexResult!=GOOD){node.error="ip";return regexResult;}else{if(depFuncsResult){if(hasNatPatAdressAssociated){return WRONG;}else{res=businessRule(node.getDataValue());if(res){node.error=undefined;return GOOD;}else{node.error="badsubnet";return WRONG;}}}else{node.error=undefined;return NOT_GOOD_NOT_WRONG;}}}
function buildSelectEquipmentList(jSelect,XConnectedDevices){jQuery.orange.config.api.crud.read([XConnectedDevices],function(result){for(var connectedDevice in result[XConnectedDevices].values){var equipLabel;if(result[XConnectedDevices].values[connectedDevice]['UserFriendlyName']!=""&&result[XConnectedDevices].values[connectedDevice]['UserFriendlyName']!=undefined&&result[XConnectedDevices].values[connectedDevice]['UserFriendlyName']!=null){equipLabel=result[XConnectedDevices].values[connectedDevice]['UserFriendlyName'];}else if(result[XConnectedDevices].values[connectedDevice]['Login']!=""&&result[XConnectedDevices].values[connectedDevice]['Login']!=undefined&&result[XConnectedDevices].values[connectedDevice]['Login']!=null){equipLabel=result[XConnectedDevices].values[connectedDevice]['Login'];}
else{equipLabel="";}
var knowndevices=jSelect.attr("enumerated");connectedDevice=connectedDevice.replace("'","\'");knowndevices=knowndevices.substring(0,knowndevices.length-1);knowndevices=knowndevices+",\""+equipLabel+"\"]";jSelect.attr("enumerated",knowndevices);var newoption=$("<option/>");newoption.attr("value",equipLabel);newoption.attr("refId",connectedDevice);newoption.text(equipLabel);jSelect.append(newoption);}});}
function dhcpdns_postLoadTableAddRow(id,attrs){var currentId;if(attrs!=undefined&&attrs.uid!=undefined){currentId=$("#dhcpdnsTable").attr("dataid")+"[@uid='"+attrs.uid+"']";}else if(id!=undefined){currentId=$("#dhcpdnsTable").attr("dataid")+"[@uid='"+id+"']";}else{currentId=id;}
var tr=jQuery.orange.widget.Table.addRow.call(this,currentId,attrs);$(tr).bind('verifyNatPatIpAdress',function(){var adressNatPat="Device/NAT/PortMappings/PortMapping[InternalClient='"+$("td:eq(1) input",this)[0].getDataValue()+"']";jQuery.orange.config.api.crud.read([adressNatPat],function(result){if(result[adressNatPat]!=undefined||result[adressNatPat]!=null){$("#natpatRuleForIp").css('display','block');jQuery.orange.widget.Table.NatPatIpAdress=true;}
else{$("#natpatRuleForIp").css('display','none');jQuery.orange.widget.Table.NatPatIpAdress=false;}});});buildSelectEquipmentList($("td:eq(0) select",tr),"Device/Networks/LAN[@name='LAN']/ConnectedDevices/EthernetDevice");buildSelectEquipmentList($("td:eq(0) select",tr),"Device/Networks/LAN[@name='LAN']/ConnectedDevices/WiFiDevice");$("td:eq(0) select.table-col-0",tr).addClass("italic-font-style");$("td:eq(0) select",tr).bind('valueChange',function(event,newvalue){var jTR=$(event.target).parent().parent();var XSelectedDevice=$(event.target[event.target.selectedIndex]).attr("refId");var ip;var mac;jQuery.orange.config.api.crud.read([XSelectedDevice],function(result){if(result[XSelectedDevice].values[XSelectedDevice]['Login']!=""&&result[XSelectedDevice].values[XSelectedDevice]['Login']!=undefined&&result[XSelectedDevice].values[XSelectedDevice]['Login']!=null){ip=result[XSelectedDevice].values[XSelectedDevice]['RemoteIPAddress'];mac=result[XSelectedDevice].values[XSelectedDevice]['MACAddress'];}else{ip=result[XSelectedDevice].values[XSelectedDevice]['IPAddress'];mac=result[XSelectedDevice].values[XSelectedDevice]['PhysAddress'];}});if(ip!=undefined){$("td:eq(1) input",jTR)[0].setDataValue(ip);}
if(mac!=undefined){$("td:eq(2) input",jTR)[0].setDataValue(mac);}});$("td:eq(1) input",tr)[0].validate=function(){return dhcpdns_tableCheckIPSubnet_Validate(this);};$("td:eq(1) input",tr)[0].getError=function(){return this.error;};return tr;}
function dhcpdns_tableOnDataUpdateBecomeStatic(){this.crudAction="update";var form=getFirstParentWithNodeName(this,"FORM");var oldState=jQuery.orange.widget.Table.getState.call(form);arrayRemove(form.addPending,this);$(form)[0].modifsOK=[];var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);var self=$(this);var id=self.attr("dataId");form.parentNode.mapping[id]["static"]=true;self.removeClass("table-row-added");var jInput=$("td:eq(1) input",self);jInput[0].dataValueRef=jInput.val();$("select",form).each(function(){dhcpdns_fillNameSelect(form.parentNode.mapping,$(this));});}
function dhcpdns_tableOnDataUpdateBecomeNotStatic(){var form=getFirstParentWithNodeName(this,"FORM");var oldState=jQuery.orange.widget.Table.getState.call(form);arrayRemove(form.deletePending,this);$(this).remove();var newState=jQuery.orange.widget.Table.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);var self=$(this);var id=self.attr("dataId");form.parentNode.mapping[id]["static"]=false;$("select",form).each(function(){dhcpdns_fillNameSelect(form.parentNode.mapping,$(this));});}
function dhcpdns_fillNameSelect(mapping,jSelect){jSelect.empty();var option=$("<option value='' i18n='page.myNetwork.dhcpdns.staticip.select.choose'/>").orangeTranslate();jSelect.append(option[0]);for(var id in mapping)
if(!mapping[id]["static"])
jSelect.append($("<option/>").attr("value",id).text(mapping[id].name)[0]);}
function dhcpdns_tableGetActions(crudAction){var actions=jQuery.orange.widget.Table.getActions.call(this,crudAction);if(actions===false)
return false;for(var i in actions){var action=actions[i];if(action.crud=="delete"){action.crud="update";action.node.onDataUpdate=dhcpdns_tableOnDataUpdateBecomeNotStatic;if(action.id.indexOf("ConnectedDevices")!=-1){action.id+="/AddressSource";action.value="DHCP";}else{action.id+="/StaticIPAddress";action.value=false;}}else if(action.crud=="create"){action.crud="update";var id=action.id;var widget=getFirstParentWithNodeName(action.node,"FORM").parentNode;var values=widget.mapping[id];if(action.attrs[values.nameAttr]!=values.name)
actions.push({crud:"update",id:id+"/"+values.nameAttr,node:$("td:eq(0) input",action.node)[0],value:action.attrs[values.nameAttr]});if(action.attrs[values.ipAttr]!=values.ip)
actions.push({crud:"update",id:id+"/"+values.ipAttr,node:$("td:eq(1) input",action.node)[0],value:action.attrs[values.ipAttr]});action.attrs=undefined;if(id.indexOf("ConnectedDevices")!=-1){action.id=id+"/AddressSource";action.value="STATIC";}else{action.id=id+"/StaticIPAddress";action.value=true;}}}
return actions;}
function dhcpdns_clearErrorMessages(){var fields=[$("#iprouter"),$("#dhcpSlotStart"),$("#dhcpSlotEnd"),$("#ipvpnstart"),$("#ipvpnend")];for(var i=0;i<fields.length;i++){fields[i].removeClass("errorInput");}
$("#dhcpsloterror").hide();$("#vpnsloterror").hide();$("#dhcpSlotStartBadNetwork").hide();$("#dhcpSlotEndBadNetwork").hide();$("#vpnSlotStartBadNetwork").hide();$("#vpnSlotStartSameNetwork").hide();$("#vpnSlotEndBadNetwork").hide();$("#vpnSlotEndSameNetwork").hide();$("#staticIPBadSubnet").hide();}
function dhcpdns_isSameIP(ip1,ip2,maxDots){var nbDots=0;ip1+=".";ip2+=".";var diff=false;for(var i=0;i<ip1.length&&i<ip2.length&&nbDots<maxDots;i++){if(ip1.charAt(i)!=ip2.charAt(i)){diff=true;break;}
if(ip1.charAt(i)=='.'){nbDots++;}}
return!diff&&nbDots==maxDots;}
function dhcpdns_worst(a,b){var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var NOT_GOOD_NOT_WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;if(a==WRONG||b==WRONG){return WRONG;}else if(a==GOOD&&b==GOOD){return GOOD;}else{return NOT_GOOD_NOT_WRONG;}}
function dhcpdns_areConstraintsOK(jNodes){var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var worst=GOOD;for(var i=0;i<jNodes.length;i++){worst=dhcpdns_worst(worst,jQuery.orange.widget.Form.verifyConstraints(jNodes[i][0],true));}
return worst;}
var dhcpdns_msgKO_map={};function dhcpdns_isKO(node){var form=$("#dhcpdns form")[0];if(arrayIndexOf(form.dataKO,node)!=-1){return true;}
var isKO=false;for(var n in dhcpdns_msgKO_map){if(arrayIndexOf(dhcpdns_msgKO_map[n],node)!=-1){isKO=true;break;}}
return isKO;}
function dhcpdns_addToDataKO(jNode,jErrorMessage){var form=$("#dhcpdns form")[0];var jErrorMessageID=jErrorMessage.attr("id");var nodesAssociatedToThisError=dhcpdns_msgKO_map[jErrorMessageID];if(nodesAssociatedToThisError==undefined){nodesAssociatedToThisError=new Array();dhcpdns_msgKO_map[jErrorMessageID]=nodesAssociatedToThisError;}
if(arrayIndexOf(nodesAssociatedToThisError,jNode[0])==-1){nodesAssociatedToThisError.push(jNode[0]);if(arrayIndexOf(form.dataKO,jErrorMessage[0])==-1){form.dataKO.push(jErrorMessage[0]);}
jNode.addClass("errorInput");jErrorMessage.show();}}
function dhcpdns_removeFromDataKO(jNode,jErrorMessage){var form=$("#dhcpdns form")[0];var jErrorMessageID=jErrorMessage.attr("id");var nodesAssociatedToThisError=dhcpdns_msgKO_map[jErrorMessageID];if(nodesAssociatedToThisError!=undefined){if(arrayIndexOf(nodesAssociatedToThisError,jNode[0])!=-1){arrayRemove(nodesAssociatedToThisError,jNode[0]);if(nodesAssociatedToThisError.length==0){dhcpdns_msgKO_map[jErrorMessageID]=undefined;arrayRemove(form.dataKO,jErrorMessage[0]);jErrorMessage.hide();}
if(!dhcpdns_isKO(jNode[0])){jNode.removeClass("errorInput");}}}}
function dhcpdns_checkBusinessRules_single_routerIp(){return dhcpdns_areConstraintsOK([$("#iprouter")]);}
function dhcpdns_checkBusinessRules_single_subnetMask(){return dhcpdns_areConstraintsOK([$("#subnetMask")]);}
function dhcpdns_checkBusinessRules_single_vpnStart(){return dhcpdns_areConstraintsOK([$("#ipvpnstart")]);}
function dhcpdns_checkBusinessRules_single_vpnEnd(){return dhcpdns_areConstraintsOK([$("#ipvpnend")]);}
function dhcpdns_isDisabled(jNode){return jNode.attr("disabled")!=undefined&&jNode.attr("disabled")!="";}
function dhcpdns_areAllDisabled(jNodes){var res=true;for(var i=0;i<jNodes.length;i++){if(!dhcpdns_isDisabled(jNodes[i])){res=false;break;}}
return res;}
function dhcpdns_checkBusinessRules_single_generic(jNodes,dependentFuncs,jErrorMsg,businessRule){var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var NOT_GOOD_NOT_WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;if(dhcpdns_areAllDisabled(jNodes)){return GOOD;}
var res=NOT_GOOD_NOT_WRONG;var depFuncsResult=GOOD;for(var i=0;i<dependentFuncs.length;i++){depFuncsResult=dhcpdns_worst(depFuncsResult,dependentFuncs[i].call(this));}
if(depFuncsResult==GOOD){if(dhcpdns_areConstraintsOK(jNodes)==GOOD){var arguments=new Array();for(var i=0;i<jNodes.length;i++){arguments.push(jNodes[i][0].getDataValue());}
var form=$("#dhcpdns form")[0];var oldState=jQuery.orange.widget.Form.getState.call(form);var isRuleOK=businessRule.apply(this,arguments);if(!isRuleOK){for(var i=0;i<jNodes.length;i++){dhcpdns_addToDataKO(jNodes[i],jErrorMsg);}
res=WRONG;}else{for(var i=0;i<jNodes.length;i++){dhcpdns_removeFromDataKO(jNodes[i],jErrorMsg);}
res=GOOD;}
var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}else{for(var i=0;i<jNodes.length;i++){dhcpdns_removeFromDataKO(jNodes[i],jErrorMsg);}}}else if(depFuncsResult==WRONG||depFuncsResult==NOT_GOOD_NOT_WRONG){for(var i=0;i<jNodes.length;i++){dhcpdns_removeFromDataKO(jNodes[i],jErrorMsg);}
res=WRONG;}
return res;}
function dhcpdns_checkBusinessRules_single_dhcpSlotIpStart(){return dhcpdns_checkBusinessRules_single_generic([$("#dhcpSlotStart")],[dhcpdns_checkBusinessRules_single_routerIp],$("#dhcpSlotStartBadNetwork"),function(dhcpSlotStart){var iprouter=$("#iprouter")[0].getDataValue();var subnetmask=$("#subnetMask")[0].getDataValue();var iprouter32=stringToIP32(iprouter);var subnet32=stringToIP32(subnetmask);var dhcpSlotStart32=stringToIP32(dhcpSlotStart);return((iprouter32&subnet32)==(dhcpSlotStart32&subnet32));});}
function dhcpdns_checkBusinessRules_single_dhcpSlotIpEnd(){return dhcpdns_checkBusinessRules_single_generic([$("#dhcpSlotEnd")],[dhcpdns_checkBusinessRules_single_routerIp],$("#dhcpSlotEndBadNetwork"),function(dhcpSlotEnd){var iprouter=$("#iprouter")[0].getDataValue();var subnetmask=$("#subnetMask")[0].getDataValue();var iprouter32=stringToIP32(iprouter);var subnet32=stringToIP32(subnetmask);var dhcpSlotEnd32=stringToIP32(dhcpSlotEnd);return((iprouter32&subnet32)==(dhcpSlotEnd32&subnet32));});}
function dhcpdns_checkBusinessRules_combined_dhcpSlotRange(){return dhcpdns_checkBusinessRules_single_generic([$("#dhcpSlotStart"),$("#dhcpSlotEnd")],[dhcpdns_checkBusinessRules_single_dhcpSlotIpStart,dhcpdns_checkBusinessRules_single_dhcpSlotIpEnd],$("#dhcpsloterror"),function(ipstart,ipend){var dhcpSlotStart32=stringToIP32(ipstart);var dhcpSlotEnd32=stringToIP32(ipend);return(dhcpSlotStart32<=dhcpSlotEnd32);});}
function dhcpdns_checkBusinessRules_single_vpnSlotIpStart(){return dhcpdns_checkBusinessRules_single_generic([$("#ipvpnstart")],[dhcpdns_checkBusinessRules_single_routerIp],$("#vpnSlotStartBadNetwork"),function(ipvpnstart){var iprouter=$("#iprouter")[0].getDataValue();var subnetmask=$("#subnetMask")[0].getDataValue();var iprouter32=stringToIP32(iprouter);var subnet32=stringToIP32(subnetmask);var ipvpnstart32=stringToIP32(ipvpnstart);return((iprouter32&subnet32)!=(ipvpnstart32&subnet32));});}
function dhcpdns_checkBusinessRules_single_vpnSlotIpEnd(){return dhcpdns_checkBusinessRules_single_generic([$("#ipvpnend")],[dhcpdns_checkBusinessRules_single_routerIp],$("#vpnSlotEndBadNetwork"),function(ipvpnend){var iprouter=$("#iprouter")[0].getDataValue();var subnetmask=$("#subnetMask")[0].getDataValue();var iprouter32=stringToIP32(iprouter);var subnet32=stringToIP32(subnetmask);var ipvpnend32=stringToIP32(ipvpnend);return((iprouter32&subnet32)!=(ipvpnend32&subnet32));});}
function dhcpdns_checkBusinessRules_combined_vpnSlotRange(){return dhcpdns_checkBusinessRules_single_generic([$("#ipvpnstart"),$("#ipvpnend")],[dhcpdns_checkBusinessRules_single_vpnSlotIpStart,dhcpdns_checkBusinessRules_single_vpnSlotIpEnd],$("#vpnsloterror"),function(ipstart,ipend){var ipvpnstart32=stringToIP32(ipstart);var ipvpnend32=stringToIP32(ipend);return(ipvpnstart32<=ipvpnend32);});}
function dhcpdns_checkFieldValue(){dhcpdns_checkBusinessRules_single_routerIp();dhcpdns_checkBusinessRules_single_dhcpSlotIpStart();dhcpdns_checkBusinessRules_single_dhcpSlotIpEnd();dhcpdns_checkBusinessRules_combined_dhcpSlotRange();dhcpdns_checkBusinessRules_single_vpnSlotIpStart();dhcpdns_checkBusinessRules_single_vpnSlotIpEnd();dhcpdns_checkBusinessRules_combined_vpnSlotRange();}
function dhcpdns_onDataChange(node,showErrorMsg){jQuery.orange.widget.Form.onDataChange.call(this,node,showErrorMsg);dhcpdns_checkFieldValue();var form=$("#dhcpdns form")[0];var newState=jQuery.orange.widget.Form.getState.call(form);if(newState==jQuery.orange.widget.Form.STATE_MODIF_OK&&(arrayIndexOf(form.modifsOK,$("#iprouter")[0])!=-1||arrayIndexOf(form.modifsOK,$("#dhcpSlotStart")[0])!=-1||arrayIndexOf(form.modifsOK,$("#dhcpSlotEnd")[0])!=-1||(arrayIndexOf(form.modifsOK,$("#ckDHCP")[0])!=-1&&$("#ckDHCP")[0].getDataValue()==true))){$("#rebootnote").css('display','inline');}else{$("#rebootnote").css('display','none');}}
jQuery.orange.config.areacontent.dhcpdns={preParse:function(){var XminAdressVPN="Device/Networks/LAN[@name='LAN']/MinAddressVPN";jQuery.orange.config.api.crud.read([XminAdressVPN],function(result){for(var minAdressVPN in result[XminAdressVPN].values){if(result[XminAdressVPN].values[minAdressVPN]==""||result[XminAdressVPN].values[minAdressVPN]==undefined||result[XminAdressVPN].values[minAdressVPN]==null){var id2value={};id2value[minAdressVPN]="192.168.5.1";jQuery.orange.config.api.crud.update(id2value);}}});var XmaxAdressVPN="Device/Networks/LAN[@name='LAN']/MaxAddressVPN";jQuery.orange.config.api.crud.read([XmaxAdressVPN],function(result){for(var maxAdressVPN in result[XmaxAdressVPN].values){if(result[XmaxAdressVPN].values[maxAdressVPN]==""||result[XmaxAdressVPN].values[maxAdressVPN]==undefined||result[XmaxAdressVPN].values[maxAdressVPN]==null){var id2value={};id2value[maxAdressVPN]="192.168.5.11";jQuery.orange.config.api.crud.update(id2value);}}});},preParse:function(){var XminAdressVPN="Device/Networks/LAN[@name='LAN']/MinAddressVPN";jQuery.orange.config.api.crud.read([XminAdressVPN],function(result){for(var minAdressVPN in result[XminAdressVPN].values){if(result[XminAdressVPN].values[minAdressVPN]==""||result[XminAdressVPN].values[minAdressVPN]==undefined||result[XminAdressVPN].values[minAdressVPN]==null){var id2value={};id2value[minAdressVPN]="192.168.5.1";jQuery.orange.config.api.crud.update(id2value);}}});var XmaxAdressVPN="Device/Networks/LAN[@name='LAN']/MaxAddressVPN";jQuery.orange.config.api.crud.read([XmaxAdressVPN],function(result){for(var maxAdressVPN in result[XmaxAdressVPN].values){if(result[XmaxAdressVPN].values[maxAdressVPN]==""||result[XmaxAdressVPN].values[maxAdressVPN]==undefined||result[XmaxAdressVPN].values[maxAdressVPN]==null){var id2value={};id2value[maxAdressVPN]="192.168.5.11";jQuery.orange.config.api.crud.update(id2value);}}});},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_dhcpdns.html");});$("#ckDHCP").bind("change",function(event,newValue){dhcpdns_disableElements();dhcpdns_checkFieldValue();if($("#ckDHCP")[0].getDataValue()){$("#ServerErrorState").attr("class","error block visibledependent-hide");}else{$("#ServerErrorState").attr("class","error block");}
$("#natpatRuleForIp").css('display','none');});$("#dnsmode").bind("valueChange",function(event,newValue){dhcpdns_disableElements();dhcpdns_checkFieldValue();$("#natpatRuleForIp").css('display','none');});dhcpdns_clearErrorMessages();$("#dhcpdns form")[0].onDataChange=dhcpdns_onDataChange;$("#dhcpdnsTable")[0].addRow=dhcpdns_postLoadTableAddRow;},postLoad:function(){var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){if(result[MeshEnable].values[MeshEnable]==true){$("#ckDHCP").setDisabled(true);if($("#ckDHCP")[0].attr('checked'))
$("#meshnote").css('display','inline');else
$("#meshnote").css('display','none');}else
$("#meshnote").css('display','none');});function verifyNatPatIpAdressWithcurrentValue(tr){var boolresult=false;var adressNatPat="Device/NAT/PortMappings/PortMapping[InternalClient='"+tr.children[1].children[0].dataValueRef+"']";jQuery.orange.config.api.crud.read([adressNatPat],function(result){if(result[adressNatPat]!=undefined){if(tr.children[1].children[0].dataValueRef!=tr.children[1].children[0].value){$("#natpatRuleForIp").css('display','block');boolresult=false;}
else{boolresult=true;}}
else{boolresult=true;}});return boolresult;}
$("#dhcpsubmit").bind("click",function(){$("#rebootnote").css('display','none');var innerNatPatIpAdress=true;function tableValid(){var i=0;while(this[i]){var haschangedAndnatPat=verifyNatPatIpAdressWithcurrentValue(this[i]);innerNatPatIpAdress=innerNatPatIpAdress&&haschangedAndnatPat;i++;}}
var child=$("#dhcpdnsTable form table tbody").children();if(child){tableValid.apply(child);}
jQuery.orange.widget.Table.NatPatIpAdress=innerNatPatIpAdress;if(!innerNatPatIpAdress){$("#dhcpdnsTable form").action=false;}});$("#dhcpcancel").bind("click",function(){$("#rebootnote").css('display','none');$("#natpatRuleForIp").css('display','none');});$("#iprouter").bind("keyup change",function(){dhcpdns_checkBusinessRules_single_routerIp();dhcpdns_checkBusinessRules_single_dhcpSlotIpStart();dhcpdns_checkBusinessRules_single_dhcpSlotIpEnd();dhcpdns_checkBusinessRules_combined_dhcpSlotRange();dhcpdns_checkBusinessRules_single_vpnSlotIpStart();dhcpdns_checkBusinessRules_single_vpnSlotIpEnd();dhcpdns_checkBusinessRules_combined_vpnSlotRange();$("#natpatRuleForIp").css('display','none');$("#dhcpdnsTable input[class*='table-col-1']").each(function(){jQuery.orange.widget.Form.onDataChange.call($("#dhcpdnsTable form")[0],this);});});$("#dhcpSlotStart").bind("keyup change",function(){dhcpdns_checkBusinessRules_single_dhcpSlotIpStart();dhcpdns_checkBusinessRules_combined_dhcpSlotRange();$("#natpatRuleForIp").css('display','none');});$("#dhcpSlotEnd").bind("keyup change",function(){dhcpdns_checkBusinessRules_single_dhcpSlotIpEnd();dhcpdns_checkBusinessRules_combined_dhcpSlotRange();$("#natpatRuleForIp").css('display','none');});$("#ipvpnstart").bind("keyup change",function(){dhcpdns_checkBusinessRules_combined_vpnSlotRange();$("#natpatRuleForIp").css('display','none');});$("#ipvpnend").bind("keyup change",function(){dhcpdns_checkBusinessRules_single_vpnSlotIpEnd();dhcpdns_checkBusinessRules_combined_vpnSlotRange();$("#natpatRuleForIp").css('display','none');});dhcpdns_checkFieldValue();$("#dhcpdnsTable .table-add-button img").attr('i18n','page.myNetwork.dhcpdns.staticip.add').parent().orangeParse();$("#dhcpdnsTableErr").insertAfter($("#dhcpdnsTable table"));$("#staticIPBadSubnet").insertAfter($("#dhcpdnsTable table"));}};natpat_tableDefaultValues={"ALL":{protocol:"ALL",port:"0"},"DNS":{protocol:"ALL",port:"53"},"HTTP":{protocol:"TCP",port:"80"},"HTTPS":{protocol:"TCP",port:"443"},"FTP-Data":{protocol:"TCP",port:"20"},"FTP":{protocol:"TCP",port:"21"},"POP3":{protocol:"TCP",port:"110"},"POP3S":{protocol:"TCP",port:"995"},"IMAP":{protocol:"TCP",port:"143"},"IMAPS":{protocol:"TCP",port:"993"},"SMTP":{protocol:"TCP",port:"25"},"SMTP-Auth":{protocol:"TCP",port:"587"},"NTP":{protocol:"UDP",port:"123"},"NNTP":{protocol:"TCP",port:"119"},"Telnet":{protocol:"TCP",port:"23"},"SSH":{protocol:"TCP",port:"22"},"Ping":{protocol:"ICMP"}};function natpat_tableRangeOnDataUpdate(value,result){if(result!=undefined)
return;this.dataValueRef=this.getDataValue();jQuery.orange.widget.Form.onDataChange.call(getFirstParentWithNodeName(this,"FORM"),this);}
function natpat_tableSelect4Change(event,ui){var input=event.target;if(input.value==jQuery.orange.config.i18n.map["page.myNetwork.natpat.redirections.equipmentip.ipchoice"]){input.setDataValue("");jQuery.orange.widget.Form.verifyConstraints(input,false);}}
function natpat_tableSelect0Change(event,ui){var input=event.target;var value=(ui.item!=undefined)?ui.item.value:input.value;var td=input.parentNode;if(value!=jQuery.orange.config.i18n.map[$(input).attr("i18n")+AUTOCOMPLETE_EMPTYTEXT_I18N_SUFFIX]){var protocolAndPort=natpat_tableDefaultValues[value];if(protocolAndPort!=undefined){var tr=td.parentNode;if(protocolAndPort.port!=undefined){$("td:eq(1)  [widgettype='PortRange']",tr)[0].setDataValue(protocolAndPort.port);}
$("td:eq(2) [widgettype='PortRange']",tr)[0].setDataValue("0");natpat_tableOnRowSelect(null,tr);select=$("td:eq(3) select",tr)[0];var protocol=protocolAndPort.protocol;select.setDataValue(protocol);}}
else{var tr=td.parentNode;$("td:eq(1) input",tr)[0].setDataValue("");$("td:eq(3) select",tr)[0].setDataValue("TCP");}}
function natpat_tableAddRow(id,attrs){if(attrs!=undefined){if(attrs.ExternalPort!=undefined)
if(attrs.ExternalPortEndRange!=undefined&&parseInt(attrs.ExternalPortEndRange)>0)
attrs.ExternalPortRange=attrs.ExternalPort+"-"+attrs.ExternalPortEndRange;else
attrs.ExternalPortRange=""+attrs.ExternalPort;if(attrs.InternalPort!=undefined)
if(attrs.InternalPortEndRange!=undefined&&parseInt(attrs.InternalPortEndRange)>0&&attrs.InternalPort!=attrs.InternalPortEndRange)
attrs.InternalPortRange=attrs.InternalPort+"-"+attrs.InternalPortEndRange;else
attrs.InternalPortRange=""+attrs.InternalPort;}
var currentId;var tr;if(attrs!=undefined&&attrs.uid!=undefined){currentId=$("#natpatTable").attr("dataid")+"[@uid='"+attrs.uid+"']";}
else if(id!=undefined){currentId=$("#natpatTable").attr("dataid")+"[@uid='"+id+"']";}
else{currentId=id;}
tr=jQuery.orange.widget.Table.addRow.call(this,currentId,attrs);$("td:eq(3) select",tr).each(function(){if(this.dataValueRef!=undefined&&this.getDataValue()!=this.dataValueRef){var value=this.dataValueRef;$(this).empty().attr("enumerated","['"+value+"']").append("<option value='"+value+"'>"+value+"</option>");this.setDataValue(value);}});$("td:eq(1) input",tr)[0].onDataUpdate=natpat_tableRangeOnDataUpdate;$("td:eq(2) input",tr)[0].onDataUpdate=natpat_tableRangeOnDataUpdate;var source=new Array();for(var name in natpat_tableDefaultValues)
source.push(name);var inputAppli=$("td:eq(0) input",tr);var emptyText=jQuery.orange.config.i18n.map[inputAppli.attr("i18n")+AUTOCOMPLETE_EMPTYTEXT_I18N_SUFFIX];makeAutoComplete(inputAppli,emptyText,source);if(attrs!=undefined)
jQuery.orange.setDataValue(inputAppli[0],attrs['Description']);inputAppli.bind("valueChange autocompletechange autocompleteclose",natpat_tableSelect0Change);var inputEquip=$("td:eq(4) input",tr);inputEquip.bind("valueChange autocompletechange autocompleteclose",natpat_tableSelect4Change);source=new Array();for(var index in natpat_tableDeviceList){var active=natpat_tableDeviceList[index]["Active"];var IPAddress=natpat_tableDeviceList[index]["IPAddress"];var userFriendlyName=natpat_tableDeviceList[index]["UserFriendlyName"];var sourceNature=natpat_tableDeviceList[index]["AddressSource"];if(active=="CONNECTED"){source.push(userFriendlyName);}else if(sourceNature=="STATIC"){source.push(IPAddress);}}
var inputDevice=$("td:eq(4) input",tr);var emptyTextDevice=jQuery.orange.config.i18n.map[inputDevice.attr("i18n")+AUTOCOMPLETE_EMPTYTEXT_I18N_SUFFIX];var ipchoiceDevice=jQuery.orange.config.i18n.map[inputDevice.attr("i18n")+".ipchoice"];emptyTextDevice=ipchoiceDevice;if(source.length>0){source.push("");}
source.push(ipchoiceDevice);makeAutoComplete(inputDevice,ipchoiceDevice,source,ipchoiceDevice);inputDevice[0].getDataValue=function(){var value=inputDevice.val();if(value!=""){for(var index in natpat_tableDeviceList){if(natpat_tableDeviceList[index]["UserFriendlyName"]==value){return natpat_tableDeviceList[index]["IPAddress"];}}}
return(this.value==ipchoiceDevice)?"":this.value;};inputDevice[0].setDataValue=function(value){this.value=value;$(this).trigger("valueChange",[value]);};inputDevice[0].validate=function(){var NOT_GOOD_NOT_WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;var displayValue=inputDevice.val();if(displayValue==""||displayValue==jQuery.orange.config.i18n.map["page.myNetwork.natpat.redirections.equipmentip.ipchoice"]){return NOT_GOOD_NOT_WRONG;}
for(var index in natpat_tableDeviceList){if(natpat_tableDeviceList[index]["UserFriendlyName"]==displayValue||natpat_tableDeviceList[index]["IPAddress"]==displayValue){if(natpat_isStatic(natpat_tableDeviceList[index]["PhysAddress"])){this.error=undefined;return GOOD;}else{this.error="notstatic";return WRONG;}}}
if(jQuery.orange.widget.Form.constraint.regex(jQuery.orange.config.namedregex.ipaddress,natpat_tableDeviceList[index]["IPAddress"])==WRONG){this.error="ip";return WRONG;}else{this.error=undefined;return GOOD;}};inputDevice[0].getError=function(){return this.error;};if(attrs!=undefined&&attrs['InternalClient']!=""){for(var index in natpat_tableDeviceList){if(natpat_tableDeviceList[index]["IPAddress"]==attrs['InternalClient']){if(natpat_tableDeviceList[index]["UserFriendlyName"]!=""){inputDevice.val(natpat_tableDeviceList[index]["UserFriendlyName"]);}else{inputDevice.val(attrs['InternalClient']);}}}}else{inputDevice.val(emptyTextDevice);inputDevice.addClass(AUTOCOMPLETE_EMPTYTEXT_CSS_CLASS);}
inputDevice.bind("valueChange",function(event,ui){inputDevice.trigger("change");});inputDevice.bind("autocompletechange autocompleteclose",function(event,ui){if(ui.item!=undefined){inputDevice[0].setDataValue(ui.item.value);}});if(attrs!=undefined)
return tr;$("td:eq(2) input",tr)[0].setDataValue("0");$("td:eq(5) input",tr)[0].setDataValue(true);return tr;}
function natpat_tableGetActions(crudAction){var actions=jQuery.orange.widget.Table.getActions.call(this,crudAction);if(actions===false)
return false;for(var i in actions){var action=actions[i];if(action.crud=="update"){if(action.id.endsWith("Range")){var prefix=action.id.substring(0,action.id.length-5);action.id=prefix;var index=action.value.indexOf("-");if(index!=-1){var end=action.value.substring(index+1);action.value=action.value.substring(0,index);actions.push({id:action.id+"EndRange",crud:"update",node:action.node,value:end});}}}else if(action.crud=="create"){action.id="Device/NAT/PortMappings/PortMapping";var attrs=action.attrs,newAttrs={Creator:"USER"};for(var name in attrs){var value=attrs[name];if(name.endsWith("Range")){var prefix=name.substring(0,name.length-5);var index=value.indexOf("-");if(index!=-1){newAttrs[prefix]=value.substring(0,index);newAttrs[prefix+"EndRange"]=value.substring(index+1);}else
newAttrs[prefix]=value;}else
newAttrs[name]=value;}
action.attrs=newAttrs;}}
return actions;}
function natpat_tableOnRowSelect(event,tr){$("#natpat #externalport").text($("td:eq(1) input",tr)[0].value);$("#natpat #internalport").text($("td:eq(2) input",tr)[0].value);$("input[type=text]",tr.parentNode).unbind(".natpat");$("td:eq(1) input",tr).bind("keyup.natpat",function(event){$("#natpat #externalport").text(event.target.value);});$("td:eq(1) [widgettype='PortRange']",tr).bind("valueChange.natpat",function(event){$("#natpat #externalport").text($("input",this)[0].value);});$("td:eq(2) input",tr).bind("keyup.natpat",function(event){$("#natpat #internalport").text(event.target.value);});}
function natpat_initializeStaticDeviceList(){natpat_staticDeviceList={};var xpath_staticPoolDevices="Device/Networks/LAN[@name='LAN']/StaticPoolDevices/StaticPoolDevice";jQuery.orange.config.api.crud.read([xpath_staticPoolDevices],function(result){var data=result[xpath_staticPoolDevices];if(data!=undefined){for(var device in data.values){var macAddress=data.values[device]["PhysAddress"];if(macAddress!=undefined&&macAddress!=""){natpat_staticDeviceList[macAddress]="static";}}}});}
String.prototype.startsWith=function(str){return(this.match("^"+str)==str);};String.prototype.trim=function(){return(this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,""));};function natpat_isStatic(macAddress){return(natpat_staticDeviceList[macAddress]=="static");}
jQuery.orange.config.areacontent.natpat={postParse:function(area){natpat_initializeStaticDeviceList();natpat_tableDeviceList=new Array();var EthernetDevice="Device/Networks/LAN[@name='LAN']/ConnectedDevices/EthernetDevice";var i=0;jQuery.orange.config.api.crud.read([EthernetDevice],function(result){if(result[EthernetDevice]!=undefined){for(var device in result[EthernetDevice].values){natpat_tableDeviceList[i]={"IPAddress":result[EthernetDevice].values[device]["IPAddress"],"UserFriendlyName":result[EthernetDevice].values[device]["UserFriendlyName"],"AddressSource":result[EthernetDevice].values[device]["AddressSource"],"PhysAddress":result[EthernetDevice].values[device]["PhysAddress"],"Active":result[EthernetDevice].values[device]["Active"],"Uid":result[EthernetDevice].values[device]["uid"]};i++;}}});var WiFiDevice="Device/Networks/LAN[@name='LAN']/ConnectedDevices/WiFiDevice";jQuery.orange.config.api.crud.read([WiFiDevice],function(result){if(result[WiFiDevice]!=undefined){for(var device in result[WiFiDevice].values){natpat_tableDeviceList[i]={"IPAddress":result[WiFiDevice].values[device]["IPAddress"],"UserFriendlyName":result[WiFiDevice].values[device]["UserFriendlyName"],"AddressSource":result[WiFiDevice].values[device]["AddressSource"],"PhysAddress":result[WiFiDevice].values[device]["PhysAddress"],"Active":result[WiFiDevice].values[device]["Active"],"Uid":result[WiFiDevice].values[device]["uid"]};i++;}};});var table=$("#natpatTable",area)[0];table.addRow=natpat_tableAddRow;var form=$("form",table)[0];form.getActions=natpat_tableGetActions;$(table).bind("rowSelect",natpat_tableOnRowSelect);},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_natpat.html");});$("#natpatTableErr").insertAfter($("#natpatTable table"));$("#natpatTable .table-add-button img").attr('i18n','page.myNetwork.natpat.redirections.add').parent().orangeParse();$("#natpat form")[0].crudCallDelegate=function(crudExec){$("#btnSave").setDisabled(true);$("#btnCancel").setDisabled(true);crudExec();};jQuery.orange.widget.Table.NatPatIpAdress=false;}};jQuery.orange.config.areacontent.upnp={postParse:function(){var UPNpEnable="Device/NAT/UPNpEnable";jQuery.orange.config.api.crud.read([UPNpEnable],function(result){if(result[UPNpEnable].values[UPNpEnable]==false){var UPnP="Device/NAT/PortMappings/PortMapping[Creator='UPNP']";}});$('#ckUPnP').bind("change",function(event,newValue){if(newValue){$("#refreshBtn").removeClass("disabled");$("#refreshBtn").setDisabled(false);}else if(newValue!=undefined){$("#refreshBtn").addClass("disabled");$("#refreshBtn").setDisabled(true);}});$("#refreshBtn").bind('click',function(){$("#content").orangeLoad(menu.mapping.upnp);});var table=$("#upnpTable")[0];table.addRow=upnp_tableAddRow;function upnp_tableAddRow(id,attrs){var tr=jQuery.orange.widget.Table.addRow.call(this,id,attrs);$(tr).attr("noAutoRefresh","true");$("td:eq(5)",tr).attr("i18n","page.myNetwork.upnp.applist.col.delete");$("td:eq(5)",tr).orangeTranslate();return tr;}
$("#help").bind("click",function(){helpPopup("html/main/help_upnp.html");});}};function resetDeviceList(){$(".unselectable").show();$("#DeviceList").val('unselected');$("#DeviceList").css("font-style","italic");}
jQuery.orange.config.areacontent.dmz={goDisable:function(disable){$("#btnDelete").setDisabled(disable);if(disable){$("#btnDelete").attr("i18n","page.myNetwork.dmz.delete.undeletable");$("#btnDelete").orangeTranslate();}else{$("#btnDelete").attr("i18n","page.myNetwork.dmz.delete");$("#btnDelete").orangeTranslate();}},preParse:function(){$("#DMZIP").hide();$("#DeviceList").append('<option style="font-style:italic;" class="unselectable" value="" i18n="page.myNetwork.dmz.device"/>');},postParse:function(){var EthernetDevice="Device/Networks/LAN[@name='LAN']/ConnectedDevices/EthernetDevice";jQuery.orange.config.api.crud.read([EthernetDevice],function(result){if(result[EthernetDevice]!=undefined){for(var device in result[EthernetDevice].values){if(result[EthernetDevice].values[device]["IPAddress"]!=""){$("#DeviceList").append('<option style="font-style: normal;" value="'+result[EthernetDevice].values[device]["IPAddress"]+'">'+result[EthernetDevice].values[device]["UserFriendlyName"]+'</option>');}}}});var WiFiDevice="Device/Networks/LAN[@name='LAN']/ConnectedDevices/WiFiDevice";jQuery.orange.config.api.crud.read([WiFiDevice],function(result){if(result[WiFiDevice]!=undefined){for(var device in result[WiFiDevice].values){if(result[WiFiDevice].values[device]["IPAddress"]!="")
$("#DeviceList").append('<option style="font-style: normal;" value="'+result[WiFiDevice].values[device]["IPAddress"]+'">'+result[WiFiDevice].values[device]["UserFriendlyName"]+'</option>');}}});$("#DeviceList").append('<option value="null" disabled="disabled"/>');$("#DeviceList").append('<option style="font-style: italic;" value="STATIC" i18n="page.myNetwork.dmz.static"/>');$("#DeviceList").parent().orangeParse();$("#DeviceList").bind("change",function(event,newValue){$("#DMZIP").removeClass("supErrorInput");$("#existantiperror").hide();var jNode=$("#DMZIP_vis");if(event.currentTarget.value=="STATIC"){jNode.setDisabled(false);$("#DMZIP").val("");$("#DMZIP").show();$("#DMZIP_vis").hide();$("#DeviceList").css("font-style","italic");}else{$("#DeviceList").css("font-style","normal");jNode.setDisabled(true);$("#DMZIP").hide();$("#DMZIP_vis").show();if(event.currentTarget.value!="null"){if(event.currentTarget.value==""){$("#DMZIP").val("");$("#DeviceList").css("font-style","italic");resetDeviceList();}else{$("#DMZIP").val(event.currentTarget.value);}}else{$("#DMZIP").val("");$("#DeviceList").css("font-style","italic");resetDeviceList();}}
$("#DMZIP").trigger("valueChange");});$("#DeviceList").attr('i18n','page.myNetwork.dmz.device').parent().orangeParse();$("#dmz form")[0].onReset=function(){$("#DMZIP").removeClass("supErrorInput");$("#existantiperror").hide();jQuery.orange.config.areacontent.dmz.postLoad();var form=$("#dmz form")[0];var dmzNode=$("#DMZIP");var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO.splice(arrayIndexOf2(form.dataKO,dmzNode),1);var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);};$("#dmz form")[0].crudCallDelegate=function(crudExec){crudExec();$("#DMZIP").removeClass("supErrorInput");$("#existantiperror").hide();if($("#DMZIP")[0].getDataValue()!=""){jQuery.orange.config.areacontent.dmz.goDisable(false);}
else{jQuery.orange.config.areacontent.dmz.goDisable(true);}};$("#btnDelete").bind('click',function(){$("#DMZIP").removeClass("supErrorInput");$("#existantiperror").hide();if(this.getAttribute('disabled')!="disabled"){openConfirmationPopup('popup.confirm.title','popup.confirm.text',function(){resetDeviceList();$("#DeviceList").trigger('change');jQuery.orange.config.areacontent.dmz.goDisable(true);});}});},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_dmz.html");});var notAllowedIP=new Array();var IPRouters="Device/Networks/LAN[@name='LAN']/IPRouters";jQuery.orange.config.api.crud.read([IPRouters],function(result){for(var Xiprouter in result[IPRouters].values){notAllowedIP.push(result[IPRouters].values[Xiprouter]);}});var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){MeshEnable=result[MeshEnable].values[MeshEnable];});if(MeshEnable==true){var APDevice="Device/MESH/AccessPoints/AccessPoint";jQuery.orange.config.api.crud.read([APDevice],function(result){if(result[APDevice].nb>0){for(var box in result[APDevice].values){notAllowedIP.push(result[APDevice].values[box]["IPAddress"]);}}});}
var jNode=$("#DMZIP_vis");var value=$("#DMZIP")[0].dataValueRef;var options=$("#DeviceList")[0].options;if(value!=""){for(var i=0;i<options.length;i++){if(options[i].value==value){jNode.setDisabled(true);$("#DMZIP").hide();$("#DMZIP_vis").show();$("#DeviceList").val(value);break;}else{$("#DeviceList").val("STATIC");$("#DMZIP").val(value);jNode.setDisabled(false);$("#DMZIP").show();$("#DMZIP_vis").hide();}}}else{resetDeviceList();$("#DMZIP").val("");jNode.setDisabled(true);$("#DMZIP").hide();$("#DMZIP_vis").show();}
$("#DMZIP").trigger("valueChange");$("#DMZIP").bind('valueChange',function(event){$("#DMZIP").removeClass("supErrorInput");$("#DMZIP_vis").val(event.target.value);});$("#DMZIP_vis").val($("#DMZIP").val());if($("#DMZIP").val()==""){jQuery.orange.config.areacontent.dmz.goDisable(true);}
else{jQuery.orange.config.areacontent.dmz.goDisable(false);}
$("#DMZIP").bind('change keyup',function(event){var form=$("#dmz form")[0];var dmzNode=$("#DMZIP");var oldState=jQuery.orange.widget.Form.getState.call(form);if(arrayIndexOf(notAllowedIP,event.target.value)!=-1){if(arrayIndexOf2(form.dataKO,dmzNode)==-1){$("#existantiperror").show();$("#DMZIP").addClass("supErrorInput");form.dataKO.push(dmzNode);}else{$("#existantiperror").hide();}}else{dmzNode.removeClass("supErrorInput");form.dataKO.splice(arrayIndexOf2(form.dataKO,$("#DMZIP")),1);$("#existantiperror").hide();}
var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState)
jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);});$("select#DeviceList").bind('click',function(){$(".unselectable").hide();});if($("#DeviceList").val()!="STATIC"&&$("#DeviceList").val()!=""){$("#DeviceList").css("font-style","normal");}}};var ntpTimezone=new Object;ntpTimezone["UTC-12_00_INTERNATIONAL_DATE_LINE_WEST"]=9;ntpTimezone["UTC-11_00_MIDWAY_ISLAND_SAMOA"]=19;ntpTimezone["UTC-10_00_HAWAII"]=29;ntpTimezone["UTC-09_00_ALASKA"]=39;ntpTimezone["UTC-08_00_PACIFIC_TIME_(US/CANADA)_TIJUANA"]=49;ntpTimezone["UTC-07_00_ARIZONA"]=59;ntpTimezone["UTC-07_00_MOUNTAIN_TIME_(US/CANADA)"]=59;ntpTimezone["UTC-07_00_CHIHUAHUA_MAZATLAN"]=59;ntpTimezone["UTC-06_00_CENTRAL_AMERICA"]=69;ntpTimezone["UTC-06_00_CENTRAL_TIME_(US/CANADA)"]=69;ntpTimezone["UTC-06_00_GUADALAJARA_MEXICO_CITY_MONTERREY"]=69;ntpTimezone["UTC-06_00_SASKATCHEWAN"]=69;ntpTimezone["UTC-05_00_BOGOTA_LIMA_QUITO"]=79;ntpTimezone["UTC-05_00_EASTERN_TIME_(US/CANADA)"]=79;ntpTimezone["UTC-05_00_INDIANA_(EAST)"]=79;ntpTimezone["UTC-04_00_ATLANTIC_TIME_(CANADA)"]=89;ntpTimezone["UTC-04_00_CARACAS_LA_PAZ"]=89;ntpTimezone["UTC-04_00_SANTIAGO"]=89;ntpTimezone["UTC-03_30_NEWFOUNDLAND"]=94;ntpTimezone["UTC-03_00_BRASILIA"]=99;ntpTimezone["UTC-03_00_BUENOS_AIRES_GEORGETOWN"]=99;ntpTimezone["UTC-03_00_GREENLAND"]=99;ntpTimezone["UTC-02_00_MID-ATLANTIC"]=109;ntpTimezone["UTC-01_00_AZORES_CAPE_VERDE_IS"]=119;ntpTimezone["UTC-00_CASABLANCA_LISBON_MONROVIA"]=129;ntpTimezone["UTC-00_DUBLIN_EDINBURGH_LONDON"]=129;ntpTimezone["UTC+01_00_AMSTERDAM_BERN_ROME_STOCKHOLM"]=139;ntpTimezone["UTC+01_00_BELGRADE_BERLIN_BUDAPEST_LJUBLJANA"]=139;ntpTimezone["UTC+01_00_BRUSSELS_COPENHAGEN_MADRID"]=139;ntpTimezone["UTC+01_00_PARIS"]=139;ntpTimezone["UTC+01_00_BRATISLAVA_PRAGUE_VIENNA"]=139;ntpTimezone["UTC+01_00_SARAJEVO_SKOPJE_WARSAW_ZAGREB"]=139;ntpTimezone["UTC+01_00_WEST_CENTRAL_AFRICA"]=139;ntpTimezone["UTC+02_00_ATHENS_ISTANBUL_MINSK"]=149;ntpTimezone["UTC+02_00_BUCHAREST_CAIRO"]=149;ntpTimezone["UTC+02_00_HARARE_PRETORIA"]=149;ntpTimezone["UTC+02_00_HELSINKI_KYIV_RIGA_SOFIA_TALLINN_VILNIUS"]=149;ntpTimezone["UTC+02_00_JERUSALEM"]=149;ntpTimezone["UTC+03_00_BAGHDAD_KUWAIT_RIYADH"]=159;ntpTimezone["UTC+03_00_MOSCOW_ST_PETERSBURG_VOLGOGRAD"]=159;ntpTimezone["UTC+03_00_NAIROBI"]=159;ntpTimezone["UTC+03_30_TEHRAN"]=165;ntpTimezone["UTC+04_00_ABU_DHABI_MUSCAT"]=169;ntpTimezone["UTC+04_00_BAKU_TBILISI_YEREVAN"]=169;ntpTimezone["UTC+04_30_KABUL"]=174;ntpTimezone["UTC+05_00_EKATERINBURG"]=179;ntpTimezone["UTC+05_00_ISLAMABAD_KARACHI_TASHKENT"]=179;ntpTimezone["UTC+05_30_CHENNAY_KOLKATA_MUMBAL_NEW_DELHI"]=184;ntpTimezone["UTC+05_45_KATMANDU"]=186;ntpTimezone["UTC+06_00_ALMATY_NOVOSIBIRSK"]=189;ntpTimezone["UTC+06_00_ASTANA_DHAKA"]=189;ntpTimezone["UTC+06_30_RANGOON"]=194;ntpTimezone["UTC+07_00_BANGKOK_HANOI_JAKARTA"]=199;ntpTimezone["UTC+07_00_KRASNOYARSK"]=199;ntpTimezone["UTC+08_00_BEIJING_CHONGQING_HONG_KONG_URUMQI"]=209;ntpTimezone["UTC+08_00_IRKUTSK_ULAAN_BATAAR"]=209;ntpTimezone["UTC+08_00_KUALA_LUMPUR_SINGAPORE"]=209;ntpTimezone["UTC+08_00_PERTH_TAIPEI"]=209;ntpTimezone["UTC+09_00_OSAKA_SAPPORO_TOKYO"]=219;ntpTimezone["UTC+09_00_SEOUL_YAKUTSK"]=219;ntpTimezone["UTC+09_30_ADELAIDE_DARWIN"]=224;ntpTimezone["UTC+10_00_BRISBANE"]=229;ntpTimezone["UTC+10_00_CANBERRA_MELBOURNE_SYDNEY"]=229;ntpTimezone["UTC+10_00_GUAM_PORT_MORESBY"]=229;ntpTimezone["UTC+10_00_HOBART_VLADIVOSTOK"]=229;ntpTimezone["UTC+11_00_MAGADAN_SOLOMON_IS_NEW_CALEDONIA"]=239;ntpTimezone["UTC+12_00_AUCKLAND_WELLINGTON"]=249;ntpTimezone["UTC+12_00_FIJI_KAMCHATKA_MARSHALL_IS"]=249;ntpTimezone["UTC+13_00_NUKUALOFA"]=259;function ntp_updateEarthMap(newValue){if(newValue){$("#ntpmapselection").css('left',ntpTimezone[newValue]+'px');}}
var fuseau=0;function heure_gmt(){if(fuseau==0){suffix="Z";}else if(fuseau==-1){suffix="A";}else if(fuseau==-2){suffix="B";}else if(fuseau==-3){suffix="C";}else if(fuseau==-4){suffix="D";}else if(fuseau==-5){suffix="E";}else if(fuseau==-6){suffix="F";}else if(fuseau==-7){suffix="G";}else if(fuseau==-8){suffix="H";}else if(fuseau==-9){suffix="I";}else if(fuseau==-10){suffix="J";}else if(fuseau==-11){suffix="K";}else if(fuseau==-12){suffix="L";}else if(fuseau==1){suffix="M";}else if(fuseau==2){suffix="N";}else if(fuseau==3){suffix="O";}else if(fuseau==4){suffix="P";}else if(fuseau==5){suffix="Q";}else if(fuseau==6){suffix="R";}else if(fuseau==7){suffix="S";}else if(fuseau==8){suffix="T";}else if(fuseau==9){suffix="U";}else if(fuseau==10){suffix="V";}else if(fuseau==11){suffix="W";}else if(fuseau==12){suffix="X";}else if(fuseau==-1){suffix="Y";}
memoire=fuseau;var x=new Date();var heure_gmt_temp=x.getUTCHours();var heure_gmt=heure_gmt_temp+fuseau;var year=x.getUTCFullYear();var month=x.getUTCMonth()+1;var day=x.getUTCDate();if(heure_gmt<0){heure_gmt=24+heure_gmt;}
if(heure_gmt>23){heure_gmt=heure_gmt-24;}
if(heure_gmt<=9)heure_gmt="0"+heure_gmt;var minutes=x.getMinutes();if(minutes<=9)minutes="0"+minutes;var secondes=x.getSeconds();if(secondes<=9)secondes="0"+secondes;if(month<=9)month="0"+month;if(day<=9)day="0"+day;var gmt=year+"-"+month+"-"+day+"T"+heure_gmt+":"+minutes+":"+secondes+suffix;if($("#CurrentLocalTime")[0]!=undefined){$("#CurrentLocalTime")[0].setDataValue(gmt);}}
function getGmt(timeZone){var diffGMT=0;var indexOp=timeZone.indexOf("+",0);if(indexOp==-1){indexOp=timeZone.indexOf("-",0);var diff=timeZone.substring(indexOp+1,indexOp+3);diffGMT=0-parseInt(diff);}
else{var diff=timeZone.substring(indexOp+1,indexOp+3);diffGMT=parseInt(diff);}
return diffGMT;}
var gmtTimer;jQuery.orange.config.areacontent.ntp={postParse:function(){$("#ntpmapselection").css('left',ntpTimezone["UTC-12_00_INTERNATIONAL_DATE_LINE_WEST"]+'px');$("#ntptimezone").bind("change",function(event,newValue){ntp_updateEarthMap(newValue);});$("#ntptimezone select").bind("change keyup",function(event){var newValue=$("#ntptimezone")[0].getDataValue();fuseau=getGmt(newValue);clearTimeout(gmtTimer);gmtTimer=setInterval(function(){heure_gmt()},1000);ntp_updateEarthMap(newValue);});$("#help").bind("click",function(){helpPopup("html/main/help_ntp.html");});},postLoad:function(){gmtTimer=setInterval(function(){heure_gmt()},1000);}};function TableBorder(){$("#stsTable tr").css("border","none");$(".vpn_graphicsts").css("border-right","1px solid #CCCCCC");$("#nomadeTable tr").css("border","none");$(".vpn_graphicnomade").css("border-right","1px solid #CCCCCC");var nbLignestsTable=$("#stsTable tr").length-1;var nbLignenomadeTable=$("#nomadeTable tr").length-1;if(nbLignestsTable>=2){$("#stsTable tr").css("border","1px solid #CCCCCC");$(".vpn_graphicsts").css("border-right","none");}
if(nbLignenomadeTable>=2){$("#nomadeTable tr").css("border","1px solid #CCCCCC");$(".vpn_graphicnomade").css("border-right","none");}}
function vpn_synchronizeTableWidth(){var nbColsSts=$("#stsTable th").length;var nbColsNomade=$("#nomadeTable th").length;for(var c=0;c<Math.max(nbColsSts,nbColsNomade);c++){var widthSts=0;if(c<nbColsSts){widthSts=$("#stsTable th:eq("+c+")").width();}
var widthNomade=0;if(c<nbColsNomade){widthNomade=$("#nomadeTable th:eq("+c+")").width();}
var finalWidth=Math.max(widthSts,widthNomade);if(c<nbColsSts){$("#stsTable th:eq("+c+")").width(finalWidth);}
if(c<nbColsNomade){$("#nomadeTable th:eq("+c+")").width(finalWidth);}}}
function vpn_isDeletable(node){var deletable=false;var jRow=$(node).parents("tr");if(jRow.length==1){deletable=jRow.attr("connected")=="false";}
return deletable;}
function vpn_updateDeletable(node){var jRow=$(node).parents("tr");var jTrashBin=$("td img.deleting",jRow);if(jTrashBin.length==1){var deletable=vpn_isDeletable(node);jQuery.orange.setDataValue(jTrashBin[0],deletable);}}
function vpn_updateMaskedSts(){var doMask=$("#maskSts")[0].getDataValue();if(doMask=="oui"){$("#stsTable tr[activated='false']").show();$("#maskSts").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.maskinactive.true.tip"]);}else{$("#stsTable tr[activated='false']").hide();$("#maskSts").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.maskinactive.false.tip"]);}
$("#stsTable tr[activated='true']").show();$("#stsTable tr[deleted='true']").hide();}
function vpn_updateMaskedNomade(){var doMask=$("#maskNomade")[0].getDataValue();if(doMask=="oui"){$("#nomadeTable tr[activated='false']").show();$("#maskNomade").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.maskinactive.true.tip"]);}else{$("#nomadeTable tr[activated='false']").hide();$("#maskNomade").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.maskinactive.false.tip"]);}
$("#nomadeTable tr[activated='true']").show();$("#nomadeTable tr[deleted='true']").hide();}
jQuery.orange.config.areacontent.vpn={preParse:function(){$("#content").removeData("selectedUserName");$("#stsTable, #nomadeTable").hide();var defaultGroupName="default";var XdefaultGroup="Device/Networks/WAN[@name='WAN']/VPN/RoadWarriorVPNs/RoadWarriorVPN[@Name='"+defaultGroupName+"']";jQuery.orange.config.api.crud.read([XdefaultGroup],function(result){if(result[XdefaultGroup]==undefined){jQuery.orange.config.api.crud.create("Device/Networks/WAN[@name='WAN']/VPN/RoadWarriorVPNs/RoadWarriorVPN",{"Name":"default"});}});$("#maskSts").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.maskinactive.true.tip"]);$("#maskNomade").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.maskinactive.true.tip"]);var Xsites="Device/Networks/WAN[@name='WAN']/VPN/NetToNetVPNs/NetToNetVPN";jQuery.orange.config.api.crud.read([Xsites],function(result){var lineref=0;for(site in result[Xsites].values){var sitename=result[Xsites].values[site]["Name"];var rowContent="<tr id=\"sts"+lineref+"\" refid=\"Device/Networks/WAN[@name='WAN']/VPN/NetToNetVPNs/NetToNetVPN[@Name='"+sitename+"']\">";var Xconnected="Device/Networks/WAN[@name='WAN']/VPN/NetToNetVPNs/NetToNetVPN[@Name='"+sitename+"']/Connected";rowContent+="<td><img class=\"status\" dataid=\""+Xconnected+"\" i18nPrefix=\"data.vpn.vpnSts.status\" widgetType=\"Image\"/></td>";rowContent+="<td>"+sitename+"</td>";var Xenable="Device/Networks/WAN[@name='WAN']/VPN/NetToNetVPNs/NetToNetVPN[@Name='"+sitename+"']/Enable";rowContent+="<td class='center'><input lineref=\""+lineref+"\" class=\"enablingSite\" type=\"checkbox\" dataId=\""+Xenable+"\"/></td>";rowContent+="<td class=\"btnCursor\"> <a id=\""+sitename+"\" class=\"linktosts\"><img  i18n=\"data.vpn.vpnSts.Update\" widgetType=\"Image\"/></a></td>";rowContent+="<td class='center'><img lineref=\""+lineref+"\" sitename=\""+sitename+"\" class=\"deleting\" dataid=\""+Xconnected+"\" i18nPrefix=\"data.vpn.vpnSts.deleteable\" widgetType=\"Image\"/></td>";rowContent+="</tr>";$("#stsTable").append(rowContent);lineref++;}});var Xnomades="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser";jQuery.orange.config.api.crud.read([Xnomades],function(result){var lineref=0;for(nomade in result[Xnomades].values){var nomadename=result[Xnomades].values[nomade]["Login"];var rowContent="<tr id=\"nomade"+lineref+"\" refid=\"Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+nomadename+"']\">";var Xconnected="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+nomadename+"']/ConnectionStatus";rowContent+="<td><img class=\"status\" dataid=\""+Xconnected+"\" i18nPrefix=\"data.vpn.vpnSts.status\"/></td>";rowContent+="<td>"+nomadename+"</td>";var Xenable="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+nomadename+"']/Enable";rowContent+="<td class='center'><input lineref=\""+lineref+"\" class=\"enablingUser\" type=\"checkbox\" dataId=\""+Xenable+"\"/></td>";rowContent+="<td class=\"btnCursor\"><a lineref=\""+lineref+"\" class=\"linktouser\" id=\""+nomadename+"\" ><img  i18n=\"data.vpn.vpnNomade.Update\" widgetType=\"Image\"/></a></td>";rowContent+="<td class=\"Cursor\"><a lineref=\""+lineref+"\" class=\"orange linktogroup modeledlink\" dataid=\"Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+nomadename+"']/Group\" i18nPrefix=\"data.vpn.group.name\"></a></td>";rowContent+="<td class='center'><img lineref=\""+lineref+"\" nomadename=\""+nomadename+"\" class=\"deleting\" dataid=\""+Xconnected+"\"  i18nPrefix=\"data.vpn.vpnNomade.deleteable\" widgetType=\"Image\"/></td>";rowContent+="</tr>";$("#nomadeTable").append(rowContent);lineref++;}});},postParse:function(){},postLoad:function(){$("#addVpnNomade a img").attr("disabled","disabled");$("#help").bind("click",function(){helpPopup("html/main/help_vpn.html");});$(".linktosts").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.sts.tip"]);$(".linktogroup").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.group.tip"]);$(".linktouser").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.user.tip"]);var stsInit=function(){var sitelist=$("input.enablingSite");var lineref="";for(var int=0;int<sitelist.length;int++){lineref=sitelist[int].getAttribute("lineref");var jCheckBoxActivate=$("#stsTable tr#sts"+lineref+" td input.enablingSite");var jImgStatus=$("#stsTable tr#sts"+lineref+" td img.status");var jRow=$("#stsTable tr#sts"+lineref);$("#stsTable tr#sts"+lineref).hide();if(!jCheckBoxActivate[0].getDataValue()){jCheckBoxActivate.attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.activate.false.tip"]);jImgStatus.attr("i18nPrefix","data.vpn.vpnSts.status.deactivated");jRow.attr("activated","false");}else{jCheckBoxActivate.attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.activate.true.tip"]);jImgStatus.attr("i18nPrefix","data.vpn.vpnSts.status");jRow.attr("activated","true");}
if(jImgStatus[0].dataValueRef){jRow.attr("connected","true");}else{jRow.attr("connected","false");}
jRow.attr("deleted","false");vpn_updateDeletable(jCheckBoxActivate);jImgStatus.parent().orangeRead();$("#stsTable tr#sts"+lineref+" td img.deleting").parent().orangeRead();}
vpn_updateMaskedSts();};stsInit();$("#stsTable .status").bind("valueChange",function(event,newvalue){$(this).parents("tr").attr("connected",newvalue);vpn_updateDeletable(this);});$("#stsTable .enablingSite").bind("change",function(event){});$("#stsTable .deleting").bind("click",function(event){var lineref=$(event.target).attr("lineref");if(vpn_isDeletable(this)){openConfirmationPopup('popup.confirm.title','popup.confirm.text',function(){$("#stsTable tr#sts"+lineref).attr("deleted","true");vpn_updateMaskedSts();$("#cancelation").setDisabled(false);$("#submiting").setDisabled(false);});}});$("#maskSts").bind("change",function(event,newValue){vpn_updateMaskedSts();});var nomadeInit=function(){var userlist=$("input.enablingUser");for(var int=0;int<userlist.length;int++){var lineref=userlist[int].getAttribute("lineref");var jCheckBoxActivate=$("#nomadeTable tr#nomade"+lineref+" td input.enablingUser");var jImgStatus=$("#nomadeTable tr#nomade"+lineref+" td img.status");var jRow=$("#nomadeTable tr#nomade"+lineref);jRow.hide();if(!jCheckBoxActivate[0].getDataValue()){jCheckBoxActivate.attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.activate.nomade.false.tip"]);jImgStatus.attr("i18nPrefix","data.vpn.vpnSts.status.deactivated");jRow.attr("activated","false");}else{jCheckBoxActivate.attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.activate.nomade.true.tip"]);jImgStatus.attr("i18nPrefix","data.vpn.vpnSts.status");jRow.attr("activated","true");}
if(jImgStatus[0].dataValueRef){jRow.attr("connected","true");}else{jRow.attr("connected","false");}
jRow.attr("deleted","false");jImgStatus.bind("valueChange",function(event,newvalue){$(this).parents("tr").attr("connected",newvalue);vpn_updateDeletable(this);});jCheckBoxActivate.bind("valueChange",function(event,newvalue){$(this).parents("tr").attr("activated",newvalue);vpn_updateDeletable(this);});vpn_updateDeletable(jCheckBoxActivate);jImgStatus.parent().orangeRead();$("#nomadeTable tr#nomade"+lineref+" td img.deleting").parent().orangeRead();}
vpn_updateMaskedNomade();};nomadeInit();$("#nomadeTable .enablingUser").bind("change",function(event){});$("#nomadeTable .deleting").bind("click",function(event){var lineref=$(event.target).attr("lineref");if(vpn_isDeletable(this)){openConfirmationPopup('popup.confirm.title','popup.confirm.text',function(){$("#nomadeTable tr#nomade"+lineref).attr("deleted","true");vpn_updateMaskedNomade();$("#cancelation").setDisabled(false);$("#submiting").setDisabled(false);});}});$("#maskNomade").bind("change",function(event,newValue){vpn_updateMaskedNomade();});$("#stsTable, #nomadeTable").show();vpn_synchronizeTableWidth();TableBorder();$("#stsTable .linktosts").bind("click",function(event){var selectedSiteName=$(event.target).parent().attr("id");$("#content").data("selectedSiteName",selectedSiteName);jQuery.orange.widget.MenuItem.setCurrent('m2.m271');});$("#nomadeTable .linktouser").bind("click",function(event){var selectedUserName=$(event.target).parent().attr("id");$("#content").data("selectedUserName",selectedUserName);jQuery.orange.widget.MenuItem.setCurrent('m2.m273');});$("#nomadeTable .linktogroup").bind("click",function(event){var selectedGroupName=this.dataValueRef;$("#content").data("selectedGroupName",selectedGroupName);jQuery.orange.widget.MenuItem.setCurrent('m2.m272');});$(".modeledlink").each(function(){if(this.dataValueRef!="default"){this.innerHTML=this.dataValueRef;}});$("#vpn form")[0].crudCallDelegate=function(crudExec){crudExec();$("tr[deleted='true']").each(function(){var Xtodelete=$(this).attr("refid");jQuery.orange.config.api.crud.del(Xtodelete,function(result){$("#content").orangeLoad(menu.mapping.vpn);});});nomadeInit();stsInit();$("#cancelation").setDisabled(true);$("#submiting").setDisabled(true);};$("#cancelation").bind("click keydown",function(){nomadeInit();stsInit();$("#cancelation").setDisabled(true);$("#submiting").setDisabled(true);});}};function vpnStS_preset2Gui(remotehardware){var preset=IPSecEasyModeStS[remotehardware];if(preset===undefined){preset=IPSecEasyModeStS["default"];}
if(preset!=undefined){if(preset.ExpertMode===true){$("#vpnexpertmode")[0].setDataValue(true);}
$("#Protocol")[0].setDataValue(preset.Protocol);$("#AggressiveMode")[0].setDataValue(preset.Mode);$("#Encryption1")[0].setDataValue(preset.Encryption1);$("#Authentication1")[0].setDataValue(preset.Authentication1);$("#DiffieGroup")[0].setDataValue(preset.HellmannGroup);$("#LifeTime1")[0].setDataValue(preset.LifeTime1);$("#Encryption2")[0].setDataValue(preset.Encryption2);$("#Authentication2")[0].setDataValue(preset.Authentication2);$("#PFSGroup")[0].setDataValue(preset.PFSGroup);$("#LifeTime2")[0].setDataValue(preset.LifeTime2);$("#DeadPeerDetection")[0].setDataValue(preset.DeadPeerDetection);}}
jQuery.orange.config.areacontent.vpnSts={setDefaultsValuesOnCreation:function(){$("#connectedSts")[0].setDataValue(false);$("#enableSts")[0].setDataValue(true);$("#enableSts")[0].dataValueRef=true;$("#sitename")[0].setDataValue("");$("#sitename")[0].dataValueRef="";$("#sitename").trigger('valueChange');$("#hostname")[0].setDataValue("");$("#hostname")[0].dataValueRef="";$("#hostname").trigger('valueChange');$("#remotehardware")[0].setDataValue("LIVEBOXPROV3");$("#remotehardware")[0].dataValueRef="LIVEBOXPROV3";$("#remotehardware").trigger('valueChange');$("#psk")[0].setDataValue("");$("#psk")[0].dataValueRef="";$("#psk").trigger('valueChange');$("#destip")[0].setDataValue("");$("#destip")[0].dataValueRef="";$("#destip").trigger('valueChange');$("#destmask")[0].setDataValue("");$("#destmask")[0].dataValueRef="";$("#destmask").trigger('valueChange');$("#vpnexpertmode")[0].setDataValue(false);},onReset:function(){$("#stsForm")[0].onReset=undefined;var resetresult=jQuery.orange.widget.Form.onReset.call(this);$("#stsForm")[0].onReset=jQuery.orange.config.areacontent.vpnSts.onReset;var form=this;if($("#vpnSts form").attr('creation')){$("[dataId]",this).each(function(){var node=this;if(arrayIndexOf($("[widgetType='Button'] input"),node)==-1){var valueStatus=jQuery.orange.widget.Form.verifyConstraints(this,false);if(valueStatus==fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG||valueStatus==fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG){form.dataKO.push(node);}}});jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnSts form")[0],jQuery.orange.widget.Form.STATE_ONCREATE);}
return resetresult;},onDataChange:function(node,showErrorMsg){$("#stsForm")[0].onDataChange=undefined;jQuery.orange.widget.Form.onDataChange.call(this,node,showErrorMsg);$("#stsForm")[0].onDataChange=jQuery.orange.config.areacontent.vpnSts.onDataChange;if($("#vpnSts form").attr('creation')){var modified=false;$("[dataId]",this).each(function(){var node=this;if(arrayIndexOf($("[widgetType='Button'] input"),node)==-1){if(node.dataValueRef!=undefined){if(node.getDataValue()!=node.dataValueRef){if(!modified){modified=true;}}}}});if(modified){jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnSts form")[0],jQuery.orange.widget.Form.getState.call(this));}else{jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnSts form")[0],jQuery.orange.widget.Form.STATE_ONCREATE);}}},preParse:function(){$("#stsForm")[0].onReset=jQuery.orange.config.areacontent.vpnSts.onReset;$("#stsForm")[0].onDataChange=jQuery.orange.config.areacontent.vpnSts.onDataChange;var selectedSite=$("#content").data('selectedSiteName');if(selectedSite==undefined){$("#vpnSts form").attr('creation',true);}
var XPREFIX="";if(selectedSite==undefined){$("#deleteStsVpn").hide();$("#saveStsVpn").hide();$("#saveStsVpn").attr("disabled","disabled");$("#createStsVpn").show();XPREFIX="";}else{XPREFIX="Device/Networks/WAN[@name='WAN']/VPN/NetToNetVPNs/NetToNetVPN[@Name='"+selectedSite+"']/";$("#deleteStsVpn").show();$("#saveStsVpn").show();$("#createStsVpn").remove();}
$("#stsForm").data("XCONNECTED",XPREFIX+"Connected");$("#stsForm").data("XENABLE",XPREFIX+"Enable");if(selectedSite==undefined){$("#stsForm").data("XNAME",XPREFIX+"Name");}else{$("#stsForm").data("XNAME",XPREFIX+"@Name");}
$("#stsForm").data("XHOSTNAME",XPREFIX+"Hostname");$("#stsForm").data("XREMOTEHARDWARE",XPREFIX+"RemoteHardware");$("#stsForm").data("XPRESHAREDKEY",XPREFIX+"PresharedKey");$("#stsForm").data("XLOCALIP",XPREFIX+"LocalIPAddress");$("#stsForm").data("XLOCALMASK",XPREFIX+"LocalIPMask");$("#stsForm").data("XREMOTEIP",XPREFIX+"RemoteIPAddress");$("#stsForm").data("XREMOTEMASK",XPREFIX+"RemoteIPMask");$("#stsForm").data("XPROTOCOL",XPREFIX+"Protocol");$("#stsForm").data("XAGRESSIVEMODE",XPREFIX+"AggressiveMode");$("#stsForm").data("XENCRYPTION1",XPREFIX+"Encryption1");$("#stsForm").data("XAUTH1",XPREFIX+"Authentication1");$("#stsForm").data("XDIFFIE",XPREFIX+"DiffieGroup");$("#stsForm").data("XLIFETIME1",XPREFIX+"LifeTime1");$("#stsForm").data("XENCRYPTION2",XPREFIX+"Encryption2");$("#stsForm").data("XAUTH2",XPREFIX+"Authentication2");$("#stsForm").data("XPFS",XPREFIX+"PFSGroup");$("#stsForm").data("XLIFETIME2",XPREFIX+"LifeTime2");$("#stsForm").data("XDEADPEER",XPREFIX+"DeadPeerDetection");$("#stsForm").data("XEXPERTMODE",XPREFIX+"ExpertMode");var dataidcontainers=$("#stsForm [dataidref]");for(var int=0;int<dataidcontainers.length;int++){var currentDataidRef=dataidcontainers[int].getAttribute("dataidref");dataidcontainers[int].setAttribute("dataid",$("#stsForm").data(currentDataidRef));}
$("#connectedSts").bind("valueChange",function(event,newValue){$("#deleteStsVpn").setDisabled(newValue==undefined||newValue==true);});},postParse:function(area){$("#backTovpn").bind("click",function(){jQuery.orange.widget.MenuItem.setCurrent('m2.m27');});$("#createStsVpn input[type='submit'], #saveStsVpn input[type='submit']").each(function(){this.crudCallback=function(){area.popupOnUnsubmitted=false;jQuery.orange.widget.MenuItem.setCurrent('m2.m27');};});},postLoad:function(area){$("#help").bind("click",function(){helpPopup("html/main/help_vpnSts.html");});$("#sitename").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.name.tip"]);$("#hostname").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.hostname.tip"]);$("#psk").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.psk.tip"]);$("#currentIP").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.currentip.tip"]);$("#currentMask").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.currentmask.tip"]);$("#destip").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.destip.tip"]);$("#destmask").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.destmask.tip"]);$("#LifeTime1").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.lifetime"]);$("#LifeTime2").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.lifetime"]);$("#remotehardware").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.remotehardware.tip"]);$("#Protocol").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.protocol.tip"]);$("#AggressiveMode").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.mode.tip"]);$("#Encryption1").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.encrypt.tip"]);$("#Encryption2").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.encrypt.tip"]);$("#Authentication1").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.auth.tip"]);$("#Authentication2").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.auth.tip"]);$("#DiffieGroup").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.diffie.tip"]);$("#PFSGroup").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnSts.pfs.tip"]);var subnetMask=$("#currentMask")[0].getDataValue();if(subnetMask==""){var XcurrentMask="Device/Networks/LAN[@uid='1']/SubnetMask";jQuery.orange.config.api.crud.read([XcurrentMask],function(result){subnetMask=result[XcurrentMask].values[XcurrentMask];$("#currentMask")[0].setDataValue(subnetMask);$("#currentMask")[0].dataValueRef=subnetMask;$("#currentMask").trigger('valueChange');});}
if($("#currentIP")[0].getDataValue()==""){var XcurrentIP="Device/Networks/LAN[@uid='1']/IPRouters";jQuery.orange.config.api.crud.read([XcurrentIP],function(result){var newvalue=result[XcurrentIP].values[XcurrentIP];var ip32=stringToIP32(newvalue);var mask32=stringToIP32(subnetMask);newvalue=ip32ToString(ip32&mask32);$("#currentIP")[0].setDataValue(newvalue);$("#currentIP")[0].dataValueRef=newvalue;$("#currentIP").trigger('valueChange');});}
$("#saveStsVpn").bind('click',function(){$("#deleteStsVpn").css("display","");});$("#createStsVpn").bind('click',function(){$("#deleteStsVpn").css("display","");$("#saveStsVpn").css("display","");$("#createStsVpn").css("display","none");});function isNetworkOverlaped(newstate){if(newstate){var currentIPNode=$("#currentIP");var currentIP=currentIPNode.val();var destIPNode=$("#destip");var destIP=destIPNode.val();var currentMaskNode=$("#currentMask");var currentMask=currentMaskNode.val();var destmaskNode=$("#destmask");var destmask=destmaskNode.val();var reg=new RegExp("[\.]+","g");var currentMaskvalues=currentMask.split(reg);var destmaskvalues=destmask.split(reg);var currentIPvalues=currentIP.split(reg);var destIPvalues=destIP.split(reg);var currentMaskvaluesbool=currentMaskvalues.length==4;var destmaskvaluesbool=destmaskvalues.length==4;var currentIPvaluesbool=currentIPvalues.length==4;var destIPvaluesbool=destIPvalues.length==4;if(currentMaskvaluesbool&&destmaskvaluesbool&&currentIPvaluesbool&&destIPvaluesbool){var chevauchementIp=false;for(var i=0;i<4;i++){if((currentIPvalues[i]&currentMaskvalues[i])==(destIPvalues[i]&destmaskvalues[i])){continue;}else{if(currentMaskvalues[i]==0||destmaskvalues[i]==0){chevauchementIp=true;}
break;}}
if(chevauchementIp){$("#createStsVpn").attr('disabled','true');$("#networkOverlap").show();}
else{$("#networkOverlap").hide();}}}
else{$("#networkOverlap").hide();}}
$("#currentMask").add($("#destmask")).bind("keyup change",isNetworkOverlaped);$("#currentIP").add($("#destip")).bind("keyup change",function(){var form=$("#vpnSts form")[0];var currentIPNode=$("#currentIP");var currentIP=currentIPNode.val();var destIPNode=$("#destip");var destIP=destIPNode.val();var oldState=jQuery.orange.widget.Form.getState.call(form);if(destIP==currentIP&&jQuery.orange.widget.Form.verifyConstraints(currentIPNode[0])&&jQuery.orange.widget.Form.verifyConstraints(destIPNode[0])){$("#identicalIPerror").css('display','inline');currentIPNode.addClass('supErrorInput');destIPNode.addClass('supErrorInput');form.dataKO.push(currentIPNode);form.dataKO.push(destIPNode);}else if(destIP!=currentIP){$("#identicalIPerror").css('display','none');if(jQuery.orange.widget.Form.verifyConstraints(currentIPNode[0])){currentIPNode.removeClass('supErrorInput');form.dataKO.splice(arrayIndexOf2(form.dataKO,currentIPNode),1);}
if(jQuery.orange.widget.Form.verifyConstraints(destIPNode[0])){destIPNode.removeClass('supErrorInput');form.dataKO.splice(arrayIndexOf2(form.dataKO,destIPNode),1);}}
jQuery.orange.widget.Form.onDataChange.call(form,$("#destip")[0]);jQuery.orange.widget.Form.onDataChange.call(form,$("#destmask")[0]);var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}
isNetworkOverlaped(newState);});$("#remotehardware").bind('change valueChange',function(event){var remotehardware=$("#remotehardware")[0].getDataValue();vpnStS_preset2Gui(remotehardware);});$("#deleteStsVpn").bind('activateButton',function(){openConfirmationPopup('popup.confirm.title','popup.confirm.text',function(){var Xdelete="Device/Networks/WAN[@name='WAN']/VPN/NetToNetVPNs/NetToNetVPN[@Name='"+$("#sitename")[0].getDataValue()+"']";jQuery.orange.config.api.crud.del(Xdelete,function(result){jQuery.orange.widget.MenuItem.setCurrent('m2.m27');});});});$("#vpnexpertmode").bind('change valueChange',function(){var expertMode=$("#vpnexpertmode")[0].getDataValue();if(expertMode===false){var remotehardware=$("#remotehardware")[0].getDataValue();if(remotehardware=="OTHER"){$("#remotehardware")[0].setDataValue("LIVEBOXPROV3");}else{vpnStS_preset2Gui(remotehardware);}}});var selectedSite=$("#content").data('selectedSiteName');if(selectedSite==undefined){jQuery.orange.config.areacontent.vpnSts.setDefaultsValuesOnCreation();jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnSts form")[0],jQuery.orange.widget.Form.STATE_ONCREATE);}
$("#content").removeData('selectedSiteName');}};function vpnNomade_getDefaultPresharedKey(){return $("#routerName")[0].dataValueRef;}
function vpnNomade_preset2Gui(remotesoftware){var preset=IPSecEasyModeRoadWarrior[remotesoftware];$("#roadWarriorEnabled")[0].setDataValue(true);if(preset===undefined){preset=IPSecEasyModeRoadWarrior["default"];}
if(preset!=undefined){$("#ipallocationmode")[0].setDataValue(preset.IPAllocation);$("#internetaccessmode")[0].setDataValue(preset.UsersAccess);$("#protocol")[0].setDataValue(preset.Protocol);$("#agressivemode")[0].setDataValue(preset.Mode);$("#crypt1")[0].setDataValue(preset.Encryption1);$("#auth1")[0].setDataValue(preset.Authentication1);$("#diffie")[0].setDataValue(preset.HellmannGroup);$("#lifetime1")[0].setDataValue(preset.LifeTime1);$("#crypt2")[0].setDataValue(preset.Encryption2);$("#auth2")[0].setDataValue(preset.Authentication2);$("#pfs")[0].setDataValue(preset.PFSGroup);$("#lifetime2")[0].setDataValue(preset.LifeTime2);$("#deadpeerdetection")[0].setDataValue(preset.DeadPeerDetection);if(preset.ExpertMode===true){$("#vpnexpertmode")[0].setDataValue(true);}}}
jQuery.orange.config.areacontent.vpnNomade={onReset:function(){$("#nomadeForm")[0].onReset=undefined;var resetresult=jQuery.orange.widget.Form.onReset.call(this);$("#nomadeForm")[0].onReset=jQuery.orange.config.areacontent.vpnNomade.onReset;var form=this;if($("#vpnNomade form").attr('creation')){$("[dataId]",this).each(function(){var node=this;if(arrayIndexOf($("[widgetType='Button'] input"),node)==-1){var valueStatus=jQuery.orange.widget.Form.verifyConstraints(this,false);if(valueStatus==fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG||valueStatus==fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG){form.dataKO.push(node);}}});jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnNomade form")[0],jQuery.orange.widget.Form.STATE_ONCREATE);}
return resetresult;},onDataChange:function(node,showErrorMsg){$("#nomadeForm")[0].onDataChange=undefined;jQuery.orange.widget.Form.onDataChange.call(this,node,showErrorMsg);$("#nomadeForm")[0].onDataChange=jQuery.orange.config.areacontent.vpnNomade.onDataChange;if($("#vpnNomade form").attr('creation')){var modified=false;$("[dataId]",this).each(function(){var node=this;if(arrayIndexOf($("[widgetType='Button'] input"),node)==-1){if(node!=$("#routerName")[0]&&node!=$("#noneditabelmgroupname")[0]&&node!=$("#auth")[0]&&node.dataValueRef!=undefined){if(node.getDataValue()!=node.dataValueRef){if(!modified){modified=true;}}}}});if(modified){jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnNomade form")[0],jQuery.orange.widget.Form.getState.call(this));}else{jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnNomade form")[0],jQuery.orange.widget.Form.STATE_ONCREATE);}}},preParse:function(){$("#nomadeForm")[0].onReset=jQuery.orange.config.areacontent.vpnNomade.onReset;$("#nomadeForm")[0].onDataChange=jQuery.orange.config.areacontent.vpnNomade.onDataChange;var XPREFIX="";var selectedGroup=$("#content").data('selectedGroupName');if(selectedGroup==undefined){$("#vpnNomade form").attr('creation',true);}
if(selectedGroup==undefined){$("#assigneduserslist").prev().css("display","none");$("#assigneduserslist").css("display","none");$("#deleteNomadeGroup").css("display","none");$("#saveNomadeGroup").css("display","none");$("#createNomadeGroup").css("display","");$("#noUser").show();XPREFIX="";}else{$("#createNomadeGroup").remove();var Xnomades="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser";jQuery.orange.config.api.crud.read([Xnomades],function(result){var usersdisplay="";var userRank=0;for(nomade in result[Xnomades].values){var Xuser=Xnomades+"[@Login='"+result[Xnomades].values[nomade]["Login"]+"']";if(selectedGroup==result[Xnomades].values[nomade]["Group"]){usersdisplay+="<input userRank=\"user"+userRank+"\" class=\"assignedUser\" type=\"checkbox\" checked/>";usersdisplay+="<span dataId=\""+Xuser+"/@Login\"/>";usersdisplay+="<input style=\"display:none\" class=\"userconnectionstatus\" type=\"checkbox\" dataId=\""+Xuser+"/ConnectionStatus\"/>";usersdisplay+="<input id=\"user"+userRank+"\" style=\"display:none\" class=\"usergroup\" type=\"text\" dataId=\""+Xuser+"/Group\"/>";usersdisplay+="&#160;&#160;";userRank++;}}
$("#assigneduserslist").append(usersdisplay);if(userRank==0){$("#noUser").show();}else{$("#noUser").hide();}});XPREFIX="Device/Networks/WAN[@name='WAN']/VPN/RoadWarriorVPNs/RoadWarriorVPN[@Name='"+selectedGroup+"']/";}
if(selectedGroup==undefined){$("#nomadeForm").data("XNAME",XPREFIX+"Name");}else{$("#nomadeForm").data("XNAME",XPREFIX+"@Name");}
$("#nomadeForm").data("ENABLE",XPREFIX+"Enable");$("#nomadeForm").data("XREMOTESOFTWARE",XPREFIX+"RemoteSoftware");$("#nomadeForm").data("XAUTH",XPREFIX+"UserAuthentication");$("#nomadeForm").data("XIPALLOCATIONMODE",XPREFIX+"IPAllocationMode");$("#nomadeForm").data("XINTERNETACCESSMODE",XPREFIX+"InternetAccessMode");$("#nomadeForm").data("XPRESHAREDKAY",XPREFIX+"PresharedKey");$("#nomadeForm").data("XPROTOCOL",XPREFIX+"Protocol");$("#nomadeForm").data("XINTERFACENAME",XPREFIX+"InterfaceName");$("#nomadeForm").data("XAGRESSIVEMODE",XPREFIX+"AggressiveMode");$("#nomadeForm").data("XENCRYPTION1",XPREFIX+"Encryption1");$("#nomadeForm").data("XAUTH1",XPREFIX+"Authentication1");$("#nomadeForm").data("XDIFFIE",XPREFIX+"DiffieGroup");$("#nomadeForm").data("XLIGETIME1",XPREFIX+"LifeTime1");$("#nomadeForm").data("XENCRYPTION2",XPREFIX+"Encryption2");$("#nomadeForm").data("XAUTH2",XPREFIX+"Authentication2");$("#nomadeForm").data("XPFS",XPREFIX+"PFSGroup");$("#nomadeForm").data("XLIGETIME2",XPREFIX+"LifeTime2");$("#nomadeForm").data("XDEADPEERCONNECTION",XPREFIX+"DeadPeerDetection");$("#nomadeForm").data("XEXPERTMODE",XPREFIX+"ExpertMode");var dataidcontainers=$("#nomadeForm [dataidref]");for(var int=0;int<dataidcontainers.length;int++){var currentDataidRef=dataidcontainers[int].getAttribute("dataidref");dataidcontainers[int].setAttribute("dataid",$("#nomadeForm").data(currentDataidRef));}},postParse:function(area){$("#backTovpn").bind("click",function(){jQuery.orange.widget.MenuItem.setCurrent('m2.m27');});$("#createNomadeGroup input[type='submit'], #saveNomadeGroup input[type='submit']").each(function(){this.crudCallback=function(){area.popupOnUnsubmitted=false;jQuery.orange.widget.MenuItem.setCurrent('m2.m27');};});},postLoad:function(area){$("#help").bind("click",function(){helpPopup("html/main/help_vpnNomade.html");});$("#keyvisible")[0].setDataValue(false);$("#keyvisible")[0].dataValueRef=false;$("#keyvisible").trigger('change');$("#presharedkey")[0].mask(true);$("#remotesoftware").bind('change valueChange',function(){var remotesoftware=$("#remotesoftware")[0].getDataValue();vpnNomade_preset2Gui(remotesoftware);});$("#vpnexpertmode").bind("change valueChange",function(){var expertMode=$("#vpnexpertmode")[0].getDataValue();if(expertMode===false){var remotesoftware=$("#remotesoftware")[0].getDataValue();if(remotesoftware=="OTHER"){$("#remotesoftware")[0].setDataValue("SHREW");}else{vpnNomade_preset2Gui(remotesoftware);}}});var selectedGroup=$("#content").data('selectedGroupName');if(selectedGroup==undefined){$("#groupname")[0].setDataValue("");$("#groupname")[0].dataValueRef="";$("#groupname").trigger('valueChange');$("#remotesoftware")[0].setDataValue("SHREW");$("#remotesoftware")[0].dataValueRef="SHREW";$("#remotesoftware").trigger('valueChange');$("#auth")[0].dataValueRef=0;$("#auth").orangeTranslate();var presharedkey=vpnNomade_getDefaultPresharedKey();$("#presharedkey")[0].setDataValue(presharedkey);$("#presharedkey")[0].dataValueRef=presharedkey;$("#presharedkey").trigger('valueChange');$("#keyvisible")[0].setDataValue(true);$("#keyvisible")[0].dataValueRef=true;$("#keyvisible").trigger('change');$("#presharedkey")[0].mask(false);$("#vpnexpertmode")[0].setDataValue(false);$("#vpnexpertmode")[0].dataValueRef=false;$("#vpnexpertmode").trigger('valueChange');jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnNomade form")[0],jQuery.orange.widget.Form.STATE_ONCREATE);}
$("#groupname").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.groupname.tip"]);$("#presharedkey").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.presharedkey.tip"]);$("#lifetime1").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.lifetime.tip"]);$("#lifetime2").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.lifetime.tip"]);$("#remotesoftware").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.remotesoftware.tip"]);$("#ipallocationmode").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.ipallocationmode.tip"]);$("#internetaccessmode").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.internetaccessmode.tip"]);$("#protocol").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.protocol.tip"]);$("#interfacename").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.interfacename.tip"]);$("#agressivemode").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.agressivemode.tip"]);$("#crypt1").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.crypt.tip"]);$("#crypt2").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.crypt.tip"]);$("#auth1").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.auth.tip"]);$("#auth2").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.auth.tip"]);$("#diffie").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.diffie.tip"]);$("#pfs").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.pfs.tip"]);$(".assignedUser").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.assigned.tip"]);$("#groupname").bind('change keyup',function(event){$(".usergroup").each(function(i){this.setDataValue($(event.target)[0].getDataValue());});});$(".usergroup").each(function(i){$(this).bind('valueChange',function(event,newValue){if(newValue!=$("#groupname")[0].getDataValue()){if($("[userrank='"+this.id+"']")[0].getDataValue()==true){$("[userrank='"+this.id+"']")[0].setDataValue(false);}}else{if($("[userrank='"+this.id+"']")[0].getDataValue()==false){$("[userrank='"+this.id+"']")[0].setDataValue(true);}}});});$(".assignedUser").bind('valueChange',function(event){var currentuser=event.target.getAttribute('userRank');var currentgroup=$("#groupname")[0].getDataValue();console.log(currentuser+" ::: "+$("#"+currentuser)[0].getDataValue());if(event.target.checked){$("#"+currentuser)[0].setDataValue(currentgroup);event.target.setAttribute('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.assigned.tip"]);}else{$("#"+currentuser)[0].setDataValue("default");event.target.setAttribute('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnNomade.unassigned.tip"]);}});$("#remotesoftware").setDisabled(true);if($("#groupname")[0].getDataValue()=="default"){$("#groupname").css("display","none");$("#noneditabelmgroupname").css("display","");$("#remotesoftware").setDisabled(true);$("#ipallocationmode").setDisabled(true);$("#internetaccessmode").setDisabled(true);}
$(".userconnectionstatus").bind('change',function(event,newvalue){if(($("#groupname")[0].getDataValue()!="default"&&$("#groupname")[0].getDataValue()!="")){if(!asConnectedUsers($("#groupname")[0].getDataValue())){$("#deleteNomadeGroup").css("display","");}else{$("#deleteNomadeGroup").css("display","none");}}});if(($("#groupname")[0].getDataValue()!="default"&&$("#groupname")[0].getDataValue()!="")){if(!asConnectedUsers($("#groupname")[0].getDataValue())){$("#deleteNomadeGroup").css("display","");}}
if($("#groupname")[0].getDataValue()=="default"){$("#reinitnomadegroup").css("display","");}
$("#reinitnomadegroup").bind("activateButton",function(){$("#keyvisible")[0].setDataValue(true);var presharedkey=vpnNomade_getDefaultPresharedKey();$("#presharedkey")[0].setDataValue(presharedkey);});$('#keyvisible').bind("change valueChange",function(event,newValue){if(newValue!=undefined){$("#presharedkey")[0].mask(!newValue);}});var form=$("#nomadeForm")[0];var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO=[];form.modifsOK=[];var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}
$("#deleteNomadeGroup").bind('click',function(){openConfirmationPopup('popup.confirm.title','popup.confirm.text',function(){if(asUsers($("#groupname")[0].getDataValue())){var Xnomades="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser";jQuery.orange.config.api.crud.read([Xnomades],function(result){var id2value={};for(nomade in result[Xnomades].values){if($("#groupname")[0].getDataValue()==result[Xnomades].values[nomade]["Group"]){var XUserGroup="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+result[Xnomades].values[nomade]["Login"]+"']/Group";id2value[XUserGroup]="default";}}
jQuery.orange.config.api.crud.update(id2value);});}
var Xdelete="Device/Networks/WAN[@name='WAN']/VPN/RoadWarriorVPNs/RoadWarriorVPN[@Name='"+$("#groupname")[0].getDataValue()+"']";jQuery.orange.config.api.crud.del(Xdelete,function(result){jQuery.orange.widget.MenuItem.setCurrent('m2.m27');});});});$("#content").removeData('selectedGroupName');}};asConnectedUsers=function(groupname){var asConnectedUsersStatus=false;var Xnomades="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser";jQuery.orange.config.api.crud.read([Xnomades],function(result){for(nomade in result[Xnomades].values){if(groupname==result[Xnomades].values[nomade]["Group"]&&result[Xnomades].values[nomade]["ConnectionStatus"]==true){asConnectedUsersStatus=true;}}});return asConnectedUsersStatus;};asUsers=function(groupname){var asUsersStatus=false;var Xnomades="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser";jQuery.orange.config.api.crud.read([Xnomades],function(result){for(nomade in result[Xnomades].values){if(groupname==result[Xnomades].values[nomade]["Group"]){asUsersStatus=true;}}});return asUsersStatus;};function vpnUser_addToDataKO(node){var form=$("#vpnUser form")[0];var indexDataKO=arrayIndexOf2(form.dataKO,node);if(indexDataKO==-1){var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO.push(node);var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}
console.log("vpnUser_addToDataKO(): node="+$(node).attr("id"));}
function vpnUser_showError(jFieldInError,jErrorMsg){jFieldInError.addClass('errorInput');jErrorMsg.show();}
function vpnUser_removeFromDataKO(node){var form=$("#vpnUser form")[0];var indexDataKO=arrayIndexOf2(form.dataKO,node);if(indexDataKO!=-1){var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO.splice(indexDataKO,1);var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}
console.log("vpnUser_removeFromDataKO(): node="+$(node).attr("id"));}
function vpnUser_hideError(jFieldInError,jErrorMsg){jFieldInError.removeClass('errorInput');jErrorMsg.hide();}
function vpnUser_checkPassword(hasFocus){var passwordValue=$("#userpass input[type='password']").val();var isCorrect=passwordValue!=undefined&&passwordValue!=""&&passwordValue.length>=8;if(isCorrect){vpnUser_removeFromDataKO($("#userpass")[0]);}else{vpnUser_addToDataKO($("#userpass")[0]);}
if(isCorrect||passwordValue==""){vpnUser_hideError($("#userpass"),$("#errorMsgLength"));}else{if(hasFocus&&passwordValue.length<8){}else{vpnUser_showError($("#userpass"),$("#errorMsgLength"));}}
console.log("vpnUser_checkPassword(): isCorrect="+isCorrect);return isCorrect;}
function vpnUser_checkPasswordConfirm(hasFocus){return true;var passwordValue=$("#userpass input[type='password']").val();var confirmValue=$("#userpassconfirm input[type='password']").val();var isCorrect=(passwordValue==confirmValue);if(isCorrect||confirmValue==""||passwordValue==""||hasFocus&&passwordValue.startsWith(confirmValue)){vpnUser_hideError($("#userpassconfirm"),$("#errorMsgDiff"));}else{vpnUser_showError($("#userpassconfirm"),$("#errorMsgDiff"));}
return isCorrect;}
jQuery.orange.config.areacontent.vpnUser={onReset:function(){$("#userForm")[0].onReset=undefined;var resetresult=jQuery.orange.widget.Form.onReset.call(this);$("#userForm")[0].onReset=jQuery.orange.config.areacontent.vpnUser.onReset;var form=this;if($("#vpnUser form").attr('creation')){$("[dataId]",this).each(function(){var node=this;if(arrayIndexOf($("[widgetType='Button'] input"),node)==-1){var valueStatus=jQuery.orange.widget.Form.verifyConstraints(this,false);if(valueStatus==fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG||valueStatus==fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG){form.dataKO.push(node);}}});jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnUser form")[0],jQuery.orange.widget.Form.STATE_ONCREATE);}
return resetresult;},onDataChange:function(node,showErrorMsg){$("#userForm")[0].onDataChange=undefined;jQuery.orange.widget.Form.onDataChange.call(this,node,showErrorMsg);$("#userForm")[0].onDataChange=jQuery.orange.config.areacontent.vpnUser.onDataChange;var jForm=$("#vpnUser form");if(jForm.attr('creation')){var modified=false;$("[dataId]",this).each(function(){var node=this;if(arrayIndexOf($("[widgetType='Button'] input"),node)==-1){if(node.dataValueRef!=undefined){if(node.getDataValue()!=node.dataValueRef){if(!modified){modified=true;}}}}});var currentState=jQuery.orange.widget.Form.getState.call(this);if(currentState==jQuery.orange.widget.Form.STATE_KO){jQuery.orange.widget.Form.setButtonsDisabled.call(jForm[0],jQuery.orange.widget.Form.STATE_KO);}else if(modified){jQuery.orange.widget.Form.setButtonsDisabled.call(jForm[0],jQuery.orange.widget.Form.STATE_MODIF_OK);}else{jQuery.orange.widget.Form.setButtonsDisabled.call(jForm[0],jQuery.orange.widget.Form.STATE_NO_MODIF);}}},preParse:function(){$("#userForm")[0].onReset=jQuery.orange.config.areacontent.vpnUser.onReset;$("#userForm")[0].onDataChange=jQuery.orange.config.areacontent.vpnUser.onDataChange;var userRef=$("#content").data('selectedUserName');if(userRef==undefined){$("#vpnUser form").attr('creation',true);}
if(userRef==undefined){userRef="";$("#deleteUserVpn").css("display","none");$("#saveUserVpn").css("display","none");$("#createUserVpn").css("display","");$("#userenable").attr("dataid","Enable");$("#username").attr("dataid","Login");$("#userpass").attr("dataid","Password");$("#hiddengroup").attr("dataid","Group");}else{$("#createUserVpn").remove();$("#connectedNomade").attr("dataid","Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+userRef+"']/ConnectionStatus");$("#userenable").attr("dataid","Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+userRef+"']/Enable");$("#username").attr("dataid","Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+userRef+"']/@Login");$("#userpass").attr("dataid","Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+userRef+"']/Password");$("#hiddengroup").attr("dataid","Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+userRef+"']/Group");}
var Xgroups="Device/Networks/WAN[@name='WAN']/VPN/RoadWarriorVPNs/RoadWarriorVPN";jQuery.orange.config.api.crud.read([Xgroups],function(result){var dynamicEnum="";for(group in result[Xgroups].values){var groupname=result[Xgroups].values[group]["Name"];if(groupname!=undefined&&groupname!=""){dynamicEnum+="'"+groupname+"',";}}
$("#userprofil").attr("enumerated","["+dynamicEnum.substring(0,dynamicEnum.length-1)+"]");});},postParse:function(){$("#backTovpn").bind("click",function(){jQuery.orange.widget.MenuItem.setCurrent('m2.m27');});var maxWidth=0;$('.forminput-label').each(function(index){if($(this).width()>maxWidth)
maxWidth=$(this).width();});},postLoad:function(area){$("#help").bind("click",function(){helpPopup("html/main/help_vpnUser.html");});$("#userpassconfirm input[type='password']").val($("#userpass input[type='password']").val());$("#userpassconfirm input[type='text']").val($("#userpass input[type='text']").val());if($("#content").data('selectedUserName')==undefined){$("#userenable")[0].setDataValue(true);$("#userenable")[0].dataValueRef=true;$("#userenable").trigger('valueChange');$("#userenable").setDisabled(false);}
$("#username").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnUser.username.tip"]);$("#userpass").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnUser.password.tip"]);$("#userpassconfirm").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnUser.confirm.tip"]);$("#userprofil select").bind("valueChange",function(event,newvalue){$("#hiddengroup")[0].setDataValue(event.target.currentValue);$("#hiddengroup").trigger('valueChange');});$("#vpnUser form")[0].crudCallDelegate=function(crudExec){crudExec();$("#content").data("selectedUserName",$("#username")[0].getDataValue());area.popupOnUnsubmitted=false;jQuery.orange.widget.MenuItem.setCurrent('m2.m27');};$("#deleteUserVpn").bind('click',function(){openConfirmationPopup('popup.confirm.title','popup.confirm.text',function(){var Xdelete="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+$("#username")[0].getDataValue()+"']";jQuery.orange.config.api.crud.del(Xdelete,function(result){jQuery.orange.widget.MenuItem.setCurrent('m2.m27');});});});$("#cancelUserVpn").bind('activateButton',function(){var form=$("#vpnUser form")[0];var userpassNode=$("#userpass input[type='password']");var userpassconfirmNode=$("#userpassconfirm input[type='password']");var userpassVisibleNode=$("#userpass input[type='text']");var userpassVisibleconfirmNode=$("#userpassconfirm input[type='text']");var userProfilNode=$("#userprofil select");userProfilNode.val($("#hiddengroup")[0].dataValueRef);$("#userpassconfirm")[0].setDataValue($("#userpass")[0].dataValueRef);$("#errorMsgLength").css('display','none');$("#errorMsgDiff").css('display','none');userpassVisibleNode.removeClass('errorInput');userpassVisibleconfirmNode.removeClass('errorInput');var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO.splice(arrayIndexOf2(form.dataKO,userpassNode),1);form.dataKO.splice(arrayIndexOf2(form.dataKO,userpassconfirmNode),1);var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}});$("#userpass").bind('keyup change valueChange input propertyChange blur',function(event){var form=$("#vpnUser form")[0];var node=$("#userpassconfirm")[0];var showError=!this.hasFocus();jQuery.orange.widget.Form.onDataChange.call(form,node,showError);});$("#userpass input[type='text']").bind('input propertyChange blur',function(event){$("#userpass").trigger("change");});var confirmPasswordError="";$("#userpassconfirm")[0].validate=function(){var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;var WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.WRONG;var NOT_GOOD_NOT_WRONG=fr.orange.livebox.gui.api.ProgressiveRegexp.NOT_GOOD_NOT_WRONG;var passwordValue=$("#userpass input[type='password']").val();var confirmValue=$("#userpassconfirm input[type='password']").val();var isCorrect=(passwordValue==confirmValue);if(isCorrect){confirmPasswordError="";return GOOD;}else if(passwordValue.startsWith(confirmValue)){confirmPasswordError="identpassserror";return NOT_GOOD_NOT_WRONG;}else{confirmPasswordError="identpassserror";return WRONG;}};$("#userpassconfirm")[0].getError=function(){return confirmPasswordError;};var userRef=$("#content").data('selectedUserName');if(userRef==undefined){$("#hiddengroup")[0].dataValueRef='default';$("#hiddengroup")[0].setDataValue('default');$("#userprofil")[0].setDataValue('default');$("#userpass")[0].setDataValue("");$("#userpass")[0].dataValueRef="";$("#userpassconfirm")[0].setDataValue("");$("#userpassconfirm")[0].dataValueRef="";jQuery.orange.widget.Form.setButtonsDisabled.call($("#vpnUser form")[0],jQuery.orange.widget.Form.STATE_ONCREATE);}else{var Xuserprofil="Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+$("#username")[0].getDataValue()+"']/Group";jQuery.orange.config.api.crud.read([Xuserprofil],function(result){for(userprofil in result[Xuserprofil].values){$("#hiddengroup")[0].dataValueRef=result[Xuserprofil].values[userprofil];$("#userprofil")[0].setDataValue(result[Xuserprofil].values[userprofil]);}});}
$("#content").removeData('selectedUserName');}};jQuery.orange.config.areacontent.vpnMail={preParse:function(){var userRef=$("#content").data('selectedUserName');if(userRef==undefined){userRef="";}
$("#userRef").attr("ref",userRef);$("#destinationmail").attr("dataid","Device/Networks/WAN[@name='WAN']/VPN/VPNUsers/VPNUser[@Login='"+userRef+"']/Email");$("#content").removeData('selectedUserName');},postParse:function(){},postLoad:function(area){$("#help").bind("click",function(){helpPopup("html/main/help_vpnMail.html");});if($("#destinationmail")[0].getDataValue()=="email@domain.com"){$("#destinationmail")[0].setDataValue("");$("#destinationmail").trigger('valueChange');}else{$("#destinationmail").trigger('valueChange');$("#sendMail").setDisabled(false);$("#validMail").setDisabled(false);}
$("#sourcemail").removeAttr("regex");$("#destinationmail").removeAttr("regex");$("#sourcemail").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnMail.sourcemail.tip"]);$("#destinationmail").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnMail.destinationmail.tip"]);$("#validMail").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnMail.valid"]);$("#backToUserVpn").attr('title',jQuery.orange.config.i18n.map["page.myNetwork.vpn.vpnMail.return"]);$("#sendMail").bind('click',function(){openConfirmationPopup('popup.vpn.mail.title','popup.vpn.mail.text',function(){$("#vpnMail form").submit();});});$("#vpnMail form")[0].crudCallDelegate=function(crudExec){crudExec();area.popupOnUnsubmitted=false;jQuery.orange.widget.MenuItem.setCurrent('m2.m27');};$("#backToUserVpn").bind("click",function(){$("#content").data("selectedUserName",$("#userRef").attr("ref"));jQuery.orange.widget.MenuItem.setCurrent('m2.m273');});$("#userForm")[0].setButtonsDisabled=function(newState){jQuery.orange.widget.Form.setButtonsDisabled.call(this,newState);$("#sendMail").setDisabled(newState==jQuery.orange.widget.Form.STATE_KO);$("#validMail").setDisabled(newState==jQuery.orange.widget.Form.STATE_KO);};var currentState=jQuery.orange.widget.Form.getState.call($("#userForm")[0]);$("#userForm")[0].setButtonsDisabled(currentState);}};function dyndns_tableAddRow(id,attrs){var tr;if(attrs!=undefined&&attrs.uid!=undefined){currentId=$("#dyndnsTable").attr("dataid")+"[@uid='"+attrs.uid+"']";tr=jQuery.orange.widget.Table.addRow.call(this,currentId,attrs);}
else if(id!=undefined){currentId=$("#dyndnsTable").attr("dataid")+"[@uid='"+id+"']";tr=jQuery.orange.widget.Table.addRow.call(this,currentId,attrs);}else{tr=jQuery.orange.widget.Table.addRow.call(this,id,attrs);}
if(attrs!=undefined&&(attrs.Status!="ENABLED"||attrs.LastError!="NOERROR")){$("td:eq(4)",tr).empty();$("td:eq(4)",tr).append('<span class="error" i18n="page.myNetwork.dyndns.error" i18nPrefix="page.myNetwork.dyndns.error">'+attrs.LastError+'</span>');$("td:eq(4)",tr).orangeParse();$("td:eq(4)",tr).orangeTranslate();}else if(attrs==undefined){$("td:eq(4)",tr).empty();}
return tr;}
jQuery.orange.config.areacontent.dyndns={preParse:function(){$("#dyndnsTable").hide();$("#dyndnsTable")[0].addRow=dyndns_tableAddRow;},postParse:function(){$("#dyndnsTable").hide();$("#dyndnsTable .table-add-button").append("<span id=\"btnAdd\"  widgetType=\"ButtonImage\"  i18n=\"page.myNetwork.dyndns.add\"/>");$("#dyndnsTable .table-add-button").orangeParse();$("#dyndnsTable .table-add-button").orangeTranslate();$("#dyndnsTable .table-add-container").append("<span id=\"btnRefresh\"  widgetType=\"ButtonImage\"  i18n=\"common.refreshtip\"/>");$("#dyndnsTable .table-add-container").orangeParse();$("#dyndnsTable .table-add-container").orangeTranslate();},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_dyndns.html");});$("img[i18n='table.button.add']").parent().remove();$("#dyndnsTableErr").insertAfter($("#dyndnsTable table"));$("#btnRefresh").bind('click',function(){$("#content").orangeLoad(menu.mapping.dyndns);});$("#dyndnsTable").show();}};function routing_tableAddRow(id,attrs){var tr;if(id!=undefined){currentId="Device/RoutesInfo/RouteInfo[@uid='"+id+"']";tr=jQuery.orange.widget.Table.addRow.call(this,currentId,attrs);}else{tr=jQuery.orange.widget.Table.addRow.call(this,id,attrs);$("td:eq(4) input",tr).val("0");$("td:eq(5) input",tr)[0].setDataValue(true);}
return tr;}
jQuery.orange.config.areacontent.routing={postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_routing.html");});$("#routingTable .table-add-button img").attr('i18n','page.myNetwork.routing.add').parent().orangeParse();$("#routingTableErr").insertAfter($("#routingTable table"));$("#routingTable")[0].addRow=routing_tableAddRow;}};jQuery.orange.config.areacontent.network_meshLb={preParse:function(){try{fr.orange.livebox.gui.pages.engine.MeshPresenter.initWidget();}catch(err){}},postParse:function(){$("#btnDisableMesh").click(function(){openConfirmationPopup('popup.disablemesh.title','popup.disablemesh.text',function(){var MeshEnable="Device/MESH/Enable";var id2value={};id2value[MeshEnable]=false;jQuery.orange.config.api.crud.update(id2value,function(){jQuery.orange.widget.MenuItem.setCurrent('m0');$('[widgetType="VisibleDependent"][dataId="Device/MESH/Enable"]').each(function(){$(this)[0].setDataValue(false);});});});});},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_networkMeshLb.html");});}};jQuery.orange.config.areacontent.liveboxEnvironment={preParse:function(){try{fr.orange.livebox.gui.pages.engine.EquipmentPresenter.initWidget();}catch(err){}}};jQuery.orange.config.areacontent.userEquipment={preParse:function(){try{fr.orange.livebox.gui.pages.engine.EquipmentPresenter.initWidget();}catch(err){}
$('#content').removeData('XDeviceRestriction');},postParse:function(){}};function officeCustomization_tableAddRow(id,attrs){var tr;if(attrs!=undefined&&attrs.uid!=undefined){currentId=$("#officeCustomizationTable").attr("dataid")+"[@uid='"+attrs.uid+"']";tr=jQuery.orange.widget.Table.addRow.call(this,currentId,attrs);var dataId=$("td:eq(0) input",tr).attr("dataid");dataId=dataId.replace("/Name","/@Name");$("td:eq(0) input",tr).attr("dataid",dataId);}
else if(id!=undefined){currentId=$("#officeCustomizationTable").attr("dataid")+"[@uid='"+id+"']";tr=jQuery.orange.widget.Table.addRow.call(this,currentId,attrs);var dataId=$("td:eq(0) input",tr).attr("dataid");dataId=dataId.replace("/Name","/@Name");$("td:eq(0) input",tr).attr("dataid",dataId);}
else{tr=jQuery.orange.widget.Table.addRow.call(this,id,attrs);}
return tr;}
jQuery.orange.config.areacontent.officeCustomization={postParse:function(){$("#officeCustomizationTable")[0].addRow=officeCustomization_tableAddRow;},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_officeCustomization.html");});$("#officeCustomizationTable .table-add-button img").attr('i18n','page.myEquipments.officeCustomization.add').parent().orangeParse();$("#officeCustomizationTableErr").insertAfter($("#officeCustomizationTable>form>table"));}};jQuery.orange.config.areacontent.customEquipmentTHD={postParse:function(){var XpathDevice=$('#customEquipmentTHD span:eq(0)').text();var url=$('#customEquipmentTHD span:eq(1)').text();var Rooms="Device/UserInterface/Rooms/Room";jQuery.orange.config.api.crud.read([Rooms],function(result){if(result[Rooms].nb==0){$("#location").replaceWith($('<span/>').attr('i18n','page.myEquipments.userEquipment.filtre.location.none'));}
else{var enum0="",room;for(room in result[Rooms].values){enum0+="'"+result[Rooms].values[room]["Name"]+"',";}
enum0=enum0.substr(0,enum0.length-1);$("#location").replaceWith('<span id="location" widgetType="EnumInput" widgetArg="\'select\'" dataId="'+XpathDevice+'/Location" enumerated="['+enum0+']" i18n="page.myEquipments.customEquipmentEth.config.location"/>');}});$("#location").parent().orangeParse();$("#btnEject").click(function(){openConfirmationPopup('popup.eject.title','popup.eject.text',function(){jQuery.orange.config.api.rpc.eject(false,XpathDevice,function(error,reply){openErrorPopup();});});});},postLoad:function(){var XpathDevice=$('#customEquipmentTHD span:eq(0)').text();$("#help").bind("click",function(){helpPopup("html/main/help_customEquipmentTHD.html");});var url=$('#customEquipmentTHD span:eq(1)').text();var Icons=XpathDevice+"/Icon";jQuery.orange.config.api.crud.read([Icons],function(result){if(result[Icons].values[Icons]==undefined||result[Icons].values[Icons]==""||result[Icons].values[Icons]==null){if(url!=null){$("#equicon")[0].setDataValue("ico_devices_livephone.png");}
$("#equicon").orangeParse();var form=$("#customEquipmentTHD form")[0];var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO=[];form.modifsOK=[];var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}});$("#btnBack").bind('click',function(){jQuery.orange.widget.MenuItem.setCurrent('m3.m31.m310');});$("#btnDelete").click(function(){openConfirmationPopup('popup.deletedevice.title','popup.deletedevice.text',function(){jQuery.orange.config.api.rpc.unpair(XpathDevice,function(result){jQuery.orange.widget.MenuItem.setCurrent('m3.m31.m310');});});});$("#connectionstatuslabel").bind('change',function(){var valueInForm=$("#connectionstatuslabel")[0].getDataValue();if(valueInForm=="CONNECTED"){$("#btnDelete").setDisabled(true);}else{$("#btnDelete").setDisabled(false);}});$("#connectionstatuslabel").trigger("change");var name=XpathDevice+"/Name";jQuery.orange.config.api.crud.read([name],function(result){if(result[name].values[name]!=undefined){$("#phoneName").val(result[name].values[name]);}});$("select","#selectType")[0].disabled=true;$("select","#selectType")[0].selectedIndex=2;$("#btnSave").click(function(){var id2value={};id2value[name]=$("#phoneName").val();jQuery.orange.config.api.crud.update(id2value,function(){$("#saved_popup").dialog('open');setTimeout("$('#saved_popup').dialog('close')",4000);});});}};jQuery.orange.config.areacontent.customEquipmentEth={postParse:function(){var XpathDevice=$('#customEquipmentEth span:eq(0)').text();var i18n_title=$('#customEquipmentEth span:eq(1)').text();var XpathRouter=$('#customEquipmentEth span:eq(2)').text();var i18n_subtilte=$('#customEquipmentEth span:eq(3)').text();var url=$('#customEquipmentEth span:eq(4)').text();$("#content").data("title",i18n_title);$("#content").data("XpathRouter",XpathRouter);$("#content").data("i18n_subtilte",i18n_subtilte);$("#content").data("url",url);var Rooms="Device/UserInterface/Rooms/Room";jQuery.orange.config.api.crud.read([Rooms],function(result){if(result[Rooms].nb==0){}
else{var enum0="",room;for(room in result[Rooms].values){enum0+="'"+result[Rooms].values[room]["Name"]+"',";}
enum0=enum0.substr(0,enum0.length-1);$("#location").replaceWith('<span id="location" widgetType="EnumInput" widgetArg="\'select\'" dataId="'+XpathDevice+'/Location" enumerated="['+enum0+']" i18n="page.myEquipments.customEquipmentEth.config.location"/>');}});$("#location").parent().orangeParse();},postLoad:function(){var isMine=false;if(isMine){$("#blacklisted").setDisabled(true);}
var XpathDevice=$('#customEquipmentEth span:eq(0)').text();var url=$('#customEquipmentEth span:eq(4)').text();var Icons=XpathDevice+"/Icon";var i18n_title=$('#customEquipmentEth span:eq(1)').text();$("#help").bind("click",function(){if(i18n_title=="page.myEquipments.customEquipmentEth.title"){helpPopup("html/main/help_customEquipmentEth.html")}else{helpPopup("html/main/help_customEquipmentWifi.html");}});jQuery.orange.config.api.crud.read([Icons],function(result){if(result[Icons].values[Icons]==undefined||result[Icons].values[Icons]==""||result[Icons].values[Icons]==null){if(url!=null&&url!=""){$("#equicon")[0].setDataValue(url);}else{$("#equicon")[0].setDataValue("ico_devices_desktop.png");}
$("#equicon").orangeParse();var form=$("#customEquipmentEth form")[0];var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO=[];form.modifsOK=[];var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}});$("#customEquipmentEth form")[0].crudCallDelegate=function(crudExec){crudExec();if(!$("#ckBlacklisted")[0].getDataValue()){$("#restrictions").empty();$("#restrictions").append('<a id="linktorestrictions" href="javascript:;" class="orange" i18n="page.myEquipments.customEquipmentEth.inetaccess.restrictions.link" widgettype="MenuItem" widgetarg="{menu: \'m3.m31.m314\', subst: {XrestrictedDevice: \''+XpathDevice.replace(/\'/g,"\\\'")+'\'}}"></a>');}else{$("#restrictions").empty();$("#restrictions").append('<span class="disabled" i18n="page.myEquipments.customEquipmentEth.inetaccess.restrictions.link"/>');}
$("#restrictions").orangeParse();};$("#btnBack").bind('click',function(){jQuery.orange.widget.MenuItem.setCurrent('m3.m31.m310');});$("#btnDelete").click(function(){openConfirmationPopup('popup.deletedevice.title','popup.deletedevice.text',function(){jQuery.orange.config.api.crud.del(XpathDevice,function(result){jQuery.orange.widget.MenuItem.setCurrent('m3.m31.m310');});});});$("#connectionstatuslabel").bind('change',function(){var valueInForm=$("#connectionstatuslabel")[0].getDataValue();if(valueInForm=="CONNECTED"){$("#btnDelete").setDisabled(true);}else{$("#btnDelete").setDisabled(false);}});$("#connectionstatuslabel").trigger("change");$("#ckBlacklisted").bind('change',function(event,newvalue){if(newvalue==undefined){newvalue=$("#ckBlacklisted")[0].getDataValue();}
var isBlacklisted=newvalue;var wasBlacklisted=$("#ckBlacklisted")[0].dataValueRef;if(isBlacklisted!=undefined){if(isBlacklisted){$("#restrictions").empty();$("#restrictions").append('<span class="disabled" i18n="page.myEquipments.customEquipmentEth.inetaccess.restrictions.link"/>');}else if(!isBlacklisted&&(isBlacklisted==wasBlacklisted)){$("#restrictions").empty();$("#restrictions").append('<a id="linktorestrictions"  class="orange" href="javascript:;" i18n="page.myEquipments.customEquipmentEth.inetaccess.restrictions.link" widgettype="MenuItem" widgetarg="{menu: \'m3.m31.m314\', subst: {XrestrictedDevice: \''+XpathDevice.replace(/\'/g,"\\\'")+'\'}}"></a>');}
$("#restrictions").orangeParse();}});$("#ckBlacklisted").trigger('change');if((navigator.appName=='Microsoft Internet Explorer')&&(navigator.appName.indexOf("Explorer")>=0)&&(getInternetExplorerVersion()==8)){}else{$("<thead style=\"display:none;\">"+"<tr>"+"<th i18n=\"page.myEquipments.customEquipmentEth.selecteur.back\"></th>"+"<th i18n=\"page.myEquipments.customEquipmentEth.selecteur.icon\"></th>"+"<th i18n=\"page.myEquipments.customEquipmentEth.selecteur.next\"></th>"+"</tr>"+"</thead>").prependTo("#equicon>table");$("#equicon>table").attr("summary","");$("#equicon>table").attr("widgetType","I18nable");$("#equicon>table").attr("widgetArg","{I18nable: {attribute: 'summary', i18n: 'page.myEquipments.customEquipmentEth.selecteur.summary'} }");$("<caption style='display:none' i18n='page.myEquipments.customEquipmentEth.selecteur.caption'/>").prependTo("#equicon>table");$("#equicon").orangeParse();$("#equicon").orangeTranslate();}}};jQuery.orange.config.areacontent.customEquipmentUsb={postParse:function(){var XpathDevice=$('#customEquipmentUsb span:eq(0)').text();var url=$('#customEquipmentUsb span:eq(1)').text();var Rooms="Device/UserInterface/Rooms/Room";jQuery.orange.config.api.crud.read([Rooms],function(result){if(result[Rooms].nb==0){$("#location").replaceWith($('<span/>').attr('i18n','page.myEquipments.userEquipment.filtre.location.none'));}
else{var enum0="",room;for(room in result[Rooms].values){enum0+="'"+result[Rooms].values[room]["Name"]+"',";}
enum0=enum0.substr(0,enum0.length-1);$("#location").replaceWith('<span id="location" widgetType="EnumInput" widgetArg="\'select\'" dataId="'+XpathDevice+'/Location" enumerated="['+enum0+']" i18n="page.myEquipments.customEquipmentEth.config.location"/>');}});$("#location").parent().orangeParse();$("#btnEject").click(function(){openConfirmationPopup('popup.eject.title','popup.eject.text',function(){jQuery.orange.config.api.rpc.eject(false,XpathDevice,function(error,reply){openErrorPopup();});});});},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_customEquipmentUSB.html");});var XpathDevice=$('#customEquipmentUsb span:eq(0)').text();var url=$('#customEquipmentUsb span:eq(1)').text();var Icons=XpathDevice+"/Icon";jQuery.orange.config.api.crud.read([Icons],function(result){if(result[Icons].values[Icons]==undefined||result[Icons].values[Icons]==""||result[Icons].values[Icons]==null){$("#equicon")[0].setDataValue("ico_devices_usbhdd.png");$("#equicon").orangeParse();var form=$("#customEquipmentUsb form")[0];var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO=[];form.modifsOK=[];var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}});var Volume=XpathDevice+"/Volumes/Volume";jQuery.orange.config.api.crud.read([Volume],function(result){var widget=$("#customEquipmentUsb_table")[0];var columns=widget.conf.columns;var form=$("form",widget)[0];var data=result[Volume];if(data!=undefined){form.dataConstraints=data.constraints;columns[0].attr="Name";columns[1].attr="FileSystem";columns[2].attr="Capacity";columns[5].attr="Status";var id;for(id in data.values){var values=data.values[id];values['FreeSpace']=values['Capacity']-values['UsedSpace'];values['PercentageUsed']=Math.round((values['UsedSpace']/values['Capacity'])*100)+"%";values['FormatBtn']='<span id="btnFormat_'+values['Name']+'" widgetType="ButtonImage"  i18n="page.myEquipments.customEquipmentUsb.infos.format.btn"/>';values['VerifBtn']='<span id="btnVerif_'+values['Name']+'" widgetType="ButtonImage"  i18n="page.myEquipments.customEquipmentUsb.infos.verif.btn"/>';jQuery.orange.widget.Table.addRow.call(widget,id,values);}}
$('#customEquipmentUsb_table').orangeParse();});$('#customEquipmentUsb_table span[id^="btnFormat"]').each(function(){$(this).bind('click',function(){var xpath=$(this).parents("tr").attr("dataid");var i18nTitle;var i18nText;if($(this).parent().parent().children('td:eq(1)')[0].dataValueRef=="FAT32"){i18nTitle='popup.format.title';i18nText='popup.format.text';}
else{i18nTitle='popup.formatfat32.title';i18nText='popup.formatfat32.text';}
openConfirmationPopup(i18nTitle,i18nText,function(){jQuery.orange.config.api.rpc.format(xpath,"FAT32",null,function(error,reply){openErrorPopup();});});});});$('#customEquipmentUsb_table span[id^="btnVerif"]').each(function(){$(this).bind('click',function(){if($(this).parent().parent().children('td:eq(1)')[0].dataValueRef=="NTFS"){openErrorPopup('popup.checkerr.title','popup.checkerr.text');return;}
var xpath=$(this).parents("tr").attr("dataid");jQuery.orange.config.api.rpc.check(xpath,null,function(error,reply){if(error.code==jQuery.gui.XMO_USED_DEVICE_ERR||error.code==jQuery.gui.XMO_NO_DEVICE_ERR){openErrorPopup('popup.checkerr.title','popup.checkerr.text');}
else{openErrorPopup();}});});});$("#btnBack").bind('click',function(){jQuery.orange.widget.MenuItem.setCurrent('m3.m31.m310');});$("#btnDelete").click(function(){openConfirmationPopup('popup.deletedevice.title','popup.deletedevice.text',function(){jQuery.orange.config.api.crud.del(XpathDevice,function(result){jQuery.orange.widget.MenuItem.setCurrent('m3.m31.m310');});});});$("#connectionstatuslabel").bind('change',function(){var valueInForm=$("#connectionstatuslabel")[0].getDataValue();if(valueInForm=="CONNECTED"){$("#btnDelete").setDisabled(true);}else{$("#btnDelete").setDisabled(false);}});$("#connectionstatuslabel").trigger("change");}};jQuery.orange.config.areacontent.customEquipmentStd={postParse:function(){var XpathDevice=$('#customEquipmentStd span:eq(0)').text();var Rooms="Device/UserInterface/Rooms/Room";jQuery.orange.config.api.crud.read([Rooms],function(result){if(result[Rooms].nb==0){$("#location").replaceWith($('<span/>').attr('i18n','page.myEquipments.userEquipment.filtre.location.none'));}
else{var enum0="",room;for(room in result[Rooms].values){enum0+="'"+result[Rooms].values[room]["Name"]+"',";}
enum0=enum0.substr(0,enum0.length-1);$("#location").replaceWith('<span id="location" widgetType="EnumInput" widgetArg="\'select\'" dataId="'+XpathDevice+'/Location" enumerated="['+enum0+']" i18n="page.myEquipments.customEquipmentEth.config.location"/>');}});$("#location").parent().orangeParse();},postLoad:function(){var XpathDevice=$('#customEquipmentStd span:eq(0)').text();var Icons=XpathDevice+"/Icon";jQuery.orange.config.api.crud.read([Icons],function(result){if(result[Icons].values[Icons]==undefined||result[Icons].values[Icons]==""||result[Icons].values[Icons]==null){$("#equicon")[0].setDataValue("theme/webCorporate/image/device/usb.png");$("#equicon").orangeParse();var form=$("#customEquipmentStd form")[0];var oldState=jQuery.orange.widget.Form.getState.call(form);form.dataKO=[];form.modifsOK=[];var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}}});$("#btnBack").bind('click',function(){jQuery.orange.widget.MenuItem.setCurrent('m3.m31.m310');});$("#connectionstatuslabel").bind('change',function(){var valueInForm=$("#connectionstatuslabel")[0].getDataValue();if(valueInForm=="CONNECTED"){$("#btnDelete").setDisabled(true);}else{$("#btnDelete").setDisabled(false);}});$("#connectionstatuslabel").trigger("change");}};function restrictions_ensureDatamodelIsInitialized(){var daysMap={'MONDAY':1,'TUESDAY':1,'WEDNESDAY':1,'THURSDAY':1,'FRIDAY':1,'SATURDAY':1,'SUNDAY':1};var XpathDevice=$('#restriction span:eq(0)').text()+"/BlacklistedSchedule/ManagementDay";jQuery.orange.config.api.crud.read([XpathDevice],function(result){for(var xpathKey in result){for(var managementDayKey in result[xpathKey].values){var managementDay=result[xpathKey].values[managementDayKey];if(daysMap[managementDay.DayIndex]!=undefined){daysMap[managementDay.DayIndex]=undefined;}}}
var actions=[];for(var day in daysMap){if(daysMap[day]!=undefined){var attrs={'DayIndex':day};for(var h=0;h<24;h++){attrs["Hours"+h]=true;}
actions.push({crud:'create',id:XpathDevice,attrs:attrs});}}
if(actions.length>0){jQuery.orange.config.api.crud.exec(actions);}});}
jQuery.orange.config.areacontent.restriction={preParse:function(){restrictions_ensureDatamodelIsInitialized();var i18n_title=$("#content").data("title");var XpathRouter=$("#content").data("XpathRouter");var i18n_subtilte=$("#content").data("i18n_subtilte");var url=$("#content").data("url");var XpathDevice=$('#restriction span:eq(0)').text();$("#btnBackEquip").attr("widgetArg","{MenuItem: {menu: 'm3.m31.m311', subst: {i18n_title : '"+i18n_title+"',i18n_subtilte : '"+i18n_subtilte+"',XpathRouter : '"+XpathRouter+"', XpathDevice: '"+XpathDevice.replace(/\'/g,"\\\'")+"', url:'"+url+"'}}}");var days=['MONDAY','TUESDAY','WEDNESDAY','THURSDAY','FRIDAY','SATURDAY','SUNDAY'];for(var d in days){for(var i=0;i<24;i++){$('#restriction form').append('<input style="display:none" id="'+days[d]+'_Hours'+i+'" type="checkbox" dataId="'+XpathDevice+'/BlacklistedSchedule/ManagementDay[@DayIndex=\''+days[d]+'\']/Hours'+i+'">');}}
$("#restriction input[type='button'][class!='allon'][class!='alloff']").each(function(){$(this).attr('i18n','page.myEquipments.restriction.hour');});$("#restriction input[type='button'][class='allon']").each(function(){$(this).attr('i18n','page.myEquipments.restriction.on');});$("#restriction input[type='button'][class='alloff']").each(function(){$(this).attr('i18n','page.myEquipments.restriction.off');});},postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_restriction.html");});$("#restriction input[type='button'][class='onetoggle']").each(function(){var associed_ck=$('#'+$(this).parent().parent().attr('id')+'_Hours'+$(this).val());if(associed_ck[0].checked){$(this).removeClass('active');$(this).addClass('deactive');}
else{$(this).removeClass('deactive');$(this).addClass('active');}
$(this).bind('click',function(){associed_ck[0].checked=!associed_ck[0].checked;associed_ck.trigger('valueChange');});associed_ck.bind('valueChange',function(){var id=this.id;var day=id.substring(0,id.indexOf('_'));var hour=id.substring(id.indexOf('_')+6,id.length);if(this.checked){$("#restriction #"+day+" input[type='button'][value='"+hour+"']").removeClass('active');$("#restriction #"+day+" input[type='button'][value='"+hour+"']").addClass('deactive');}
else{$("#restriction #"+day+" input[type='button'][value='"+hour+"']").removeClass('deactive');$("#restriction #"+day+" input[type='button'][value='"+hour+"']").addClass('active');}});});$("#restriction input[type='button'][class='allon']").each(function(){$(this).bind('click',function(){var input_list=$(this).parent().parent().children('td').children('input[class!="allon"][class!="alloff"]');input_list.each(function(){var associed_ck=$('#'+$(this).parent().parent().attr('id')+'_Hours'+$(this).val());associed_ck[0].checked=false;associed_ck.trigger('valueChange');});});});$("#restriction input[type='button'][class='alloff']").each(function(){$(this).bind('click',function(){var input_list=$(this).parent().parent().children('td').children('input[class!="allon"][class!="alloff"]');input_list.each(function(){var associed_ck=$('#'+$(this).parent().parent().attr('id')+'_Hours'+$(this).val());associed_ck[0].checked=true;associed_ck.trigger('valueChange');});});});}};jQuery.orange.config.areacontent.restart={postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_restart.html");});$("#btnRebootBox").click(function(){openConfirmationPopup('popup.confirmrebootlivebox.title','popup.confirmrebootlivebox.text',function(){var boxName=$("#restart h1 span:eq(1)").text();var XpathRPC=$('#restart span:eq(1)').text();jQuery.orange.config.api.rpc.reboot(XpathRPC,function(reply,cb){showRebootPage(boxName);},function(error,reply){if(error!=undefined&&error.code==jQuery.gui.XMO_REQUEST_NO_ERR){showRebootPage(boxName);}else{openErrorPopup();}});});});$("#btnRebootWiFi").click(function(){openConfirmationPopup('popup.rebootwifi.title','popup.rebootwifi.text',function(){var Xwifienable="Device/Networks/LAN[@name=\'LAN\']/LANPorts/LANWiFiPort/Enable";var id2value={};id2value[Xwifienable]=false;jQuery.orange.config.api.crud.update(id2value);id2value[Xwifienable]=true;jQuery.orange.config.api.crud.update(id2value);});});}};jQuery.orange.config.areacontent.update={postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_update.html");});$("#btnUpdate").click(function(){var XpathRouter=$('#update span:eq(0)').text();var XpathRPC=$('#update span:eq(1)').text();openConfirmationPopup('popup.confirmupdate.title','popup.confirmupdate.text',function(){jQuery.orange.config.api.rpc.requestDownload(XpathRPC,function(isUpdateInProgress){if(isUpdateInProgress){jQuery.orange.widget.MenuItem.setCurrent('m3.m30.m3041',{XpathRouter:XpathRouter});}else{openErrorPopup("page.myEquipments.update.popup.nonewfirmware.title","page.myEquipments.update.popup.nonewfirmware.msg");}},function(error,reply){openErrorPopup("page.myEquipments.update.popup.error.title","page.myEquipments.update.popup.error.msg");});});});}};function updateInProgress_onProgressChange(percentage){if(percentage<0.0)percentage=0.0;if(percentage>1.0)percentage=1.0;$('#completeStatus')[0].setDataValue(percentage*100);$(".progressbar-text").html(percentage*100+"%");}
function updateInProgress_onRebooting(){var liveboxName=$('#updateInProgress h1 span:eq(1)').text();showRebootPage(liveboxName);onRebootDone(function(){window.location="index.html";});}
jQuery.orange.config.areacontent.updateInProgress={postParse:function(){$('#completeStatus').attr('maxvalue','100');var internatStatusSurveyRequest=jQuery.orange.config.api.client.newRequest();internatStatusSurveyRequest.onPeriodicValue("Device/DeviceInfo/UpdateStatus",function(newvalue){if($('#completeStatus')[0]!=undefined){updateInProgress_onProgressChange(newvalue);if(newvalue>=1.0){updateInProgress_onRebooting();}}},function(){},function(){},{timer:5});internatStatusSurveyRequest.send();onRebootStart(updateInProgress_onRebooting);}};function reinitialisation_enableDisableSimCardReinit(simcardState,isGateway){if(isGateway&&(simcardState=='VALID'||simcardState=='VALID_SECURE')){$("#insertCard").hide();$("#radioType input:eq(0)").removeAttr('disabled');$("#radioType input:eq(1)").removeAttr('disabled');$("#radioType")[0].setDataValue('0');}else{if(isGateway){$("#insertCard").show();}else{$("#insertCard").hide();}
$("#radioType input:eq(0)").attr('disabled','disabled');$("#radioType input:eq(1)").attr('disabled','disabled');$("#radioType")[0].setDataValue('2');}}
jQuery.orange.config.areacontent.reinitialisation={postParse:function(){var isGateway=($("#rpcpath").text()=="Device");$("#help").bind("click",function(){helpPopup("html/main/help_reinitialisation.html");});$("#radioType span:eq(0)").after('<div class="margin-left-20" i18n="page.myEquipments.reinitialisation.reinit.typedescription.0"/>');$("#radioType span:eq(1)").after('<div class="margin-left-20" i18n="page.myEquipments.reinitialisation.reinit.typedescription.1"/>');$("#radioType span:eq(2)").after('<div class="margin-left-20"  i18n="page.myEquipments.reinitialisation.reinit.typedescription.2"/>');$("#radioType").orangeParse();$("#memoryCardStatus").bind('change',function(event){reinitialisation_enableDisableSimCardReinit(event.target.value,isGateway);});if(!isGateway){reinitialisation_enableDisableSimCardReinit("NOT_PRESENT",false);}
$("#btnReinitBox").click(function(){openConfirmationPopup('popup.reinitlivebox.title','popup.reinitlivebox.text',function(){var type="SIMCARD_FULL";if($("#radioType input:eq(0)").is(':checked'))
type="SIMCARD_FULL";else if($("#radioType input:eq(1)").is(':checked'))
type="SIMCARD_MINI";else if($("#radioType input:eq(2)").is(':checked'))
type="FACTORY";var boxName=$("#reinitialisation h1 span:eq(1)").text();var XpathRPC=$('#reinitialisation span:eq(1)').text();jQuery.orange.config.api.rpc.reinitialize(XpathRPC,type,function(reply,cb){showRebootPage(boxName);},function(error,reply){if(error!=undefined&&error.code==jQuery.gui.XMO_REQUEST_NO_ERR){showRebootPage(boxName);}else{openErrorPopup();}});showRebootPage(boxName);});});$("#btnReinitBox").setDisabled(jQuery.orange.config.api.authorization.accessRemoteDisable);$("#btnReinitBox > img").setDisabled(jQuery.orange.config.api.authorization.accessRemoteDisable);}};jQuery.orange.config.areacontent.reinitialisationAP={postParse:function(){$("#btnReinitBox").click(function(){openConfirmationPopup('popup.reinitlivebox.title','popup.reinitlivebox.text',function(){var boxName=$("#reinitialisationAP h1 span:eq(1)").text();});});}};jQuery.orange.config.areacontent.restartInProgress={preParse:function(){},postLoad:function(){}};jQuery.orange.config.areacontent.save={postParse:function(area){$("#help").bind("click",function(){helpPopup("html/main/help_save.html");});$("#btnSave").setDisabled(true);$("#savename").bind('change keyup',function(event){if(event.target.value==""){$("#btnSave").setDisabled(true);}
else{$("#btnSave").setDisabled(false);}});$("#savename").bind('change keyup',function(){var alphaNum=new RegExp("^[A-Za-z0-9]+$","g");var savename=$("#savename")[0].getDataValue();if(savename.length>0&&!(alphaNum.test(savename))){$('#newSaveError').show();$("#savename").addClass("errorInput");return;};if(savename.length>32){$('#newSaveErrorLength').show();$("#savename").addClass("errorInput");return;};$('#newSaveError').hide();$('#newSaveErrorLength').hide();$("#savename").removeClass("errorInput");});$("#btnSave").bind('click',function(){var alphaNum=new RegExp("^[A-Za-z0-9]+$","g");var savename=$("#savename")[0].getDataValue();if(!(alphaNum.test(savename))){$('#newSaveError').show();return;};if(savename.length>32){$('#newSaveErrorLength').show();return;};var customfilename="livebox.bin";if(savename!=""||savename!=undefined||savename!=null){customfilename=$("#savename")[0].getDataValue()+".bin";}
var req=jQuery.orange.config.api.client.newRequest();req.downloadFile("Device/DeviceInfo/VendorConfigFile",customfilename,null,function(){alert("Le processus de sauvegarde a chou");});req.send();});}};jQuery.orange.config.areacontent.restore={postParse:function(area){$("#selectedfile").parent().hide();$("#btnRestore").setDisabled(true);$("#saveFileChooser").bind('change',function(event){var GOOD=fr.orange.livebox.gui.api.ProgressiveRegexp.GOOD;$("#saveFileChooser")[0].setFocus(false);var ok=jQuery.orange.widget.Form.verifyConstraints($("#saveFileChooser")[0],true)==GOOD;if(ok){$("#selectedfile").html($("#saveFileChooser").val());$("#selectedfile").parent().show();}else{$("#selectedfile").parent().hide();}
$("#btnRestore").setDisabled(!ok);});$("#btnRestore").click(function(){var boxName=$("#restore h1 span:eq(1)").text();openConfirmationPopup('popup.restore.title','popup.restore.text',function(){var req=jQuery.orange.config.api.client.newRequest();req.uploadFile("Device/DeviceInfo/VendorConfigFile",'#saveFileChooser',function(){},function(){alert("Erreur de restauration");});req.send();showRebootPage(boxName);});});$("#help").bind("click",function(){helpPopup("html/main/help_restore.html");});}};function infoSystem_preParse(){$("#routerlist").attr('i18n','page.myEquipments.userEquipment.filtre.lb').parent().orangeParse();$("#routerlist").bind("change",function(event,newValue){if(newValue){if(newValue=='ALL'){$(".sysinfo").css('height','auto');$(".sysinfo").css('overflow','visible');$(".sysinfo").parent().children('div').children('span').removeClass('plus');$(".sysinfo").parent().children('div').children('span').addClass('moins');}else{$(".sysinfo").css('height','0');$(".sysinfo").css('overflow','hidden');$(".sysinfo").parent().children('div').children('span').removeClass('moins');$(".sysinfo").parent().children('div').children('span').addClass('plus');if(newValue!="MASTERBOX"){newValue="id"+newValue;}
$("#"+newValue+" > div > span").removeClass('plus');$("#"+newValue+" > div > span").addClass('moins');$("#"+newValue+" > .sysinfo").css('height','auto');$("#"+newValue+" > .sysinfo").css('overflow','visible');}}});}
function infoSystem_postParse(element){var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){MeshEnable=result[MeshEnable].values[MeshEnable];});if(MeshEnable!=true){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").addClass('moins');}else{var APDevice="Device/MESH/AccessPoints/AccessPoint[Alias!='GWC']";jQuery.orange.config.api.crud.read([APDevice],function(result){var RouterName="Device/DeviceInfo/RouterName";jQuery.orange.config.api.crud.read([RouterName],function(result){$("#routerlist select").append('<option value="MASTERBOX">'+result[RouterName].values[RouterName]+'</option>');});if(result[APDevice].nb>0){for(var box in result[APDevice].values){var uid=result[APDevice].values[box]["uid"];var RouterName="Device/MESH/AccessPoints/AccessPoint[@uid='"+uid+"']/DeviceInfo/RouterName";jQuery.orange.config.api.crud.read([RouterName],function(result){$("#routerlist select").append('<option value="'+uid+'">'+result[RouterName].values[RouterName]+'</option>');});$("#id"+uid+" > .sysinfo").css('height','0');$("#id"+uid+" > .sysinfo").css('overflow','hidden');}
$("#routerlist select").append('<option value="ALL" i18n="livebox.ALL"/>');}});}
$(element).orangeRead();$(element).orangeParse();$(element).orangeTranslate();$(".moins").each(function(){var tip=jQuery.orange.config.i18n.map["page.diagnostic.infosystem.section.tip"];tip=tip.replace("<Section>",$("h1>span:eq(1)").html());tip=tip.replace("<RouterName>",$(this).text());$(this).attr('title',tip);});$(".plus").each(function(){var tip=jQuery.orange.config.i18n.map["page.diagnostic.infosystem.section.tip"];tip=tip.replace("<Section>",$("h1>span:eq(1)").html());tip=tip.replace("<RouterName>",$(this).text());$(this).attr('title',tip);});$("div>span").each(function(){$(this).bind("click",function(){if($(this).attr('class')=="plus"){$(this).parent().parent().children('.sysinfo').css('height','auto');$(this).parent().parent().children('.sysinfo').css('overflow','visible');$(this).removeClass('plus');$(this).addClass('moins');}
else if($(this).attr('class')=="moins"){$(this).parent().parent().children('.sysinfo').css('height','0');$(this).parent().parent().children('.sysinfo').css('overflow','hidden');$(this).removeClass('moins');$(this).addClass('plus');}});});}
jQuery.orange.config.areacontent.infoSystem={preParse:function(){var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){MeshEnable=result[MeshEnable].values[MeshEnable];});if(MeshEnable!=true){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');}else{var nbAPDevice;var APDevice="Device/MESH/AccessPoints/AccessPoint[Alias!='GWC']";jQuery.orange.config.api.crud.read([APDevice],function(result){if(result[APDevice]==undefined){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');}
else{nbAPDevice=result[APDevice].nb;if(result[APDevice].nb==0){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');}
else if(result[APDevice].nb>0){var box;for(box in result[APDevice].values){var uid=result[APDevice].values[box]["uid"];$(".maindiv > form").append('<div id="id'+uid+'"/>');$("#id"+uid).append('<div class="headBoxType1 margin-top-10"><span class="plus" ><span class="h3Text margin-left-30" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/DeviceInfo/RouterName"/></span></div>');var content="";content+='<div class="sysinfo">';content+='<div class="boxType4 border-bottom-3">';content+='<div class="h2Text orange" i18n="page.diagnostic.infosystem.general"/>';content+='<div class="clear"/>';content+='<div class="margin-leftInfSys-30" widgetType="FormInput" widgetArg="{\'align\':\'left\'}" i18n="page.diagnostic.infosystem.general.1.1">';content+='<span class="bold_font" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/DeviceInfo/Manufacturer"/>';content+='</div>';content+='<div class="margin-leftInfSys-30" widgetType="FormInput" widgetArg="{\'align\':\'left\'}" i18n="page.diagnostic.infosystem.general.1.2">';content+='<span class="bold_font" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/DeviceInfo/ModelName"/>';content+='</div>';content+='<div class="margin-leftInfSys-30" widgetType="FormInput" widgetArg="{\'align\':\'left\'}" i18n="page.diagnostic.infosystem.general.1.3">';content+='<span class="bold_font" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/DeviceInfo/Country" i18nPrefix="data.diagnostic.infosystem.country"/>';content+='</div>';content+='<div class="margin-leftInfSys-30" widgetType="FormInput" widgetArg="{\'align\':\'left\'}" i18n="page.diagnostic.infosystem.general.1.4">';content+='<span class="bold_font" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/DeviceInfo/OSVersion"/>';content+='</div>';content+='<div class="margin-leftInfSys-30" widgetType="FormInput" widgetArg="{\'align\':\'left\'}" i18n="page.diagnostic.infosystem.general.1.5">';content+='<span class="bold_font" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/DeviceInfo/GUIVersion"/>';content+='</div>';content+='<div class="margin-leftInfSys-30" widgetType="FormInput" widgetArg="{\'align\':\'left\'}" i18n="page.diagnostic.infosystem.general.mesh.1.10">';content+='<span class="bold_font" dataId="Device/MESH/AccessPoints/AccessPoint[@uid=\''+uid+'\']/IPAddress"/>';content+='</div>';content+='</div>';content+='</div>';$("#id"+uid).append(content);}}}});}
infoSystem_preParse();},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#infoSystem");}};jQuery.orange.config.areacontent.infoSystemADSL={preParse:function(){$("#subtitleADSL").hide();$("#subtitleFTTH").hide();infoSystem_preParse();},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#infoSystemADSL");},postLoad:function(){$("#subtitleADSL").show();$("#subtitleFTTH").show();}};jQuery.orange.config.areacontent.infoSystemVoIP={preParse:function(){var MeshEnable="Device/MESH/Enable";MeshEnable=false;if(MeshEnable!=true){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');}
infoSystem_preParse();},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#infoSystemVoIP");}};jQuery.orange.config.areacontent.infoSystemTV={preParse:function(){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');infoSystem_preParse();},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#infoSystemTV");}};jQuery.orange.config.areacontent.infoSystemWiFi={preParse:function(){var MeshEnable="Device/MESH/Enable";MeshEnable=false;if(MeshEnable!=true){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');}else{}
infoSystem_preParse();},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#infoSystemWiFi");}};jQuery.orange.config.areacontent.infoSystemLAN={preParse:function(){var MeshEnable="Device/MESH/Enable";MeshEnable=false;if(MeshEnable!=true){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');}else{}
infoSystem_preParse();},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#infoSystemLAN");}};jQuery.orange.config.areacontent.infoSystemUSB={preParse:function(){var Xuid_USB1="Device/Networks/LAN[@name='LAN']/LANPorts/USBPort[@Name='Front']/@uid";jQuery.orange.config.api.crud.read([Xuid_USB1],function(result){for(var uid in result[Xuid_USB1].values){uid_USB1=result[Xuid_USB1].values[uid];}
var linkedDevices="Device/Networks/LAN[@name='LAN']/LANPorts/USBPort[HUBPort='"+uid_USB1+"']";jQuery.orange.config.api.crud.read([linkedDevices],function(result2){if(result2[linkedDevices]!=undefined){var device;var i=4;for(device in result2[linkedDevices].values){$("#gwc_usb1").append('<br/><div widgetType="FormInput"><span dataId="'+device+'/Status" i18nPrefix="data.diagnostic.infosystem.usb.linkstatus"/></div>');$("#gwc_usb1").append('<div widgetType="FormInput"><span dataId="'+device+'/DeviceClass" i18nPrefix="data.diagnostic.infosystem.usb.function"/></div>');$("#gwc_usb1").orangeParse();$('[dataid="'+device+'/Status"]').parent().prev().html("7."+i+"&#160;<span i18n='page.diagnostic.infosystem.usb.usb.linkstatus'/>");i++;$('[dataid="'+device+'/DeviceClass"]').parent().prev().html("7."+i+"&#160;<span i18n='page.diagnostic.infosystem.usb.usb.function'/>");i++;$("#gwc_usb1").orangeParse();}}});});var Xuid_USB2="Device/Networks/LAN[@name='LAN']/LANPorts/USBPort[@Name='Left']/@uid";jQuery.orange.config.api.crud.read([Xuid_USB2],function(result){for(var uid2 in result[Xuid_USB2].values){uid_USB2=result[Xuid_USB2].values[uid2];}
var linkedDevices="Device/Networks/LAN[@name='LAN']/LANPorts/USBPort[HUBPort='"+uid_USB2+"']";jQuery.orange.config.api.crud.read([linkedDevices],function(result2){if(result2[linkedDevices]!=undefined){var device;var i=4;for(device in result2[linkedDevices].values){$("#gwc_usb2").append('<br/><div widgetType="FormInput"><span dataId="'+device+'/Status" i18nPrefix="data.diagnostic.infosystem.usb.linkstatus"/></div>');$("#gwc_usb2").append('<div widgetType="FormInput"><span dataId="'+device+'/DeviceClass" i18nPrefix="data.diagnostic.infosystem.usb.function"/></div>');$("#gwc_usb2").orangeParse();$('[dataid="'+device+'/Status"]').parent().prev().html("8."+i+"&#160;<span i18n='page.diagnostic.infosystem.usb.usb.linkstatus'/>");i++;$('[dataid="'+device+'/DeviceClass"]').parent().prev().html("8."+i+"&#160;<span i18n='page.diagnostic.infosystem.usb.usb.function'/>");i++;$("#gwc_usb2").orangeParse();}}});});var MeshEnable="Device/MESH/Enable";MeshEnable=false;if(MeshEnable!=true){$("#routerlist").parent().remove();$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');}else{}
infoSystem_preParse();},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#infoSystemUSB");}};jQuery.orange.config.areacontent.infoSystemMesh={postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#infoSystemMesh");},postLoad:function(){var OSVersion;var ConfigurationVersion;var GUIVersion;var needSynchro=false;var masterBox="Device/DeviceInfo";jQuery.orange.config.api.crud.read([masterBox],function(result){var widget=$("#infosystemmesh_table")[0];var columns=widget.conf.columns;var form=$("form",widget)[0];var data=result[masterBox];if(data!=undefined){form.dataConstraints=data.constraints;columns[0].attr="RouterName";columns[1].attr="OSVersion";columns[2].attr="ConfigurationMeshVersion";columns[3].attr="GUIVersion";var id;for(id in data.values){var values=data.values[id];jQuery.orange.widget.Table.addRow.call(widget,id,values);OSVersion=values['OSVersion'];ConfigurationVersion=values['ConfigurationMeshVersion'];GUIVersion=values['GUIVersion'];}}});var MeshEnable="Device/MESH/Enable";jQuery.orange.config.api.crud.read([MeshEnable],function(result){MeshEnable=result[MeshEnable].values[MeshEnable];});if(MeshEnable==true){var APDevice="Device/MESH/AccessPoints/AccessPoint[Alias!='GWC']";jQuery.orange.config.api.crud.read([APDevice],function(result){if(result[APDevice].nb>0){var box;for(box in result[APDevice].values){var uid=result[APDevice].values[box]["uid"];var meshBox="Device/MESH/AccessPoints/AccessPoint[@uid='"+uid+"']/DeviceInfo";jQuery.orange.config.api.crud.read([meshBox],function(result){var widget=$("#infosystemmesh_table")[0];var columns=widget.conf.columns;var form=$("form",widget)[0];var data=result[meshBox];if(data!=undefined){form.dataConstraints=data.constraints;columns[0].attr="RouterName";columns[1].attr="OSVersion";columns[2].attr="GUIVersion";var id;for(id in data.values){var values=data.values[id];jQuery.orange.widget.Table.addRow.call(widget,id,values);if(values['OSVersion']!=OSVersion||values['GUIVersion']!=GUIVersion){needSynchro=true;}}}});}}});}
$("#infoSystemMesh #btnSynchro").setDisabled(!needSynchro);}};jQuery.orange.config.areacontent.infoSystemMeshSynchro={postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});},postLoad:function(){jQuery.orange.config.api.rpc.syncNetwork(function(success){if(success){waitForRebootAndReload();}else{openErrorPopup();$("#error_popup").bind("closePopup",function(){jQuery.orange.widget.MenuItem.setCurrent("m4.m40.m407");});}});}};jQuery.orange.config.areacontent.telephoneHD={preParse:function(){$("#MASTERBOX > div > span").removeClass('plus');$("#MASTERBOX > div > span").removeClass('moins');},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_infoSystem.html");});infoSystem_postParse("#telephoneHD");}};var started=false;var timeoutId;var seconds=900;function startTimer(){if(!started)
{started=true;updateTimer();}}
function updateTimer(){if(seconds>0){seconds-=1;$('#timer')[0].setDataValue($('#timer')[0].getDataValue()-1);var minVar=Math.floor(seconds/60);var secVar=seconds%60;$(".progressbar-text").html(((minVar<10)?"0":"")+minVar+((secVar<10)?"min 0":"min ")+secVar+"s");timeoutId=setTimeout("updateTimer()",1000);}
else
{timerEnd();}}
function stopTimer(){started=false;clearTimeout(timeoutId);seconds=900;$('#timer').attr('maxvalue','900');$('#timer')[0].setDataValue(900);$(".progressbar-text").html("15min 00s");$("#remain1").show();$("#remain2").hide();}
function extendTimer(){if(seconds>0){$("#remain1").hide();$("#remain2").show();seconds=7200;$('#timer').attr('maxvalue','7200');$('#timer')[0].setDataValue(7200);$(".progressbar-text").html("120min 00s");}}
function timerEnd(){started=false;clearTimeout(timeoutId);seconds=900;$('#timer').attr('maxvalue','900');$('#timer')[0].setDataValue(900);$(".progressbar-text").html("15min 00s");$("#remain1").show();$("#remain2").hide();$("#btnGo img").removeAttr('disabled');$("#btnStop img").attr('disabled','disabled');$("#btnExtend img").attr('disabled','disabled');;}
jQuery.orange.config.areacontent.distantaccessservice={postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_distantaccessservice.html");});$("#btnGo").setDisabled(false);$("#btnStop").setDisabled(true);$("#btnExtend").setDisabled(true);$('#timer')[0].setDataValue(900);$('#timer').attr('maxvalue','900');$(".progressbar-text").html("15min 00s");$("#btnStop img").attr('disabled','disabled');$("#btnExtend img").attr('disabled','disabled');$("#btnGo").bind("click",function(event){startTimer();$("#btnGo").setDisabled(true);$("#btnStop").setDisabled(false);$("#btnExtend").setDisabled(false);});$("#btnStop").bind("click",function(event){stopTimer();$("#btnGo").setDisabled(false);$("#btnStop").setDisabled(true);$("#btnExtend").setDisabled(true);});$("#btnExtend").bind("click",function(event){extendTimer();});},postLoad:function(){$("#url").html('https://'+$("#ip").html()+':'+$("#port").html());}};jQuery.orange.config.areacontent.basiclogs={postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_basiclogs.html");});var UdpFlood="Device/DeviceInfo/Logs/DoSProtection/UdpFlood";jQuery.orange.config.api.crud.read([UdpFlood],function(result){var widget=$("#dosprotection_table")[0];var columns=widget.conf.columns;var form=$("form",widget)[0];var data=result[UdpFlood];if(data!=undefined){form.dataConstraints=data.constraints;columns[0].attr="Id";columns[1].attr="Name";columns[2].attr="Activate";columns[3].attr="HitsNumber";var id;for(id in data.values){var values=data.values[id];values['Id']=1;values['Name']="UDPflood";jQuery.orange.widget.Table.addRow.call(widget,id,values);}}});var TcpFlood="Device/DeviceInfo/Logs/DoSProtection/TcpFlood";jQuery.orange.config.api.crud.read([TcpFlood],function(result){var widget=$("#dosprotection_table")[0];var columns=widget.conf.columns;var form=$("form",widget)[0];var data=result[TcpFlood];if(data!=undefined){form.dataConstraints=data.constraints;columns[0].attr="Id";columns[1].attr="Name";columns[2].attr="Activate";columns[3].attr="HitsNumber";var id;for(id in data.values){var values=data.values[id];values['Id']=2;values['Name']="TCPflood";jQuery.orange.widget.Table.addRow.call(widget,id,values);}}});var IcmpFlood="Device/DeviceInfo/Logs/DoSProtection/IcmpFlood";jQuery.orange.config.api.crud.read([IcmpFlood],function(result){var widget=$("#dosprotection_table")[0];var columns=widget.conf.columns;var form=$("form",widget)[0];var data=result[IcmpFlood];if(data!=undefined){form.dataConstraints=data.constraints;columns[0].attr="Id";columns[1].attr="Name";columns[2].attr="Activate";columns[3].attr="HitsNumber";var id;for(id in data.values){var values=data.values[id];values['Id']=3;values['Name']="ICMPflood";jQuery.orange.widget.Table.addRow.call(widget,id,values);}}});var WinNuke="Device/DeviceInfo/Logs/DoSProtection/WinNuke";jQuery.orange.config.api.crud.read([WinNuke],function(result){var widget=$("#dosprotection_table")[0];var columns=widget.conf.columns;var form=$("form",widget)[0];var data=result[WinNuke];if(data!=undefined){form.dataConstraints=data.constraints;columns[0].attr="Id";columns[1].attr="Name";columns[2].attr="Activate";columns[3].attr="HitsNumber";var id;for(id in data.values){var values=data.values[id];values['Id']=4;values['Name']="WINNuke";jQuery.orange.widget.Table.addRow.call(widget,id,values);}}});}};jQuery.orange.config.areacontent.advancedlogs={postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_advancedlogs.html");});var AdvancedLog="Device/DeviceInfo/Logs/AdvancedLogs/AdvancedLog";jQuery.orange.config.api.crud.read([AdvancedLog],function(result){var widget=$("#advancedlogs_table")[0];var columns=widget.conf.columns;var form=$("form",widget)[0];var data=result[AdvancedLog];if(data!=undefined){var id;for(id in data.values){var values=data.values[id];jQuery.orange.widget.Table.addRow.call(widget,id,values);}}});$("#advancedlogs_table").orangeParse();$("#ckAll")[0].setDataValue(true);$("#ckAll").attr('title',jQuery.orange.config.i18n.map['page.diagnostic.logs.advancedlogs.showsort.type.ALL.true.tip']);$('#ckList input').each(function(){this.checked=true;$(this).attr('title',jQuery.orange.config.i18n.map[$(this).next().attr('i18n')+'.true.tip']);});$('#ckAll').bind('change',function(event,newValue){if(newValue){$("#ckAll").attr('title',jQuery.orange.config.i18n.map['page.diagnostic.logs.advancedlogs.showsort.type.ALL.true.tip']);$('#ckList input').each(function(){this.checked=true;$(this).attr('title',jQuery.orange.config.i18n.map[$(this).next().attr('i18n')+'.true.tip']);});$('#type select option').each(function(){$(this).removeAttr('disabled');});$('#type select').val($('#type select option:eq(0)').val());$('#type select').trigger('change');}
else if(newValue!=undefined){$("#ckAll").attr('title',jQuery.orange.config.i18n.map['page.diagnostic.logs.advancedlogs.showsort.type.ALL.false.tip']);$('#type select option').each(function(){if($(this)[0].dataValue=='ALL'){$(this).attr('disabled','disabled');}});$('#type select option:eq(1)').removeAttr('disabled');$('#type select').val($('#type select option:eq(1)').val());$('#type select').trigger('change');}
grayDisabledOptionsIE7('type');});$('#ckList input').each(function(){$(this).bind('change',function(event){if(event.target.checked){$(event.target).attr('title',jQuery.orange.config.i18n.map[$(event.target).next().attr('i18n')+'.true.tip']);}
else{$(event.target).attr('title',jQuery.orange.config.i18n.map[$(event.target).next().attr('i18n')+'.false.tip']);}
var isOneChecked=false;var allAreChecked=true;$('#ckList input').each(function(){if(this.checked){isOneChecked=true;$('#type select option[i18n="'+$(this).next().attr('i18n')+'"]').removeAttr('disabled');}
else{allAreChecked=false;$('#type select option[i18n="'+$(this).next().attr('i18n')+'"]').attr('disabled','disabled');}});if(isOneChecked){$("#ckAll")[0].setDataValue(false);$("#ckAll").attr('title',jQuery.orange.config.i18n.map['page.diagnostic.logs.advancedlogs.showsort.type.ALL.false.tip']);$('#type select option:eq(0)').attr('disabled','disabled');$('#type select').val($('#type select option:enabled').val());$('#type select').trigger('change');}
else{$("#ckAll")[0].setDataValue(true);$("#ckAll").attr('title',jQuery.orange.config.i18n.map['page.diagnostic.logs.advancedlogs.showsort.type.ALL.true.tip']);$('#type select option:eq(0)').removeAttr('disabled');$('#type select').val($('#type select option:eq(0)').val());$('#type select').trigger('change');}
if(allAreChecked){$("#ckAll")[0].setDataValue(true);$("#ckAll").attr('title',jQuery.orange.config.i18n.map['page.diagnostic.logs.advancedlogs.showsort.type.ALL.true.tip']);$('#type select option:eq(0)').removeAttr('disabled');$('#type select').val($('#type select option:eq(0)').val());$('#type select').trigger('change');}
grayDisabledOptionsIE7('type');});});$('#type').bind('change',function(event,newvalue){if(newvalue=='ALL'){$('#advancedlogs_table tr.table-row').each(function(){$(this).show();});}
else{$('#advancedlogs_table td.table-col-1').each(function(){if($(this)[0].dataValueRef!=newvalue){$(this).parent().hide();}
else{$(this).parent().show();}});}});$("#saveLog").bind('click',function(event){jQuery.orange.config.api.rpc.getLogsURL('syslog.txt');});}};jQuery.orange.config.areacontent.ping={postLoad:function(){$("#btnPing").setDisabled(true);$("#repetition")[0].setDataValue('5');var ExternalIPAddress="Device/Networks/WAN[@name='WAN']/ExternalIPAddress";jQuery.orange.config.api.crud.read([ExternalIPAddress],function(result){$("#origin").append('<option value="'+result[ExternalIPAddress].values[ExternalIPAddress]+'">'+result[ExternalIPAddress].values[ExternalIPAddress]+'</option>');});var IPRouters="Device/Networks/LAN[@name='LAN']/IPRouters";jQuery.orange.config.api.crud.read([IPRouters],function(result){$("#origin").append('<option value="'+result[IPRouters].values[IPRouters]+'">'+result[IPRouters].values[IPRouters]+'</option>');});var APDevice="Device/MESH/AccessPoints/AccessPoint[Alias!='GWC']";jQuery.orange.config.api.crud.read([APDevice],function(result){if(result[APDevice].nb>0){var box;for(box in result[APDevice].values){$("#origin").append('<option value="'+result[APDevice].values[box]["IPAddress"]+'">'+result[APDevice].values[box]["IPAddress"]+'</option>');}}});$("#target").add($("#size")).bind('change keyup',function(event){var error=false;$("#ping input").each(function(){if(jQuery.orange.widget.Form.verifyConstraints(this)==false)
error=true;});$("#btnPing").setDisabled(error);});$("#btnPing").bind('click',function(){var target=$("#target").val();var origin=$("#origin").val();var size=$("#size").val();var repetition=$("#repetition")[0].getDataValue();$("#results").val(jQuery.orange.config.api.rpc.IPv4Ping(target,origin,size,repetition));});}};function password_checkCurrent(hasFocus){var oldHashPassword=jQuery.orange.config.api.client.getPassword();var password=$("#currentpassword input[type='password']").val();var hashPassword=jQuery.orange.config.api.client.hashPassword(password);var isCorrect=hashPassword==oldHashPassword;if(hasFocus!=undefined){if(isCorrect||hasFocus||password==""){$("#errorMsgCurrentDiff").hide();$("#currentpassword").removeClass('errorInput');}else{$("#errorMsgCurrentDiff").show();$("#currentpassword").addClass('errorInput');}}
return isCorrect;}
function password_checkNew(hasFocus){var newpasswordValue=$("#newpassword input[type='password']").val();var isCorrect=newpasswordValue!=""&&4<=newpasswordValue.length&&newpasswordValue.length<=32;if(hasFocus!=undefined){if(isCorrect||newpasswordValue==""){$("#newpassword").removeClass('errorInput');$("#errorMsgLength").hide();}else{if(hasFocus&&newpasswordValue.length<4){}else{$("#newpassword").addClass('errorInput');$("#errorMsgLength").show();}}}
return isCorrect;}
function password_checkConfirm(hasFocus){var newpasswordValue=$("#newpassword input[type='password']").val();var confirmValue=$("#newpasswordconfirm input[type='password']").val();var isCorrect=(newpasswordValue==confirmValue);if(hasFocus!=undefined){if(isCorrect||confirmValue==""||newpasswordValue==""||hasFocus&&newpasswordValue.startsWith(confirmValue)){$("#errorMsgNewDiff").hide();$("#newpasswordconfirm").removeClass('errorInput');}else{$("#errorMsgNewDiff").show();$("#newpasswordconfirm").addClass('errorInput');}}
return isCorrect;}
function password_secretanswerFocus(){$("#secretanswer")[0].setDataValue("");$(this).unbind('focus',password_secretanswerFocus);password_enableDisableWigets();}
function password_checkSecretAnswer(){var secretAnswer=$("#secretanswer")[0].getDataValue();var isCorrect=secretAnswer.length>0;return isCorrect;}
function password_enableDisableWigets(){var allPasswordsCorrect=password_checkCurrent()&&password_checkNew()&&password_checkConfirm();var secretquery=$("#secretquery")[0].getDataValue();var secretqueryCorrect=false;if(secretquery.length>0){secretqueryCorrect=true;}
var secretanswer=$("#secretanswer")[0].getDataValue();var secretanswerCorrect=false;if(password_checkSecretAnswer()){secretanswerCorrect=true;}
var allCorrect=allPasswordsCorrect&&secretanswerCorrect&&secretqueryCorrect;if(allPasswordsCorrect){$("#secretquery").setDisabled(false);$("#secretanswer").setDisabled(false);}else{$("#secretquery").setDisabled(true);$("#secretanswer").setDisabled(true);}
if(allCorrect){$('#btnSave').setDisabled(false);}else{$('#btnSave').setDisabled(true);}
if($("#currentpassword input[type='password']").val()!=""||$("#newpassword input[type='password']").val()!=""||$("#newpasswordconfirm input[type='password']").val()!=""){$('#btnCancel').setDisabled(false);}else{$('#btnCancel').setDisabled(true);}}
jQuery.orange.config.areacontent.password={preParse:function(){$("#username").html(jQuery.orange.config.api.client.user);$("#secretquery").attr('dataId','Device/UserAccounts/ManagedUsers/ManagedUser[Login=\''+jQuery.orange.config.api.client.user+'\']/SecretQuery');var XsecretQuery="Device/UserAccounts/ManagedUsers/ManagedUser[Login=\'"+jQuery.orange.config.api.client.user+"\']/SecretQuery";jQuery.orange.config.api.crud.read([XsecretQuery],function(result){for(var secretQ in result[XsecretQuery].values){if(result[XsecretQuery].values[secretQ]==""||result[XsecretQuery].values[secretQ]==undefined||result[XsecretQuery].values[secretQ]==null){var id2value={};id2value[XsecretQuery]=jQuery.orange.config.i18n.map["page.myAccount.password.secretquery.defaultcontent"];jQuery.orange.config.api.crud.update(id2value);}}});},postParse:function(){$("#help").bind("click",function(){helpPopup("html/main/help_password.html");});$("#secretquery").setDisabled(true);$("#secretanswer").setDisabled(true);$("#secretanswer").bind("keydown",function(){$("#secretanswer").attr("required",true);$("#secretanswer").orangeParse();$("#secretanswer").orangeTranslate();});$("#currentpassword input[type='text']").bind("blur",function(){password_checkCurrent(false);});$("#currentpassword").bind('valueChange',function(){password_checkCurrent(true);password_enableDisableWigets();});$("#newpassword").bind('valueChange',function(){password_checkNew(true);password_checkConfirm(true);password_enableDisableWigets();});$("#newpassword input[type='text']").bind('blur',function(event){password_checkNew(false);});$("#newpasswordconfirm").bind('valueChange',function(){password_checkConfirm(true);password_enableDisableWigets();});$("#newpasswordconfirm input[type='text']").bind('blur',function(){password_checkConfirm(false);});$("#currentpassword input[type='text']").bind('focus',function(){password_checkConfirm(false);});$("#currentpassword, #newpassword, #newpasswordconfirm").bind('valueChange',function(){if($("#currentpassword input[type='text']").val()!=""||$("#newpassword input[type='text']").val()!=""||$("#newpasswordconfirm input[type='text']").val()!=""){$("#saveOkNoSecure").css('display','none');$("#saveOkSecure").css('display','none');}});$("#secretanswer").bind('valueChange change keyup',function(){password_checkSecretAnswer();password_enableDisableWigets();});$("#secretquery").bind('valueChange change keyup',function(){password_enableDisableWigets();});$("#secretanswer input[type='text']").bind('focus',password_secretanswerFocus);$('#btnSave').bind('click',function(){$('#btnCancel').setDisabled(true);$("#secretanswer input[type='text']").bind('focus',password_secretanswerFocus);});$('#btnCancel').bind('click',function(){$("#currentpassword input[type='password']").val("");$("#currentpassword input[type='text']").val("");$("#newpassword input[type='password']").val("");$("#newpassword input[type='text']").val("");$("#newpasswordconfirm input[type='password']").val("");$("#newpasswordconfirm input[type='text']").val("");$("#secretanswer input[type='text']").bind('focus',password_secretanswerFocus);$("#saveOkNoSecure").hide();$("#saveOkSecure").hide();$("#errorMsgNewDiff").hide();$("#errorMsgCurrentDiff").hide();$("#errorMsgLength").hide();$("#currentpassword").removeClass('errorInput');$("#newpassword").removeClass('errorInput');$("#newpasswordconfirm").removeClass('errorInput');$("#errorMsgLength").hide();$("#errorMsgNewDiff").hide();$("#errorMsgCurrentDiff").hide();$("#secretquery").setDisabled(true);$("#secretanswer")[0].setDataValue("");$("#secretanswer").setDisabled(true);$('#btnCancel').setDisabled(true);$('#btnSave').setDisabled(true);});$("#password form")[0].crudCallDelegate=function(crudExec){var id2value={};var Password='Device/UserAccounts/ManagedUsers/ManagedUser[Login=\''+jQuery.orange.config.api.client.user+'\']/Password';var hashPass=jQuery.orange.config.api.client.hashPassword($("#newpassword input[type='password']").val());id2value[Password]=hashPass;var xpathSecretAnswer='Device/UserAccounts/ManagedUsers/ManagedUser[Login=\''+jQuery.orange.config.api.client.user+'\']/SecretAnswer';if($("#secretanswer")[0].getDataValue()!='aaaaaaaaaaaaaaa'){id2value[xpathSecretAnswer]=$("#secretanswer")[0].getDataValue();}
jQuery.orange.config.api.crud.update(id2value,function(errors){var isError=false;for(var e in errors){if(e!=undefined&&e==Password){isError=true;}}
if(!isError){jQuery.orange.config.api.client._md5Pass=hashPass;if($("#memoryCardStatus")[0].getDataValue()!='NOT_PRESENT'&&$("#password_newpassword")[0].getDataValue()!="admin"){$("#saveOkSecure").css('display','block');$("#saveOkNoSecure").css('display','none');}else{$("#saveOkSecure").css('display','none');$("#saveOkNoSecure").css('display','block');}}else{alert("Erreur lors du changement de mot de passe");}
$("#currentpassword input[type='text']").val("");$("#currentpassword input[type='password']").val("");$("#newpassword input[type='text']").val("");$("#newpassword input[type='password']").val("");$("#newpasswordconfirm input[type='text']").val("");$("#newpasswordconfirm input[type='password']").val("");$("#secretquery").setDisabled(true);$("#secretanswer").setDisabled(true);$("#errorMsgNewDiff").hide();$("#errorMsgCurrentDiff").hide();$("#errorMsgLength").hide();$("#currentpassword").removeClass('errorInput');$("#newpassword").removeClass('errorInput');$("#newpasswordconfirm").removeClass('errorInput');crudExec();});};$("#currentpassword input").attr('size','36');$("#currentpassword input").css('width','150px');$("#newpassword input").attr('size','36');$("#newpassword input").css('width','150px');$("#newpasswordconfirm input").attr('size','36');$("#newpasswordconfirm input").css('width','150px');$("#secretquery").attr('size','73');$("#secretquery").css('width','250px');$("#secretanswer input").attr('size','73');$("#secretanswer input").css('width','250px');$("#secretanswer")[0].setDataValue("aaaaaaaaaaaaaaa");$("#secretanswer input[type='text']").bind("focus",password_secretanswerFocus);}};jQuery.orange.config.areacontent.preference={postLoad:function(){$("#help").bind("click",function(){helpPopup("html/main/help_preference.html");});$("#preference select").attr('i18n','page.myAccount.preferences.timeoutconfig.timeout').parent().orangeParse();currentsessiontimeout=$("#preference select")[0].dataValueRef;var val;$("#preference select option").each(function(){if($(this)[0].dataValue==currentsessiontimeout){val=$(this).attr('value');}});$("#preference select").val(val);$("#preference select").trigger('valueChange');}};jQuery.orange.config.areacontent.distantAccess={preParse:function(area){area.popupOnUnsubmitted=true;$("#userremoteaccess").attr('dataId','Device/UserAccounts/ManagedUsers/ManagedUser[Login=\'remote\']/RemoteAccessMgt/UserRemoteAccess[@Service=\'HTTPS\']/Enabled');},postParse:function(){$("#userremoteaccess").bind("change",function(event,newValue){if(newValue!=undefined)
$("#port").setDisabled(!newValue);});$("#port").setDisabled(!$("#userremoteaccess input").attr('checked'));var DynDNSEnable="Device/DynamicDNS/DynDNS/Enable";jQuery.orange.config.api.crud.read([DynDNSEnable],function(result){$("#currenturl").empty();if(result[DynDNSEnable]!=undefined&&result[DynDNSEnable].values[DynDNSEnable]==true){$("#currenturl").append('https://<span dataId="Device/DynamicDNS/DynDNS/Name"/>:<span dataId="Device/UserInterface/RemoteAccess/RemoteHTTPSPort"/>');}
else{$("#currenturl").append('https://<span dataId="Device/Networks/WAN[@name=\'WAN\']/ExternalIPAddress"/>:<span dataId="Device/UserInterface/RemoteAccess/RemoteHTTPSPort"/>');}});},postLoad:function(area){$("#port").bind("keyup change",function(event){if(!$("#password")[0].getDataValue().length>=8){$("#btnSave").setDisabled(false);}
else{$("#btnSave").setDisabled(true);}});$("#userremoteaccess").bind("change",function(event){if($("#userremoteaccess")[0].getDataValue()&&$("#port").val().length<6){$("#btnSave").setDisabled(true);}});$("#help").bind("click",function(){helpPopup("html/main/help_distantAccess.html");});$("#password").attr('dataId','Device/UserAccounts/ManagedUsers/ManagedUser[Login=\'remote\']/Password');$("#password").orangeParse();$("#password").orangeTranslate();$("#port").bind("keyup change blur",function(event){var form=$("#distantAccess form")[0];var currentPortNode=$("#port");var currentPort=currentPortNode.val();$("#identicalPorterror").css('display','none');var oldState=jQuery.orange.widget.Form.getState.call(form);if(jQuery.orange.widget.Form.verifyConstraints(currentPortNode[0])){currentPortNode.removeClass('supErrorInput');form.dataKO.splice(arrayIndexOf2(form.dataKO,currentPortNode),1);}
var newState=jQuery.orange.widget.Form.getState.call(form);if(newState!=oldState){jQuery.orange.widget.Form.onStateChange.call(form,oldState,newState);}});$("#distantAccess form")[0].crudCallDelegate=function(crudExec){crudExec();var id2value={};var Password='Device/UserAccounts/ManagedUsers/ManagedUser[Login=\'remote\']/Password';var hashPass=jQuery.orange.config.api.client.hashPassword($("#password input[type='password']").val());if($("#password")[0].getDataValue()!='softeam.1'){id2value[Password]=hashPass;}
jQuery.orange.config.api.crud.update(id2value,function(errors){});};$("#annuler").bind('click',function(){area.popupOnUnsubmitted=false;$("#content").orangeLoad(menu.mapping.accountdistantAccess);});}};jQuery.orange.config.areacontent.forgetPassword1={preParse:function(){installation_toggleDisplay(false);},postParse:function(){$("#cancelBtn").add("#validateBtn").setDisabled(true);$("#SecretAnswer").bind("change keyup",function(){$("#cancelBtn").add("#validateBtn").setDisabled($("#SecretAnswer").val()=="");});$("#backBtn").click(function(){$("#global").orangeLoad(menu.mapping.home);installation_toggleDisplay(true);});$("#cancelBtn").click(function(){$("#SecretAnswer").val("");$("#SecretAnswer").trigger("change");$(".error").hide();});$("#validateBtn").click(function(){jQuery.orange.config.api.rpc.checkSecretAnswer("admin",$("#SecretAnswer").val(),function(obj){if(obj!=undefined&&obj.match==true){$(".error").hide();$('#authDialog').dialog('close');jQuery.orange.config.api.authorization.login("admin","admin",function(connected){if(connected){$("#authDialog").orangeLoad(menu.mapping.forgetPassword2,{LOGIN:"admin"});$("#authDialog").dialog({autoOpen:true,modal:true,width:"500px",minHeight:"200px",open:function(){jQuery.orange.widget.Form.alignFormInputs.call($("#forgetPassword2 form")[0]);}});}});}
else{$(".error").show();}});});$("#forgetPassword1>a.close").bind("click",function(){$("#authDialog").dialog('close');$("#global").orangeLoad(menu.mapping.home);installation_toggleDisplay(true);});},postLoad:function(){$("#failedpassLenght").hide();$("#failedpassCheck").hide();}};function forgetPassword_checkPassword(){if(($("#newPassword").val().length>=4&&$("#newPassword").val().length<=32)&&$("#newPassword").val()==$("#confirmNewPassword").val())
{$("#validateBtn").setDisabled(false);}
else{$("#validateBtn").setDisabled(true);}
if($("#newPassword").val().length>=4&&$("#newPassword").val().length<=32)
{$("#failedpassLenght").hide();}else{$("#failedpassLenght").show();}
if($("#newPassword").val()==$("#confirmNewPassword").val()){$("#failedpassCheck").hide();}else{$("#failedpassCheck").show();}}
jQuery.orange.config.areacontent.forgetPassword2={postParse:function(){$("#cancelBtn").add("#validateBtn").setDisabled(true);$("#newPassword").bind("change keyup",function(){if($("#newPassword").val()!=""){$("#cancelBtn").setDisabled(false);forgetPassword_checkPassword();}else if($("#newPassword").val()==""&&$("#confirmNewPassword").val()==""){$("#cancelBtn").setDisabled(true);$("#validateBtn").setDisabled(true);}});$("#confirmNewPassword").bind("change keyup",function(){if($("#confirmNewPassword").val()!=""){$("#cancelBtn").setDisabled(false);forgetPassword_checkPassword();}else if($("#newPassword").val()==""&&$("#confirmNewPassword").val()==""){$("#cancelBtn").setDisabled(true);$("#validateBtn").setDisabled(true);}});$("#backBtn").click(function(){$("#global").orangeLoad(menu.mapping.home);installation_toggleDisplay(true);});$("#cancelBtn").click(function(){$("#newPassword").val("");$("#confirmNewPassword").val("");$("#newPassword").trigger("change");$("#confirmNewPassword").trigger("change");});$("#validateBtn").click(function(){var Password="Device/UserAccounts/ManagedUsers/ManagedUser[Login='admin']/Password";var id2value={};var hashPass=jQuery.orange.config.api.client.hashPassword($("#confirmNewPassword").val());id2value[Password]=hashPass;jQuery.orange.config.api.crud.update(id2value,function(){$('#authDialog').dialog('close');$('#isConnected').show();$("#global").orangeLoad(menu.mapping.home);installation_toggleDisplay(true);});});$("#forgetPassword2>a.close").bind("click",function(){$("#authDialog").dialog('close');$("#global").orangeLoad(menu.mapping.home);installation_toggleDisplay(true);});}};function auth_grayBtn(){var grayBtn=$('#uLogin').val()==""||$('#uPassword').val()=="";$('#btnAuth').setDisabled(grayBtn);if(grayBtn){$('#btnAuth > img ').attr('src','theme/webCorporate/image/fr/btn_seconnecter_off.gif');}else{$('#btnAuth > img ').attr('src','theme/webCorporate/image/fr/btn_seconnecter.gif');}}
function authentificationRemoteInit(callback){auth_grayBtn();$('#uLogin').focus();$('#uLogin').add($('#uPassword')).bind('keyup change',function(){auth_grayBtn();});$('#uLogin').add($('#uPassword')).bind('keypress',function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(keycode==13&&($('#btnAuth').attr('disabled')==undefined||$('#btnAuth').attr('disabled')==false)){$('#btnAuth').trigger('click');}});$('#btnAuth').bind("click",function(){authenticate(callback);});}
function authenticate(callback){uLogin=$("#uLogin").val();uPassword=$("#uPassword").val();jQuery.orange.config.api.authorization.login(uLogin,uPassword,function(connected){if(!connected){$('#failedAuthMsg').removeClass('hidden');return false;}else{$('#failedAuthMsg').removeClass('hidden');}
callback(true);$("#authDialog").dialog('close');lastActionTime=new Date().getTime();});};