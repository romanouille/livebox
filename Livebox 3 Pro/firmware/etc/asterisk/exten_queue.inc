exten => start,1,GotoIf($["${DB(${CALLERID(num)}/PhoneLockEnable)}" = "1"]?hangup:)
same => n,GotoIf($[$[${REGEX("${ARG1}" ${forwards})}] & $["${EXISTS(${BLINDTRANSFER})}"="0"] ]?VM:)
same => n, NoOp(********* ${CDR(groupexten)} *********)
same => n,Set(CDR(groupexten)=${ARG1})
same => n,Set(forwards=${forwards} ${ARG1})
same => n,GotoIf($[ $["${DB(Call_Forward/${ARG1}/CallForwardUnconditionalEnable)}"="1"] ]?:test_FM)
same => n,GotoIf($["${DB(Call_Forward/${ARG1}/CallForwardUnconditionalNumber)}" = "${ARG1}"]?test_FM:)
same => n,GotoIf($["${DB(Call_Forward/${ARG1}/CallForwardUnconditionalNumber)}" = "${CALLERID(num)}"]?:test_1)
same => n,GotoIf($[${FIELDQTY(forwards, )} = 2]?:VM)
same => n,Goto(normal_process)
same => n(test_1),GotoIf(${REGEX("${DB(Call_Forward/${ARG1}/CallForwardUnconditionalNumber)}" ${forwards})}?play_busy:next_check)
same => n(play_busy),Macro(playback,3,number-is-now,busy,retry-later)
same => n(hangup),hangup()

same => n(next_check),GotoIf($[ "${VALID_EXTENSION(${DB(${ARG1}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG1}/CallForwardUnconditionalNumber)},1,Macro,Permit)}"="0" ]?:continue)
same => n,GotoIf($[ "${VALID_EXTENSION(${DB(${ARG1}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG1}/CallForwardUnconditionalNumber)},1,Macro,Denied)}"="0" ]?continue:)

same => n,GotoIf($[${FIELDQTY(forwards, )} = 2]?VM:)
same => n,Macro(voicemail,${ARG1})

same => n(continue),Goto(${DB(${ARG1}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG1}/CallForwardUnconditionalNumber)},1)

same => n(test_FM),GotoIf($["${this_is_followme}"="1"]?:test_DND)
same => n,Set(ARG3=${ARG5})
same => n,Goto(normal_process)
same => n(test_DND),GotoIf($[ $["${DB(Call_Forward/${ARG1}/DoNotDisturbEnable)}"="1"] ]?:test_CFNR)
same => n(VM),Macro(exist_voicemail,${forwards:-3})
same => n(test_CFNR),Set(CFNR=${IF($[ $["${DB(Call_Forward/${ARG1}/CallForwardOnNoAnswerEnable)}"="1"] & $["${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)}" != "${ARG1}"] ]?1:0)})

same => n(normal_process),Set(group_members=${DB(group/${ARG1}/activated)})
same => n,Goto(${ARG2})
same => n(Simultaneous),GoSub(Sub_Simultaneous,start,1(${group_members},${ARG3},${ARG1}))
same => n,Return()
same => n(Cyclic),GoSub(Sub_Cyclic,start,1(${group_members},${ARG3},${ARG4},${ARG1}))
same => n,Return()
same => n(Hierarchic),GoSub(Sub_Hierarchic,start,1(${ARG3},${ARG4},${ARG1}))
same => n,Return()

[Sub_Simultaneous]
exten => start,1,Set(queue_members=${ARG1})
;same => n,GotoIf(${REGEX("SIP/${CALLERID(num)}" ${ARG1})}?create_queue:dial_queue)
same => n(create_queue),Set(count_members=${FIELDQTY(group_members,&)})
same => n,Set(i=1)
same => n,While($[ ${i} < $[${count_members}+1] ])
same => n,Set(member=${CUT(group_members,\&,${i})})
same => n,Set(exten_member=${CUT(member,\/,2)})
same => n,GotoIf($[$["${member}"="SIP/${CALLERID(num)}"] | $[ $["${DB(${exten_member}/CallWaitingEnable)}"="0"] & $["${DEVICE_STATE(${member})}"="INUSE"] ] |$["${DEVICE_STATE(${member})}"="UNKNOWN"] | $["${DEVICE_STATE(${member})}"="UNAVAILABLE"] | $["${DEVICE_STATE(${member})}"="BUSY"] ]?next_member)
same => n,Set(new_queue=${member}&${new_queue})
same => n(next_member),Set(i=$[${i} + 1])
same => n,EndWhile()
same => n(create_queue),Set(count_members=${FIELDQTY(new_queue,&)})
same => n,GotoIf($["${count_members}" = "0"]?return)
same => n,Set(new_queue=${CUT(new_queue,\&,-$[${count_members}-1])})
same => n,NoOp(${new_queue})
same => n,Set(queue_members=${new_queue})
same => n(dial_queue),GotoIf($["${this_is_followme}"="1"]?set_MH:)   
same => n,SIPRemoveHeader(Diversion:)
same => n,SIPAddHeader(Diversion: "${DB(${ARG3}/ExtensionName)}"<sip:${ARG3}@192.168.2.1>\;reason=unconditional\;privacy=off\;screen=yes)

same => n,NoOp(PRINT FORWARD TRUNK ${ARG1}  *${forwards}*  testtttttttttttt )

same => n,GotoIf($[ $["${FIELDQTY(forwards, )}"="3"] & $["${DB(Call_Forward/${forwards:1:3}/CallForwardUnconditionalEnable)}"="1"]  ]?:check_call)
same => n,GotoIf($["${DB(RingBack_USER/${forwards:1:3}/Enable)}"="1"]?ModeUser:verify_RBTrunk)
same => n(ModeUser),Set(MOH=m(${forwards:1:3}))
same => n(Mode_2),Set(SIP_CODEC=g729)
same => n,Answer()
same => n,Wait(1)
same => n,Goto(dial)
same => n(check_call),GotoIf($[ "${FIELDQTY(forwards, )}">"2" ]?dial:)

same => n(verify_RBTrunk),GotoIf($[ $[${RING_BACK}=0] | $["${is_incomingCall}"!="1"] ]?RingBack_NotActivated:RingBack_Activated)   
same => n(RingBack_Activated),Set(MOH=m(ringback))
same => n,GotoIf($[${RING_BACK}=1]?Delayed_RB:Simultanoues_RB)
same => n(Delayed_RB),Answer(1000)
same => n,Wait(1)
same => n,Macro(playback,1,/usr/lib/asterisk/customer/ringback/trunk/RingBackTrunkFileName)
same => n,Goto(RingBack_NotActivated)
same => n(Simultanoues_RB),Answer()
same => n,Wait(1)
same => n(RingBack_NotActivated),Goto(dial)
same => n(set_MH),Set(MOH=m(default))

same => n(dial),GotoIf($[${EXISTS(${BLINDTRANSFER})}]?:No-BlindTransfer)
same => n,Set(MOH=${IF($[ $[ "${REGEX("trunk" ${REFERED_CHANNEL})}"="1" ] | $["${is_incomingCall}"="1"]]?m(default):)})
same => n(No-BlindTransfer),GotoIf($[ $["${DB(Trunk/GeneralRinger)}"="0"] | $["${is_incomingCall}"!="1"] ]?No_GeneralRingerGroup:)
same => n,Set(CallGeneralRinger=Local/GRCall@GeneralRinger_1&)
same => n,Set(CallPrincipalGeneralRinger=Local/PrincipalCall@GeneralRinger_2)
same => n,Set(_PrincipalNumber=${queue_members})
same => n,Set(_GRNumber=SIP/${DB(Trunk/GeneralRinger)})
same => n,Dial(${CallGeneralRinger}${CallPrincipalGeneralRinger},${ARG2},${MOH}c)
same => n,Goto(test_status_group)

same => n(No_GeneralRingerGroup),Dial(${queue_members},${ARG2},${MOH}c)
same => n(test_status_group),GotoIf($["${this_is_followme}"="1"]?return:)
same => n,GotoIf($[ "${DIALSTATUS}"="NOANSWER" ]?:test_busy)
same => n,GotoIf($[ "${CFNR}"="1" ]?:return)
same => n,GotoIf($[ $["${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)}"="${CALLERID(num)}"] | $["${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)}"="${ARG3}"] ]?return)
same => n,GotoIf(${REGEX("${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)}" ${forwards})}?play_busy)

same => n,GotoIf($[ "${VALID_EXTENSION(${DB(${ARG3}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)},1,Macro,Permit)}"="0" ]?:continue)
same => n,GotoIf($[ "${VALID_EXTENSION(${DB(${ARG3}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)},1,Macro,Denied)}"="0" ]?continue:)

same => n,GotoIf($[${FIELDQTY(forwards, )} = 2]?VM:)
same => n,Macro(voicemail,${ARG3})

same => n(continue),Goto(${DB(${ARG3}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)},1)

same => n(test_busy),GotoIf($[ "${DIALSTATUS}"="BUSY" ]?return:hangup)
same => n(return),Return()
same => n,hangup()
same => n(play_busy),Macro(playback,3,number-is-now,busy,retry-later)
same => n(hangup),hangup()
same => n(VM),Macro(exist_voicemail,${forwards:-3})
same => n,hangup()

[Sub_Cyclic]
exten => start,1,Set(count_members=${FIELDQTY(group_members,&)})
same => n,Set(count_all_members=${FIELDQTY(DB(members_group/${ARG4}),&)})
same => n,Set(i=1)
same => n,While($[ ${i} < $[${count_members}+1] ])
same => n,Set(one_member=${CUT(group_members,\&,${i})})
same => n,Set(exten_member=${CUT(one_member,\/,2)})
same => n,GotoIf( $["${DB(${exten_member}/CallWaitingEnable)}"="1"]?:next_one)
same => n,Set(CW_ok=1)
same => n,ExitWhile() 
same => n(next_one),Set(i=$[${i} + 1])
same => n,EndWhile()
same => n,GotoIf( $["${CW_ok}"="1"]?:return)
same => n,Set(i=1)
same => n,While($[ ${i} < $[${count_members}+1] ])
same => n,Set(test_member=${CUT(group_members,\&,${i})})
same => n,GotoIf($[$["${test_member}"="SIP/${CALLERID(num)}"] | $["${DEVICE_STATE(${test_member})}"="UNKNOWN"] | $["${DEVICE_STATE(${test_member})}"="UNAVAILABLE"]]?:no_problem)
same => n,Set(i=$[${i} + 1])
same => n,EndWhile()
same => n,GotoIf($[ "${exit_while}"="1" ]?next_while:)
same => n,Return()                                                  
same => n(no_problem),Set(exit_while=1)                                                                               
same => n,ExitWhile()                                        
same => n(next_while),Set(order_member=0)
same => n,Set(exit=0)
same => n,set(time_remaining=${ARG2})
same => n,Set(exit=$[${IF($[${time_remaining} <= 0]?1:0)}])
same => n,While($[${exit}=0])
same => n,Set(order_member=${MATH(${order_member}+1,i)})
same => n,Set(order_member=${IF($[${order_member}>=${count_members}]?1:${order_member})})
same => n,Set(member=${CUT(group_members,\&,${order_member})})
same => n,GotoIf($[ "${CUT(DB(last_called/${ARG4}),\#,3)}"="${DB(members_group/${ARG4})}" ]?new_called:continue)
same => n(new_called),Set(pos_last_called=${CUT(DB(last_called/${ARG4}),\#,2)})
same => n,Set(found_activ=0)
same => n,While( $[ "${found_activ}" != "1" ] )
same => n,Set(pos_last_called=${MATH(${pos_last_called}+1,i)})
same => n,Set(pos_last_called=${IF($[ "${count_all_members}" <="${pos_last_called}" ]?1:${pos_last_called})})
same => n,Set(member=${CUT(DB(members_group/${ARG4}),\&,${pos_last_called} )})
same => n,Set(found_activ=${IF($[ ${REGEX("${member}" ${group_members})} ]?1:0)})
same => n(end_while),EndWhile()
same => n,GoSub(sub_find_position,start,1(${group_members},${member}))
same => n,Set(order_member=${position})
same => n(continue),Set(go_to_next=${IF($[ $["${member}"="SIP/${CALLERID(num)}"] | $["${DEVICE_STATE(${member})}"="UNKNOWN"] | $["${DEVICE_STATE(${member})}"="UNAVAILABLE"]]?1:0)})
same => n,GoSub(sub_find_position,start,1(${DB(members_group/${ARG4})},${member}))
same => n,Set(DB(last_called/${ARG4})=${member}#${position}#${DB(members_group/${ARG4})})
same => n,GotoIf($["${go_to_next}"="1"]?next_member)
same => n,Set(time_start_queue=${EPOCH})
same => n,GotoIf($["${this_is_followme}"="1"]?set_MH:)
same => n,SIPRemoveHeader(Diversion:)
same => n,SIPAddHeader(Diversion: "${DB(${ARG4}/ExtensionName)}"<sip:${ARG4}@192.168.2.1>\;reason=unconditional\;privacy=off\;screen=yes)

same => n,NoOp(PRINT FORWARD TRUNK ${ARG1}  *${forwards}*  testtttttttttttt ${MOH})
same => n,GotoIf($[ "${EXISTS(${MOH})}"="1"]?dial:)
same => n,GotoIf($[ $["${FIELDQTY(forwards, )}"="3"] & $["${DB(Call_Forward/${forwards:1:3}/CallForwardUnconditionalEnable)}"="1"] ]?:check_call)
same => n,GotoIf($["${DB(RingBack_USER/${forwards:1:3}/Enable)}"="1"]?ModeUser:verify_RBTrunk)
same => n(ModeUser),Set(MOH=m(${forwards:1:3}))
same => n(Mode_2),Set(SIP_CODEC=g729)
same => n,Answer()
same => n,Wait(1)
same => n,Goto(dial)
same => n(check_call),GotoIf($[ "${FIELDQTY(forwards, )}">"2" ]?dial:)

same => n(verify_RBTrunk),GotoIf($[ $[${RING_BACK}=0] | $["${is_incomingCall}"!="1"] ]?RingBack_NotActivated:RingBack_Activated)   
same => n(RingBack_Activated),Set(MOH=m(ringback))
same => n,GotoIf($[${RING_BACK}=1]?Delayed_RB:Simultanoues_RB)
same => n(Delayed_RB),Answer(1000)
same => n,Wait(1)
same => n,Macro(playback,1,/usr/lib/asterisk/customer/ringback/trunk/RingBackTrunkFileName)
same => n,Goto(RingBack_NotActivated)
same => n(Simultanoues_RB),Answer()
same => n,Wait(1)
same => n(RingBack_NotActivated),Goto(dial)
same => n(set_MH),Set(MOH=m(default))
same => n(dial),Set(exten_member=${CUT(member,\/,2)})
same => n,GotoIf( $[$["${DB(${exten_member}/CallWaitingEnable)}"="0"] & $["${DEVICE_STATE(${member})}"="INUSE"] | $["${DEVICE_STATE(${member})}"="BUSY"] ]?next_member)
same => n,GotoIf($["${old_member}"="${member}"]?exit_busy:clean)
same => n(exit_busy),ExitWhile()
same => n(clean),Set(old_member=)

same => n,GotoIf($[${EXISTS(${BLINDTRANSFER})}]?:No-BlindTransfer)
same => n,Set(MOH=${IF($[ $[ "${REGEX("trunk" ${REFERED_CHANNEL})}"="1" ] | $["${is_incomingCall}"="1"]]?m(default):)})
same => n(No-BlindTransfer),GotoIf($[ $["${DB(Trunk/GeneralRinger)}"="0"] | $["${is_incomingCall}"!="1"] ]?No_GeneralRingerGroup:)
same => n,Set(CallGeneralRinger=Local/GRCall@GeneralRinger_1&)
same => n,Set(CallPrincipalGeneralRinger=Local/PrincipalCall@GeneralRinger_2)
same => n,Set(_PrincipalNumber=${member})
same => n,Set(_GRNumber=SIP/${DB(Trunk/GeneralRinger)})
same => n,Dial(${CallGeneralRinger}${CallPrincipalGeneralRinger},${ARG3},${MOH}c)
same => n,Goto(test_status_group)
same => n(No_GeneralRingerGroup),Dial(${member},${ARG3},${MOH}c)

same => n(test_status_group),Goto(${DIALSTATUS})
same => n(BUSY), Set(old_member=${member})
same => n,Set(time_dialing=${MATH(${EPOCH}-${time_start_queue},i)})
same => n,Set(time_remaining=${MATH(${time_remaining}-${time_dialing},i)})
same => n,Goto(next_member)
same => n(NOANSWER),Set(time_remaining=${MATH(${time_remaining}-${ARG3},i)})
same => n,Goto(next_member)
same => n(CHANUNAVAIL),Goto(next_member)
same => n(CANCEL),hangup()
same => n(ANSWER),hangup()
same => n(CONGESTION),hangup()
same => n(next_member),Set(exit=$[${IF($[${time_remaining} <= 0]?1:0)}])
same => n,Set(order_member=${IF($[${order_member}=${count_members}]?0:${order_member})})
same => n,EndWhile()
same => n,GotoIf($["${this_is_followme}"="1"]?return:)
same => n,GotoIf($[ "${DIALSTATUS}"="NOANSWER" ]?:test_busy)
same => n,GotoIf($[ "${CFNR}"="1" ]?:return)
same => n,GotoIf($["${DB(Call_Forward/${ARG4}/CallForwardOnNoAnswerNumber)}"="${CALLERID(num)}" ]?return)
same => n,GotoIf(${REGEX("${DB(Call_Forward/${ARG4}/CallForwardOnNoAnswerNumber)}" ${forwards})}?play_busy)

same => n,GotoIf($[ "${VALID_EXTENSION(${DB(${ARG4}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG4}/CallForwardOnNoAnswerNumber)},1,Macro,Permit)}"="0" ]?:continue_Forward)
same => n,GotoIf($[ "${VALID_EXTENSION(${DB(${ARG4}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG4}/CallForwardOnNoAnswerNumber)},1,Macro,Denied)}"="0" ]?continue_Forward:)

same => n,GotoIf($[${FIELDQTY(forwards, )} = 2]?VM:)
same => n,Macro(voicemail,${ARG3})

same => n(continue_Forward),Goto(${DB(${ARG4}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG4}/CallForwardOnNoAnswerNumber)},1)
same => n(test_busy),GotoIf($[ "${DIALSTATUS}"="BUSY" ]?return:hangup)
same => n(return),Return()
same => n(hangup),hangup()
same => n(play_busy),Macro(playback,3,number-is-now,busy,retry-later)
same => n(hangup),hangup()
same => n(VM),Macro(exist_voicemail,${forwards:-3})
same => n,hangup()

[Sub_Hierarchic]
exten => start,1,Set(count_members=${FIELDQTY(group_members,&)})
same => n,Set(i=1)
same => n,While($[ ${i} < $[${count_members}+1] ])
same => n,Set(one_member=${CUT(group_members,\&,${i})})
same => n,Set(exten_member=${CUT(one_member,\/,2)})
same => n,GotoIf( $["${DB(${exten_member}/CallWaitingEnable)}"="1"]?:next_one)
same => n,Set(CW_ok=1)
same => n,ExitWhile()
same => n(next_one),Set(i=$[${i} + 1])
same => n,EndWhile()
same => n,GotoIf( $["${CW_ok}"="1"]?:return)
same => n,Set(order_member=0)
same => n,Set(exit=0)
same => n,set(time_remaining=${ARG1})
same => n,While($[${exit}=0])
same => n,Set(order_member=${MATH(${order_member}+1,i)})
same => n,Set(member=${CUT(group_members,\&,${order_member})})
same => n,GotoIf($[$["${member}"="SIP/${CALLERID(num)}"] | $["${DEVICE_STATE(${member})}"="UNKNOWN"] | $["${DEVICE_STATE(${member})}"="UNAVAILABLE"]]?next_member)
same => n,Set(time_start_queue=${EPOCH})
same => n,GotoIf($["${this_is_followme}"="1"]?set_MH:)
same => n,SIPRemoveHeader(Diversion:)
same => n,SIPAddHeader(Diversion: "${DB(${ARG3}/ExtensionName)}"<sip:${ARG3}@192.168.2.1>\;reason=unconditional\;privacy=off\;screen=yes)

same => n,NoOp(PRINT FORWARD TRUNK ${ARG1}  *${forwards}*  testtttttttttttt ${MOH})
same => n,GotoIf($[ "${EXISTS(${MOH})}"="1"]?dial:)
same => n,GotoIf($[ $["${FIELDQTY(forwards, )}"="3"] & $["${DB(Call_Forward/${forwards:1:3}/CallForwardUnconditionalEnable)}"="1"] ]?:check_call)
same => n,GotoIf($["${DB(RingBack_USER/${forwards:1:3}/Enable)}"="1"]?ModeUser:verify_RBTrunk)
same => n(ModeUser),Set(MOH=m(${forwards:1:3}))
same => n(Mode_2),Set(SIP_CODEC=g729)
same => n,Answer()
same => n,Wait(1)
same => n,Goto(dial)
same => n(check_call),GotoIf($[ "${FIELDQTY(forwards, )}">"2" ]?dial:)

same => n(verify_RBTrunk),GotoIf($[ $[${RING_BACK}=0] | $["${is_incomingCall}"!="1"] ]?RingBack_NotActivated:RingBack_Activated)   
same => n(RingBack_Activated),Set(MOH=m(ringback))
same => n,GotoIf($[${RING_BACK}=1]?Delayed_RB:Simultanoues_RB)
same => n(Delayed_RB),Answer(1000)
same => n,Wait(1)
same => n,Macro(playback,1,/usr/lib/asterisk/customer/ringback/trunk/RingBackTrunkFileName)
same => n,Goto(RingBack_NotActivated)
same => n(Simultanoues_RB),Answer()
same => n,Wait(1)
same => n(RingBack_NotActivated),Goto(dial)
same => n(set_MH),Set(MOH=m(default))
same => n(dial),Set(exten_member=${CUT(member,\/,2)})
same => n,GotoIf( $[$["${DB(${exten_member}/CallWaitingEnable)}"="0"] & $["${DEVICE_STATE(${member})}"="INUSE"] | $["${DEVICE_STATE(${member})}"="BUSY"]]?next_member)

same => n,GotoIf($[${EXISTS(${BLINDTRANSFER})}]?:No-BlindTransfer)
same => n,Set(MOH=${IF($[ $[ "${REGEX("trunk" ${REFERED_CHANNEL})}"="1" ] | $["${is_incomingCall}"="1"]]?m(default):)})
same => n(No-BlindTransfer),GotoIf($[ $["${DB(Trunk/GeneralRinger)}"="0"] | $["${is_incomingCall}"!="1"] ]?No_GeneralRingerGroup:)
same => n,Set(CallGeneralRinger=Local/GRCall@GeneralRinger_1&)
same => n,Set(CallPrincipalGeneralRinger=Local/PrincipalCall@GeneralRinger_2)
same => n,Set(_PrincipalNumber=${member})
same => n,Set(_GRNumber=SIP/${DB(Trunk/GeneralRinger)})
same => n,Dial(${CallGeneralRinger}${CallPrincipalGeneralRinger},${ARG2},${MOH}c)
same => n,Goto(test_status_group)
same => n(No_GeneralRingerGroup),Dial(${member},${ARG2},${MOH}c)

same => n(test_status_group),Goto(${DIALSTATUS})
same => n(BUSY),Set(time_dialing=${MATH(${EPOCH}-${time_start_queue},i)})
same => n,Set(time_remaining=${MATH(${time_remaining}-${time_dialing},i)})
same => n,Goto(next_member)
same => n(NOANSWER),Set(time_remaining=${MATH(${time_remaining}-${ARG2},i)})
same => n,Goto(next_member)
same => n(CHANUNAVAIL),Goto(next_member)
same => n(CANCEL),hangup()
same => n(ANSWER),hangup()
same => n(CONGESTION),hangup()
same => n(next_member),Set(exit=${IF($[ $[${order_member}=${count_members}] | $[${time_remaining} <= 0] ]?1:0)})
same => n,EndWhile()
same => n,GotoIf($["${this_is_followme}"="1"]?return:)
same => n,GotoIf($[ "${DIALSTATUS}"="NOANSWER" ]?:test_busy)
same => n,GotoIf($[ "${CFNR}"="1" ]?:return)
same => n,GotoIf($["${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)}"="${CALLERID(num)}" ]?return)
same => n,GotoIf(${REGEX("${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)}" ${forwards})}?play_busy)

same => n,GotoIf($[ "${VALID_EXTENSION(${DB(${ARG3}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)},1,Macro,Permit)}"="0" ]?:continue)
same => n,GotoIf($[ "${VALID_EXTENSION(${DB(${ARG3}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)},1,Macro,Denied)}"="0" ]?continue:)

same => n,GotoIf($[${FIELDQTY(forwards, )} = 2]?VM:)
same => n,Macro(voicemail,${ARG3})

same => n(continue),Goto(${DB(${ARG3}/CF_ProfileID_Group)},${DB(Call_Forward/${ARG3}/CallForwardOnNoAnswerNumber)},1)

same => n(test_busy),GotoIf($[ "${DIALSTATUS}"="BUSY" ]?return:hangup)
same => n(return),Return()
same => n(hangup),hangup()
same => n(play_busy),Macro(playback,3,number-is-now,busy,retry-later)
same => n(hangup),hangup()
same => n(VM),Macro(exist_voicemail,${forwards:-3})
same => n,hangup()

[sub_find_position]
exten=> start,1,Set(j=1)
same => n,Set(found=0)
same => n,While($["${found}"!="1"])
same => n,NoOp(${CUT(ARG1,\&,${j})}  ###  ${ARG2})
same => n,Set(found=$[${IF($[ "${CUT(ARG1,\&,${j})}"="${ARG2}" ]?1:0)}])
same => n,Set(j=$[${j} + 1])
same => n,NoOp(${j})
same => n,EndWhile()
same => n,Set(position=$[${j}-1])
same => n,Return()
