#!/bin/sh

source /usr/lib/transfers/transfer_functions.sh

#####################################################################################
# Defaults
#####################################################################################
TMPFILE="/etc/config/digitmap_tmp.xml"
CACERTFILE="/usr/lib/cwmp/cwmpdcerts.pem"

#####################################################################################
# Command line argument parsing
#####################################################################################
parse_command_line $*

#####################################################################################
# Call CURL to perform the download
#####################################################################################
transfer_file "--cacert $CACERTFILE -o $TMPFILE"

#####################################################################################
# Check if the downloaded file is valid
#####################################################################################
if [ ! -e "$TMPFILE" ]; then
   finish_transfer 9018 "Downloaded file does not exist"
   exit 1
fi

#####################################################################################
# Apply new digitmap before update transfer status
#####################################################################################
/bin/pcb_cli "NMC.applyDigitMap()"

#####################################################################################
# Update the status
#####################################################################################
finish_transfer 0 ""

exit 0

